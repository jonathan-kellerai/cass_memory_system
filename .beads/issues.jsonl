{"id":"bd-19eu","title":"Coverage audit + open gaps for cass-memory","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-21T09:42:36.790633692Z","created_by":"ubuntu","updated_at":"2026-01-21T17:15:07.323357855Z","closed_at":"2026-01-21T17:15:07.321821309Z","close_reason":"Updated GAP_ANALYSIS with coverage findings, added direct audit unit test, and opened follow-up bead for command unit tests","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-19eu","depends_on_id":"cass_memory_system-sdt1","type":"discovered-from","created_at":"2026-01-21T09:42:36.803727722Z","created_by":"ubuntu"}]}
{"id":"bd-2ruk","title":"FEATURE: cm robot-docs JSON (capabilities + examples)","description":"Problem: Agents need machine-readable CLI docs for cm beyond narrative README sections.\n\nGoal:\n- Add `cm robot-docs <topic>` or `cm --robot-docs` returning JSON/NDJSON.\n- Topics: guide (quickstart), commands (flag inventory), examples, exit-codes.\n- Ensure stdout is data-only and compatible with `--json` output conventions.\n\nAcceptance:\n- New command documented in README/AGENTS.\n- Includes version + schema_version metadata.\n- Provides copy-paste examples for cm context/onboard/playbook flows.","status":"open","priority":2,"issue_type":"feature","created_at":"2026-01-25T10:17:02.939306719Z","created_by":"ubuntu","updated_at":"2026-01-25T10:17:02.939306719Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["agent-friendly","docs","json"],"dependencies":[{"issue_id":"bd-2ruk","depends_on_id":"bd-56x","type":"discovered-from","created_at":"2026-01-25T10:17:02.939306719Z","created_by":"ubuntu"}]}
{"id":"bd-39k6","title":"Unit tests for command modules only covered by E2E (guard/init/mark/similar/starters/stats/trauma/usage)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-21T17:14:57.574755569Z","created_by":"ubuntu","updated_at":"2026-01-21T17:35:58.008158041Z","closed_at":"2026-01-21T17:35:58.007993281Z","close_reason":"Added unit tests for guard/init/mark/similar/starters/stats/trauma/usage with JSON validation coverage","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-39k6","depends_on_id":"bd-19eu","type":"discovered-from","created_at":"2026-01-21T17:14:57.669114659Z","created_by":"ubuntu"}]}
{"id":"bd-3orp","title":"Expand command unit tests for guard/init/similar JSON paths","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-21T19:08:54.260162065Z","created_by":"ubuntu","updated_at":"2026-01-21T19:08:58.724939803Z","closed_at":"2026-01-21T19:08:58.724884910Z","close_reason":"Added unit tests for guard --install missing .claude, init --repo outside git, and similar JSON success","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-3orp","depends_on_id":"cass_memory_system-sdt1.4.2","type":"discovered-from","created_at":"2026-01-21T19:08:54.300035122Z","created_by":"ubuntu"}]}
{"id":"bd-73k7","title":"Update all dependencies to latest stable versions","description":"Run /library-updater to update all dependencies to latest stable versions. Verify build, run tests, commit.","status":"open","priority":3,"issue_type":"task","created_at":"2026-02-11T06:20:26.222622437Z","created_by":"ubuntu","updated_at":"2026-02-11T06:20:26.222622437Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-vz6k","title":"TASK: cm --schema output for JSON schemas","description":"Problem: Integrations lack a canonical JSON schema for cm outputs (context, onboard status, quickstart).\n\nGoal:\n- Add `cm --schema` (or `cm robot-docs schemas`) that emits JSON Schema for core commands.\n- Provide a top-level map keyed by command name (context, quickstart, onboard status/sample/read, playbook add).\n- Include schema versioning.\n\nAcceptance:\n- Command returns JSON-only on stdout.\n- Schemas for context/quickstart/onboard status are complete and validated.\n- README updated with usage example.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-25T10:17:15.475608592Z","created_by":"ubuntu","updated_at":"2026-01-25T10:17:15.475608592Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["agent-friendly","json","schema"],"dependencies":[{"issue_id":"bd-vz6k","depends_on_id":"bd-56x","type":"discovered-from","created_at":"2026-01-25T10:17:15.475608592Z","created_by":"ubuntu"}]}
{"id":"cass_memory_system-02d8","title":"[Unit] llm.ts - LLM Client & Response Handling","description":"## Target: src/llm.ts - LLM Integration\n\n### Functions to Test:\n\n1. **createLLMClient(config)** - Client factory\n   - Creates Anthropic client\n   - Creates OpenAI client\n   - Validates API key presence\n   - Returns typed client\n\n2. **generateContext(prompt, options)** - Context generation\n   - Sends prompt to LLM\n   - Returns response text\n   - Handles rate limits\n   - Timeout handling\n\n3. **parseStructuredResponse(response, schema)** - Parse LLM JSON\n   - Valid JSON extracted\n   - Schema validation\n   - Partial response handling\n   - Markdown code block extraction\n\n4. **buildPrompt(template, variables)** - Prompt construction\n   - Variable substitution\n   - Escaping handled\n   - Missing variables error\n   - Template validation\n\n5. **estimateTokens(text)** - Token estimation\n   - Approximate count\n   - Handles Unicode\n   - Handles code blocks\n   - Returns conservative estimate\n\n6. **retryWithBackoff(fn, options)** - Retry logic\n   - Existing tests in test/retry.test.ts\n   - EXPAND coverage\n   - Verify exponential backoff\n   - Max retries respected\n\n### API Key Handling:\n- ANTHROPIC_API_KEY\n- OPENAI_API_KEY\n- Error when missing\n- Redaction in logs\n\n### Mock-Free Testing Strategy:\n- Test pure functions without API calls\n- Integration tests hit real API (separate suite)\n- Use test API keys for CI\n- Skip gracefully when no keys","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-08T01:28:41.264474Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-02d8","depends_on_id":"cass_memory_system-mmxv","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"},{"issue_id":"cass_memory_system-02d8","depends_on_id":"cass_memory_system-uufj","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"}]}
{"id":"cass_memory_system-02tu","title":"Improve test coverage for curate.ts","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-08T02:09:31.845458Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-05x","title":"[Cass] CASS_EXIT_CODES constant - Error code mapping","description":"Define CASS_EXIT_CODES constant for intelligent error recovery.\n\n## Signature\n```typescript\nconst CASS_EXIT_CODES: Record<number, { \n  name: string; \n  retryable: boolean; \n  action?: string \n}>\n```\n\n## Exit Code Mapping\n- 0: { name: \"success\", retryable: false }\n- 2: { name: \"usage_error\", retryable: false }\n- 3: { name: \"index_missing\", retryable: true, action: \"rebuild_index\" }\n- 4: { name: \"not_found\", retryable: false }\n- 5: { name: \"idempotency_mismatch\", retryable: false }\n- 9: { name: \"unknown\", retryable: false }\n- 10: { name: \"timeout\", retryable: true, action: \"reduce_limit\" }\n\n## Purpose\nUsed throughout cass wrapper functions to determine:\n- Whether an operation should be retried\n- What recovery action to take (rebuild index, reduce limit, etc.)\n- How to classify errors for user feedback\n\n## Implementation Notes\n- Export as const for type safety\n- Use in withCassErrorRecovery and individual wrapper functions\n- Document each exit code meaning in comments","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:44:52.768520Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-07rn","title":"Unit tests for tracking.ts - Session tracking","description":"Complete unit test coverage for tracking.ts:\n- Session tracking state management\n- Processed session recording\n- Session metadata extraction\n- Progress tracking APIs\n- Edge cases: concurrent access, corrupted state files\nNO MOCKS - use real temp directory fixtures","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-08T01:25:42.625455Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-07rn","depends_on_id":"cass_memory_system-ai52","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"}]}
{"id":"cass_memory_system-082i","title":"[P1] Add examples to all command help text","description":"# Task: Add Examples to Help Text\n\n## Problem\nHelp text lacks practical examples:\n```\ncm context [options] <task>\n  -j, --json           Output JSON\n  --format <fmt>       Force output format\n  ...\n```\n\nUser doesn't know: What does a typical invocation look like?\n\n## Solution\n\n### Add Examples Section\n```\ncm context [options] <task>\n\nOptions:\n  -j, --json           Output JSON\n  --format <fmt>       Force output format (markdown|json)\n  --limit <n>          Max rules to return (default: 20)\n  ...\n\nExamples:\n  # Get context for a coding task\n  cm context \"implement user authentication\" --json\n\n  # Get context with semantic search disabled\n  cm context \"fix the login bug\" --no-semantic\n\n  # Get context for workspace only\n  cm context \"refactor utils\" --scope workspace\n\n  # Get top 5 most relevant rules\n  cm context \"write tests\" --limit 5\n```\n\n### Commands to Update (all with examples)\n- context: common task queries\n- reflect: batch vs single session\n- playbook: add, list, export, import\n- mark: helpful, harmful with reasons\n- doctor: check, fix, self-test\n- outcome: success, failure, mixed\n- why: full ID vs partial match\n- stats: with filters\n- All others\n\n## Implementation\nAdd .addHelpText('after', ...) to each command.\n\n## Files\n- All src/commands/*.ts (add examples)\n- Consider: shared example helper\n\n## Acceptance\n- [ ] Every command has 3-5 examples\n- [ ] Examples cover common use cases\n- [ ] Examples are copy-pasteable\n- [ ] Examples include both simple and advanced","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-16T15:33:15.419025Z","updated_at":"2025-12-17T03:59:44.845409Z","closed_at":"2025-12-17T03:59:44.845409Z","close_reason":"Added per-command Examples sections to CLI help (including subcommands) using commander addHelpText; verified help output and typechecked.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-082i","depends_on_id":"cass_memory_system-8zaj","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"}]}
{"id":"cass_memory_system-0dv","title":"[Curator] detectConflicts - Find contradictory rules","description":"Detect semantic conflicts between new and existing bullets using deterministic heuristics.\n\nSignature:\nfunction detectConflicts(\n  newContent: string,\n  existingBullets: PlaybookBullet[]\n): ConflictReport[]\n\nConflict detection heuristics:\n1. Negation conflict:\n   - Same category\n   - One contains 'never'/'don\\'t'/'avoid'\n   - Other is affirmative\n   - High word overlap (jaccard > 0.5)\n   \n2. Opposite sentiment:\n   - Same category\n   - One says 'always'/'must'/'required'\n   - Other says 'never'/'avoid'/'forbidden'\n   - Subject matter overlap\n   \n3. Explicit contradiction:\n   - Patterns like 'X is good' vs 'X is bad'\n   - 'Use X' vs 'Don\\'t use X'\n   \n4. Scope conflict:\n   - One is general, one is specific exception\n   - Example: 'Always validate input' vs 'Skip validation for trusted sources'\n\nFor each conflict found, create ConflictReport:\n- newBulletContent: the content being added\n- conflictingBulletId: existing bullet ID\n- conflictingContent: existing bullet content\n- reason: human-readable explanation\n\nImportant: Conflicts are WARNINGS, not blockers.\n- Still allows add (new bullet may be valid exception)\n- Reports conflicts in CurationResult\n- User/analyst can review and resolve\n\nThis prevents false positives while maintaining awareness.","notes":"Fixed lock staleness option bug: withLock now respects staleLockThresholdMs; added coverage","status":"tombstone","priority":3,"issue_type":"task","created_at":"2025-12-07T21:45:03.082308Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-0ede","title":"[Unit] tracking.ts - Feedback Event Management","description":"## Target: src/tracking.ts - Feedback Tracking\n\n### Functions to Test:\n\n1. **addFeedbackEvent(bullet, event)** - Add event to bullet\n   - Adds to feedbackEvents array\n   - Creates array if missing\n   - Validates event schema\n   - Timestamp added if missing\n   - Returns updated bullet\n\n2. **markHelpful(bullet, context?)** - Mark as helpful\n   - Adds helpful event\n   - Context stored if provided\n   - Timestamp is current time\n   - Idempotent (multiple calls OK)\n\n3. **markHarmful(bullet, context?)** - Mark as harmful\n   - Adds harmful event\n   - Context stored if provided\n   - Timestamp is current time\n   - Does NOT remove helpful events\n\n4. **getLastFeedback(bullet)** - Get most recent feedback\n   - Returns most recent event\n   - Handles empty events\n   - Handles missing events\n\n5. **getFeedbackCounts(bullet)** - Count feedback types\n   - Returns {helpful: N, harmful: M}\n   - Handles empty/missing events\n   - Efficient for large arrays\n\n6. **clearFeedback(bullet)** - Reset feedback\n   - Removes all events\n   - Returns updated bullet\n   - Preserves other fields\n\n### Event Schema Validation:\n- type: 'helpful' | 'harmful' only\n- timestamp: valid ISO string\n- context: optional string\n\n### Edge Cases:\n- Null/undefined bullet\n- Malformed feedbackEvents\n- Very large event arrays (1000+)\n- Events with identical timestamps","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-08T01:27:54.003462Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-0ede","depends_on_id":"cass_memory_system-mmxv","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"},{"issue_id":"cass_memory_system-0ede","depends_on_id":"cass_memory_system-uufj","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"}]}
{"id":"cass_memory_system-0ew","title":"Phase 2: Core Pipeline + Anti-Patterns","description":"# EPIC: Core Pipeline + Anti-Patterns\n\n## Purpose\nImplement the full diary → reflect → curate pipeline with anti-pattern learning.\nThis phase makes the system actually learn from agent sessions.\n\n## Background & Reasoning\nThe ACE paper's key insight is that LLM-generated rules can \"collapse\" if the LLM \nrewrites the entire playbook. The solution: deterministic curation that only applies\ndelta operations (add/helpful/harmful/replace/deprecate).\n\nThis phase also introduces anti-pattern inversion - when a bullet proves harmful \nmultiple times, instead of deleting it, we invert it to \"DON'T do X\" and mark it\nas kind=anti_pattern. This captures negative learnings.\n\n## Priority Features (from ROI analysis)\n- P3: Anti-pattern inversion (8× impact)\n- P5: Maturity states candidate/established/proven (5× impact)\n- P6: Cascading config global + .cass/ repo-level (4× impact)\n- P8: Forget command + toxic bullet log (3× impact)\n- P11: Evidence-count gate pre-LLM validation (8× impact)\n- P13: Doctor command system health (5× DX impact)\n\n## Key Deliverables\n1. `cass-memory diary <session>` - Generate structured diary from session\n2. `cass-memory reflect --days N` - Run full reflection cycle\n3. `cass-memory curate` - Apply deltas deterministically\n4. `cass-memory mark <id> --helpful/--harmful` - Record feedback\n5. `cass-memory forget <id>` - Permanently block toxic patterns\n6. `cass-memory doctor` - System health check\n\n## Critical Algorithms\n1. **Evidence-count gate**: Before sending to LLM validator, check if session\n   success/failure counts provide enough signal. If 5+ successes with 0 failures,\n   auto-accept. If 3+ failures with 0 successes, auto-reject.\n\n2. **Anti-pattern inversion**: When harmfulCount crosses threshold, transform\n   bullet from \"Use X for Y\" to \"AVOID: X causes Z problems when doing Y\"\n\n3. **Maturity state machine**:\n   - draft: <3 feedback events\n   - established: 3-10 helpful, <30% harmful\n   - proven: 10+ helpful, <10% harmful ratio\n   - retired: deprecated OR 30%+ harmful\n\n## Dependencies\n- Requires Phase 1 completion (types, config, cass wrapper)","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-07T21:16:41.288609Z","updated_at":"2025-12-14T00:12:09.635333Z","closed_at":"2025-12-14T00:12:09.635333Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-0ew","depends_on_id":"cass_memory_system-5eh","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"}]}
{"id":"cass_memory_system-0ew.1","title":"Diary Generation: cass-memory diary (Reflector Input)","description":"# Feature: Diary Generation Command\n\n## Purpose\nThe \"Working Memory\" layer: transform raw agent sessions into structured diary\nentries. These diaries become input to the Reflector for delta extraction.\n\n## Usage\n```bash\ncass-memory diary ~/.claude/sessions/session-abc.jsonl --json\ncass-memory diary <session-path> [--enrich] [--save]\n```\n\n## Process Flow\n```\n1. Load session via cass export (markdown format)\n2. Apply secret sanitization\n3. Run LLM extraction (DiaryExtractionSchema)\n4. If --enrich: Query cass for related sessions (cross-agent)\n5. Save to ~/.cass-memory/diary/{id}.json\n6. Output result\n```\n\n## DiaryEntry Fields (from LLM)\n- **status**: success | failure | mixed\n- **accomplishments**: What was completed (SPECIFIC - file names, functions)\n- **decisions**: Design choices with rationale\n- **challenges**: Problems encountered, errors, blockers\n- **preferences**: User style revelations\n- **keyLearnings**: Reusable insights\n\n## Cross-Agent Enrichment (--enrich)\n```typescript\nasync function enrichDiary(diary: DiaryEntry, config: Config): Promise<DiaryEntry> {\n  // Extract keywords from diary content\n  const keywords = [\n    ...diary.keyLearnings,\n    ...diary.challenges.map(extractKeywords).flat()\n  ].slice(0, 5);\n  \n  // Query cass for related sessions from OTHER agents\n  const related = await safeCassSearch(keywords.join(\" \"), {\n    limit: 5,\n    days: 30,\n    // Exclude the same agent\n    agent: ALL_AGENTS.filter(a => a !== diary.agent)\n  }, config.cassPath);\n  \n  diary.relatedSessions = related.map(h => ({\n    sessionPath: h.source_path,\n    agent: h.agent,\n    relevanceScore: h.score,\n    snippet: h.snippet\n  }));\n  \n  return diary;\n}\n```\n\n## LLM Prompt (Key Instructions)\n```\nBe SPECIFIC and ACTIONABLE. Avoid generic statements.\nInclude specific:\n- File names and paths\n- Function/class/component names\n- Error messages and stack traces\n- Commands run\n- Tools used\n\nIf the session lacks information for a field, provide an empty array.\n```\n\n## Output\n```json\n{\n  \"id\": \"diary-abc123\",\n  \"sessionPath\": \"~/.claude/sessions/session-abc.jsonl\",\n  \"timestamp\": \"2025-12-07T10:30:00Z\",\n  \"agent\": \"claude\",\n  \"workspace\": \"/Users/x/projects/myapp\",\n  \"status\": \"success\",\n  \"accomplishments\": [\n    \"Fixed authentication timeout by increasing session TTL in config.ts:42\",\n    \"Added retry logic to AuthService.refresh() method\"\n  ],\n  \"decisions\": [\n    \"Chose 7200s TTL to match expected user session duration\"\n  ],\n  \"challenges\": [\n    \"Initial confusion about which config file controls TTL\"\n  ],\n  \"preferences\": [\n    \"User prefers explicit error messages over silent failures\"\n  ],\n  \"keyLearnings\": [\n    \"Auth timeout issues are usually config-related, not code bugs\"\n  ],\n  \"relatedSessions\": [...],\n  \"tags\": [\"auth\", \"timeout\", \"config\"],\n  \"searchAnchors\": [\"authentication timeout\", \"session TTL\", \"AuthService\"]\n}\n```\n\n## Dependency\n- Requires Phase 1 completion (LLM, cass wrapper, sanitization)","status":"tombstone","priority":1,"issue_type":"feature","created_at":"2025-12-07T21:21:02.394292Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"feature","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-0ew.1","depends_on_id":"cass_memory_system-0ew","type":"parent-child","created_at":"2026-01-21T09:28:49Z","created_by":"import"},{"issue_id":"cass_memory_system-0ew.1","depends_on_id":"cass_memory_system-5eh.4","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"},{"issue_id":"cass_memory_system-0ew.1","depends_on_id":"cass_memory_system-5eh.5","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"},{"issue_id":"cass_memory_system-0ew.1","depends_on_id":"cass_memory_system-5eh.9","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"}]}
{"id":"cass_memory_system-0ew.2","title":"Mark Command: cass-memory mark (Feedback Recording)","description":"# Feature: Mark Command\n\n## Purpose\nRecord bullet usage feedback. This is how the playbook learns:\n- Mark helpful when a rule helps you succeed\n- Mark harmful when following a rule causes problems\n\n## Usage\n```bash\ncass-memory mark b-abc123 --helpful\ncass-memory mark b-abc123 --harmful --reason \"Caused test failures\"\ncass-memory mark b-abc123 --helpful --session ~/.claude/sessions/abc.jsonl\n```\n\n## Implementation\n```typescript\nasync function markCommand(\n  bulletId: string,\n  flags: { helpful?: boolean; harmful?: boolean; reason?: string; session?: string }\n): Promise<void> {\n  const config = await loadConfig();\n  const playbook = await loadMergedPlaybook(config);\n  \n  // Find bullet\n  const bullet = findBullet(playbook, bulletId);\n  if (!bullet) {\n    error(`Bullet not found: ${bulletId}`);\n    process.exit(1);\n  }\n  \n  // Create feedback event WITH TIMESTAMP (P1 - critical for decay)\n  const event: FeedbackEvent = {\n    type: flags.helpful ? \"helpful\" : \"harmful\",\n    timestamp: now(),\n    sessionPath: flags.session,\n    reason: flags.reason\n  };\n  \n  // Add event to bullet\n  bullet.feedbackEvents.push(event);\n  \n  // Update legacy counts (for backwards compatibility)\n  if (flags.helpful) bullet.helpfulCount++;\n  else bullet.harmfulCount++;\n  \n  // Update timestamps\n  bullet.updatedAt = now();\n  \n  // Recalculate state\n  bullet.state = calculateMaturityState(bullet, config);\n  \n  // Save playbook\n  await savePlaybook(playbook, config.playbookPath);\n  \n  // Also log to usage.jsonl for audit trail\n  await appendUsageLog({\n    bulletId,\n    event,\n    effectiveScoreAfter: getEffectiveScore(bullet, config)\n  });\n  \n  output({\n    success: true,\n    bulletId,\n    event,\n    newState: bullet.state,\n    effectiveScore: getEffectiveScore(bullet, config)\n  }, formatMarkResult, flags);\n}\n```\n\n## Usage Log Format\n```\n~/.cass-memory/usage.jsonl\n{\"bulletId\":\"b-abc123\",\"type\":\"helpful\",\"timestamp\":\"2025-12-07T10:30:00Z\",\"session\":\"...\"}\n{\"bulletId\":\"b-def456\",\"type\":\"harmful\",\"timestamp\":\"2025-12-07T11:00:00Z\",\"reason\":\"...\"}\n```\n\n## State Transitions After Mark\n- If new harmful feedback pushes ratio > 30%: state → \"retired\"\n- If helpful feedback reaches 10 with ratio < 10%: state → \"proven\"\n- Automatic decay recalculation happens on every read\n\n## Output\n```json\n{\n  \"success\": true,\n  \"bulletId\": \"b-abc123\",\n  \"event\": {\n    \"type\": \"helpful\",\n    \"timestamp\": \"2025-12-07T10:30:00Z\"\n  },\n  \"newState\": \"proven\",\n  \"effectiveScore\": 15.2\n}\n```","status":"tombstone","priority":1,"issue_type":"feature","created_at":"2025-12-07T21:21:02.639637Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"feature","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-0ew.2","depends_on_id":"cass_memory_system-0ew","type":"parent-child","created_at":"2026-01-21T09:28:49Z","created_by":"import"},{"issue_id":"cass_memory_system-0ew.2","depends_on_id":"cass_memory_system-5eh.6","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"},{"issue_id":"cass_memory_system-0ew.2","depends_on_id":"cass_memory_system-5eh.8","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"}]}
{"id":"cass_memory_system-0ew.3","title":"Reflector Pipeline: src/reflect.ts (Delta Extraction)","description":"# Feature: Reflector Pipeline\n\n## Purpose\nThe \"Reflector\" phase of ACE: extract reusable lessons (deltas) from diary entries.\nThis is where the LLM analyzes sessions and proposes playbook changes.\n\n## Key Innovation: Multi-Iteration Reflection\nInstead of one pass, run the reflector multiple times (configurable 1-3):\n- Iteration 0: General insights\n- Iteration 1: Focus on missed patterns\n- Iteration 2: Focus on edge cases\n\nThis catches insights a single pass might miss.\n\n## Implementation\n```typescript\nasync function reflectOnSession(\n  diary: DiaryEntry,\n  playbook: Playbook,\n  config: Config\n): Promise<Delta[]> {\n  const allDeltas: Delta[] = [];\n  \n  // Get cass history for cross-referencing\n  const cassHistory = await getCassHistoryForDiary(diary, config);\n  \n  // Format existing bullets for prompt\n  const existingBullets = formatBulletsForPrompt(playbook.bullets);\n  \n  // Multi-iteration reflection\n  for (let i = 0; i < config.maxReflectorIterations; i++) {\n    const iterationNote = i > 0\n      ? `This is iteration ${i + 1}. Focus on insights you may have missed.`\n      : \"\";\n    \n    const output = await runReflector(\n      ReflectorOutputSchema,\n      diary,\n      existingBullets,\n      cassHistory,\n      i,\n      config\n    );\n    \n    // Convert raw output to typed deltas\n    const deltas = output.deltas.map(d => convertToTypedDelta(d, diary.sessionPath));\n    \n    // Deduplicate against previous iterations\n    const newDeltas = deduplicateDeltas(deltas, allDeltas);\n    allDeltas.push(...newDeltas);\n    \n    // Early exit if no new insights\n    if (newDeltas.length === 0) break;\n  }\n  \n  return allDeltas;\n}\n```\n\n## Delta Types Extracted\n1. **add**: New insight not covered by existing bullets\n2. **helpful**: Existing bullet proved useful\n3. **harmful**: Existing bullet caused problems\n4. **replace**: Existing bullet needs updated wording\n5. **deprecate**: Existing bullet is outdated\n\n## Prompt Guidelines (Critical for Quality)\n```\nGuidelines for the LLM:\n- Be SPECIFIC. Bad: \"Write tests\". Good: \"For React hooks, test effects separately with renderHook\"\n- Include concrete examples, file patterns, command flags when relevant\n- Only propose deltas for genuinely reusable insights\n- Consider if a bullet would help a DIFFERENT agent on a similar problem\n- Maximum 20 deltas per reflection\n```\n\n## Deduplication Logic\n```typescript\nfunction deduplicateDeltas(newDeltas: Delta[], existing: Delta[]): Delta[] {\n  return newDeltas.filter(d => {\n    if (d.type === \"add\") {\n      // Check content similarity\n      return !existing.some(e =>\n        e.type === \"add\" && jaccardSimilarity(d.bullet.content, e.bullet.content) > 0.8\n      );\n    }\n    // For helpful/harmful, allow multiple from same session\n    return true;\n  });\n}\n```","status":"tombstone","priority":0,"issue_type":"feature","created_at":"2025-12-07T21:21:03.831701Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"feature","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-0ew.3","depends_on_id":"cass_memory_system-0ew","type":"parent-child","created_at":"2026-01-21T09:28:49Z","created_by":"import"},{"issue_id":"cass_memory_system-0ew.3","depends_on_id":"cass_memory_system-0ew.1","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"},{"issue_id":"cass_memory_system-0ew.3","depends_on_id":"cass_memory_system-5eh.9","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"}]}
{"id":"cass_memory_system-0ew.4","title":"Evidence-Count Gate: Pre-LLM Validator (P11)","description":"# Feature: Evidence-Count Gate (P11)\n\n## Purpose\nBEFORE sending a proposed rule to the LLM validator, check if historical\nsession success/failure counts provide enough signal to auto-accept or\nauto-reject. This saves LLM tokens and speeds up the pipeline.\n\n## The Insight\nIf 5+ sessions SUCCEEDED with a pattern and 0 FAILED, we don't need an LLM\nto tell us it's valid. Conversely, if 3+ sessions FAILED and 0 SUCCEEDED,\nwe can auto-reject without burning tokens.\n\n## Implementation\n```typescript\ninterface EvidenceGateResult {\n  action: \"auto-accept\" | \"auto-reject\" | \"needs-llm\";\n  confidence: number;\n  successCount: number;\n  failureCount: number;\n  relevantSessions: CassHit[];\n}\n\nasync function evidenceCountGate(\n  proposedRule: string,\n  config: Config\n): Promise<EvidenceGateResult> {\n  // 1. Extract keywords from proposed rule\n  const keywords = extractKeywords(proposedRule);\n  \n  // 2. Search cass for sessions mentioning this pattern\n  const hits = await safeCassSearch(keywords.join(\" \"), {\n    limit: 20,\n    days: config.validationLookbackDays\n  }, config.cassPath);\n  \n  // 3. Classify sessions by outcome (success/failure)\n  let successCount = 0;\n  let failureCount = 0;\n  \n  for (const hit of hits) {\n    const outcome = classifySessionOutcome(hit);\n    if (outcome === \"success\") successCount++;\n    else if (outcome === \"failure\") failureCount++;\n  }\n  \n  // 4. Apply gates\n  // Strong success signal: auto-accept\n  if (successCount >= 5 && failureCount === 0) {\n    return {\n      action: \"auto-accept\",\n      confidence: 0.95,\n      successCount,\n      failureCount,\n      relevantSessions: hits\n    };\n  }\n  \n  // Strong failure signal: auto-reject\n  if (failureCount >= 3 && successCount === 0) {\n    return {\n      action: \"auto-reject\",\n      confidence: 0.9,\n      successCount,\n      failureCount,\n      relevantSessions: hits\n    };\n  }\n  \n  // Ambiguous: needs LLM analysis\n  return {\n    action: \"needs-llm\",\n    confidence: 0.5,\n    successCount,\n    failureCount,\n    relevantSessions: hits\n  };\n}\n```\n\n## Session Outcome Classification\n```typescript\nfunction classifySessionOutcome(hit: CassHit): \"success\" | \"failure\" | \"unknown\" {\n  const snippet = hit.snippet.toLowerCase();\n  \n  // Success indicators\n  if (snippet.includes(\"fixed\") || \n      snippet.includes(\"resolved\") ||\n      snippet.includes(\"completed\") ||\n      snippet.includes(\"works now\")) {\n    return \"success\";\n  }\n  \n  // Failure indicators\n  if (snippet.includes(\"failed\") ||\n      snippet.includes(\"error\") ||\n      snippet.includes(\"broken\") ||\n      snippet.includes(\"didn't work\")) {\n    return \"failure\";\n  }\n  \n  return \"unknown\";\n}\n```\n\n## Integration with Validator\n```typescript\nasync function validateRule(\n  proposedRule: string,\n  config: Config\n): Promise<ValidationResult> {\n  // 1. Check evidence gate first\n  const gateResult = await evidenceCountGate(proposedRule, config);\n  \n  if (gateResult.action === \"auto-accept\") {\n    return {\n      valid: true,\n      reason: `Auto-accepted: ${gateResult.successCount} successes, 0 failures`,\n      confidence: gateResult.confidence\n    };\n  }\n  \n  if (gateResult.action === \"auto-reject\") {\n    return {\n      valid: false,\n      reason: `Auto-rejected: ${gateResult.failureCount} failures, 0 successes`,\n      confidence: gateResult.confidence\n    };\n  }\n  \n  // 2. Fall through to LLM validation\n  return runLLMValidator(proposedRule, gateResult.relevantSessions, config);\n}\n```\n\n## ROI\n- Saves LLM tokens on clear-cut cases\n- Faster pipeline (no network call for auto-decisions)\n- More transparent reasoning (explicit success/failure counts)","status":"tombstone","priority":0,"issue_type":"feature","created_at":"2025-12-07T21:22:32.925118Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"feature","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-0ew.4","depends_on_id":"cass_memory_system-0ew","type":"parent-child","created_at":"2026-01-21T09:28:49Z","created_by":"import"},{"issue_id":"cass_memory_system-0ew.4","depends_on_id":"cass_memory_system-5eh.4","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"}]}
{"id":"cass_memory_system-0ew.5","title":"Curator Pipeline: Deterministic Delta Application (ACE Core)","description":"# Feature: Curator Pipeline (Deterministic Delta Application)\n\n## Purpose\nThe \"Curator\" phase of ACE: apply validated deltas to the playbook\nDETERMINISTICALLY. No LLM rewriting of the playbook - only precise\ndelta operations. This prevents \"context collapse\" where the LLM\nrewrites everything and loses accumulated knowledge.\n\n## Critical Principle\nThe ACE paper's key insight: if you let the LLM rewrite the entire\nplaybook, information is lost through summarization and compression.\nInstead, the curator only applies specific operations:\n- Add new bullets\n- Increment helpful/harmful counts\n- Replace specific content\n- Deprecate specific bullets\n- Merge similar bullets\n\n## Implementation\n```typescript\nfunction curatePlaybook(\n  playbook: Playbook,\n  deltas: Delta[],\n  config: Config\n): { playbook: Playbook; applied: number; skipped: number } {\n  let applied = 0;\n  let skipped = 0;\n  \n  for (const delta of deltas) {\n    switch (delta.type) {\n      case \"add\":\n        // Check for duplicates BEFORE adding\n        if (isDuplicate(delta.bullet.content, playbook.bullets, config.dedupSimilarityThreshold)) {\n          // Merge into existing instead of adding\n          const existing = findSimilarBullet(delta.bullet.content, playbook.bullets);\n          if (existing) {\n            existing.feedbackEvents.push({\n              type: \"helpful\",\n              timestamp: now(),\n              sessionPath: delta.sourceSession\n            });\n            existing.helpfulCount++;\n          }\n          skipped++;\n          continue;\n        }\n        \n        // Add new bullet\n        const newBullet = createBullet(delta.bullet, delta.sourceSession);\n        playbook.bullets.push(newBullet);\n        applied++;\n        break;\n        \n      case \"helpful\":\n      case \"harmful\":\n        const bullet = findBullet(playbook, delta.bulletId);\n        if (bullet) {\n          bullet.feedbackEvents.push({\n            type: delta.type,\n            timestamp: now(),\n            sessionPath: delta.sourceSession,\n            reason: delta.type === \"harmful\" ? delta.reason : undefined\n          });\n          if (delta.type === \"helpful\") bullet.helpfulCount++;\n          else bullet.harmfulCount++;\n          bullet.updatedAt = now();\n          applied++;\n        } else {\n          skipped++;\n        }\n        break;\n        \n      case \"replace\":\n        const toReplace = findBullet(playbook, delta.bulletId);\n        if (toReplace) {\n          toReplace.content = delta.newContent;\n          toReplace.updatedAt = now();\n          applied++;\n        } else {\n          skipped++;\n        }\n        break;\n        \n      case \"deprecate\":\n        const toDeprecate = findBullet(playbook, delta.bulletId);\n        if (toDeprecate) {\n          toDeprecate.deprecated = true;\n          toDeprecate.deprecationReason = delta.reason;\n          toDeprecate.replacedBy = delta.replacedBy;\n          toDeprecate.state = \"retired\";\n          toDeprecate.updatedAt = now();\n          applied++;\n        } else {\n          skipped++;\n        }\n        break;\n        \n      case \"merge\":\n        // Merge multiple bullets into one\n        const toMerge = delta.bulletIds.map(id => findBullet(playbook, id)).filter(Boolean);\n        if (toMerge.length >= 2) {\n          const merged = mergeBullets(toMerge, delta.mergedContent);\n          playbook.bullets.push(merged);\n          toMerge.forEach(b => {\n            b.deprecated = true;\n            b.deprecationReason = \"Merged into \" + merged.id;\n            b.replacedBy = merged.id;\n          });\n          applied++;\n        } else {\n          skipped++;\n        }\n        break;\n    }\n  }\n  \n  // Update playbook metadata\n  playbook.metadata.lastReflection = now();\n  playbook.metadata.totalReflections++;\n  \n  return { playbook, applied, skipped };\n}\n```\n\n## Auto-Pruning (Decay-Aware)\n```typescript\nfunction autoPrunePlaybook(playbook: Playbook, config: Config): number {\n  const before = playbook.bullets.length;\n  \n  playbook.bullets = playbook.bullets.filter(b => {\n    // Never prune explicitly deprecated (user decision)\n    if (b.deprecated) return true;\n    \n    // Calculate effective score with decay\n    const score = getEffectiveScore(b, config);\n    \n    // Prune if score is significantly negative\n    return score > -config.pruneHarmfulThreshold;\n  });\n  \n  return before - playbook.bullets.length;\n}\n```","notes":"Picking up curator deterministic delta application; will align with types and fix typecheck blockers.","status":"tombstone","priority":0,"issue_type":"feature","created_at":"2025-12-07T21:22:34.234580Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"feature","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-0ew.5","depends_on_id":"cass_memory_system-0ew","type":"parent-child","created_at":"2026-01-21T09:28:49Z","created_by":"import"},{"issue_id":"cass_memory_system-0ew.5","depends_on_id":"cass_memory_system-5eh.3","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"},{"issue_id":"cass_memory_system-0ew.5","depends_on_id":"cass_memory_system-5eh.6","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"},{"issue_id":"cass_memory_system-0ew.5","depends_on_id":"cass_memory_system-5eh.8","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"}]}
{"id":"cass_memory_system-0ew.6","title":"Anti-Pattern Inversion (P3)","description":"# Feature: Anti-Pattern Inversion (P3 - 8× Impact)\n\n## Purpose\nWhen a bullet proves consistently harmful, instead of just deleting it,\nINVERT it into an anti-pattern. This preserves the negative learning:\n\"We tried X and it caused problems, so DON'T do X.\"\n\n## The Problem\nWithout inversion:\n- Rule: \"Use singleton pattern for database connections\"\n- Gets marked harmful 5 times (causes connection leaks)\n- System deletes it\n- 3 months later, someone proposes the same rule again\n- The failure is forgotten, cycle repeats\n\nWith inversion:\n- Rule gets inverted to: \"AVOID: Singleton pattern for database connections (causes connection leaks)\"\n- Marked as kind=anti_pattern\n- Future proposals matching this pattern trigger warnings\n\n## Implementation\n```typescript\nfunction shouldInvertToAntiPattern(bullet: PlaybookBullet, config: Config): boolean {\n  const { decayedHelpful, decayedHarmful } = getDecayedCounts(bullet, config);\n  \n  // Inversion threshold: harmful significantly outweighs helpful\n  // AND we have enough data points to be confident\n  return (\n    decayedHarmful >= 3 &&                    // Minimum harmful events\n    decayedHarmful > decayedHelpful * 2 &&    // 2:1 harmful:helpful ratio\n    !bullet.deprecated                         // Not already handled\n  );\n}\n\nfunction invertToAntiPattern(\n  bullet: PlaybookBullet,\n  reason: string\n): PlaybookBullet {\n  // Create inverted content\n  const invertedContent = generateAntiPatternContent(bullet.content, reason);\n  \n  return {\n    ...bullet,\n    id: generateBulletId(), // New ID for the anti-pattern\n    kind: \"anti_pattern\",\n    content: invertedContent,\n    \n    // Reset feedback (this is a new bullet)\n    feedbackEvents: [],\n    helpfulCount: 0,\n    harmfulCount: 0,\n    state: \"draft\",\n    \n    // Track provenance\n    sourceSessions: bullet.sourceSessions,\n    sourceAgents: bullet.sourceAgents,\n    tags: [...bullet.tags, \"inverted\", \"anti-pattern\"],\n    \n    createdAt: now(),\n    updatedAt: now()\n  };\n}\n\nfunction generateAntiPatternContent(\n  originalContent: string,\n  reason: string\n): string {\n  // Transform positive advice into negative warning\n  // \"Use X for Y\" → \"AVOID: X for Y (causes Z)\"\n  \n  // Simple heuristic transformation\n  const cleaned = originalContent\n    .replace(/^(always |prefer |use |try |consider )/i, \"\")\n    .trim();\n  \n  return `AVOID: ${cleaned}. ${reason}`;\n}\n```\n\n## Integration with Curator\n```typescript\nfunction curatePlaybook(playbook: Playbook, deltas: Delta[], config: Config) {\n  // ... apply deltas ...\n  \n  // Check for bullets that should be inverted\n  for (const bullet of playbook.bullets) {\n    if (shouldInvertToAntiPattern(bullet, config)) {\n      const antiPattern = invertToAntiPattern(\n        bullet,\n        `Marked harmful ${bullet.harmfulCount} times`\n      );\n      \n      // Add anti-pattern\n      playbook.bullets.push(antiPattern);\n      \n      // Deprecate original\n      bullet.deprecated = true;\n      bullet.deprecationReason = `Inverted to anti-pattern: ${antiPattern.id}`;\n      bullet.replacedBy = antiPattern.id;\n      bullet.state = \"retired\";\n    }\n  }\n}\n```\n\n## Example Inversion\n**Before** (harmful rule):\n```yaml\n- id: \"b-abc123\"\n  kind: \"stack_pattern\"\n  content: \"Use global mutable state for sharing data between components\"\n  harmfulCount: 5\n  helpfulCount: 1\n```\n\n**After** (anti-pattern):\n```yaml\n- id: \"b-def456\"\n  kind: \"anti_pattern\"\n  content: \"AVOID: Global mutable state for sharing data between components. Marked harmful 5 times - causes race conditions and debugging nightmares.\"\n  tags: [\"inverted\", \"anti-pattern\", \"state-management\"]\n  \n- id: \"b-abc123\"\n  deprecated: true\n  deprecationReason: \"Inverted to anti-pattern: b-def456\"\n  replacedBy: \"b-def456\"\n  state: \"retired\"\n```","status":"tombstone","priority":0,"issue_type":"feature","created_at":"2025-12-07T21:22:34.432332Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"feature","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-0ew.6","depends_on_id":"cass_memory_system-0ew","type":"parent-child","created_at":"2026-01-21T09:28:49Z","created_by":"import"},{"issue_id":"cass_memory_system-0ew.6","depends_on_id":"cass_memory_system-0ew.5","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"},{"issue_id":"cass_memory_system-0ew.6","depends_on_id":"cass_memory_system-5eh.6","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"}]}
{"id":"cass_memory_system-0ew.7","title":"Forget Command + Toxic Bullet Log (P8)","description":"# Feature: Forget Command + Toxic Bullet Log (P8)\n\n## Purpose\nPermanently block a pattern that should NEVER be suggested again.\nMore severe than deprecation - this is for truly harmful patterns\nthat caused production issues, security problems, etc.\n\n## Usage\n```bash\ncass-memory forget b-abc123 --reason \"Caused production outage\"\ncass-memory forget --list  # Show toxic bullet log\n```\n\n## Difference from Deprecation\n| Aspect | Deprecate | Forget |\n|--------|-----------|--------|\n| Reversible | Yes | No (requires manual edit) |\n| Stays in playbook | Yes (marked deprecated) | Removed entirely |\n| Future proposals | Allowed | Blocked via semantic matching |\n| Audit trail | In playbook | In toxic_bullets.log |\n\n## Implementation\n```typescript\nasync function forgetCommand(\n  bulletId: string,\n  flags: { reason: string; list?: boolean }\n): Promise<void> {\n  if (flags.list) {\n    return listToxicBullets();\n  }\n  \n  const config = await loadConfig();\n  const playbook = await loadMergedPlaybook(config);\n  \n  // Find bullet\n  const bullet = findBullet(playbook, bulletId);\n  if (!bullet) {\n    error(`Bullet not found: ${bulletId}`);\n    process.exit(1);\n  }\n  \n  // Log to toxic bullets file BEFORE removing\n  await appendToxicLog({\n    id: bullet.id,\n    content: bullet.content,\n    reason: flags.reason,\n    forgottenAt: now(),\n    originalBullet: bullet\n  });\n  \n  // Remove from playbook\n  playbook.bullets = playbook.bullets.filter(b => b.id !== bulletId);\n  \n  await savePlaybook(playbook, config.playbookPath);\n  \n  output({\n    success: true,\n    bulletId,\n    action: \"forgotten\",\n    reason: flags.reason\n  }, formatForgetResult, flags);\n}\n```\n\n## Toxic Bullet Log Format\n```\n~/.cass-memory/toxic_bullets.log\n# One JSON object per line\n{\"id\":\"b-abc123\",\"content\":\"Use eval() for dynamic code execution\",\"reason\":\"Security vulnerability - allows code injection\",\"forgottenAt\":\"2025-12-07T10:30:00Z\"}\n```\n\n## Blocking Future Proposals\nWhen the curator processes new \"add\" deltas, check against toxic log:\n```typescript\nasync function isSemanticallyToxic(\n  content: string,\n  toxicPatterns: ToxicEntry[]\n): Promise<boolean> {\n  for (const toxic of toxicPatterns) {\n    const similarity = jaccardSimilarity(content, toxic.content);\n    if (similarity > 0.7) {\n      log(`Blocked: \"${content}\" matches toxic pattern \"${toxic.content}\"`);\n      return true;\n    }\n  }\n  return false;\n}\n```\n\n## Cascading Toxic Logs\nBoth global and repo-level toxic logs are checked:\n```typescript\nconst globalToxic = await loadToxicLog(\"~/.cass-memory/toxic_bullets.log\");\nconst repoToxic = await loadToxicLog(\"./.cass/toxic.log\");\nconst allToxic = [...globalToxic, ...repoToxic];\n```\n\n## List Output\n```bash\n$ cass-memory forget --list\n\nTOXIC BULLETS (permanently blocked):\n\n[b-abc123] 2025-12-07\n  \"Use eval() for dynamic code execution\"\n  Reason: Security vulnerability - allows code injection\n\n[b-def456] 2025-11-15  \n  \"Store passwords in localStorage\"\n  Reason: Security violation - passwords must never be in client storage\n```","status":"tombstone","priority":1,"issue_type":"feature","created_at":"2025-12-07T21:22:34.672378Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"feature","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-0ew.7","depends_on_id":"cass_memory_system-0ew","type":"parent-child","created_at":"2026-01-21T09:28:49Z","created_by":"import"},{"issue_id":"cass_memory_system-0ew.7","depends_on_id":"cass_memory_system-5eh.8","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"}]}
{"id":"cass_memory_system-0ew.8","title":"Doctor Command: System Health Check (P13)","description":"# Feature: Doctor Command (P13 - 5× DX Impact)\n\n## Purpose\nComprehensive system health check. Catches configuration issues, missing\ndependencies, stale data, and other problems BEFORE they cause failures.\n\n## Usage\n```bash\ncass-memory doctor\ncass-memory doctor --fix  # Auto-fix simple issues\ncass-memory doctor --json\n```\n\n## Checks Performed\n\n### 1. Configuration Checks\n- Config file exists and is valid JSON\n- Required fields present\n- API key environment variables set\n- Paths are writable\n\n### 2. Dependency Checks  \n- cass is available and healthy\n- cass index is up to date\n- LLM API is reachable (optional ping)\n\n### 3. Data Integrity Checks\n- Playbook YAML is valid\n- No orphaned bullet references\n- No circular deprecation chains\n- feedbackEvents timestamps are valid ISO 8601\n\n### 4. Health Metrics\n- Bullets with negative effective scores\n- Stale bullets (no feedback in 90+ days)\n- High harmful ratio bullets\n- Duplicate content detection\n\n## Implementation\n```typescript\ninterface DoctorCheck {\n  name: string;\n  status: \"pass\" | \"warn\" | \"fail\";\n  message: string;\n  fixable?: boolean;\n  fix?: () => Promise<void>;\n}\n\nasync function doctorCommand(flags: { fix?: boolean; json?: boolean }): Promise<void> {\n  const checks: DoctorCheck[] = [];\n  \n  // Configuration checks\n  checks.push(await checkConfigExists());\n  checks.push(await checkConfigValid());\n  checks.push(await checkApiKeys());\n  \n  // Dependency checks\n  checks.push(await checkCassAvailable());\n  checks.push(await checkCassIndex());\n  \n  // Data integrity checks\n  checks.push(await checkPlaybookValid());\n  checks.push(await checkNoOrphanedRefs());\n  checks.push(await checkNoCircularDeprecations());\n  checks.push(await checkTimestampsValid());\n  \n  // Health metrics\n  checks.push(await checkNegativeScoreBullets());\n  checks.push(await checkStaleBullets());\n  checks.push(await checkHighHarmfulRatio());\n  checks.push(await checkDuplicateContent());\n  \n  // Auto-fix if requested\n  if (flags.fix) {\n    for (const check of checks.filter(c => c.status !== \"pass\" && c.fixable)) {\n      await check.fix?.();\n      check.status = \"pass\";\n      check.message += \" (auto-fixed)\";\n    }\n  }\n  \n  // Output\n  output({ checks, summary: summarizeChecks(checks) }, formatDoctorResult, flags);\n  \n  // Exit code based on results\n  const hasFailures = checks.some(c => c.status === \"fail\");\n  if (hasFailures) process.exit(1);\n}\n```\n\n## Example Output\n```\n╭─────────────────────────────────────────────────────────────╮\n│                   CASS-MEMORY DOCTOR                        │\n├─────────────────────────────────────────────────────────────┤\n│                                                             │\n│ CONFIGURATION                                               │\n│   ✓ Config file exists                                      │\n│   ✓ Config is valid JSON                                    │\n│   ✓ ANTHROPIC_API_KEY is set                                │\n│                                                             │\n│ DEPENDENCIES                                                │\n│   ✓ cass is available (v0.5.2)                              │\n│   ⚠ cass index is 3 days old (run: cass index --incremental)│\n│                                                             │\n│ DATA INTEGRITY                                              │\n│   ✓ Playbook YAML is valid                                  │\n│   ✓ No orphaned references                                  │\n│   ✓ No circular deprecations                                │\n│                                                             │\n│ PLAYBOOK HEALTH                                             │\n│   ⚠ 3 bullets have negative effective scores                │\n│   ⚠ 12 bullets are stale (no feedback in 90+ days)          │\n│   ✓ No high harmful ratio bullets                           │\n│   ⚠ 2 potential duplicate pairs detected                    │\n│                                                             │\n├─────────────────────────────────────────────────────────────┤\n│ Summary: 8 passed, 4 warnings, 0 failures                   │\n│                                                             │\n│ Recommendations:                                            │\n│   • Run `cass index --incremental` to update search index   │\n│   • Review bullets with negative scores:                    │\n│     cass-memory playbook list --at-risk                     │\n│   • Consider merging duplicate bullets:                     │\n│     cass-memory similar b-abc123                            │\n╰─────────────────────────────────────────────────────────────╯\n```","status":"tombstone","priority":1,"issue_type":"feature","created_at":"2025-12-07T21:22:34.902332Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"feature","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-0ew.8","depends_on_id":"cass_memory_system-0ew","type":"parent-child","created_at":"2026-01-21T09:28:49Z","created_by":"import"},{"issue_id":"cass_memory_system-0ew.8","depends_on_id":"cass_memory_system-5eh.4","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"},{"issue_id":"cass_memory_system-0ew.8","depends_on_id":"cass_memory_system-5eh.7","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"},{"issue_id":"cass_memory_system-0ew.8","depends_on_id":"cass_memory_system-5eh.8","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"}]}
{"id":"cass_memory_system-0ew.9","title":"Reflect Command: cass-memory reflect (Full Pipeline)","description":"# Feature: Reflect Command (Full Pipeline Orchestration)\n\n## Purpose\nOrchestrate the full diary → reflect → validate → curate pipeline.\nThis is the command that makes the playbook learn from recent sessions.\n\n## Usage\n```bash\ncass-memory reflect --days 7 --max-sessions 10\ncass-memory reflect --dry-run --json  # See what would happen\ncass-memory reflect --session ~/.claude/sessions/abc.jsonl  # Single session\n```\n\n## Process Flow\n```\n1. Find unprocessed sessions (not in processed.log)\n2. For each session:\n   a. Generate diary (if not exists)\n   b. Run reflector (extract deltas)\n   c. Run validator on \"add\" deltas (evidence gate + LLM)\n   d. Apply deltas via curator\n   e. Mark session as processed\n3. Save updated playbook\n4. Run auto-prune\n5. Check for anti-pattern inversions\n```\n\n## Implementation\n```typescript\nasync function reflectCommand(flags: ReflectFlags): Promise<void> {\n  const config = await loadConfig();\n  const playbook = await loadMergedPlaybook(config);\n  \n  // 1. Find sessions to process\n  const sessions = flags.session\n    ? [{ path: flags.session, agent: detectAgent(flags.session) }]\n    : await findUnprocessedSessions(config);\n  \n  if (sessions.length === 0) {\n    output({ message: \"No new sessions to process\" }, null, flags);\n    return;\n  }\n  \n  const results: ReflectionResult[] = [];\n  \n  // 2. Process each session\n  for (const session of sessions.slice(0, flags.maxSessions || 10)) {\n    // 2a. Generate diary\n    let diary = await loadDiary(session.path);\n    if (!diary) {\n      diary = await generateDiary(session.path, session.agent, config);\n      await saveDiary(diary);\n    }\n    \n    // 2b. Run reflector\n    const deltas = await reflectOnSession(diary, playbook, config);\n    \n    // 2c. Validate \"add\" deltas\n    const validatedDeltas: Delta[] = [];\n    for (const delta of deltas) {\n      if (delta.type === \"add\" && config.validationEnabled) {\n        const validation = await validateRule(delta.bullet.content, config);\n        if (validation.valid) {\n          // Optionally use refined content\n          if (validation.refinedContent) {\n            delta.bullet.content = validation.refinedContent;\n          }\n          validatedDeltas.push(delta);\n        }\n      } else {\n        validatedDeltas.push(delta);\n      }\n    }\n    \n    // 2d. Dry run check\n    if (flags.dryRun) {\n      results.push({\n        session: session.path,\n        diary,\n        proposedDeltas: validatedDeltas,\n        applied: false\n      });\n      continue;\n    }\n    \n    // 2e. Apply deltas\n    const { applied, skipped } = curatePlaybook(playbook, validatedDeltas, config);\n    \n    // 2f. Mark processed\n    await markSessionProcessed(session.path);\n    \n    results.push({\n      session: session.path,\n      diary,\n      proposedDeltas: validatedDeltas,\n      applied: true,\n      deltasApplied: applied,\n      deltasSkipped: skipped\n    });\n  }\n  \n  // 3. Save playbook (if not dry run)\n  if (!flags.dryRun) {\n    // Run anti-pattern inversion check\n    checkAndInvertAntiPatterns(playbook, config);\n    \n    // Auto-prune\n    const pruned = autoPrunePlaybook(playbook, config);\n    \n    await savePlaybook(playbook, config.playbookPath);\n    \n    output({\n      sessionsProcessed: results.length,\n      results,\n      pruned\n    }, formatReflectResult, flags);\n  } else {\n    output({\n      dryRun: true,\n      sessionsAnalyzed: results.length,\n      results\n    }, formatReflectDryRun, flags);\n  }\n}\n```\n\n## Processed Log\n```\n~/.cass-memory/reflections/global.processed.log\n# Format: {diaryId}\\t{timestamp}\\t{sessionPath}\ndiary-abc123\t2025-12-07T10:30:00Z\t~/.claude/sessions/session-001.jsonl\ndiary-def456\t2025-12-07T11:00:00Z\t~/.cursor/state.vscdb:session-xyz\n```\n\n## Output (--json)\n```json\n{\n  \"sessionsProcessed\": 3,\n  \"results\": [\n    {\n      \"session\": \"~/.claude/sessions/abc.jsonl\",\n      \"deltasApplied\": 5,\n      \"deltasSkipped\": 2,\n      \"newBullets\": [\"b-abc123\", \"b-def456\"],\n      \"helpfulMarks\": 2,\n      \"harmfulMarks\": 1\n    }\n  ],\n  \"pruned\": 0,\n  \"antiPatternsInverted\": 0\n}\n```","status":"tombstone","priority":1,"issue_type":"feature","created_at":"2025-12-07T21:23:02.233237Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"feature","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-0ew.9","depends_on_id":"cass_memory_system-0ew","type":"parent-child","created_at":"2026-01-21T09:28:49Z","created_by":"import"},{"issue_id":"cass_memory_system-0ew.9","depends_on_id":"cass_memory_system-0ew.1","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"},{"issue_id":"cass_memory_system-0ew.9","depends_on_id":"cass_memory_system-0ew.3","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"},{"issue_id":"cass_memory_system-0ew.9","depends_on_id":"cass_memory_system-0ew.4","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"},{"issue_id":"cass_memory_system-0ew.9","depends_on_id":"cass_memory_system-0ew.5","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"},{"issue_id":"cass_memory_system-0ew.9","depends_on_id":"cass_memory_system-0ew.6","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"}]}
{"id":"cass_memory_system-0htq","title":"[MCP:Future] MCP server architecture design","description":"Run cass-memory as MCP server for direct agent integration:\n- No CLI parsing overhead\n- Native tool calls from agents\n- Real-time communication\n\nBenefits:\n- Faster than CLI invocation\n- Richer error handling\n- Streaming support for long operations\n\nThis is a future enhancement (P4 priority) that will enable agents to interact with cass-memory more efficiently through the Model Context Protocol.","status":"tombstone","priority":1,"issue_type":"feature","created_at":"2025-12-07T21:49:27.530409Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"feature","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-0jm6","title":"Add --session flag to single playbook add for provenance tracking","status":"closed","priority":3,"issue_type":"feature","created_at":"2025-12-15T16:47:58.457694Z","updated_at":"2025-12-15T16:51:43.679568Z","closed_at":"2025-12-15T16:51:43.679568Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-0k57","title":"[Integration] File System Operations - Real I/O Tests","description":"## Target: Integration tests for file I/O across modules\n\n### Test Scenarios:\n\n1. **Playbook File Lifecycle**\n   - Create temp directory\n   - Save playbook to disk\n   - Load playbook from disk\n   - Verify round-trip integrity\n   - Concurrent read/write handling\n   - File locking verification\n\n2. **Config File Lifecycle**\n   - Create config in temp home\n   - Modify and save config\n   - Reload and verify\n   - Migration from older versions\n\n3. **Diary Directory Scanning**\n   - Create temp diary structure\n   - Add various file types (.md, .json, .jsonl)\n   - Scan and verify all found\n   - Handle permission issues\n   - Handle symlinks\n\n4. **Cross-Module File Operations**\n   - Init creates structure\n   - Context reads from structure\n   - Mark modifies playbook\n   - Verify all in sync\n\n### Test Infrastructure:\n\n```typescript\n// test/helpers/temp-env.ts\nexport async function withTempCassHome(fn: (home: string) => Promise<void>) {\n  const tempDir = await mkdtemp(join(tmpdir(), 'cass-test-'));\n  const originalHome = process.env.HOME;\n  try {\n    process.env.HOME = tempDir;\n    await fn(tempDir);\n  } finally {\n    process.env.HOME = originalHome;\n    await rm(tempDir, { recursive: true });\n  }\n}\n```\n\n### Logging Requirements:\n- Log each file operation\n- Include timestamps\n- Show file sizes\n- Report timing for perf issues","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-08T01:30:05.491647Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-0k57","depends_on_id":"cass_memory_system-mmxv","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"},{"issue_id":"cass_memory_system-0k57","depends_on_id":"cass_memory_system-uufj","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"},{"issue_id":"cass_memory_system-0k57","depends_on_id":"cass_memory_system-zc1d","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"}]}
{"id":"cass_memory_system-0l6","title":"[Cass] cassView - Get specific line from session","description":"Implement cassView() to get a specific line from a session.\n\n## Signature\n```typescript\nasync function cassView(\n  sessionPath: string, \n  lineNumber: number,\n  cassPath = \"cass\"\n): Promise<string | null>\n```\n\n## CLI Command\n`cass view {sessionPath} -n {lineNumber} --json`\n\n## Implementation\n- Use execFile() to run view command\n- Return exact line content\n- Return null on error\n\n## Error Handling\n- Return null if session not found\n- Return null if line number out of range\n- No retries needed\n\n## Parameters\n- sessionPath: Full path to session file\n- lineNumber: Specific line to retrieve (1-indexed)\n\n## Output\nReturns just the content of the specified line without line number prefix.\n\n## Usage\nPrecise line retrieval for:\n- Following up on search hits\n- Fetching specific context\n- Validation and verification\n\n```typescript\nconst line = await cassView(\"/path/to/session.txt\", 42);\nif (line) {\n  console.log(\"Line 42:\", line);\n}\n```\n\n## vs cassExpand\n- cassView: Single line only, exact content\n- cassExpand: Context window around line, includes line numbers\n\n## Exit Codes\n- 0: Success\n- 4: Session or line not found","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:45:02.815833Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-0pm7","title":"[UX][safety] Require explicit confirmation for --hard deletions","description":"Problem\n- `cm playbook remove --hard` and `cm undo --hard` permanently delete bullets without confirmation.\n- This is a data-loss footgun and undermines trust.\n\nWhat to do\n- Add an explicit confirmation pattern for irreversible operations:\n  - If TTY: prompt “Type DELETE to confirm” (or similar)\n  - If non-TTY: require `--yes` (or error with guidance)\n- Consider requiring a two-flag combination for the most dangerous path (e.g., `--hard --yes`).\n\nNotes\n- Confirmation UI should be centralized (shared helper) so other destructive operations can reuse it.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-13T10:18:54.216326Z","updated_at":"2025-12-13T11:06:41.551699Z","closed_at":"2025-12-13T11:06:41.551699Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-0pm7","depends_on_id":"cass_memory_system-jfc5","type":"parent-child","created_at":"2026-01-21T09:28:49Z","created_by":"import"}]}
{"id":"cass_memory_system-0pzz","title":"[P2] Add unit tests for quickstart.ts command","description":"# Task: Unit tests for quickstart.ts command (184 lines)\n\n## What to Test\n- [ ] Agent documentation generated correctly\n- [ ] JSON output format verified\n- [ ] Content is accurate and helpful\n- [ ] Links/references are valid\n- [ ] Examples are executable\n\n## Files\n- Source: src/commands/quickstart.ts (184 lines)\n- Test: test/quickstart.test.ts (new)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T15:30:50.171747Z","updated_at":"2025-12-17T08:19:54.557887Z","closed_at":"2025-12-17T08:19:54.557887Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-0q0","title":"[LLM] PROMPTS.reflector - Delta extraction prompt template","description":"Full prompt template for delta extraction with variables:\n{existingBullets}, {status}, {accomplishments}, {decisions}, {challenges}, {preferences}, {keyLearnings}, {cassHistory}, {iterationNote}\n\nKey delta types:\n1. ADD: New insight not covered by existing bullets - MUST be specific\n2. HELPFUL: Existing bullet proved useful\n3. HARMFUL: Following existing bullet caused problems\n4. REPLACE: Existing bullet needs updated wording\n5. DEPRECATE: Existing bullet is outdated/wrong\n\nGuidelines emphasized:\n- Only genuinely reusable insights\n- Consider: Would this help a DIFFERENT agent?\n- Max 20 deltas per reflection\n- Be specific with file names, function names, error messages\n- Avoid vague/generic rules\n\nTemperature: 0.5 (slightly higher for creativity)\nUsed in runReflector function.\n\nIteration note: On subsequent iterations, remind LLM to focus on novel insights not already proposed.","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:44:52.858965Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-0rfo","title":"Unit tests for curate.ts - Curator pipeline logic","description":"Complete unit test coverage for curate.ts:\n- curatePlaybook() with various playbook states\n- Anti-pattern detection and inversion\n- Bullet merging and deduplication logic\n- Pruning based on harmful threshold\n- Maturity state transitions (candidate -> active -> proven)\n- Deprecation handling\n- Decay half-life configuration application\n- Edge cases: empty playbook, single bullet, all harmful\nNO MOCKS - use real playbook fixtures","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-08T01:25:14.551852Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-0rfo","depends_on_id":"cass_memory_system-ai52","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"}]}
{"id":"cass_memory_system-0sv","title":"[Generator] checkDeprecatedPatterns - Warn about deprecated usage","description":"Check if deprecated patterns appear in historical context and generate warnings.\n\nSIGNATURE:\nfunction checkDeprecatedPatterns(history: CassHit[], playbook: Playbook): string[]\n\nPURPOSE:\nAlert the agent when historical context shows usage of patterns that have been marked as deprecated in the playbook. Helps prevent repeating outdated approaches.\n\nFLOW:\n1. Get all deprecatedPatterns from playbook\n2. For each deprecated pattern:\n   a. Check if pattern.oldPattern appears in any history snippet\n   b. If found, generate warning string using pattern.replacement\n3. Return array of warning strings\n\nDEPRECATED PATTERN STRUCTURE:\n{\n  oldPattern: string,        // What to look for (regex or literal)\n  replacement: string,       // What to use instead\n  reason?: string,          // Why it was deprecated\n  deprecatedAt: Date        // When it was deprecated\n}\n\nEXAMPLE:\nPlaybook has:\n  { oldPattern: 'AuthHandler', replacement: 'AuthService', reason: 'Refactored to service pattern' }\n\nHistory contains:\n  'Using AuthHandler.authenticate() for login flow'\n\nOutput:\n  ['AuthHandler class was deprecated - use AuthService instead (Reason: Refactored to service pattern)']\n\nWARNING FORMAT:\n'{oldPattern} was deprecated - use {replacement} instead'\nIf reason exists: append '(Reason: {reason})'\n\nMATCHING LOGIC:\n- Case-sensitive substring match by default\n- Support regex if pattern starts with '/' (optional enhancement)\n- Match against snippet content only (not metadata)\n\nUSE CASE:\nPrevents agent from learning from old sessions that use deprecated approaches, even if those sessions were marked helpful at the time.\n\nIMPLEMENTATION NOTES:\n- Return empty array if no deprecatedPatterns defined\n- Return empty array if history is empty\n- Multiple warnings possible (one per deprecated pattern found)","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:44:58.536656Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-0thy","title":"[Unit Tests] reflect.ts - Reflector pipeline functions","description":"## Unit Tests: reflect.ts - Reflector Pipeline Functions\n\n### Test Categories\n\n#### 1. runReflector()\n- Generates structured reflection from session content\n- Includes summary, lessons, patterns, warnings\n- Handles empty session gracefully\n- Respects max tokens/length constraints\n\n#### 2. extractDiaryFields()\n- Parses LLM response into diary structure\n- Handles missing optional fields\n- Validates field types\n- Sanitizes malformed content\n\n#### 3. buildReflectionPrompt()\n- Includes session transcript excerpts\n- Includes existing playbook context\n- Formats as clear LLM instruction\n- Handles long sessions (truncation)\n\n#### 4. parseReflectionResponse()\n- Extracts structured data from LLM JSON\n- Handles markdown-wrapped JSON\n- Falls back gracefully on parse errors\n- Validates against expected schema\n\n#### 5. shouldReflect()\n- True when session exceeds min message count\n- True when time since last reflection > threshold\n- False for trivial sessions\n- Respects force flag override\n\n#### 6. Edge Cases\n- Very long sessions (1000+ messages)\n- Sessions with only system messages\n- Sessions with code blocks and special chars\n- Non-UTF8 content handling\n\n### Test Approach\n- Use sample session fixtures\n- Verify prompt construction (no LLM calls)\n- Test parsing with various LLM response formats\n- Real file I/O for diary writes","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-08T01:23:30.386074Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-0thy","depends_on_id":"cass_memory_system-ep5y","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"},{"issue_id":"cass_memory_system-0thy","depends_on_id":"cass_memory_system-p4mv","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"},{"issue_id":"cass_memory_system-0thy","depends_on_id":"cass_memory_system-yj1z","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"}]}
{"id":"cass_memory_system-0up6","title":"[UX][safety] Prevent accidental overwrite for commands that write files","description":"Problem\n- Some commands can write to user-specified paths (e.g., `cm project --output <path>`), and currently overwrite without confirmation.\n- This can clobber files (AGENTS.md, docs) unexpectedly.\n\nWhat to do\n- For commands that write files, adopt a safe default:\n  - If target exists: refuse and instruct to pass `--force`\n  - Optionally support `--dry-run` to print to stdout without writing\n- Ensure behavior is consistent across any file-writing commands.\n\nNotes\n- This is a UX safety improvement; it also aligns with the broader “explicit intent” principle.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-13T10:33:08.398962Z","updated_at":"2025-12-13T21:07:54.012950Z","closed_at":"2025-12-13T21:07:54.012950Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-0up6","depends_on_id":"cass_memory_system-0pm7","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"},{"issue_id":"cass_memory_system-0up6","depends_on_id":"cass_memory_system-jfc5","type":"parent-child","created_at":"2026-01-21T09:28:49Z","created_by":"import"}]}
{"id":"cass_memory_system-0z1y","title":"[CLI:stats] renderStatsUI - Pretty terminal output","description":"Implements the renderStatsUI function that creates beautiful terminal output for playbook statistics.\n\nFUNCTION SIGNATURE:\n```typescript\nfunction renderStatsUI(stats: PlaybookStats): string\n```\n\nOUTPUT FORMAT:\n```\n╭─────────────────────────────────────────────────────╮\n│              CASS-MEMORY PLAYBOOK HEALTH            │\n├─────────────────────────────────────────────────────┤\n│ Total Bullets: 156 (Global: 89, Workspace: 67)      │\n│                                                     │\n│ BY MATURITY:                                        │\n│   ● Candidate:   23 (14.7%)  ░░░░░                  │\n│   ● Established: 87 (55.8%)  ████████████████       │\n│   ● Proven:      41 (26.3%)  ████████               │\n│   ● Deprecated:   5 ( 3.2%)  █                      │\n│                                                     │\n│ BY TYPE:                                            │\n│   ● Rules:         142 (91.0%)                      │\n│   ● Anti-Patterns:  14 ( 9.0%)                      │\n│                                                     │\n│ SCORE DISTRIBUTION:                                 │\n│   🌟 Excellent (8+):  28 (17.9%)                    │\n│   ✓  Good (4-7):      94 (60.3%)                    │\n│   –  Neutral (0-3):   29 (18.6%)                    │\n│   ⚠  At Risk (<0):     5 ( 3.2%)                    │\n│                                                     │\n│ TOP PERFORMERS:                                     │\n│   1. [12.4] Use React.memo for expensive renders   │\n│   2. [11.8] Run migrations in transaction          │\n│   3. [10.2] Validate input at API boundary         │\n│                                                     │\n│ ⚠  AT RISK (5):                                     │\n│   • [-2.1] abc-123: Cache without expiry           │\n│   • [-1.5] def-456: Skip error handling            │\n│                                                     │\n│ 📊 STALE BULLETS (12): No feedback in 90+ days     │\n│ 🔗 MERGE CANDIDATES (3): High similarity detected  │\n│                                                     │\n│ 💡 RECOMMENDATIONS:                                 │\n│   • Review at-risk bullets: cass-memory show <id>  │\n│   • Consider merging similar rules                 │\n│   • Clean up stale bullets                         │\n╰─────────────────────────────────────────────────────╯\n```\n\nIMPLEMENTATION REQUIREMENTS:\n\n1. BOX DRAWING:\n   - Use Unicode box characters (╭╮╰╯├┤│─)\n   - Dynamic width based on terminal size\n   - Proper padding and alignment\n\n2. COLOR CODING (using chalk):\n   - Green: Good metrics, top performers\n   - Yellow: Neutral, warnings\n   - Red: At risk, negative scores\n   - Blue: Headers, section titles\n   - Gray: Secondary information\n\n3. VISUAL ELEMENTS:\n   - Bar charts using █░ characters\n   - Percentage display with proper formatting\n   - Icons/emoji for quick scanning\n   - Proper number formatting (1,234 vs 1234)\n\n4. RESPONSIVE LAYOUT:\n   - Detect terminal width\n   - Truncate long bullet previews with ellipsis\n   - Adjust bar chart length to fit\n   - Collapse sections if terminal too narrow\n\n5. INFORMATION HIERARCHY:\n   - Most important metrics at top\n   - Actionable items highlighted\n   - Supporting details below\n   - Recommendations at bottom\n\nCONTENT PRIORITIZATION:\n- Show top 3 performers (not all 10)\n- Show all at-risk bullets (critical)\n- Summarize stale/merge counts (details via other commands)\n- Include next-action recommendations\n\nACCESSIBILITY:\n- Works in non-color terminals (fallback to ASCII)\n- Readable without emoji support\n- Screen reader friendly (avoid pure visual elements)\n\nDEPENDENCIES:\n- chalk (colors)\n- terminal-size (width detection)\n- String utilities (truncate, pad, align)\n\nSUCCESS CRITERIA:\n- Output fits in standard 80-column terminal\n- Colors enhance readability without being essential\n- All key metrics visible at a glance\n- Actionable insights clearly highlighted\n- Professional appearance suitable for demos","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:54:03.844591Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-14xw","title":"[Docs] CONTRIBUTING.md - Contribution guidelines","description":"Create CONTRIBUTING.md with contribution guidelines for developers.\n\nSections:\n1. Development Setup:\n   - Prerequisites: Node.js 18+, Bun, Git\n   - Clone repository\n   - Install dependencies: bun install\n   - Run in development: bun run dev\n   \n2. Running Tests:\n   - Unit tests: bun test\n   - Integration tests: bun test:integration\n   - Coverage: bun test --coverage\n   \n3. Code Style:\n   - TypeScript strict mode enabled\n   - Prettier for formatting\n   - ESLint for linting\n   - Run: bun run lint && bun run format\n   \n4. PR Process:\n   - Fork repository\n   - Create feature branch\n   - Write tests for new features\n   - Ensure all tests pass\n   - Update documentation\n   - Submit PR with clear description\n   \n5. Issue Templates:\n   - Bug reports\n   - Feature requests\n   - Documentation improvements\n   \n6. Architecture Overview:\n   - Brief explanation for contributors\n   - Link to detailed architecture docs\n\nCode of Conduct: Be respectful and constructive","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-07T21:49:46.118799Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-15k5","title":"Fix reflect --session to bypass processed log","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-07T04:20:42.705881061Z","created_by":"ubuntu","updated_at":"2026-01-07T04:21:01.494881237Z","closed_at":"2026-01-07T04:21:01.494881237Z","close_reason":"Allow explicit --session reflection even if already processed","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-16qf","title":"[Bug] Curate: Auto-deprecation blocks anti-pattern inversion","status":"tombstone","priority":0,"issue_type":"bug","created_at":"2025-12-08T01:08:58.592115Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"bug","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-1bbr","title":"[UX][onboarding] Update quickstart messaging (accurate automation + tips)","description":"Problem\n- `cm quickstart` is meant to be agent self-documentation, but some phrasing implies reflection “automation handles this” without clearly stating that an operator must set up cron/hook.\n- It also doesn’t mention degraded-mode expectations (cass missing/index missing) or privacy defaults.\n\nWhat to do\n- Refresh quickstart content to be:\n  - Accurate about what agents do vs what operators configure\n  - Clear about what happens when components are missing\n  - Explicit about privacy posture (cross-agent enrichment is opt-in)\n- Ensure it stays concise and agent-friendly.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-13T10:20:30.606916Z","updated_at":"2025-12-13T23:07:10.704692Z","closed_at":"2025-12-13T23:07:10.704692Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-1bbr","depends_on_id":"cass_memory_system-1ojv","type":"parent-child","created_at":"2026-01-21T09:28:49Z","created_by":"import"}]}
{"id":"cass_memory_system-1ce","title":"[Playbook] getBulletsByCategory - Filter bullets by category","description":"## Function Signature\n```typescript\nfunction getBulletsByCategory(\n  playbook: Playbook,\n  category: string,\n  includeDeprecated?: boolean\n): PlaybookBullet[]\n```\n\n## Purpose\nFilter bullets by category with optional inclusion of deprecated bullets. Returns sorted array by effective score.\n\n## Algorithm\n1. Filter playbook.bullets by category match\n2. If includeDeprecated is false (default):\n   - Filter out bullets with state === \"retired\"\n   - Filter out bullets with maturity === \"deprecated\"\n3. Calculate effective score for each bullet\n4. Sort by effective score (descending)\n5. Return sorted array\n\n## Category Matching\n- **Exact match**: category === bullet.category\n- **Case-insensitive**: Normalize to lowercase\n- **Common categories**: \"testing\", \"security\", \"performance\", \"code-quality\", \"documentation\"\n\n## Effective Score Sorting\nPriority order:\n1. Highest score first (most helpful)\n2. Recent validation (newer lastValidatedAt)\n3. Maturity level (proven > established > candidate)\n\n## includeDeprecated Parameter\n```typescript\n// Active bullets only (default)\nconst testing = getBulletsByCategory(playbook, \"testing\");\n\n// Include deprecated for historical analysis\nconst allTesting = getBulletsByCategory(playbook, \"testing\", true);\n```\n\n## Usage Scenarios\n1. **Context generation**: Get top N rules for category\n2. **Category stats**: Count bullets per category\n3. **Markdown export**: Group bullets by category\n4. **Search**: Find rules in specific domain\n\n## Implementation Notes\n- Case-insensitive category matching\n- Sort by effective score for relevance\n- Default excludes deprecated (most common use)\n- Return empty array if no matches\n\n## Return Value\n```typescript\nPlaybookBullet[]  // Sorted by effective score DESC\n```\n\n## Dependencies\n- calculateEffectiveScore() - for sorting\n- getActiveBullets() - similar filtering\n\n## Related Functions\n- getActiveBullets() - all active bullets\n- exportToMarkdown() - uses this for grouping\n- findMergeCandidates() - groups by category first","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:45:10.558681Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-1f7","title":"[Playbook] savePlaybook - Write playbook to YAML","description":"## Function Signature\n```typescript\nasync function savePlaybook(playbook: Playbook, config: Config): Promise<void>\n```\n\n## Purpose\nWrite playbook to YAML file atomically. Updates metadata and prevents corruption through atomic write strategy.\n\n## Algorithm\n1. Update metadata.lastReflection to now()\n2. Ensure parent directory exists (mkdir -p)\n3. Stringify with yaml.stringify()\n4. Write atomically:\n   - Write to `{playbookPath}.tmp`\n   - Rename to `{playbookPath}` (atomic operation)\n5. Update metadata.totalReflections if changed\n\n## Atomic Write Strategy\n**Critical**: Never write directly to playbook.yaml\n- Write to temporary file first\n- Rename is atomic on POSIX systems\n- Prevents corruption if process crashes mid-write\n- Ensures playbook is always in valid state\n\n## Metadata Updates\n- `lastReflection`: Always updated to current timestamp\n- `totalReflections`: Incremented if bullets changed\n- `totalSessionsProcessed`: Updated by curator\n\n## Implementation Notes\n- Use fs.promises.rename() for atomic rename\n- Use yaml.stringify() with proper formatting\n- Ensure directory exists before writing\n- Handle EACCES permission errors\n\n## Error Handling\n- **EACCES**: Permission denied on directory or file\n- **ENOSPC**: No space left on device\n- **EIO**: I/O errors during write\n\n## Dependencies\n- fs/promises\n- yaml library\n- path module for directory handling\n\n## Related Functions\n- loadPlaybook() - reads what this writes\n- All mutation functions - call this to persist changes","notes":"Existing playbook helper implementations already present; no code changes made. Released reservation; feel free to take over.","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:44:46.901077Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-1gub","title":"[Docs] Error messages and troubleshooting guide","description":"Document common error messages and troubleshooting solutions.\n\nCommon errors:\n- 'cass not found' → Installation instructions for cass CLI prerequisite\n- 'API key missing' → How to set OPENAI_API_KEY or ANTHROPIC_API_KEY environment variables\n- 'Playbook corrupt' → Recovery instructions using validate and backup restoration\n- 'Rate limited' → Explanation of exponential backoff and retry logic\n- 'Permission denied' → chmod +x instructions for binary\n- 'Config file invalid' → JSON/YAML validation and schema errors\n- 'SQLite locked' → Concurrent access issues and solutions\n- 'Session file not found' → Path configuration and session discovery\n\nFor each error:\n- Error message text\n- Root cause explanation\n- Step-by-step solution\n- Prevention tips\n\nInclude diagnostic commands like 'doctor' for automatic troubleshooting","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-07T21:49:40.351434Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-1h9","title":"[Diary] extractDiarySafe - Extraction with fallback","description":"Safe wrapper around diary extraction with graceful fallback on failure.\n\nFunction Signature:\nasync function extractDiarySafe(\n  sessionContent: string,\n  metadata: SessionMetadata,\n  config: Config\n): Promise<DiaryEntry>\n\nProcess:\n1. Try calling extractDiaryFields(sessionContent, metadata, config)\n2. On success: Return full DiaryEntry with all extracted fields\n3. On failure: Return minimal fallback DiaryEntry\n\nFallback DiaryEntry Structure:\n- status: 'mixed'\n- accomplishments: ['[Extraction failed - see raw session]']\n- challenges: ['Diary extraction error: {error.message}']\n- decisions: []\n- preferences: []\n- keyLearnings: []\n- suggestedTags: ['extraction-failure']\n- sessionPath: metadata.sessionPath\n- agent: metadata.agent\n- workspace: metadata.workspace\n- timestamp: current time\n\nKey Features:\n- Never crashes on LLM failure\n- Preserves session reference even on failure\n- Error message stored as challenge\n- Enables post-mortem debugging\n- Maintains diary continuity\n\nError Scenarios Handled:\n- LLM API timeout or rate limit\n- Invalid JSON response from LLM\n- Schema validation failure\n- Network errors\n- Prompt token limit exceeded\n\nPhilosophy:\nA minimal diary is better than no diary. Failed extractions are marked clearly but don't break the pipeline.\n\nOutput:\nAlways returns valid DiaryEntry, either full extraction or minimal fallback.","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:45:25.166810Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-1jdn","title":"[Foundation] Define ~/.cass-memory/ directory structure","description":"Define and implement the ~/.cass-memory/ global directory structure for user-level CASS Memory System data.\n\n## Context\nThe ~/.cass-memory/ directory is the user's global memory store, containing personal configuration, playbooks, diary entries, and usage tracking. This directory persists across all projects and repositories the user works on, serving as their personal agent memory layer.\n\n## Technical Specification\n\n### Directory Structure:\n~/.cass-memory/\n├── config.json              # User configuration (API keys, default model, etc.)\n├── playbook.yaml            # Personal global playbook (rules across all projects)\n├── toxic_bullets.log        # Permanently blocked patterns (user-level)\n├── diary/                   # Diary entries organized by date\n│   ├── 2025-12-07.md\n│   ├── 2025-12-06.md\n│   └── ...\n├── reflections/             # Processed session tracking\n│   ├── session-abc123.json\n│   ├── session-def456.json\n│   └── ...\n├── usage.jsonl              # Bullet usage log with timestamps\n├── embeddings/              # Local vector store for semantic search\n│   ├── index.bin\n│   └── metadata.json\n└── cost/                    # LLM cost tracking\n    ├── monthly-2025-12.jsonl\n    └── total.json\n\n### File Specifications:\n\n#### config.json:\n- llm_provider: 'openai' | 'anthropic' | 'google'\n- model: string (e.g., 'gpt-4', 'claude-opus-4-5', 'gemini-pro')\n- api_key: string (primary API key)\n- api_keys: { openai?: string, anthropic?: string, google?: string }\n- max_tokens: number (default response length)\n- temperature: number (0-1, creativity setting)\n- enable_curation: boolean (auto-curate bullets)\n- evidence_threshold: number (usage count before LLM curation)\n- enable_sanitization: boolean (auto-detect secrets)\n\n#### playbook.yaml:\n- bullets: Array of global rules (applies to ALL projects)\n- categories: SETUP, BUILD, TEST, DEBUG, DEPLOY, etc.\n- each bullet has: content, context, priority, state, usage_count\n\n#### toxic_bullets.log:\n- Newline-delimited list of blocked bullet content\n- Case-insensitive matching\n- Applied globally to prevent toxic rules\n\n#### diary/ (daily markdown files):\n- One file per day: YYYY-MM-DD.md\n- Timestamped entries\n- Free-form text + metadata frontmatter\n- Used for reflection and pattern extraction\n\n#### reflections/ (session metadata):\n- One JSON file per session\n- session_id, timestamp, repo_path, command, duration\n- extracted_patterns: Array of learned behaviors\n- applied_bullets: Array of bullets used in session\n\n#### usage.jsonl (bullet tracking):\n- One line per bullet usage\n- timestamp, bullet_hash, repo_path, session_id, outcome\n- Used for evidence-based curation\n- Queryable for historical analysis\n\n#### embeddings/ (vector store):\n- Binary index for fast semantic search\n- Metadata mapping IDs to bullet content\n- Future: enable natural language playbook queries\n\n#### cost/ (LLM usage tracking):\n- Monthly JSONL files: timestamp, provider, model, tokens, cost\n- total.json: cumulative spend across all providers\n- Helps users budget LLM usage\n\n## Reasoning\n\n### Why Global Directory:\n1. Cross-Project Memory: Rules learned in one project apply to others\n2. User Ownership: User controls their personal memory store\n3. Privacy: Personal diary and usage data stays local\n4. Portability: Backup and restore entire memory with one directory\n\n### Why config.json:\n1. Single Source of Truth: All LLM configuration in one place\n2. API Key Security: Stored locally, never committed to git\n3. User Preferences: Default model and behavior settings\n4. Easy Onboarding: cass-memory init walks through setup\n\n### Why playbook.yaml:\n1. Human-Readable: YAML is easy to edit manually\n2. Version-Controllable: Can commit to dotfiles repo\n3. Mergeable: Combines with repo-level playbooks\n4. Hierarchical: Categories organize rules logically\n\n### Why toxic_bullets.log:\n1. Safety Net: Prevents re-learning bad patterns\n2. Permanent: Once blocked, stays blocked\n3. User Control: Users curate their own blocklist\n4. Simple Format: Plain text, easy to inspect/edit\n\n### Why diary/:\n1. Human-Readable: Markdown for manual review\n2. Daily Organization: Natural time-based structure\n3. Reflection Source: LLM mines diary for patterns\n4. Debugging: Understand what agent was thinking\n\n### Why reflections/:\n1. Session Tracking: Know what agent learned when\n2. Reproducibility: Trace which bullets were applied\n3. Analytics: Measure bullet effectiveness\n4. Audit Trail: Compliance and debugging\n\n### Why usage.jsonl:\n1. Evidence-Based: Track which rules are actually useful\n2. Queryable: Filter by repo, time range, outcome\n3. Curation Input: LLM uses usage data for decisions\n4. Append-Only: Fast writes, no corruption risk\n\n### Why embeddings/:\n1. Semantic Search: Find similar rules without exact matches\n2. Local-First: No cloud dependency for search\n3. Future-Proof: Enables natural language queries\n4. Privacy: Embeddings stay on user's machine\n\n### Why cost/:\n1. Budget Tracking: Know how much LLM usage costs\n2. Provider Comparison: See which provider is most cost-effective\n3. Monthly Reports: Track spending trends\n4. Transparency: Users see exactly what they're paying\n\n## Acceptance Criteria\n\n- ~/.cass-memory/ directory is created on cass-memory init\n- All subdirectories created (diary, reflections, embeddings, cost)\n- config.json has sensible defaults if not present\n- playbook.yaml created with empty bullets array\n- toxic_bullets.log created (empty file)\n- usage.jsonl created (empty file)\n- Permissions set correctly (user read/write only for config.json)\n- Directory creation is idempotent (safe to run multiple times)\n- Helper functions in utils.ts: resolveGlobalDir(), ensureGlobalStructure()\n- cass-memory doctor verifies directory structure\n\n## How This Serves the Universal Agent Memory System\n\nThe ~/.cass-memory/ directory is the user's personal memory layer:\n\n1. Persistence: Memory survives across projects, jobs, and machines\n2. Privacy: Personal diary and usage data never leaves user's machine\n3. Portability: Backup entire memory with one directory\n4. Cross-Project Learning: Rules learned in project A apply to project B\n5. User Control: Users own and curate their memory\n6. Multi-Agent Support: Future agents can read from same memory store\n\nThis global directory is the foundation for the universal agent memory vision. Without it, agents would be memoryless, relearning the same patterns in every project.","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:47:22.033613Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-1ojv","title":"[UX] Onboarding & Discoverability","description":"Why this matters\n- The system is powerful but adoption hinges on a smooth first-run experience and clear mental model.\n- Current docs and outputs sometimes contradict behavior (entrypoints, config paths, automation expectations).\n\nScope\n- Make install → init → doctor → first context flow obvious and copy/paste correct.\n- Improve `cm --help` information architecture (agent vs operator).\n- Ensure quickstart text matches real-world operation (cron/hook for reflect, privacy defaults).","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-12-13T10:13:30.064069Z","updated_at":"2025-12-14T00:10:29.167784Z","closed_at":"2025-12-14T00:10:29.167784Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-1ojv","depends_on_id":"cass_memory_system-q6uv","type":"parent-child","created_at":"2026-01-21T09:28:49Z","created_by":"import"}]}
{"id":"cass_memory_system-1sp","title":"[Curator] handleMergeDelta - Combine similar bullets","description":"Combine multiple similar bullets into a single consolidated rule.\n\nSignature:\nfunction handleMergeDelta(\n  playbook: Playbook,\n  delta: MergeDelta\n): { applied: boolean; newBulletId?: string }\n\nProcess:\n1. Find all bullets by delta.bulletIds\n   - If any not found: return applied: false\n2. Aggregate feedback from all bullets:\n   - Concatenate helpfulEvents arrays\n   - Concatenate harmfulEvents arrays\n   - Sum helpfulCount\n   - Sum harmfulCount\n3. Create new merged bullet:\n   - content: delta.mergedContent\n   - category: inherit from highest-maturity source\n   - kind: inherit from highest-maturity source\n   - maturity: max(source maturities)\n   - state: 'active'\n   - helpfulCount: aggregated total\n   - harmfulCount: aggregated total\n   - helpfulEvents: aggregated array\n   - harmfulEvents: aggregated array\n   - createdAt: earliest of source bullets\n   - updatedAt: current timestamp\n4. Deprecate all source bullets:\n   - For each source: handleDeprecateDelta\n   - Set deprecationReason: 'merged'\n   - Set replacedBy: new bullet ID\n5. Return applied: true, newBulletId\n\nWhy merge?\n- Consolidate duplicate rules with slightly different wording\n- Combine partial rules into comprehensive guidance\n- Reduce playbook bloat\n\nFeedback aggregation preserves trust earned across all sources.","status":"tombstone","priority":3,"issue_type":"task","created_at":"2025-12-07T21:45:02.189871Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-1tjx","title":"Task: Fix silent exits in outcome.ts (ensure JSON output)","description":"# Task: Fix Silent Exits in outcome.ts\n\n## Problem\n\noutcome.ts has two code paths that exit without producing JSON when `--json` is set:\n\n### Violation 1: No implicit signal (lines 94-97)\n\n```typescript\nconst scored = scoreImplicitFeedback(input);\nif (!scored) {\n  console.error(chalk.yellow(\"No implicit signal strong enough to record feedback.\"));\n  process.exit(0);  // Agent gets NOTHING when --json is set!\n}\n```\n\n### Violation 2: No outcomes found (lines 154-157)\n\n```typescript\nif (filtered.length === 0) {\n  console.error(chalk.yellow(`No outcomes found for session ${flags.session}`));\n  process.exit(0);  // Agent gets NOTHING when --json is set!\n}\n```\n\n## Impact\n\nAn agent running:\n```bash\ncm outcome success rule-1 --json\n```\n\nGets empty stdout if no signal is strong enough. The agent:\n1. Tries to parse JSON from empty string → fails\n2. Has no idea what happened\n3. Cannot make an informed decision about what to do next\n\n## Solution\n\n### For Violation 1 (no signal):\n\n```typescript\nconst scored = scoreImplicitFeedback(input);\nif (!scored) {\n  if (flags.json) {\n    printJsonResult({\n      feedbackRecorded: false,\n      rulesProvided: ruleIds,\n    }, { effect: false, reason: \"No implicit signal strong enough to record feedback\" });\n    return;  // Use return instead of process.exit for cleaner flow\n  }\n  console.error(chalk.yellow(\"No implicit signal strong enough to record feedback.\"));\n  return;  // Don't use process.exit(0) - just return cleanly\n}\n```\n\n### For Violation 2 (no outcomes):\n\n```typescript\nif (filtered.length === 0) {\n  if (flags.json) {\n    printJsonResult({\n      session: flags.session,\n      outcomesFound: 0,\n    }, { effect: false, reason: `No outcomes found for session ${flags.session}` });\n    return;\n  }\n  console.error(chalk.yellow(`No outcomes found for session ${flags.session}`));\n  return;\n}\n```\n\n## Files to Modify\n\n- src/commands/outcome.ts\n\n## Dependencies\n\n- Depends on: printJsonResult() helper being created first\n\n## Acceptance Criteria\n\n- [ ] `cm outcome success rule-1 --json` produces valid JSON even when no signal\n- [ ] `cm outcome-apply --session nonexistent --json` produces valid JSON\n- [ ] JSON includes `effect: false` and `reason` for soft failures\n- [ ] Human-readable output unchanged when `--json` not set\n- [ ] No more `process.exit(0)` calls - use `return` for clean exit\n\n## Notes\n\nThis is a high-priority fix because outcome recording is a core agent workflow.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-15T18:24:32.204582Z","updated_at":"2025-12-15T19:57:58.323486Z","closed_at":"2025-12-15T19:57:58.323486Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-1tjx","depends_on_id":"cass_memory_system-qwg9","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"}]}
{"id":"cass_memory_system-1v63","title":"[Tracking] Usage analytics tracking","description":"Purpose: Track usage patterns for internal analytics and debugging\n\nFile path: ~/.cass-memory/usage.jsonl\n\nFormat: JSON Lines (one JSON object per line)\n\nExample entries:\n```jsonl\n{\"timestamp\":\"2025-12-07T10:30:00Z\",\"event\":\"bullet_marked\",\"data\":{\"bulletId\":\"rule-123\",\"feedback\":\"helpful\"}}\n{\"timestamp\":\"2025-12-07T10:35:00Z\",\"event\":\"command_run\",\"data\":{\"command\":\"reflect\",\"scope\":\"workspace\",\"duration_ms\":2340}}\n{\"timestamp\":\"2025-12-07T11:00:00Z\",\"event\":\"session_count\",\"data\":{\"provider\":\"claude\",\"count\":15}}\n{\"timestamp\":\"2025-12-07T11:30:00Z\",\"event\":\"bullet_marked\",\"data\":{\"bulletId\":\"rule-456\",\"feedback\":\"harmful\"}}\n```\n\nTracked events:\n- bullet_marked: User feedback on playbook bullets (helpful/harmful)\n- command_run: Which commands executed and performance\n- session_count: Number of sessions discovered per provider\n- reflection_stats: Deltas proposed vs applied\n\nAnalytics use cases:\n- Which bullets are most helpful/harmful\n- Command usage patterns\n- System performance over time\n- Reflection effectiveness\n\nPrivacy: All local, never transmitted","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:51:20.699623Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-1vb","title":"[Foundation] .gitignore for Bun/TypeScript project","description":"Create .gitignore file with comprehensive ignore patterns for Bun, TypeScript, and CASS Memory System artifacts.\n\n## Context\nThe .gitignore file prevents committing build artifacts, dependencies, secrets, and temporary files to version control. This is critical for security, repository cleanliness, and avoiding merge conflicts.\n\n## Technical Specification\n\n### Ignore Patterns:\n\n#### Dependencies:\nnode_modules/\n.pnp.*\n.yarn/\n\n#### Build Output:\ndist/\nbuild/\n*.js (in src/ - TypeScript source only)\n*.d.ts\n*.tsbuildinfo\n\n#### Environment & Secrets:\n.env\n.env.local\n.env.*.local\nconfig.json (if it contains API keys)\n*.key\n*.pem\n*.p12\n\n#### Logs:\n*.log\nnpm-debug.log*\nyarn-debug.log*\nyarn-error.log*\nlerna-debug.log*\npnpm-debug.log*\n\n#### Testing:\ncoverage/\n.nyc_output/\n*.lcov\n\n#### IDE & OS:\n.DS_Store\n.DS_Store?\n._*\n.Spotlight-V100\n.Trashes\nehthumbs.db\nThumbs.db\n.vscode/\n.idea/\n*.swp\n*.swo\n*~\n\n#### Bun Specific:\nbun.lockb (optional - some teams commit this)\n\n#### CASS Memory System Specific:\n.cass/config.yaml (may contain local overrides with secrets)\n.cass/toxic.log (project-specific, should be committed)\ndiary/*.md (personal diary entries - never commit)\nusage.jsonl (personal usage data)\n\n## Reasoning\n\n### Why Ignore node_modules:\n1. Size: Can be hundreds of MB\n2. Reproducibility: package.json and lock file are sufficient\n3. Platform-specific: Some packages compile binaries per OS\n\n### Why Ignore dist/:\n1. Build Artifacts: Generated from source, not source itself\n2. Reproducibility: bun run build recreates it\n3. Binary Size: Compiled binaries are large\n\n### Why Ignore .env:\n1. Security: Contains API keys and secrets\n2. Local Config: Each developer has their own keys\n3. Production Safety: Prevents accidental secret commits\n\n### Why Ignore Logs:\n1. Noise: Logs change frequently\n2. Size: Can grow large quickly\n3. Local: Each developer has their own logs\n\n### Why Ignore IDE Files:\n1. Personal Preference: Each dev uses different editors\n2. Settings Drift: IDE settings are personal\n3. Repository Cleanliness: Not relevant to project\n\n### Why NOT Ignore .cass/playbook.yaml:\n1. Memory as Code: Playbook is part of the project\n2. Team Sharing: All devs should see project-specific rules\n3. Version Control: Track changes to team knowledge\n\n### Why NOT Ignore .cass/toxic.log:\n1. Shared Blocklist: Team should share blocked patterns\n2. Safety: Prevents toxic rules from spreading\n\n## Acceptance Criteria\n\n- .gitignore exists in project root\n- All standard patterns included (node_modules, dist, .env, logs)\n- OS-specific patterns included (.DS_Store, Thumbs.db)\n- IDE patterns included (.vscode, .idea, *.swp)\n- Bun patterns included if needed\n- CASS-specific patterns included\n- Comments explain each section\n- git status shows only relevant files after build\n- Secrets are never tracked (test with dummy .env)\n\n## How This Serves the Universal Agent Memory System\n\nThe .gitignore file protects the integrity and security of the CASS Memory System:\n\n1. Security: Prevents accidental API key commits that could leak to LLM providers\n2. Collaboration: Keeps repository clean for team members\n3. CI/CD: Ensures builds are reproducible without committed artifacts\n4. Privacy: Keeps personal diary entries and usage data local\n5. Memory as Code: Ensures playbooks are committed while secrets are not\n\nWithout proper .gitignore, the repository would be polluted with build artifacts, secrets would be at risk of exposure, and team collaboration would suffer from constant merge conflicts in generated files.","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:46:41.595261Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-1w95","title":"[Unit] config.ts - Configuration Loading & Validation","description":"## Target: src/config.ts (163 LOC) - ZERO CURRENT COVERAGE\n\n### Functions to Test:\n\n1. **getDefaultConfig()** - Factory function\n   - Returns valid ConfigSchema object\n   - All paths are expandable\n   - Default values are sensible\n\n2. **loadConfig(path?)** - Load configuration\n   - Default path: ~/.cass-memory/config.json\n   - Custom path parameter works\n   - Missing file → default config\n   - Invalid JSON → graceful error\n   - Partial config → merged with defaults\n   - Environment variable overrides\n\n3. **saveConfig(config, path?)** - Save configuration\n   - Writes valid JSON\n   - Creates parent directories\n   - Atomic write\n   - Preserves unknown fields (forward compat)\n\n4. **validateConfig(config)** - Validation\n   - Valid config passes\n   - Missing required fields fail\n   - Invalid types fail\n   - Path validation (existence, permissions)\n\n5. **expandConfigPaths(config)** - Path expansion\n   - ~ expanded to home directory\n   - Environment variables expanded\n   - Relative paths resolved\n   - Cross-platform handling\n\n6. **mergeConfigs(base, override)** - Config merging\n   - Override wins on conflicts\n   - Deep merge for nested objects\n   - Arrays replaced, not merged\n\n### Environment Variables:\n- CASS_MEMORY_CONFIG_PATH\n- CASS_PATH override\n- HOME / USERPROFILE handling\n\n### Test Patterns:\n- Use real temp directories\n- Modify env vars in test (restore after)\n- Test permission scenarios where possible","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-08T01:27:52.193388Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-1w95","depends_on_id":"cass_memory_system-mmxv","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"},{"issue_id":"cass_memory_system-1w95","depends_on_id":"cass_memory_system-uufj","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"}]}
{"id":"cass_memory_system-241q","title":"Tests: diary formatRawSession parsing","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T00:54:35.538593386Z","created_by":"ubuntu","updated_at":"2026-01-07T00:55:28.894821001Z","closed_at":"2026-01-07T00:55:28.894821001Z","close_reason":"Added formatRawSession parsing tests in diary.fast.test.ts","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-241q","depends_on_id":"cass_memory_system-sdt1.4","type":"discovered-from","created_at":"2026-01-21T09:28:49Z","created_by":"import"}]}
{"id":"cass_memory_system-24qw","title":"Implement 'cm trauma' CLI Management","description":"CLI commands to manage the Trauma registry.\n\nCommands:\n- 'cm trauma list': Show all active scars/traumas.\n- 'cm trauma add <pattern> --severity CRITICAL --message \"...\"': Manually record a scar.\n- 'cm trauma remove <id>': Remove a scar (requires --force).\n- 'cm trauma import <file>': Bulk import.\n\nPurpose: Allow humans (and audits) to manage the list of permanent scars.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-18T03:59:33.430164Z","updated_at":"2025-12-20T22:52:21.377426Z","closed_at":"2025-12-20T22:52:21.377426Z","close_reason":"Added trauma remove/import commands (force-confirmed removal + bulk import)","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-24qw","depends_on_id":"cass_memory_system-653r","type":"discovered-from","created_at":"2026-01-21T09:28:49Z","created_by":"import"}]}
{"id":"cass_memory_system-25k","title":"[Utils] daysSince - Days elapsed since timestamp","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:45:12.013850Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-26k9","title":"Task: Remove unused _task parameter from outcomeCommand","description":"# Task: Remove Unused _task Parameter\n\n## Context\n\nThe outcomeCommand function has an unused parameter that's just taking up space.\n\n## Current State (outcome.ts:47-48)\n\n```typescript\nexport async function outcomeCommand(\n  _task: string | undefined,  // NEVER USED\n  flags: {\n    session?: string;\n    status?: string;\n    rules?: string;\n    // ...\n  }\n)\n```\n\nThe `_task` parameter is declared but never referenced in the function body. The underscore prefix indicates the author knew it was unused.\n\n## Investigation\n\nCheck cm.ts to see how this function is called:\n\n```typescript\n// cm.ts - likely passes positional arg that's ignored\n.action(async (status, rules, opts) => {\n  await outcomeCommand(undefined, { ...opts, status, rules });\n});\n```\n\nIf `undefined` is always passed, remove the parameter entirely.\n\n## Solution\n\n```typescript\n// Before\nexport async function outcomeCommand(\n  _task: string | undefined,\n  flags: {...}\n)\n\n// After  \nexport async function outcomeCommand(\n  flags: {...}\n)\n```\n\nAlso update the call site in cm.ts.\n\n## Files to Modify\n\n- src/commands/outcome.ts - Remove parameter\n- src/cm.ts - Update call site\n\n## Acceptance Criteria\n\n- [ ] No unused parameters in outcomeCommand\n- [ ] TypeScript compilation succeeds\n- [ ] All tests pass\n\n## Priority\n\nP3 - Cleanup, not blocking.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-15T18:26:47.635647Z","updated_at":"2025-12-15T20:55:03.230011Z","closed_at":"2025-12-15T20:55:03.230011Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-27y","title":"[Playbook] pinBullet/unpinBullet - Protect bullet from auto-prune","description":"## Function Signature\n```typescript\nfunction pinBullet(playbook: Playbook, bulletId: string, reason: string): void\nfunction unpinBullet(playbook: Playbook, bulletId: string): void\n```\n\n## Purpose\nProtect critical bullets from auto-pruning. Pinned bullets are NEVER automatically deprecated, even if they accumulate harmful feedback.\n\n## Pin Implementation\n```typescript\nconst bullet = findBullet(playbook, bulletId);\nif (!bullet) throw new Error(`Bullet not found: ${bulletId}`);\n\nbullet.pinned = true;\nbullet.pinnedReason = reason;\nbullet.updatedAt = now();\n```\n\n## Unpin Implementation\n```typescript\nconst bullet = findBullet(playbook, bulletId);\nif (!bullet) throw new Error(`Bullet not found: ${bulletId}`);\n\nbullet.pinned = false;\nbullet.pinnedReason = undefined;\nbullet.updatedAt = now();\n```\n\n## Why Pin Bullets?\n1. **Critical organizational rules**: Never prune core principles\n2. **Regulatory requirements**: Legal/compliance rules must stay\n3. **Prevent accidental removal**: Protect proven valuable rules\n4. **Override auto-prune**: Keep despite negative feedback\n\n## Common Pin Reasons\n- \"Core organizational principle\"\n- \"Regulatory compliance requirement\"\n- \"Explicitly requested by team lead\"\n- \"Historical knowledge - must preserve\"\n- \"Critical security guideline\"\n\n## Auto-Prune Protection\n```typescript\nfunction shouldPrune(bullet: PlaybookBullet): boolean {\n  if (bullet.pinned) return false;  // NEVER prune pinned\n  \n  // Check harmful threshold, etc...\n}\n```\n\n## Pin vs High Priority\n- **Pinned**: Never auto-pruned, preserved indefinitely\n- **High maturity**: Can still be pruned if harmful\n- **Both**: Pinned overrides all auto-prune logic\n\n## Usage Scenarios\n1. **Manual pin**: User runs `cm pin {bulletId} --reason=\"...\"`\n2. **Migration**: Pin critical rules during schema upgrades\n3. **Organizational policy**: Pin company-wide standards\n4. **Recovery**: Pin after accidental auto-prune\n\n## Implementation Notes\n- Check pinned status BEFORE any auto-prune logic\n- Store reason for audit trail\n- Allow unpinning when no longer needed\n- Show pinned status in stats/list commands\n\n## Dependencies\n- findBullet()\n\n## Related Functions\n- autoPrune() - checks pinned status\n- getActiveBullets() - includes pinned bullets\n- deprecateBullet() - manual deprecation still works","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:45:09.305217Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-2bnu","title":"[Analysis] Document Agent Ergonomics Requirements","description":"# Document Agent Ergonomics Requirements\n\n## Purpose\nBefore making changes, we need to formally document what makes a tool ergonomic for AI agents. This becomes the design spec that guides all other work.\n\n## Key Questions to Answer\n\n1. **Context Window Economics**\n   - How much context budget can agents afford for memory retrieval?\n   - What's the sweet spot for context output size? (100 tokens? 500? 1000?)\n   - How should output scale with task complexity?\n\n2. **Command Frequency Analysis**\n   - Which commands do agents actually need to call?\n   - Which should be automated/hooks?\n   - Which are human-only operations?\n\n3. **Feedback Mechanisms**\n   - What's the lowest-friction way for agents to mark rules helpful/harmful?\n   - Can we parse structured comments from session logs?\n   - Should feedback be explicit commands or implicit signals?\n\n4. **Output Format Requirements**\n   - JSON structure for LLM consumption\n   - Essential vs optional fields\n   - Error message format for agent recovery\n\n## Deliverables\n- [ ] Written requirements doc (can be in this bead's comments or separate file)\n- [ ] Command categorization: Essential / Occasional / Automated / Human-only\n- [ ] Recommended output size targets\n- [ ] Feedback mechanism design\n\n## Considerations\n- Look at how other agent tools handle this (cass, beads/bv)\n- Consider different agent capabilities (context size, tool calling, etc.)\n- Balance between \"power user\" features and \"just works\" simplicity","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-08T17:45:55.220435Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-2cb3","title":"[E2E Tests] Toxic bullet blocking - semantic similarity filtering","description":"## E2E Test: Toxic Bullet Blocking - Semantic Similarity Filtering\n\n### Test Scenario\nTest that toxic/blocked bullets prevent similar content from surfacing\n\n### Test Steps\n\n#### 1. Exact Match Blocking\n- Add 'Never use eval()' to toxic list\n- Generate context that would include eval\n- Verify eval-related bullets filtered out\n\n#### 2. Semantic Similarity Blocking\n- Toxic: 'Avoid using any type'\n- Attempt to add: 'Use any for flexibility'\n- Verify semantically similar blocked\n- Test similarity threshold\n\n#### 3. Partial Match Handling\n- Toxic: 'console.log'\n- Bullet: 'Use console.log for debugging'\n- Verify blocked (contains toxic term)\n\n#### 4. Non-Blocking Similar\n- Toxic: 'Never use var'\n- Bullet: 'Use const/let instead of var'\n- Verify NOT blocked (different intent)\n\n#### 5. Context Generation Filtering\n- Playbook with mixed bullets (some toxic-similar)\n- Generate context\n- Verify toxic-similar filtered from output\n- Log which bullets were filtered\n\n### Verbose Logging\n- Log: 'Checking bullet against toxic list...'\n- Log: 'Toxic check: <bullet snippet>'\n- Log: 'Similarity to toxic \"X\": Y%'\n- Log: 'BLOCKED: similarity Y% exceeds threshold Z%'\n- Log: 'PASSED: no toxic similarity'\n\n### Threshold Configuration\n- Test default threshold (80%?)\n- Test custom threshold via config\n- Verify threshold respected","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-08T01:24:56.790085Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-2cb3","depends_on_id":"cass_memory_system-33w3","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"},{"issue_id":"cass_memory_system-2cb3","depends_on_id":"cass_memory_system-ep5y","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"},{"issue_id":"cass_memory_system-2cb3","depends_on_id":"cass_memory_system-yj1z","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"}]}
{"id":"cass_memory_system-2ejl","title":"[Unit] playbook.ts - Merging & Advanced Operations (Part 2)","description":"## Target: src/playbook.ts (697 LOC) - Part 2\n\n### Part 2: Merging & Advanced Operations\n\n1. **mergePlaybooks(global, repo)** - Merge global and repo playbooks\n   - Repo bullets override global by ID\n   - Non-conflicting bullets combined\n   - Metadata merged appropriately\n   - Empty playbooks handled\n   - Order preservation\n\n2. **findBulletById(playbook, id)** - Find bullet\n   - Returns bullet if found\n   - Returns null/undefined if not found\n   - Case sensitivity rules\n\n3. **findBulletsByScope(playbook, scope)** - Filter by scope\n   - Exact scope match\n   - Wildcard matching\n   - Global scope returns all\n   - Empty results valid\n\n4. **findBulletsByTag(playbook, tag)** - Filter by tag\n   - Single tag match\n   - Multiple tags (AND vs OR)\n   - Case sensitivity\n   - Empty tags handling\n\n5. **pinBullet(playbook, id)** / **unpinBullet(playbook, id)**\n   - Sets pinned: true/false\n   - Returns updated playbook\n   - Idempotent operations\n\n6. **pruneBullets(playbook, options)** - Auto-prune\n   - Remove bullets below score threshold\n   - Keep pinned bullets regardless\n   - Respect maxAge option\n   - Return count of pruned\n\n7. **exportToMarkdown(playbook)** - Markdown export\n   - Valid markdown output\n   - Preserves structure\n   - Handles special characters\n   - Code blocks escaped properly\n\n### Merge Conflict Scenarios:\n- Same ID, different content\n- Same ID, different feedbackEvents\n- Timestamps for conflict resolution\n- Priority overrides","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-08T01:27:50.693282Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-2ejl","depends_on_id":"cass_memory_system-5oro","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"},{"issue_id":"cass_memory_system-2ejl","depends_on_id":"cass_memory_system-mmxv","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"},{"issue_id":"cass_memory_system-2ejl","depends_on_id":"cass_memory_system-uufj","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"}]}
{"id":"cass_memory_system-2erm","title":"[UX][output] Respect NO_COLOR and add CASS_MEMORY_NO_EMOJI","description":"Problem\n- Commands use emojis and color inconsistently. In some terminals/CI logs this reduces readability.\n- Premium CLIs respect standard conventions (NO_COLOR) and allow “plain” output.\n\nWhat to do\n- Ensure color output respects NO_COLOR (and/or a `--no-color` flag).\n- Add a global “no emoji” toggle (env var + optional flag).\n- Route all icon decisions through the shared output helpers so behavior is consistent.\n\nNotes\n- JSON output is unaffected (no emojis/colors).\n- Non-TTY should default to plain unless user forces rich output.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-13T10:16:48.091815Z","updated_at":"2025-12-13T23:03:26.689137Z","closed_at":"2025-12-13T23:03:26.689137Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-2erm","depends_on_id":"cass_memory_system-3tds","type":"parent-child","created_at":"2026-01-21T09:28:49Z","created_by":"import"}]}
{"id":"cass_memory_system-2hi3","title":"[MCP:Future] MCP request handler implementation","description":"Implement MCP request handler:\n\n```typescript\nserver.setRequestHandler(\"tools/call\", async (request) => {\n  switch (request.params.name) {\n    case \"memory_context\":\n      return getContext(request.params.arguments);\n    case \"memory_mark\":\n      return markBullet(request.params.arguments);\n    case \"memory_search\":\n      return searchMemory(request.params.arguments);\n    case \"memory_reflect\":\n      return triggerReflect(request.params.arguments);\n    default:\n      throw new Error(\\`Unknown tool: ${request.params.name}\\`);\n  }\n});\n```\n\nRoutes tool calls to appropriate handler functions.","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:49:33.289055Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-2ki2","title":"[Testing] Add pure unit tests: playbook + scoring + types schemas","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-08T01:29:40.505494Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-2ki2","depends_on_id":"cass_memory_system-f63a","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"}]}
{"id":"cass_memory_system-2lit","title":"[Impl] Create AGENTS.md Blurb File","description":"# Create AGENTS.md Blurb File\n\n## Purpose\nCreate the ready-to-paste blurb for AGENTS.md files. This is what humans copy into their project's AGENTS.md to teach agents about cass-memory.\n\n## Requirements (Consolidated from design task)\n1. **Self-contained**: Agent understands everything from just this blurb\n2. **Minimal**: 40-50 lines max\n3. **Actionable**: Clear protocol, working examples\n4. **Copy-paste ready**: No customization needed\n\n## Blurb Structure (Target: ~45 lines)\n\n\\`\\`\\`markdown\n## cass-memory — Persistent Memory for AI Coding Agents\n\n**What it does**: [1-2 sentences about cross-session memory]\n\n### Protocol\nSTART: cm context \\\"<task>\\\" --json   ← Before non-trivial work\nWORK:  Reference rule IDs when following guidance\nEND:   Session auto-processed for learnings\n\n### Essential Commands\n\n# Get relevant rules for your task\ncm context \\\"fix authentication bug\\\" --json\n\n# Provide feedback on rules\ncm mark b-xyz123 helpful --reason \\\"prevented caching bug\\\"\ncm mark b-abc456 harmful --reason \\\"didn't apply here\\\"\n\n# Or inline in your output (auto-parsed):\n// [cass: helpful b-xyz123] this prevented a bug\n\n### Output Format\n{\n  \\\"rules\\\": [{\\\"id\\\": \\\"b-xxx\\\", \\\"content\\\": \\\"...\\\", \\\"score\\\": 8.5}],\n  \\\"antiPatterns\\\": [{\\\"id\\\": \\\"b-yyy\\\", \\\"content\\\": \\\"AVOID: ...\\\"}]\n}\n\n### More Info\ncm quickstart    # Full usage guide\ncm doctor --json # Health check\n\nExit 0 = success, stdout = JSON data\n\\`\\`\\`\n\n## Deliverables\n- [ ] AGENTS_BLURB.md file in repo root\n- [ ] Under 50 lines\n- [ ] All examples use --json\n- [ ] Test: agent can use system with ONLY this blurb\n\n## NO DEPENDENCIES\nThis task has no blockers. Just create the blurb based on requirements above.","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-08T17:47:08.367080Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-2lit","depends_on_id":"cass_memory_system-8okk","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"}]}
{"id":"cass_memory_system-2mbz","title":"E2E test: 'cass mark' command","description":"E2E test for 'cass mark' CLI command:\n- Real subprocess execution via bun\n- Test marking bullets helpful/harmful\n- Test with bullet IDs and fuzzy matching\n- Verify playbook.yaml is updated correctly\n- Verify feedback events are recorded\n- Test error cases: invalid bullet ID, already marked\n- Detailed logging: command invoked, playbook before/after diff\nSetup: fixture directory with playbook.yaml containing test bullets","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-08T01:27:12.877185Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-2mbz","depends_on_id":"cass_memory_system-8dxr","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"}]}
{"id":"cass_memory_system-2nl","title":"[Playbook] exportToMarkdown - Generate AGENTS.md format","description":"## Function Signature\n```typescript\nfunction exportToMarkdown(\n  playbook: Playbook,\n  options: {\n    topN?: number;\n    showCounts?: boolean;\n    includeAntiPatterns?: boolean;\n  }\n): string\n```\n\n## Purpose\nGenerate AGENTS.md format markdown from playbook. Used by project command to create human-readable rule documentation.\n\n## Output Format\n```markdown\n## Agent Playbook (auto-generated from cass-memory)\n\nLast updated: 2025-01-15T10:30:00Z\nTotal rules: 47 (15 proven, 20 established, 12 candidate)\n\n### Testing (12 rules)\n1. [15× helpful] For React hooks, test effects separately with act()\n2. [8× helpful] Run all tests before committing to main branch\n3. [5× helpful] Use data-testid for component selection in tests\n\n### Security (8 rules)\n1. [12× helpful] Always validate user input before database queries\n2. [10× helpful] Never log sensitive data like passwords or API keys\n\n### PITFALLS TO AVOID\n- AVOID: Caching auth tokens without expiry check\n- AVOID: Using eval() on user-provided strings\n```\n\n## Algorithm\n1. Get active bullets with getActiveBullets()\n2. Group bullets by category\n3. For each category:\n   - Sort by effective score (descending)\n   - Take top N if specified\n   - Format as numbered list\n4. If includeAntiPatterns:\n   - Filter for isNegative bullets\n   - Format as PITFALLS section\n\n## Options\n- **topN**: Limit rules per category (default: all)\n- **showCounts**: Display helpful count (default: true)\n- **includeAntiPatterns**: Add PITFALLS section (default: true)\n\n## Formatting Rules\n- Category headers: ### {Category} ({count} rules)\n- Bullet format: {index}. [{count}× helpful] {content}\n- Anti-pattern format: - AVOID: {content}\n- Sections separated by blank lines\n\n## Header Metadata\nInclude playbook summary:\n- Last updated timestamp\n- Total rule count\n- Breakdown by maturity level\n- Helpful/harmful statistics\n\n## Implementation Notes\n- Sort categories alphabetically\n- Skip categories with 0 active rules\n- Use effective score for ranking\n- Truncate long rule text if needed\n- Add generation timestamp\n\n## Usage Scenarios\n1. **Project initialization**: Generate AGENTS.md\n2. **Documentation**: Export for team review\n3. **CI/CD**: Auto-update project docs\n4. **Onboarding**: Give new team members context\n\n## Dependencies\n- getActiveBullets()\n- getBulletsByCategory()\n- calculateEffectiveScore()\n\n## Related Functions\n- savePlaybook() - writes YAML format\n- loadPlaybook() - reads YAML format\n- getActiveBullets() - filters bullets for export","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:45:13.166206Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-2r9c","title":"[P1] Add unit tests for starters.ts module","description":"# Task: Unit tests for starters.ts (392 lines)\n\n## Why Important\nstarters.ts generates starter rule sets for new users. Bad starters create poor first impressions and teach wrong patterns.\n\n## What to Test\n\n### Starter Generation\n- [ ] Default starter set is valid\n- [ ] Language-specific starters work\n- [ ] Framework-specific starters work\n- [ ] Custom starter sets load correctly\n\n### Validation\n- [ ] Generated bullets are valid schema\n- [ ] Categories are consistent\n- [ ] No duplicate content\n- [ ] Tags are appropriate\n\n### Integration\n- [ ] Starters merge with existing playbook\n- [ ] Conflicts handled gracefully\n- [ ] Progress reported correctly\n\n## Files\n- Source: src/starters.ts (392 lines)\n- Test: test/starters.test.ts (new)\n\n## Acceptance\n- [ ] All starter types tested\n- [ ] Validation comprehensive\n- [ ] Integration tested\n- [ ] No mocks used","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-16T15:30:28.759832Z","updated_at":"2025-12-16T21:40:48.750285Z","closed_at":"2025-12-16T21:40:48.750285Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-2t1","title":"[Diary] computeDiaryStats - Summary statistics","description":"Compute summary statistics across diary entries for stats command.\n\nFunction Signature:\nfunction computeDiaryStats(diaries: DiaryEntry[]): {\n  total: number;\n  byStatus: Record<string, number>;\n  byAgent: Record<string, number>;\n  avgChallenges: number;\n  avgLearnings: number;\n  topTags: Array<{tag: string; count: number}>;\n  successRate: number;\n}\n\nStatistics Computed:\n1. total: Total number of diaries\n2. byStatus: Count grouped by status (success/failure/mixed)\n3. byAgent: Count grouped by agent (claude/cursor/codex/aider)\n4. avgChallenges: Average challenges per diary\n5. avgLearnings: Average key learnings per diary\n6. topTags: Most frequent tags across all diaries (top 10)\n7. successRate: Percentage with status='success'\n\nAlgorithm:\n- Single pass through diary array\n- Accumulate counts and sums\n- Compute averages and percentages\n- Sort tags by frequency for top 10\n\nKey Metrics:\n- Success rate indicates session quality\n- Avg challenges shows debugging intensity\n- Avg learnings measures knowledge extraction\n- Top tags reveal work focus areas\n- Agent distribution shows tool usage patterns\n\nDisplay Format (stats command):\n\n\nOutput:\nReturns statistics object with all computed metrics.","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:46:54.342399Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-2wg","title":"[Types] PlaybookBullet Schema Part 3 - State and Maturity Lifecycle","description":"## Overview\nDefine lifecycle state and maturity tracking for PlaybookBullet. TWO orthogonal dimensions: STATE (lifecycle phase) and MATURITY (progressive trust).\n\n## STATE: Simplified Lifecycle (3 States)\n\n### state: 'draft' | 'active' | 'retired'\n\n#### draft\n- Definition: Newly proposed, not yet proven\n- Source: Output from reflector with low confidence / Manual addition before validation / Evidence-gated validation suggesting 'draft' state\n- Behavior: NOT included in context by default / Can be manually promoted to 'active' after review / Requires user approval or validation to activate\n- Display: Shown in separate 'Draft Rules' section\n- Example: 'Consider using Zod for validation' (only 1 supporting session)\n\n#### active\n- Definition: Validated and in production use\n- Source: Passed scientific validation / Manually activated after review / Promoted from draft after confidence threshold\n- Behavior: Included in context hydration (subject to relevance ranking) / Participates in feedback loop / Subject to confidence decay\n- Display: Main playbook sections\n- Example: 'Use TokenValidator for JWT checks' (5+ successful sessions)\n\n#### retired\n- Definition: Deprecated, superseded, or invalidated\n- Source: Exceeded harmful threshold / Manually deprecated / Auto-pruned by system / Replaced by better rule\n- Behavior: EXCLUDED from context / Kept for historical analysis / Cannot receive new feedback\n- Display: Hidden by default, available in archive\n- Example: 'Use class components' (outdated after hooks migration)\n\n## MATURITY: Progressive Trust Within 'active' State (4 Levels)\n\n### maturity: 'candidate' | 'established' | 'proven' | 'deprecated'\n\n#### candidate\n- Definition: New active rule still proving itself\n- Criteria: 0-2 helpful marks, active state\n- Confidence: LOW - use with caution\n- Behavior: Included in context but ranked lower / Higher scrutiny in validation / Susceptible to quick retirement if harmful\n- Promotion: Becomes 'established' at 3 helpful marks\n- Example: 'Use Zod schemas for API validation' (1 helpful, 0 harmful)\n\n#### established\n- Definition: Solid track record, reliable guidance\n- Criteria: 3+ helpful marks / Helpful:harmful ratio > 5:1 / Active state\n- Confidence: MEDIUM-HIGH\n- Behavior: Normal context inclusion / Standard decay rates / Trusted for most situations\n- Promotion: Becomes 'proven' at 5+ helpful marks with strong ratio\n- Example: 'Use vitest for unit tests' (7 helpful, 1 harmful)\n\n#### proven\n- Definition: Battle-tested, high-confidence guidance\n- Criteria: 5+ helpful marks / Helpful:harmful ratio > 10:1 OR 10+ helpful with ratio > 5:1 / Active state\n- Confidence: VERY HIGH\n- Behavior: Highest priority in context ranking / Slower decay rate (extended half-life) / Strong resistance to retirement / Candidate for pinning\n- Example: 'Run tests before committing' (15 helpful, 0 harmful)\n\n#### deprecated\n- Definition: RETIRED state synonym for backward compatibility\n- Mapping: maturity === 'deprecated' implies state === 'retired'\n- Usage: Legacy field, prefer checking state instead\n\n## Promotion Tracking\n\n### promotedAt: string | undefined\n- Purpose: Timestamp when rule was promoted from candidate to established\n- Format: ISO 8601 (e.g., '2025-12-07T14:30:00Z')\n- Usage: Calculate time in established/proven state / Analyze promotion velocity / Audit trail for rule evolution\n- Set: When maturity transitions from 'candidate' to 'established'\n\n## State vs Maturity Matrix\n\nState | Maturity | Context? | Meaning\ndraft | N/A | No | Awaiting validation\nactive | candidate | Yes (low priority) | New, unproven\nactive | established | Yes (normal) | Solid, reliable\nactive | proven | Yes (high priority) | Battle-tested\nretired | deprecated | No | No longer valid\n\n## Automatic Transitions\n\nState Transitions:\n- draft -> active: Pass validation OR manual promotion\n- active -> retired: Exceed harmful threshold OR manual deprecation\n- retired -> active: Manual resurrection (rare)\n\nMaturity Transitions (within active state):\n- candidate -> established: Reach 3 helpful marks with good ratio\n- established -> proven: Reach 5 helpful marks with excellent ratio\n- * -> deprecated: State transitions to retired\n\n## Examples\n\nNew Draft Rule: { state: 'draft', maturity: 'candidate', promotedAt: undefined }\n\nActive Candidate: { state: 'active', maturity: 'candidate', promotedAt: undefined, helpfulCount: 1, harmfulCount: 0 }\n\nEstablished Rule: { state: 'active', maturity: 'established', promotedAt: '2025-11-15T10:00:00Z', helpfulCount: 5, harmfulCount: 1 }\n\nProven Rule: { state: 'active', maturity: 'proven', promotedAt: '2025-10-01T08:00:00Z', helpfulCount: 12, harmfulCount: 0 }\n\nRetired Rule: { state: 'retired', maturity: 'deprecated', retiredAt: '2025-12-01T12:00:00Z', helpfulCount: 2, harmfulCount: 5, retirementReason: 'Exceeded harmful threshold' }\n\n## Acceptance Criteria\n- state enum with 3 values\n- maturity enum with 4 values\n- promotedAt optional timestamp field\n- State transition logic documented\n- Maturity promotion thresholds defined\n- Examples for all state/maturity combos\n- JSDoc explaining orthogonal nature\n- Auto-transition functions implemented","notes":"Releasing - types.ts under concurrent modification by another agent working on Part 4","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:44:59.687575Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-2yzr","title":"[UX][trust] Use invoked binary name consistently (cm vs cass-memory)","description":"Problem\n- CLI help and many messages hard-code `cass-memory` even when the intended user-facing alias is `cm`.\n- This creates confusion during onboarding (copy/paste doesn’t match what the user installed).\n\nWhat to do\n- Derive the display name from the invoked binary (e.g., `process.argv[1]` basename).\n- Apply consistently across:\n  - `cm --help` (commander `.name(...)`)\n  - “Next steps” messages (init)\n  - Hints in commands (doctor/context/similar/etc)\n  - Any error prefixing that is user-facing\n\nConstraints\n- Keep existing bin aliases working (`cass-memory` and `cm` both installed).\n- Don’t introduce a “compat shim” binary; just improve display text.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-13T10:14:48.632314Z","updated_at":"2025-12-13T10:55:59.160119Z","closed_at":"2025-12-13T10:55:59.160119Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-2yzr","depends_on_id":"cass_memory_system-c10q","type":"parent-child","created_at":"2026-01-21T09:28:49Z","created_by":"import"}]}
{"id":"cass_memory_system-3280","title":"[UX][output] Refactor similar/stats/usage outputs to design system","description":"Problem\n- `similar`, `stats`, and `usage` each use their own formatting conventions today.\n- After introducing shared output helpers, these commands should match the same visual/interaction standards.\n\nWhat to do\n- Apply shared formatting primitives to:\n  - `cm similar` (clear mode: semantic vs keyword, clearer enablement hints)\n  - `cm stats` (readable dashboard layout, consistent headings)\n  - `cm usage` (aligned numbers + consistent callouts)\n\nConstraints\n- Keep JSON output stable.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-13T10:17:41.487426Z","updated_at":"2025-12-14T00:24:24.125173Z","closed_at":"2025-12-14T00:24:24.125173Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-3280","depends_on_id":"cass_memory_system-2erm","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"},{"issue_id":"cass_memory_system-3280","depends_on_id":"cass_memory_system-3tds","type":"parent-child","created_at":"2026-01-21T09:28:49Z","created_by":"import"},{"issue_id":"cass_memory_system-3280","depends_on_id":"cass_memory_system-4ccz","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"},{"issue_id":"cass_memory_system-3280","depends_on_id":"cass_memory_system-r1hq","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"}]}
{"id":"cass_memory_system-33w3","title":"[Unit Tests] playbook.ts - All playbook management functions","description":"## Unit Tests: playbook.ts - All Playbook Management Functions\n\n### Test Categories\n\n#### 1. loadPlaybook()\n- Loads valid YAML playbook files\n- Returns empty playbook for missing file\n- Parses all field types (bullets, meta, toxic)\n- Handles YAML syntax errors gracefully\n\n#### 2. savePlaybook()\n- Writes playbook to YAML format\n- Preserves all fields correctly\n- Creates parent directories\n- Atomic write (temp file + rename)\n\n#### 3. Bullet Management\n- addBullet() appends to correct section\n- removeBullet() by content match\n- updateBullet() modifies in place\n- findBullet() searches all sections\n\n#### 4. findSimilarBullet()\n- Returns null for empty playbook\n- Finds exact content matches\n- Finds semantically similar bullets\n- Respects similarity threshold\n- Returns most similar when multiple matches\n\n#### 5. isDuplicateBullet()\n- True for exact duplicates\n- True for near-duplicates above threshold\n- False for distinct content\n- Handles empty playbook\n\n#### 6. mergeBullets()\n- Combines bullets from two playbooks\n- Deduplicates based on content\n- Preserves scores from higher-confidence source\n- Merges toxic lists\n\n#### 7. exportToMarkdown()\n- Generates readable markdown\n- Includes all sections\n- Formats scores as percentages\n- Sorts by confidence descending\n\n#### 8. Scope Matching\n- matchesScope() with exact matches\n- matchesScope() with glob patterns\n- matchesScope() with workspace filters\n- getScopedBullets() filters correctly\n\n### Test Data Requirements\n- Sample playbook YAML files\n- Bullets with various confidence scores\n- Multiple scope configurations","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-08T01:23:26.671304Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-33w3","depends_on_id":"cass_memory_system-ep5y","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"},{"issue_id":"cass_memory_system-33w3","depends_on_id":"cass_memory_system-p4mv","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"},{"issue_id":"cass_memory_system-33w3","depends_on_id":"cass_memory_system-yj1z","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"}]}
{"id":"cass_memory_system-34o5","title":"Reject empty task/query in MCP serve tools","description":"cm_context/memory_search in serve.ts only validate type; empty strings slip through and can trigger useless scans. Align with CLI validation by enforcing non-empty strings and add tests.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-07T05:45:40.943136623Z","created_by":"ubuntu","updated_at":"2026-01-07T05:47:07.747753363Z","closed_at":"2026-01-07T05:47:07.747753363Z","close_reason":"Validate non-empty task/query in MCP serve tools and add tests for empty strings.","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-35y","title":"[Decay] getEffectiveScore - Combined score with harmful weighting","description":"Calculate effective score with harmful events weighted 4× more than helpful, confidence decay based on recency, and maturity bonus for proven rules.\n\nCOMPLETE IMPLEMENTATION:\n```typescript\n/**\n * Calculate effective score with:\n * 1. Harmful events weighted 4× more than helpful\n * 2. Confidence decay based on recency\n * 3. Maturity bonus for proven rules\n */\nfunction getEffectiveScore(bullet: PlaybookBullet): number {\n  const HARMFUL_MULTIPLIER = 4;  // One harmful = 4× one helpful\n\n  const decayedHelpful = getDecayedScore(\n    bullet.helpfulEvents,\n    bullet.confidenceDecayHalfLifeDays\n  );\n  const decayedHarmful = getDecayedScore(\n    bullet.harmfulEvents,\n    bullet.confidenceDecayHalfLifeDays\n  );\n\n  const baseScore = decayedHelpful - (HARMFUL_MULTIPLIER * decayedHarmful);\n\n  // Maturity bonus\n  const maturityMultiplier = {\n    candidate: 0.5,\n    established: 1.0,\n    proven: 1.5,\n    deprecated: 0\n  }[bullet.maturity];\n\n  return baseScore * maturityMultiplier;\n}\n```\n\nRATIONALE:\n- HARMFUL_MULTIPLIER = 4: One mistake is more costly than one success. A rule that's helpful 4 times but harmful once is still dangerous.\n- Maturity bonus: Proven rules get 1.5× multiplier, candidates get 0.5×\n- Deprecated rules always score 0 (frozen)\n\nSCORING EXAMPLES:\n1. Rule with 8 recent helpful, 0 harmful, proven maturity:\n   - decayedHelpful ≈ 8.0, decayedHarmful = 0\n   - baseScore = 8 - 0 = 8\n   - effectiveScore = 8 × 1.5 = 12.0\n\n2. Rule with 4 helpful, 1 harmful, established maturity:\n   - baseScore = 4 - (4 × 1) = 0\n   - effectiveScore = 0 × 1.0 = 0 (neutral)\n\n3. Rule with 5 old helpful (180 days), 1 recent harmful, candidate:\n   - decayedHelpful ≈ 1.25 (5 × 0.25)\n   - decayedHarmful ≈ 1.0\n   - baseScore = 1.25 - 4 = -2.75\n   - effectiveScore = -2.75 × 0.5 = -1.375 (at risk)\n\nDEPENDENCIES:\n- Requires getDecayedScore() function\n- Requires PlaybookBullet type with:\n  - helpfulEvents: FeedbackEvent[]\n  - harmfulEvents: FeedbackEvent[]\n  - confidenceDecayHalfLifeDays: number\n  - maturity: BulletMaturity\n\nUSED BY:\n- checkForPromotion()\n- checkForDemotion()\n- analyzeScoreDistribution()\n- stats command","status":"tombstone","priority":3,"issue_type":"task","created_at":"2025-12-07T21:45:00.667082Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-37p9","title":"[E2E] Learning Loop - Accumulate → Curate → Extend Cycle","description":"## Target: E2E test of full ACE learning loop\n\n### Scenario: Complete Learning Cycle\n\n```\nDay 1: Agent works, creates session\nDay 2: Session imported to diary\nDay 3: Reflect analyzes sessions\nDay 3: Suggestions become bullets\nDay 4: New context uses learned bullets\nDay 5: User marks bullets helpful/harmful\nDay 6: Curate prunes low-scoring bullets\n```\n\n### Test Script:\n\n```typescript\ndescribe('E2E: ACE Learning Loop', () => {\n  it('full cycle test', async () => {\n    // Setup\n    const env = await createTestEnvironment();\n    log('Test environment created');\n\n    // Day 1: Create mock session data\n    log('Day 1: Creating session data');\n    await createMockSession(env, {\n      patterns: ['Always handle Promise rejections', 'Use const over let'],\n      timestamp: daysAgo(5)\n    });\n    log('Session created with 2 patterns');\n\n    // Day 2: Import to diary\n    log('Day 2: Importing sessions');\n    const importResult = await runCLI(['diary', '--import', sessionPath, '--json'], { env });\n    log('Import result:', importResult.stdout);\n\n    // Day 3: Reflect\n    log('Day 3: Running reflection');\n    const reflectResult = await runCLI(['reflect', '--json'], { env });\n    log('Reflect found:', JSON.parse(reflectResult.stdout).suggestions.length, 'suggestions');\n\n    // Apply suggestions\n    log('Applying suggestions to playbook');\n    await runCLI(['playbook', '--apply-suggestions', '--json'], { env });\n\n    // Day 4: Context includes new bullets\n    log('Day 4: Testing context');\n    const context = await runCLI(['context', 'Promise error handling', '--json'], { env });\n    const bullets = JSON.parse(context.stdout).bullets;\n    log('Context returned', bullets.length, 'bullets');\n    expect(bullets.some(b => b.content.includes('Promise'))).toBe(true);\n\n    // Day 5: Feedback\n    log('Day 5: Adding feedback');\n    await runCLI(['mark', bullets[0].id, 'helpful', '--json'], { env });\n    await runCLI(['mark', bullets[1].id, 'harmful', '--json'], { env });\n    log('Marked bullets helpful/harmful');\n\n    // Day 6: Curate\n    log('Day 6: Running curation');\n    const curateResult = await runCLI(['curate', '--json'], { env });\n    log('Curation result:', curateResult.stdout);\n\n    // Verify harmful bullet removed or deprioritized\n    const finalContext = await runCLI(['context', 'Promise', '--json'], { env });\n    log('Final context:', finalContext.stdout);\n  });\n});\n```\n\n### Detailed Logging:\n- State of playbook after each step\n- Scores at each stage\n- Decision points explained","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T01:31:13.904591Z","updated_at":"2025-12-14T01:59:06.184144Z","closed_at":"2025-12-14T01:59:06.184144Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-37p9","depends_on_id":"cass_memory_system-ke2x","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"},{"issue_id":"cass_memory_system-37p9","depends_on_id":"cass_memory_system-uufj","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"},{"issue_id":"cass_memory_system-37p9","depends_on_id":"cass_memory_system-zc1d","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"}]}
{"id":"cass_memory_system-3hrk","title":"[CLI:reflect] findUnprocessedSessions - Get sessions to process","description":"Helper function to discover unprocessed sessions for reflection.\n\nFunction signature:\n```typescript\nasync function findUnprocessedSessions(\n  processedLog: ProcessedLog,\n  options: ReflectOptions,\n  config: Config\n): Promise<string[]>\n```\n\nImplementation steps:\n1. Call `cass timeline --days N --json` to get session list\n2. Parse JSON output to extract session paths\n3. Filter out already-processed sessions:\n   - Load processed.log from memory directory\n   - Check each session path against log\n4. Apply agent filter if --agent specified:\n   - Match against session metadata (claude/cursor/aider/etc)\n5. Apply maxSessions limit (default: 20)\n6. Return array of session paths to process\n\nProcessedLog format:\n```\n{sessionId}\\t{timestamp}\\t{sessionPath}\\t{deltasProposed}\\t{deltasApplied}\n```\n\nEdge cases:\n- Handle missing processed.log (first run)\n- Handle malformed session paths\n- Handle sessions without agent metadata\n- Respect timeline errors gracefully\n\nReturn value:\nArray of absolute paths to session files, e.g.:\n[\"/Users/x/.claude/sessions/session-001.jsonl\", ...]","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:49:42.684823Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-3i3u","title":"Design onboard subcommand structure and deprecation layer","description":"## Context\n\nBefore implementing the onboard refactor, we need a clear design for:\n1. The new subcommand structure in cm.ts\n2. How the deprecation layer detects and translates old syntax\n3. How to structure the code to minimize duplication\n\n## Design Decisions Needed\n\n### 1. Subcommand Handler Pattern\n\nOption A: Separate handler functions\n```typescript\n// src/commands/onboard.ts\nexport async function onboardStatus(options: StatusOptions): Promise<void>\nexport async function onboardSample(options: SampleOptions): Promise<void>\n// etc.\n```\n\nOption B: Single handler with action parameter (like playbook)\n```typescript\nexport async function onboardCommand(\n  action: \"status\" | \"sample\" | \"read\" | ...\n  args: string[],\n  options: OnboardOptions\n): Promise<void>\n```\n\n**Recommendation**: Option A is cleaner and provides better type safety.\n\n### 2. Deprecation Detection\n\nThe deprecation layer should:\n1. Check if old-style flags are present\n2. Print warning to stderr (not stdout, to preserve JSON output)\n3. Map to equivalent subcommand call\n4. Execute normally\n\n```typescript\n// In cm.ts action handler\nif (opts.status) {\n  console.error(chalk.yellow('⚠️ Deprecation: `--status` is deprecated. Use `cm onboard status`'));\n  return onboardStatus({ json: opts.json });\n}\n```\n\n### 3. Default Behavior\n\nWhen `cm onboard` is called with no subcommand or flags:\n- Current: Shows error \"specify an action\"\n- Proposed: Show help (like `cm playbook` does)\n\n## Deliverables\n\n- [ ] Document final subcommand signatures\n- [ ] Document option inheritance (which options apply to which subcommands)\n- [ ] Document deprecation warning format\n- [ ] Create migration guide snippet for docs\n\n## Part of Feature\n\ncass_memory_system-e6o7 (Onboard subcommand refactor)","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-15T17:17:35.653585Z","updated_at":"2025-12-15T17:45:57.946054Z","closed_at":"2025-12-15T17:45:57.946054Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-3l7","title":"Phase 4: Polish & Integration","description":"# EPIC: Polish & Integration\n\n## Purpose\nProduction-ready release: audit capabilities, AGENTS.md export, comprehensive\nerror handling, binary compilation, and documentation.\n\n## Background & Reasoning\nFor cass-memory to be adopted by teams, it needs:\n1. Audit capabilities to verify agents follow playbook rules\n2. Easy export to AGENTS.md/CLAUDE.md formats agents already read\n3. Tombstone/deprecated pattern support for gradual deprecation\n4. Cross-platform binaries for easy distribution\n5. Comprehensive documentation and examples\n\n## Key Deliverables\n1. `cass-memory audit --days N` - Check sessions for rule violations\n2. `cass-memory project --format agents.md` - Export to agent config\n3. Deprecated patterns/tombstone mechanism\n4. Binary compilation for Linux/macOS/Windows\n5. README.md with usage examples\n6. AGENTS.md template for memory protocol\n\n## Additional Commands from Plan\n- `cass-memory top` - Show top-performing bullets\n- `cass-memory stale` - List bullets needing refresh\n- `cass-memory why <id>` - Explain bullet provenance\n- `cass-memory similar <id>` - Find related bullets\n\n## Future Enhancements (Post-MVP)\n- MCP server mode for direct agent integration\n- Team playbooks with merge/conflict resolution\n- Visualization of playbook evolution\n- Pattern detection across sessions\n- Auto-reflection hooks (post-session triggers)\n- Conflict detection between bullets\n\n## Dependencies\n- Requires Phase 3 completion (semantic search, stats)","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-12-07T21:16:42.782450Z","updated_at":"2025-12-14T00:24:55.593452Z","closed_at":"2025-12-14T00:24:55.593452Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-3l7","depends_on_id":"cass_memory_system-y8o","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"}]}
{"id":"cass_memory_system-3l7.1","title":"Audit Command: cass-memory audit","description":"# Feature: Audit Command\n\n## Purpose\nCheck recent sessions for playbook rule violations. Helps identify:\n- Rules that agents are ignoring\n- Rules that may be unclear or hard to follow\n- Opportunities for training/documentation\n\n## Usage\n```bash\ncass-memory audit --days 7 --json\ncass-memory audit --session ~/.claude/sessions/abc.jsonl\ncass-memory audit --severity high\n```\n\n## Process Flow\n```\n1. Load recent sessions from cass\n2. For each session, check against playbook rules\n3. LLM identifies potential violations\n4. Classify severity and suggest improvements\n```\n\n## Implementation\n```typescript\nasync function auditCommand(flags: AuditFlags): Promise<void> {\n  const config = await loadConfig();\n  const playbook = await loadMergedPlaybook(config);\n  \n  // Get sessions to audit\n  const sessions = flags.session\n    ? [flags.session]\n    : await getRecentSessions(config.cassPath, flags.days || 7);\n  \n  const violations: AuditViolation[] = [];\n  \n  for (const sessionPath of sessions) {\n    const content = await cassExport(sessionPath, \"markdown\", config.cassPath);\n    if (!content) continue;\n    \n    // LLM audit\n    const result = await runAudit(\n      AuditOutputSchema,\n      content,\n      formatRulesForAudit(playbook.bullets.filter(b => !b.deprecated)),\n      config\n    );\n    \n    violations.push(...result.violations.map(v => ({\n      ...v,\n      sessionPath\n    })));\n  }\n  \n  // Filter by severity if requested\n  const filtered = flags.severity\n    ? violations.filter(v => v.severity === flags.severity)\n    : violations;\n  \n  output({\n    sessionsAudited: sessions.length,\n    totalViolations: filtered.length,\n    violations: filtered,\n    summary: summarizeViolations(filtered)\n  }, formatAuditResult, flags);\n}\n```\n\n## Violation Schema\n```typescript\ninterface AuditViolation {\n  bulletId: string;\n  bulletContent: string;\n  sessionPath: string;\n  evidence: string;        // Quote from session\n  severity: \"low\" | \"medium\" | \"high\";\n  suggestion?: string;     // How to improve\n}\n```\n\n## Output Example\n```\n╭─────────────────────────────────────────────────────────────╮\n│                    AUDIT RESULTS                            │\n├─────────────────────────────────────────────────────────────┤\n│ Sessions audited: 5                                         │\n│ Violations found: 3                                         │\n│                                                             │\n│ HIGH SEVERITY (1):                                          │\n│   [b-abc123] \"Always run tests before committing\"           │\n│   Session: ~/.claude/sessions/xyz.jsonl                     │\n│   Evidence: \"Committed changes without running test suite\"  │\n│                                                             │\n│ MEDIUM SEVERITY (2):                                        │\n│   [b-def456] \"Use TypeScript strict mode\"                   │\n│   Session: ~/.cursor/sessions/abc.jsonl                     │\n│   Evidence: \"Added // @ts-ignore to bypass type error\"      │\n╰─────────────────────────────────────────────────────────────╯\n```","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2025-12-07T21:25:08.126872Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"feature","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-3l7.1","depends_on_id":"cass_memory_system-3l7","type":"parent-child","created_at":"2026-01-21T09:28:49Z","created_by":"import"},{"issue_id":"cass_memory_system-3l7.1","depends_on_id":"cass_memory_system-5eh.4","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"},{"issue_id":"cass_memory_system-3l7.1","depends_on_id":"cass_memory_system-5eh.8","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"},{"issue_id":"cass_memory_system-3l7.1","depends_on_id":"cass_memory_system-5eh.9","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"}]}
{"id":"cass_memory_system-3l7.2","title":"Project Command: Export to AGENTS.md","description":"# Feature: Project Command (Export to AGENTS.md)\n\n## Purpose\nExport playbook to agent-readable formats (AGENTS.md, CLAUDE.md).\nThis is how accumulated knowledge gets into the agent's context.\n\n## Usage\n```bash\ncass-memory project --format agents.md --output ./AGENTS.md\ncass-memory project --format claude.md --top 30\ncass-memory project --category testing,debugging\n```\n\n## Output Formats\n\n### AGENTS.md Format\n```markdown\n## Memory System: cass-memory\n\nBefore starting complex tasks, retrieve context:\n\\`\\`\\`bash\ncass-memory context \"<task>\" --json\n\\`\\`\\`\n\n### Top Rules by Category\n\n#### Testing (8 rules)\n- [b-abc123] For React hooks, test effects separately with renderHook\n- [b-def456] Mock external APIs at the service layer, not in tests\n- ...\n\n#### Debugging (5 rules)\n- [b-ghi789] Enable DEBUG=auth:* for authentication issues\n- ...\n\n### Memory Protocol\n1. PRE-FLIGHT: Run `cass-memory context` before non-trivial tasks\n2. REFERENCE: Cite bullet IDs when following rules\n3. FEEDBACK: Mark bullets helpful/harmful as you work\n```\n\n### CLAUDE.md Format (Condensed)\n```markdown\n# Project Rules (via cass-memory)\n\nTesting:\n• Test React hooks with renderHook, effects separately [b-abc123]\n• Mock APIs at service layer [b-def456]\n\nDebugging:\n• Use DEBUG=auth:* for auth issues [b-ghi789]\n```\n\n## Implementation\n```typescript\nasync function projectCommand(flags: ProjectFlags): Promise<void> {\n  const config = await loadConfig();\n  const playbook = await loadMergedPlaybook(config);\n  \n  // Filter and sort bullets\n  const bullets = playbook.bullets\n    .filter(b => !b.deprecated && b.state !== \"retired\")\n    .filter(b => !flags.category || flags.category.includes(b.category))\n    .sort((a, b) => getEffectiveScore(b, config) - getEffectiveScore(a, config))\n    .slice(0, flags.top || 50);\n  \n  // Group by category\n  const byCategory = groupBy(bullets, b => b.category);\n  \n  // Generate output\n  const content = flags.format === \"agents.md\"\n    ? generateAgentsMd(byCategory, playbook.deprecatedPatterns)\n    : generateClaudeMd(byCategory);\n  \n  if (flags.output) {\n    await writeFile(flags.output, content);\n    console.log(`Exported to ${flags.output}`);\n  } else {\n    console.log(content);\n  }\n}\n```\n\n## Category Sorting\nCategories are sorted by total effective score of their bullets,\nso the most impactful categories appear first.","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2025-12-07T21:25:08.353916Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"feature","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-3l7.2","depends_on_id":"cass_memory_system-3l7","type":"parent-child","created_at":"2026-01-21T09:28:49Z","created_by":"import"},{"issue_id":"cass_memory_system-3l7.2","depends_on_id":"cass_memory_system-5eh.6","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"},{"issue_id":"cass_memory_system-3l7.2","depends_on_id":"cass_memory_system-5eh.8","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"}]}
{"id":"cass_memory_system-3l7.3","title":"Binary Compilation + Distribution","description":"# Feature: Binary Compilation + Distribution\n\n## Purpose\nCompile cass-memory to standalone binaries for easy distribution.\nUsers shouldn't need Bun installed to use the tool.\n\n## Build Targets\n- Linux x64: dist/cass-memory-linux-x64\n- macOS ARM64: dist/cass-memory-darwin-arm64\n- macOS x64: dist/cass-memory-darwin-x64\n- Windows x64: dist/cass-memory-windows-x64.exe\n\n## Build Commands\n```json\n{\n  \"scripts\": {\n    \"build\": \"bun build src/cass-memory.ts --compile --outfile dist/cass-memory\",\n    \"build:all\": \"npm run build:linux && npm run build:macos-arm && npm run build:macos-x64 && npm run build:windows\",\n    \"build:linux\": \"bun build src/cass-memory.ts --compile --target=bun-linux-x64 --outfile dist/cass-memory-linux-x64\",\n    \"build:macos-arm\": \"bun build src/cass-memory.ts --compile --target=bun-darwin-arm64 --outfile dist/cass-memory-darwin-arm64\",\n    \"build:macos-x64\": \"bun build src/cass-memory.ts --compile --target=bun-darwin-x64 --outfile dist/cass-memory-darwin-x64\",\n    \"build:windows\": \"bun build src/cass-memory.ts --compile --target=bun-windows-x64 --outfile dist/cass-memory-windows-x64.exe\"\n  }\n}\n```\n\n## Binary Size Considerations\n- Base Bun runtime: ~50MB\n- Application code: ~200KB\n- Dependencies: ~5MB (mostly AI SDK)\n- Total: ~55MB per binary\n\n## Distribution Options\n1. GitHub Releases (primary)\n2. Homebrew formula (macOS)\n3. npm/bun global install (for developers)\n\n## Installation Instructions\n```bash\n# macOS (Homebrew)\nbrew install cass-memory\n\n# Direct download\ncurl -L https://github.com/org/cass-memory/releases/latest/download/cass-memory-darwin-arm64 -o cass-memory\nchmod +x cass-memory\nsudo mv cass-memory /usr/local/bin/\n\n# npm/bun\nbun install -g cass-memory\n```","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2025-12-07T21:25:09.629265Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"feature","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-3l7.3","depends_on_id":"cass_memory_system-3l7","type":"parent-child","created_at":"2026-01-21T09:28:49Z","created_by":"import"},{"issue_id":"cass_memory_system-3l7.3","depends_on_id":"cass_memory_system-5eh.10","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"}]}
{"id":"cass_memory_system-3l7.4","title":"Documentation: README.md + Examples","description":"# Feature: Documentation\n\n## Purpose\nComprehensive documentation for users and contributors.\n\n## Files to Create\n\n### README.md\n```markdown\n# cass-memory\n\nAgent-agnostic reflection and memory system for coding agents.\nImplements the ACE (Agentic Context Engineering) framework.\n\n## Quick Start\n\n\\`\\`\\`bash\n# Install\nbrew install cass-memory  # or download binary\n\n# Initialize\ncass-memory init\n\n# Get context before a task\ncass-memory context \"Fix authentication timeout\" --json\n\n# Mark rules as helpful/harmful\ncass-memory mark b-abc123 --helpful\ncass-memory mark b-def456 --harmful --reason \"Caused test failures\"\n\n# Run reflection on recent sessions\ncass-memory reflect --days 7\n\n# Check playbook health\ncass-memory stats\ncass-memory doctor\n\\`\\`\\`\n\n## How It Works\n\ncass-memory implements three memory layers:\n\n1. **Episodic Memory** (cass): Raw session logs from all agents\n2. **Working Memory** (Diary): Structured session summaries\n3. **Procedural Memory** (Playbook): Distilled rules with feedback tracking\n\n## Configuration\n\n\\`\\`\\`bash\n# Set your LLM provider\nexport ANTHROPIC_API_KEY=sk-ant-...\n# or\nexport OPENAI_API_KEY=sk-...\n\n# Configure\ncass-memory config --provider anthropic --model claude-sonnet-4-20250514\n\\`\\`\\`\n\n## Integration\n\nAdd to your AGENTS.md or CLAUDE.md:\n\\`\\`\\`\ncass-memory project --format agents.md >> AGENTS.md\n\\`\\`\\`\n\n## Commands\n\n| Command | Description |\n|---------|-------------|\n| init | Initialize configuration |\n| context | Get pre-task context |\n| diary | Generate diary from session |\n| reflect | Run reflection pipeline |\n| mark | Record feedback |\n| forget | Permanently block pattern |\n| stats | Show playbook health |\n| doctor | System health check |\n| audit | Check for violations |\n| project | Export to AGENTS.md |\n\\`\\`\\`\n\n### Examples Directory\n- examples/basic-workflow.md\n- examples/team-setup.md\n- examples/ci-integration.md\n```","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2025-12-07T21:25:10.905798Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"feature","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-3l7.4","depends_on_id":"cass_memory_system-3l7","type":"parent-child","created_at":"2026-01-21T09:28:49Z","created_by":"import"},{"issue_id":"cass_memory_system-3l7.4","depends_on_id":"cass_memory_system-3l7.1","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"},{"issue_id":"cass_memory_system-3l7.4","depends_on_id":"cass_memory_system-3l7.2","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"}]}
{"id":"cass_memory_system-3o4m","title":"Handle edge cases in redirect-based version resolution","description":"# Task: Edge Case Handling for Redirect-Based Resolution\n\n## Context\n\nThe redirect-based approach must handle various edge cases gracefully. This task identifies and addresses each case.\n\n## Edge Cases to Handle\n\n### 1. No Releases Exist\n\n**Scenario**: The repository has no published releases (only pre-releases or nothing).\n\n**GitHub Behavior**: Returns 404, no redirect occurs.\n\n**Current handling**:\n```bash\nfinal_url=\"$(curl -fsSL ... || true)\"  # curl fails, returns empty\ntag=\"${final_url##*/}\"                  # Empty string\n```\n\n**Solution**: The validation `[[ \"$final_url\" == *\"/releases/tag/\"* ]]` will fail, triggering fallback.\n\n**Test**:\n```bash\n# Find a repo with no releases, or use a non-existent repo\ncurl -fsSL -o /dev/null -w '%{url_effective}\\n' \\\n  \"https://github.com/torvalds/test-nonexistent/releases/latest\"\n# Returns the original URL (no redirect) or error\n```\n\n### 2. Network Timeout / DNS Failure\n\n**Scenario**: curl cannot reach GitHub (network down, DNS failure, firewall).\n\n**Current handling**:\n```bash\nfinal_url=\"$(curl -fsSL ... 2>/dev/null || true)\"\n```\n\nThe `|| true` ensures we don't exit, stderr is suppressed, and `final_url` is empty.\n\n**Enhancement**: Add explicit timeout to prevent hanging:\n```bash\nfinal_url=\"$(curl -fsSL --connect-timeout 10 --max-time 30 ... || true)\"\n```\n\n### 3. Pre-Release Only\n\n**Scenario**: Repo has releases, but latest is marked as pre-release.\n\n**GitHub Behavior**: `/releases/latest` only considers non-pre-release releases. If ALL releases are pre-releases, behaves like \"no releases\".\n\n**Solution**: This is actually desirable - we don't want to install pre-releases by default. Users can use `--version` to specify a pre-release explicitly.\n\n### 4. Non-Semver Tag Names\n\n**Scenario**: Some repos use tags like `release-2024-01-05` or `20240105` instead of `v1.2.3`.\n\n**Our Behavior**: The extraction `${final_url##*/}` works regardless of tag format - it just extracts whatever comes after the last `/`.\n\n**Validation Note**: We should NOT require tags to start with 'v'. The URL validation (`/releases/tag/`) is sufficient.\n\n**Updated validation**:\n```bash\n# DON'T do this (too restrictive):\nif [[ \"$tag\" == v* ]]; then\n\n# DO this (flexible):\nif [ -n \"$tag\" ] && [[ \"$final_url\" == *\"/releases/tag/\"* ]]; then\n```\n\n### 5. GitHub Rate Limiting on HTML Pages\n\n**Scenario**: Does GitHub rate-limit the non-API HTML pages?\n\n**Research Finding**: GitHub does not rate-limit public repository pages the same way as the API. The redirect approach uses the public web interface, not the API.\n\n**However**: GitHub may block requests without a User-Agent or with suspicious patterns. Consider adding:\n```bash\ncurl -fsSL -A \"cass-memory-installer/1.0\" ...\n```\n\n### 6. Redirect Loops or Unexpected Redirects\n\n**Scenario**: GitHub changes behavior, redirect goes somewhere unexpected.\n\n**Protection**: We validate that the final URL contains `/releases/tag/`. If it doesn't, we know something is wrong.\n\n**Example bad URLs that would fail validation**:\n- `https://github.com/.../releases` (no tag)\n- `https://github.com/login` (redirected to login)\n- Empty string (curl failed)\n\n### 7. HTTPS Certificate Issues\n\n**Scenario**: Outdated CA certificates on user's system.\n\n**curl flags**: `-fsSL` includes `-f` (fail on HTTP errors) but doesn't handle cert errors specially.\n\n**Solution**: Don't add `--insecure`. If certs are broken, the user needs to fix their system. We shouldn't silently bypass security.\n\n### 8. Corporate Proxy / Firewall\n\n**Scenario**: User is behind a proxy that intercepts HTTPS.\n\n**Behavior**: curl should respect `HTTP_PROXY`/`HTTPS_PROXY` environment variables automatically.\n\n**Note**: Some corporate proxies inject their own HTML on blocked sites. Our `/releases/tag/` validation would catch this.\n\n## Implementation Checklist\n\n- [ ] Add `--connect-timeout 10 --max-time 30` to curl\n- [ ] Ensure validation doesn't require `v` prefix on tags\n- [ ] Add User-Agent header for politeness\n- [ ] Suppress curl stderr (`2>/dev/null`) for clean output\n- [ ] Document edge case handling in code comments\n\n## Updated Implementation with Edge Case Handling\n\n```bash\nresolve_version() {\n  if [ -n \"$VERSION\" ]; then return 0; fi\n\n  info \"Resolving latest version...\"\n  \n  # Redirect-based resolution: GitHub redirects /releases/latest → /releases/tag/{version}\n  # Advantages over API: No rate limits, no JSON parsing, cross-platform\n  local releases_url=\"https://github.com/${OWNER}/${REPO}/releases/latest\"\n  local final_url\n  \n  # Timeouts: 10s connect, 30s total (handles slow/flaky networks)\n  # User-Agent: Identifies installer (GitHub may block requests without UA)\n  # || true: Don't exit on failure, we handle errors manually\n  final_url=\"$(curl -fsSL \\\n    --connect-timeout 10 \\\n    --max-time 30 \\\n    -A \"cass-memory-installer/1.0\" \\\n    -o /dev/null \\\n    -w '%{url_effective}' \\\n    \"$releases_url\" 2>/dev/null || true)\"\n  \n  # Extract tag from URL: .../releases/tag/v0.2.1 → v0.2.1\n  # Works with any tag format (v1.0.0, release-2024-01-05, etc.)\n  local tag=\"${final_url##*/}\"\n  \n  # Validate: URL must contain /releases/tag/ (proves redirect worked)\n  # Note: We intentionally don't require 'v' prefix - some repos use other formats\n  if [ -n \"$tag\" ] && [[ \"$final_url\" == *\"/releases/tag/\"* ]]; then\n    VERSION=\"$tag\"\n    info \"Resolved latest version: $VERSION\"\n  else\n    # Fallback reasons: network error, no releases, pre-release only, GitHub down\n    VERSION=\"v0.2.1\"\n    warn \"Could not resolve latest version; defaulting to $VERSION\"\n  fi\n}\n```\n\n## Testing Matrix\n\n| Scenario | Expected Result | Fallback? |\n|----------|-----------------|-----------|\n| Normal release exists | Extract version | No |\n| No releases | Empty URL | Yes |\n| Pre-release only | Empty URL | Yes |\n| Network timeout | Empty URL | Yes |\n| Invalid repo | Empty URL | Yes |\n| Non-semver tag | Extract whatever tag is | No |\n| Corporate proxy block | Wrong URL, fails validation | Yes |","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T18:38:51.512238Z","created_by":"jemanuel","updated_at":"2026-01-05T19:12:57.004541Z","closed_at":"2026-01-05T19:12:57.004541Z","close_reason":"Consolidating into single implementation task","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-3o4m","depends_on_id":"cass_memory_system-8zpe","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"}]}
{"id":"cass_memory_system-3pb","title":"[Playbook] updateBulletCounter - Increment helpful/harmful count","description":"## Function Signature\n```typescript\nfunction updateBulletCounter(\n  playbook: Playbook,\n  bulletId: string,\n  type: \"helpful\" | \"harmful\"\n): void\n```\n\n## Purpose\n**DEPRECATED**: Legacy function to increment helpful/harmful counters without timestamp tracking.\n\n## Deprecation Notice\nThis function is maintained for backward compatibility only. **New code should use recordFeedbackEvent()** instead.\n\n## Why Deprecated?\n- No timestamp tracking → cannot calculate confidence decay\n- No event history → cannot analyze feedback patterns\n- No session attribution → cannot trace feedback source\n- Prevents effective confidence scoring\n\n## Implementation\n```typescript\nconst bullet = findBullet(playbook, bulletId);\nif (!bullet) return;\n\nif (type === \"helpful\") {\n  bullet.helpfulCount++;\n} else {\n  bullet.harmfulCount++;\n}\nbullet.updatedAt = now();\n```\n\n## Migration Path\nReplace:\n```typescript\nupdateBulletCounter(playbook, bulletId, \"helpful\");\n```\n\nWith:\n```typescript\nrecordFeedbackEvent(playbook, bulletId, \"helpful\", {\n  timestamp: new Date().toISOString(),\n  sessionId: currentSessionId,\n  context: \"user marked as helpful\"\n});\n```\n\n## Removal Timeline\n- **Current**: Maintained for compatibility\n- **Future**: Will be removed in schema v3\n- **Action**: Migrate all callers to recordFeedbackEvent()\n\n## Dependencies\n- findBullet()\n\n## Related Functions\n- recordFeedbackEvent() - modern replacement\n- calculateEffectiveScore() - requires events, not just counts","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:44:56.393319Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-3tds","title":"[UX] Terminal Output Design System","description":"Why this matters\n- The product is mostly text output. Premium UX requires consistent typography, spacing, and information hierarchy.\n- Today each command prints differently (different separators, emojis, widths, and terminology).\n\nScope\n- Introduce a small shared output layer (headers, tables, wrapping, icons, badges, hints).\n- Respect terminal constraints: width, NO_COLOR, non-TTY contexts.\n- Apply it to high-traffic commands first (`context`, `doctor`, `similar`, `stats`, `usage`).","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-12-13T10:12:43.642369Z","updated_at":"2025-12-14T00:24:31.701930Z","closed_at":"2025-12-14T00:24:31.701930Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-3tds","depends_on_id":"cass_memory_system-q6uv","type":"parent-child","created_at":"2026-01-21T09:28:49Z","created_by":"import"}]}
{"id":"cass_memory_system-3tt","title":"[Playbook] findBullet - Find bullet by ID","description":"## Function Signature\n```typescript\nfunction findBullet(playbook: Playbook, bulletId: string): PlaybookBullet | undefined\n```\n\n## Purpose\nFind a bullet in the playbook by its unique ID. Simple lookup utility used by all mutation operations.\n\n## Implementation\n```typescript\nreturn playbook.bullets.find(b => b.id === bulletId);\n```\n\n## Return Value\n- **Found**: Returns the PlaybookBullet object\n- **Not found**: Returns undefined\n\n## Usage Scenarios\n1. Before updating bullet fields\n2. Before recording feedback events\n3. Before deprecating a bullet\n4. Before pinning/unpinning\n5. Validation that bullet exists\n\n## Implementation Notes\n- Simple array.find() operation\n- O(n) complexity - acceptable for typical playbook sizes\n- No error throwing - returns undefined for not found\n- Caller should handle undefined case\n\n## Common Pattern\n```typescript\nconst bullet = findBullet(playbook, bulletId);\nif (!bullet) {\n  throw new Error(`Bullet not found: ${bulletId}`);\n}\n// ... perform operation on bullet\n```\n\n## Dependencies\n- None (pure function)\n\n## Related Functions\n- updateBulletCounter() - uses this to find bullet\n- recordFeedbackEvent() - uses this to find bullet\n- deprecateBullet() - uses this to find bullet\n- pinBullet() - uses this to find bullet","notes":"Existing playbook helper implementations already present; no code changes made. Released reservation; feel free to take over.","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:44:49.607871Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-3wlb","title":"Feature: Guarantee JSON Output Contract","description":"# Feature: Guarantee JSON Output Contract\n\n## Problem Statement\n\nWhen agents pass `--json` to a command, they expect to receive JSON output they can parse. Currently, several commands have code paths that exit WITHOUT producing any JSON output:\n\n### Specific Violations Found\n\n1. **outcome.ts:94-97** - No signal strong enough\n   ```typescript\n   if (!scored) {\n     console.error(chalk.yellow(\"...\"));  // Goes to stderr\n     process.exit(0);  // NO JSON OUTPUT - agent gets nothing!\n   }\n   ```\n\n2. **outcome.ts:154-157** - No outcomes found for session\n   ```typescript\n   if (filtered.length === 0) {\n     console.error(chalk.yellow(\"...\"));\n     process.exit(0);  // NO JSON OUTPUT\n   }\n   ```\n\n## Why This Matters\n\nAn agent calling `cm outcome success rule-1 --json` and receiving empty stdout will:\n1. Fail to parse JSON (empty string is not valid JSON)\n2. Not know whether the operation succeeded or failed\n3. Have no way to recover or retry appropriately\n\nThis is the #1 blocker for reliable agent integration.\n\n## Solution Design\n\n### Principle: JSON Mode = Always JSON\n\nWhen `--json` flag is set:\n1. ALL code paths MUST call printJson() or printJsonError() before exit\n2. \"Soft success\" (command ran but had no effect) returns:\n   ```json\n   { \"success\": true, \"effect\": false, \"reason\": \"Human-readable explanation\" }\n   ```\n3. Errors return (via printJsonError):\n   ```json\n   { \"success\": false, \"error\": \"message\", \"code\": \"ERROR_CODE\" }\n   ```\n\n### Implementation Strategy\n\n1. Create a helper `printJsonResult()` that handles both success and soft-success cases\n2. Audit every command file for early exits\n3. Add JSON output before each exit when `--json` is set\n4. Add tests to verify JSON output in all code paths\n\n## Files to Modify\n\n- src/commands/outcome.ts (2 violations)\n- src/commands/audit.ts (throws after logging - unclear behavior)\n- Potentially others found during audit\n\n## Acceptance Criteria\n\n- [ ] Running `cm outcome success rule-1 --json` ALWAYS produces valid JSON\n- [ ] Running `cm outcome-apply --session nonexistent --json` produces JSON error\n- [ ] Every command with `--json` flag has been audited\n- [ ] Test coverage added for edge cases\n\n## Parent Epic\nThis feature is part of the CLI Agent-Friendliness Improvements epic.","notes":"Scope clarification (Dec 15, 2025): This feature primarily eliminated *empty-stdout* cases in JSON mode (e.g. outcome soft-success paths) by introducing/using printJsonResult(). It did NOT fully solve validation/catch error paths that still do console.error + process.exit(1) without JSON; those remaining contract violations are tracked in cass_memory_system-9iuc and the v8m5 contract section.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-15T18:23:48.023095Z","updated_at":"2025-12-15T21:38:57.543511Z","closed_at":"2025-12-15T20:11:41.152986Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-3wlb","depends_on_id":"cass_memory_system-1tjx","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"},{"issue_id":"cass_memory_system-3wlb","depends_on_id":"cass_memory_system-gtqd","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"},{"issue_id":"cass_memory_system-3wlb","depends_on_id":"cass_memory_system-qwg9","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"},{"issue_id":"cass_memory_system-3wlb","depends_on_id":"cass_memory_system-xwlp","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"}]}
{"id":"cass_memory_system-3yb","title":"[Cass] cassExpand - Get context around a line","description":"Implement cassExpand() to get context around a specific line.\n\n## Signature\n```typescript\nasync function cassExpand(\n  sessionPath: string, \n  lineNumber: number, \n  contextLines = 3,\n  cassPath = \"cass\"\n): Promise<string | null>\n```\n\n## CLI Command\n`cass expand \"{sessionPath}\" -n {lineNumber} -C {contextLines} --json`\n\n## Implementation\n- Use execFile() to run expand command\n- Return expanded context as string\n- Return null on error\n\n## Error Handling\n- Return null if session not found\n- Return null if line number out of range\n- No retries (expand is deterministic)\n\n## Parameters\n- sessionPath: Full path to session file\n- lineNumber: Target line (1-indexed)\n- contextLines: Lines before/after target (default: 3)\n\n## Output\nReturns context window around target line:\n```\n35: Previous line 3\n36: Previous line 2  \n37: Previous line 1\n38: >>> TARGET LINE <<<\n39: Next line 1\n40: Next line 2\n41: Next line 3\n```\n\n## Usage\nUsed to get surrounding context for search hits:\n```typescript\nconst hits = await cassSearch(\"bug fix\");\nfor (const hit of hits) {\n  const context = await cassExpand(hit.sessionPath, hit.lineNumber, 5);\n  console.log(context);\n}\n```\n\n## Exit Codes\n- 0: Success\n- 4: Session or line not found","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:45:00.936811Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-41k","title":"[Cass] cassCapabilities - Get cass feature support","description":"Implement cassCapabilities() to check what features cass CLI supports.\n\n## Signature\n```typescript\nasync function cassCapabilities(\n  cassPath = \"cass\"\n): Promise<Record<string, boolean>>\n```\n\n## CLI Command\n`cass capabilities --json`\n\n## Implementation\n- Use execFile() to run capabilities command\n- Parse JSON output\n- Return feature availability map\n- Return empty object on error (assume no features)\n\n## Error Handling\n- Return {} if command not supported (old cass version)\n- Return {} on parse error\n- Log at debug level\n\n## Output Structure\n```json\n{\n  \"search\": true,\n  \"timeline\": true,\n  \"export\": true,\n  \"expand\": true,\n  \"semantic_search\": false,\n  \"streaming\": false\n}\n```\n\n## Purpose\nVersion-dependent feature detection. Use to:\n- Gracefully degrade on older cass versions\n- Enable new features when available\n- Show appropriate error messages\n\n## Usage\n```typescript\nconst caps = await cassCapabilities();\n\nif (caps.semantic_search) {\n  // Use new semantic search API\n  await cassSemanticSearch(query);\n} else {\n  // Fallback to keyword search\n  await cassSearch(query);\n}\n\nif (!caps.timeline) {\n  console.error(\"Timeline feature requires cass >= 2.0\");\n  return;\n}\n```\n\n## Exit Codes\n- 0: Success\n- 2: Command not supported (old version)","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:45:03.681228Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-41r","title":"[LLM] validateApiKey - Basic format validation","description":"Function signature:\nfunction validateApiKey(provider: string): void\n\nBasic format validation for API keys:\n- Check env var exists\n- Warn if format looks wrong:\n  * OpenAI keys start with 'sk-'\n  * Anthropic keys start with 'sk-ant-'\n  * Google keys have different format patterns\n\nImplementation notes:\n- Non-blocking - just warnings for potentially invalid keys\n- Does not make actual API calls to validate\n- Helps catch common mistakes like:\n  * Using wrong key for wrong provider\n  * Copying key incorrectly (missing prefix)\n  * Using placeholder/example keys\n\nWarning message example: 'Warning: OpenAI API key does not start with sk- - this may be incorrect'","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:44:51.033883Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-43v","title":"[Playbook] recordFeedbackEvent - Record timestamped feedback","description":"## Function Signature\n```typescript\nfunction recordFeedbackEvent(\n  playbook: Playbook,\n  bulletId: string,\n  type: \"helpful\" | \"harmful\",\n  event: FeedbackEvent\n): void\n```\n\n## Purpose\nRecord timestamped feedback events for bullets. **CRITICAL** for confidence decay calculation and promotion logic.\n\n## FeedbackEvent Structure\n```typescript\ninterface FeedbackEvent {\n  timestamp: string;      // ISO 8601\n  sessionId: string;      // Source session\n  context?: string;       // Why this feedback was given\n}\n```\n\n## Implementation Steps\n1. Find bullet by ID\n2. Push event to helpfulEvents or harmfulEvents array\n3. Update aggregate helpfulCount or harmfulCount\n4. If helpful: update lastValidatedAt to event.timestamp\n5. Update bullet.updatedAt\n6. Check promotion criteria if helpful\n\n## Promotion Check (Helpful Events)\nIf helpfulCount reaches threshold:\n- **5+ helpful**: candidate → established\n- **10+ helpful**: established → proven\n- Never auto-promote if any harmful events exist\n\n## Why Events Matter\n**Timestamps enable confidence decay**:\n- Recent helpful events → high confidence\n- Old helpful events → decayed confidence\n- Events older than 2× half-life → minimal weight\n\nExample:\n- Half-life: 90 days\n- Helpful event from 90 days ago: 50% weight\n- Helpful event from 180 days ago: 25% weight\n- Helpful event from today: 100% weight\n\n## Implementation Notes\n- Always push to events array BEFORE incrementing count\n- Update lastValidatedAt only for helpful events\n- Preserve all event history (never truncate)\n- Check promotion after recording\n\n## Dependencies\n- findBullet()\n- Promotion logic\n\n## Related Functions\n- calculateEffectiveScore() - uses events for decay\n- updateBulletCounter() - deprecated version without events\n- promoteMaturity() - called if thresholds met","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:44:57.082772Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-45ir","title":"Security and Reliability Hardening: Sanitization & LLM Fallback","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-08T02:06:52.600932Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-4ae","title":"[Cass] cassIndex - Trigger index rebuild","description":"Implement cassIndex() to trigger cass index rebuild.\n\n## Signature\n```typescript\nasync function cassIndex(\n  cassPath = \"cass\", \n  options: { full?: boolean; incremental?: boolean } = {}\n): Promise<void>\n```\n\n## CLI Command\n`cass index [--full] [--incremental]`\n\n## Implementation\n- Use spawn() to show real-time progress to user\n- Set stdio: \"inherit\" to show indexing output\n- Build args array based on options\n- Reject promise on non-zero exit code\n\n## Error Handling\n- Throw error if exit code non-zero\n- Include stderr in error message\n- Let caller handle retry logic\n\n## Options\n- full: Rebuild entire index from scratch (for missing/corrupted index)\n- incremental: Update index with new sessions only (for routine maintenance)\n- No options: Default incremental rebuild\n\n## Usage\n```typescript\n// Full rebuild\nawait cassIndex(\"cass\", { full: true });\n\n// Incremental update\nawait cassIndex(\"cass\", { incremental: true });\n```\n\n## Exit Codes\n- 0: Index rebuilt successfully\n- Non-zero: Rebuild failed","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:44:55.244950Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-4aew","title":"Make ProcessedLog.save lock-safe and newline-terminated","description":"ProcessedLog.save currently writes without acquiring the same withLock used by append, and it emits no trailing newline; appending after save can concatenate JSON lines and corrupt the log. Acquire withLock in save() and always write a final newline. Add regression test.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-16T06:54:52.761298Z","updated_at":"2025-12-16T06:56:02.205521Z","closed_at":"2025-12-16T06:56:02.205521Z","close_reason":"ProcessedLog.save now uses withLock and writes a final newline to prevent append-after-save log corruption; added regression test","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-4ccz","title":"[UX][semantic] Clear semantic enablement + fallback messaging across commands","description":"Problem\n- When semantic search is disabled/unavailable, the CLI often falls back silently to keyword mode.\n- Users need to understand: (1) which mode they are in, (2) how to enable semantic, (3) what happens on first use (download), and (4) how to handle offline environments.\n\nWhat to do\n- Standardize semantic messaging across commands (`context`, `similar`, `stats` where relevant):\n  - Clear “mode” indicator (semantic vs keyword)\n  - One concise enablement hint when disabled (config key + path)\n  - Actionable offline/cached guidance\n  - No spam: one message per command run\n\nDependencies\n- Should align with the model download progress bead and the output design system.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-13T10:21:27.483276Z","updated_at":"2025-12-14T00:23:26.164877Z","closed_at":"2025-12-14T00:23:26.164877Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-4ccz","depends_on_id":"cass_memory_system-2erm","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"},{"issue_id":"cass_memory_system-4ccz","depends_on_id":"cass_memory_system-mnqm","type":"parent-child","created_at":"2026-01-21T09:28:49Z","created_by":"import"},{"issue_id":"cass_memory_system-4ccz","depends_on_id":"cass_memory_system-r1hq","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"},{"issue_id":"cass_memory_system-4ccz","depends_on_id":"cass_memory_system-wrur","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"}]}
{"id":"cass_memory_system-4dt","title":"[Curator] handleHarmfulDelta - Record negative feedback","description":"Record negative feedback for playbook bullets.\n\nSignature:\nfunction handleHarmfulDelta(\n  playbook: Playbook,\n  delta: HarmfulDelta\n): { applied: boolean }\n\nProcess:\n1. Find bullet by ID\n   - If not found: return applied: false\n2. Create FeedbackEvent:\n   - timestamp: Date.now()\n   - sessionId: delta.sessionId\n   - reason: delta.reason (required - why was this harmful?)\n   - context: delta.context (optional)\n3. Push to bullet.harmfulEvents array\n4. Increment bullet.harmfulCount\n5. Update bullet.updatedAt\n6. Return applied: true\n\nImportant notes:\n- Does NOT immediately deprecate bullets\n- Does NOT check for auto-inversion here\n- Auto-inversion happens in post-processing (autoInvertHarmfulBullets)\n- This separation allows batching and prevents premature deprecation\n\nWhy separate harmful from deprecation?\n- Single harmful event may be context-specific\n- Need consistent negative pattern (multiple harmful events)\n- Auto-inversion requires threshold crossing (effectiveScore < -pruneThreshold)\n\nHarmful feedback is EVIDENCE, not immediate action.","status":"tombstone","priority":3,"issue_type":"task","created_at":"2025-12-07T21:44:58.717997Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-4fj7","title":"[Critical] V1 Scope Gate - Define MVP Boundary","description":"# V1 Scope Gate - Define Clear MVP Boundary\n\n## The Problem\nCurrent bead set has 333 items with no clear V1/V2/V3 delineation.\nThis means:\n- No clear \"done\" point for v1\n- Risk of scope creep\n- Features compete for attention equally\n- Hard to ship anything\n\n## The Solution\nExplicitly tag every bead as v1, v2, or v3 with clear criteria.\n\n### V1 Criteria (MUST ship):\n- Zero-config works immediately\n- Basic cass search integration\n- Simple playbook (add/remove rules)\n- CLI commands for basic workflow\n- MCP server for agent integration\n- Cost controls (budget limits)\n- Privacy defaults (single-agent)\n\n### V1 Feature Set:\n```\nCOMMANDS (V1):\n  cm context <task>     # Get relevant context\n  cm reflect            # Extract rules from sessions\n  cm mark <rule> <feedback>  # Manual feedback\n  cm playbook list      # Show rules\n  cm playbook add       # Add manual rule\n  cm playbook remove    # Remove rule\n  cm init               # Setup (optional)\n  cm status             # Health check\n\nMCP TOOLS (V1):\n  cm_context            # Get context\n  cm_feedback           # Record feedback\n  cm_outcome            # Record success/failure\n\nSTORAGE (V1):\n  ~/.cass-memory/playbook.json\n  ~/.cass-memory/diary/\n  ~/.cass-memory/config.json\n```\n\n### V2 Features (Post-MVP):\n- Semantic search (embeddings)\n- Cross-agent learning\n- Confidence decay algorithm\n- Automatic curation\n- LLM validation\n- Maturity levels\n- Starter playbooks\n- Rich diary schema\n\n### V3 Features (Future):\n- Team playbooks\n- Cloud sync\n- Analytics dashboard\n- IDE plugins\n- Custom LLM providers\n- Webhooks\n- API for integrations\n\n### V1 Definition of Done:\n- [ ] All v1 commands working\n- [ ] MCP server functional\n- [ ] Works without any setup\n- [ ] Works without LLM (degraded but functional)\n- [ ] Documentation for basic usage\n- [ ] <5 minute time to first value\n\n## Why This Is Critical\n- Scope creep kills projects\n- \"Ship v1, then iterate\" is the way\n- Clear boundary enables focus\n- Users want working tool now, not perfect tool never","notes":"V1 boundary is now explicitly documented in README (MVP Scope section) and PLAN_FOR_CASS_MEMORY_SYSTEM.md (V1 Scope Gate section). All V1-tracking beads referenced there are closed as of 2025-12-14.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T22:14:12.058019Z","updated_at":"2025-12-14T02:30:07.966188Z","closed_at":"2025-12-14T02:30:07.966188Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-4fx1","title":"[E2E] Design scenario matrix + logging spec","description":"Define end-to-end coverage matrix (init->context->reflect->mark->playbook). Include success/degenerate modes (cass unavailable, LLM unavailable, bad config). Specify logging expectations (timestamps, command echo, inputs/outputs redaction), artifacts paths, and pass/fail gates.","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-08T01:29:55.983477Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-4fx1","depends_on_id":"cass_memory_system-q3h2","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"}]}
{"id":"cass_memory_system-4gw","title":"[Decay] checkForPromotion - Automatic maturity advancement","description":"Automatically advance bullets from candidate → established → proven based on effective score AND recent feedback activity.\n\nCOMPLETE IMPLEMENTATION:\n```typescript\n/**\n * Check if bullet qualifies for promotion to higher maturity level.\n * Promotion requires BOTH sufficient score AND recent helpful marks.\n */\nfunction checkForPromotion(bullet: PlaybookBullet): BulletMaturity {\n  const score = getEffectiveScore(bullet);\n  const recentHelpful = bullet.helpfulEvents.filter(e =>\n    daysSince(e.timestamp) < 30\n  ).length;\n\n  // candidate → established: score >= 2 AND recent helpful\n  if (bullet.maturity === 'candidate' && score >= 2 && recentHelpful >= 1) {\n    return 'established';\n  }\n\n  // established → proven: score >= 5 AND multiple recent helpful\n  if (bullet.maturity === 'established' && score >= 5 && recentHelpful >= 2) {\n    return 'proven';\n  }\n\n  return bullet.maturity;\n}\n\n// Helper function\nfunction daysSince(timestamp: string): number {\n  const eventTime = new Date(timestamp).getTime();\n  const now = Date.now();\n  return (now - eventTime) / (1000 * 60 * 60 * 24);\n}\n```\n\nPROMOTION CRITERIA:\n\nCandidate → Established:\n- Effective score >= 2 (net positive after decay & harmful weighting)\n- At least 1 helpful mark in last 30 days (proves current relevance)\n\nEstablished → Proven:\n- Effective score >= 5 (strong positive signal)\n- At least 2 helpful marks in last 30 days (consistent usage)\n\nWHY TWO REQUIREMENTS:\nWithout recency check, old rules with decayed scores could still promote. We want to ensure rules are CURRENTLY useful, not just historically useful.\n\nEXAMPLE SCENARIOS:\n\n1. QUALIFIES for candidate → established:\n   - 3 helpful marks in last week\n   - 0 harmful marks\n   - Effective score ≈ 1.5 (candidate maturity 0.5× multiplier)\n   - Has recent helpful ✓\n   - After promotion, score recalculated with 1.0× multiplier\n\n2. DOES NOT qualify for established → proven:\n   - 10 helpful marks from 6 months ago\n   - Decayed score ≈ 2.5\n   - Only 1 helpful in last 30 days (needs 2)\n   - Stays established until more recent usage\n\n3. RAPID promotion path:\n   - New rule marked helpful 3 times in week 1\n   - Promotes to established\n   - Marked helpful 3 more times in week 2\n   - Promotes to proven by day 14\n\nINTEGRATION:\n- Called by applyMaturityTransitions()\n- Called after each curate cycle\n- Pinned bullets can still be promoted\n- Returns new maturity level or current if no change\n\nDEPENDENCIES:\n- getEffectiveScore()\n- daysSince() helper\n- PlaybookBullet.maturity field","status":"tombstone","priority":3,"issue_type":"task","created_at":"2025-12-07T21:45:21.423759Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-4hey","title":"[Foundation] Development workflow with hot reload","description":"Configure development workflow with hot reload for fast iteration during CASS Memory System development.\n\n## Context\nDevelopers need a fast feedback loop when working on CASS Memory System. Hot reload watches source files and automatically restarts the CLI when changes are detected, eliminating manual restart cycles.\n\n## Technical Specification\n\n### Development Commands:\n\n#### Primary Development Mode:\nbash\nbun run src/cass-memory.ts [command] [args]\n\n- Runs TypeScript source directly without compilation\n- Fast startup (~50ms)\n- Full TypeScript type checking\n- No build step required\n\n#### Hot Reload Mode:\nbash\nbun --watch run src/cass-memory.ts [command] [args]\n\n- Watches all files in src/\n- Automatically restarts on file changes\n- Preserves command arguments\n- Shows clear reload indicators\n\n#### Type Check Mode:\nbash\nbun run typecheck\n# or\ntsc --noEmit\n\n- Runs TypeScript compiler without emitting files\n- Reports type errors\n- Faster than full build\n- Run before commits\n\n#### Test Watch Mode:\nbash\nbun test --watch\n\n- Runs tests on file changes\n- Shows test results in real-time\n- Supports filtering by test name\n\n### Package.json Scripts:\njson\n{\n  \"scripts\": {\n    \"dev\": \"bun run src/cass-memory.ts\",\n    \"dev:watch\": \"bun --watch run src/cass-memory.ts\",\n    \"typecheck\": \"tsc --noEmit\",\n    \"typecheck:watch\": \"tsc --noEmit --watch\",\n    \"test\": \"bun test\",\n    \"test:watch\": \"bun test --watch\",\n    \"lint\": \"eslint src/\",\n    \"format\": \"prettier --write src/\"\n  }\n}\n\n\n### Workflow Examples:\n\n#### Develop a New Command:\nbash\n# Terminal 1: Hot reload\nbun --watch run src/cass-memory.ts doctor\n\n# Terminal 2: Type checking\nbun run typecheck:watch\n\n# Terminal 3: Tests\nbun test --watch\n\n\n#### Quick Iteration:\nbash\n# Run command, see output, make changes, repeat\nbun run src/cass-memory.ts status\n# Edit src/commands/status.ts\nbun run src/cass-memory.ts status  # See changes immediately\n\n\n#### Debug Workflow:\nbash\n# Add console.log() to src/llm.ts\nbun run src/cass-memory.ts reflect\n# See logs immediately, no rebuild\n\n\n### IDE Integration:\n\n#### VS Code tasks.json:\njson\n{\n  \"version\": \"2.0.0\",\n  \"tasks\": [\n    {\n      \"label\": \"Dev: Watch\",\n      \"type\": \"shell\",\n      \"command\": \"bun --watch run src/cass-memory.ts\",\n      \"problemMatcher\": []\n    },\n    {\n      \"label\": \"TypeCheck: Watch\",\n      \"type\": \"shell\",\n      \"command\": \"tsc --noEmit --watch\",\n      \"problemMatcher\": \"-watch\"\n    }\n  ]\n}\n\n\n#### VS Code launch.json:\njson\n{\n  \"version\": \"0.2.0\",\n  \"configurations\": [\n    {\n      \"name\": \"Debug CASS Memory\",\n      \"type\": \"bun\",\n      \"request\": \"launch\",\n      \"program\": \"/src/cass-memory.ts\",\n      \"args\": [\"doctor\"],\n      \"cwd\": \"\"\n    }\n  ]\n}\n\n\n### Development Best Practices:\n\n#### Before Starting Development:\nbash\nbun install          # Install dependencies\nbun run typecheck    # Verify clean state\n\n\n#### During Development:\n- Use bun --watch for hot reload\n- Keep typecheck running in separate terminal\n- Run tests frequently with bun test\n- Commit often with clear messages\n\n#### Before Committing:\nbash\nbun run typecheck    # No type errors\nbun test             # All tests pass\nbun run build        # Binary builds successfully\n./dist/cass-memory --version  # Binary works\n\n\n## Reasoning\n\n### Why Hot Reload:\n1. Faster Feedback: See changes in < 1 second\n2. Flow State: Minimize context switching\n3. Rapid Prototyping: Try ideas quickly\n4. Debugging: Add logs without rebuilding\n\n### Why Bun for Development:\n1. Fast Startup: Bun starts TypeScript in ~50ms\n2. No Build Step: Run .ts files directly\n3. Built-in Watch: --watch flag included\n4. Hot Module Reload: Fast reloads\n\n### Why Separate Type Checking:\n1. Parallel Feedback: Types check while you run\n2. Editor Integration: See errors in IDE\n3. CI Validation: Same command in CI/local\n\n### Why Test Watch Mode:\n1. TDD Workflow: Write test, see it fail, make it pass\n2. Regression Detection: Catch breaks immediately\n3. Confidence: Know tests pass before commit\n\n### Why Not Nodemon/ts-node:\n1. Bun is Faster: Native TypeScript execution\n2. Simpler Stack: One runtime instead of three tools\n3. Better DX: Bun has better error messages\n4. Future-Proof: Bun is the target runtime\n\n## Acceptance Criteria\n\n- bun run src/cass-memory.ts executes CLI without build\n- bun --watch run src/cass-memory.ts reloads on file changes\n- bun run typecheck reports type errors\n- bun run typecheck:watch continuously checks types\n- bun test runs all tests\n- bun test --watch reruns tests on changes\n- Changes to src/ files trigger reload in < 2 seconds\n- Type errors show in terminal and IDE\n- README documents development workflow\n- CONTRIBUTING.md explains setup for new developers\n\n## How This Serves the Universal Agent Memory System\n\nFast development workflow accelerates CASS Memory evolution:\n\n1. Faster Iteration: Developers can try ideas in seconds, not minutes\n2. Better Testing: Watch mode encourages TDD and comprehensive tests\n3. Lower Barrier: New contributors can start developing immediately\n4. Debugging: Quick feedback loop for fixing bugs\n5. Experimentation: Easy to prototype new features\n6. Quality: Type checking and tests run continuously\n7. Documentation: Clear workflow guides new developers\n\nWithout hot reload and fast development tools, contributing to CASS Memory would be slow and frustrating. Fast feedback loops enable rapid innovation and keep the project moving forward.","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:49:02.593086Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-4hmk","title":"[Validation] Test Agent Workflow End-to-End","description":"# Validate Agent Workflow End-to-End\n\n## Purpose\nAfter implementing changes, validate the full agent workflow works.\n\n## Test Scenarios\n\n### Scenario 1: Agent Discovery\n1. Agent has no prior knowledge of cass-memory\n2. Agent runs \\`cm quickstart\\`\n3. Verify agent can understand how to use the system\n\n### Scenario 2: Context Retrieval\n1. Create playbook with known rules\n2. Run \\`cm context \\\"related task\\\" --json\\`\n3. Verify output is:\n   - Under 500 tokens\n   - Contains relevant rules with IDs\n   - Parseable JSON\n\n### Scenario 3: Feedback Loop\n1. Use a rule during work\n2. Provide feedback (inline comment OR cm mark)\n3. Run reflection\n4. Verify feedback was recorded\n\n### Scenario 4: Blurb Sufficiency\n1. Read ONLY the AGENTS.md blurb\n2. Attempt to use cass-memory\n3. Verify blurb is sufficient for basic usage\n\n## Depends On\n- j7lc (README rewrite) - docs must be done\n- 2lit (Blurb) - blurb must exist\n- peoi (quickstart) - command must work\n- ziej (context output) - output must be optimized\n\n## Success Criteria\nAn agent with ZERO prior knowledge can:\n1. Learn the system from quickstart or blurb\n2. Get relevant context for a task\n3. Provide feedback on rules","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-08T17:48:20.746842Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-4hmk","depends_on_id":"cass_memory_system-2lit","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"},{"issue_id":"cass_memory_system-4hmk","depends_on_id":"cass_memory_system-j7lc","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"},{"issue_id":"cass_memory_system-4hmk","depends_on_id":"cass_memory_system-peoi","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"},{"issue_id":"cass_memory_system-4hmk","depends_on_id":"cass_memory_system-ziej","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"}]}
{"id":"cass_memory_system-4iv8","title":"[Testing:Integration] cass.test.ts - Cass integration tests","description":"// Skip if cass not available\nconst SKIP_CASS = !cassAvailable();\n\nTest cases:\n- cassAvailable: returns true when installed\n- cassSearch: returns array, filters work\n- cassTimeline: returns grouped data\n- Empty results handled gracefully\nRequires cass installed to run","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-07T21:49:36.671139Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-4khw","title":"Unit Tests: Curator & Deduplication","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-08T01:23:02.173285Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-4pm1","title":"Unit Tests: Scoring Logic","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-08T01:23:01.975906Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-4sdv","title":"[Testing:LLM] Mocked LLM response tests","description":"Mock the AI SDK:\nconst mockGenerateObject = mock(() => ({\n  object: { ... }\n}));\nmock.module(\"ai\", () => ({ generateObject: mockGenerateObject }));\n\nTest cases:\n- extractDiary: returns structured diary\n- runReflector: generates deltas\n- runValidator: validates rules\n- Prompts include correct variables","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-07T21:49:38.445224Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-4ua5","title":"[Impl] Add --robot Flag Convention (like cass)","description":"# Add --robot Flag Convention (like cass)\n\n## Purpose\ncass uses `--robot` as the primary flag for machine-readable output. We use `--json`. Should we add `--robot` as an alias for consistency across the agent tool ecosystem?\n\n## Current State\n- cass: `--robot` and `--json` both work\n- cm: `--json` only\n\n## Arguments For\n- Consistency with cass (agents learn one pattern)\n- `--robot` signals \"I am an agent\" not just \"give me JSON\"\n- Can add robot-specific behaviors (suppress warnings, etc.)\n\n## Arguments Against\n- `--json` is already standard\n- Adding aliases increases surface area\n- Not strictly necessary\n\n## Recommendation\nAdd `--robot` as an alias for `--json` plus:\n- Suppress INFO-level stderr messages\n- Ensure all output is parseable\n- Add `cm robot-docs` command (like cass)\n\n## Implementation\n- Add --robot flag to all commands that have --json\n- Make --robot = --json + quieter stderr\n- Add cm robot-docs command with topics:\n  - commands: all commands for agents\n  - schemas: JSON output schemas\n  - examples: copy-paste invocations\n  - guide: quick-start for agents\n\n## Deliverables\n- [ ] --robot flag on all relevant commands\n- [ ] cm robot-docs command\n- [ ] Documentation of robot mode behavior","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-08T17:47:52.262Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-4ua5","depends_on_id":"cass_memory_system-2bnu","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"}]}
{"id":"cass_memory_system-4w3l","title":"[E2E] New User Onboarding - Fresh Install to First Context","description":"## Target: E2E test simulating new user experience\n\n### Scenario: First-Time User Setup\n\n```\nUser installs cass-memory\nUser runs init\nUser gets context for first task\nUser marks helpful bullet\nUser checks doctor\n```\n\n### Test Script:\n\n```typescript\ndescribe('E2E: New User Onboarding', () => {\n  let tempHome: string;\n  \n  beforeAll(async () => {\n    tempHome = await createIsolatedEnvironment();\n    log('Created isolated env:', tempHome);\n  });\n\n  it('step 1: init creates structure', async () => {\n    log('Starting: cm init');\n    const result = await runCLI(['init', '--json']);\n    \n    log('Exit code:', result.exitCode);\n    log('Stdout:', result.stdout);\n    log('Duration:', result.duration);\n    \n    expect(result.exitCode).toBe(0);\n    const output = JSON.parse(result.stdout);\n    expect(output.success).toBe(true);\n    expect(output.created).toContain('config.json');\n    \n    // Verify files exist\n    const configExists = await fileExists(join(tempHome, '.cass-memory/config.json'));\n    log('Config exists:', configExists);\n    expect(configExists).toBe(true);\n  });\n\n  it('step 2: context returns empty initially', async () => {\n    log('Starting: cm context');\n    const result = await runCLI(['context', 'test query', '--json']);\n    \n    log('Exit code:', result.exitCode);\n    log('Response:', result.stdout);\n    \n    const output = JSON.parse(result.stdout);\n    expect(output.bullets).toHaveLength(0);\n  });\n\n  // ... more steps\n});\n```\n\n### Logging Requirements:\n- Log every CLI invocation with full args\n- Log all stdout/stderr\n- Log timing for each step\n- Log file system state at checkpoints\n- Summary at end with pass/fail for each step\n\n### Cleanup:\n- Remove temp directories\n- Reset environment variables\n- Report any leaked resources","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T01:31:11.183941Z","updated_at":"2025-12-14T01:37:16.252139Z","closed_at":"2025-12-14T01:37:16.252139Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-4w3l","depends_on_id":"cass_memory_system-ke2x","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"},{"issue_id":"cass_memory_system-4w3l","depends_on_id":"cass_memory_system-uufj","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"},{"issue_id":"cass_memory_system-4w3l","depends_on_id":"cass_memory_system-zc1d","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"}]}
{"id":"cass_memory_system-4wv6","title":"Refactor lock.ts to use atomic mkdir","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-08T02:02:34.222705Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-4y5j","title":"[Testing] package.json test scripts","description":"{\n  \"scripts\": {\n    \"test\": \"bun test\",\n    \"test:unit\": \"bun test tests/unit\",\n    \"test:integration\": \"bun test tests/integration\",\n    \"test:llm\": \"bun test tests/llm\",\n    \"test:e2e\": \"bash tests/e2e/commands.test.sh\",\n    \"test:property\": \"bun test tests/property\",\n    \"test:coverage\": \"bun test --coverage\",\n    \"test:watch\": \"bun test --watch\"\n  }\n}","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-07T21:49:51.480478Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-4zf","title":"[Utils] truncate - Text truncation with ellipsis","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:45:14.481959Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-52q","title":"[Cass] safeCassSearch - Search with automatic error recovery","description":"Implement safeCassSearch() wrapper with automatic error recovery.\n\n## Signature\n```typescript\nasync function safeCassSearch(\n  query: string, \n  options: CassSearchOptions = {},\n  cassPath = \"cass\"\n): Promise<CassHit[]>\n```\n\n## Implementation Flow\n1. Check cassAvailable() - return [] if cass not installed\n2. Check cassNeedsIndex() - rebuild if needed\n3. Call cassSearch() with provided options\n4. Return results or [] on any failure\n\n## Error Handling\n- Never throws exceptions\n- Always returns array (empty on error)\n- Logs errors at appropriate level\n- Performs automatic recovery:\n  - Rebuilds index if missing\n  - Reduces limit on timeout\n  - Retries once after recovery\n\n## Purpose\nHigh-level wrapper for resilient search operations. Use this in:\n- reflect command\n- recall command  \n- remind command\n- Any user-facing search functionality\n\n## Usage\n```typescript\n// Safe to use without try/catch\nconst hits = await safeCassSearch(\"error handling\", { \n  limit: 10,\n  days: 30 \n});\n\nif (hits.length === 0) {\n  console.log(\"No results found\");\n} else {\n  processHits(hits);\n}\n```\n\n## vs cassSearch\n- cassSearch: Low-level, may throw, caller handles errors\n- safeCassSearch: High-level, never throws, auto-recovery","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:44:57.822142Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-53cx","title":"Enhance scoring.ts unit tests to >90% coverage","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-08T01:52:54.637908Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-53cx","depends_on_id":"cass_memory_system-u64s","type":"discovered-from","created_at":"2026-01-21T09:28:49Z","created_by":"import"}]}
{"id":"cass_memory_system-54zp","title":"Task: Standardize --json envelopes across commands","description":"## Problem\n`--json` is intended to be a machine API for coding agents, but today the JSON contract is inconsistent:\n\n- **Success envelope inconsistency**: some commands emit `{ success: true, ... }` (via `printJsonResult()`), while others emit a “bare payload” (e.g. `cm context`, `cm doctor`, `cm similar`, `cm usage`).\n- **Error shape inconsistency**:\n  - `printJsonError()` emits `{ success:false, error:\"...\", code?, details? }`\n  - `src/cm.ts handleError()` emits `{ success:false, error:{ message, code } }`\n  - some commands hand-roll `{ success:false, error:\"...\" }` (sometimes missing `code`)\n\nThis makes generic agent wrappers brittle: they can’t reliably check `success`, interpret errors, or surface consistent next steps.\n\n## Goal\nAdopt **one** JSON envelope for all `--json` outputs (no v2 shims), aligned with the helpers and the README/quickstart:\n\n- **Success**: always includes `success: true` at the top-level\n- **Soft success**: use `effect: false` + `reason` (still `success: true`)\n- **Error**: flat schema with `success:false`, `code`, `error` message, optional `hint` + `details`\n\n## Proposed contract (V1)\n\n### Success\n```json\n{ \"success\": true, ...payload }\n```\n\n### Soft success (ran but intentionally no effect)\n```json\n{ \"success\": true, \"effect\": false, \"reason\": \"...\", ...payload }\n```\n\n### Error\n```json\n{ \"success\": false, \"code\": \"MISSING_REQUIRED\", \"error\": \"...\", \"hint\": \"...\", \"details\": { ... } }\n```\n\nNotes:\n- `code` should come from `ErrorCode` in `src/types.ts`.\n- Keep the error payload **flat** (avoid multiple competing shapes).\n- Avoid nesting the main payload under `data` unless necessary.\n\n## Implementation plan\n\n1. **Make the contract explicit in code**\n   - Update `printJsonError()` to optionally accept `hint`/`retryable` (if needed) without changing the shape.\n   - Ensure `printJsonResult()` is the canonical success printer.\n\n2. **Standardize the top-level CLI error handler**\n   - Update `src/cm.ts handleError()` to use the same flat error schema as `printJsonError()`.\n\n3. **Standardize read-only command outputs**\n   - Replace bare `printJson(payload)` with `printJsonResult(payload)` in commands where the payload is an object:\n     - `src/commands/context.ts`\n     - `src/commands/doctor.ts`\n     - `src/commands/similar.ts`\n     - `src/commands/usage.ts`\n     - audit other remaining `printJson(` call sites\n\n4. **Docs alignment**\n   - Update README examples and `cm quickstart --json` wording if they imply a different envelope.\n\n## Agent-integration guidance (avoid confusion)\n- Treat `effect:false` as “not an error”; agents should not retry blindly.\n- Keep `details` structured and small; do not dump multi-page `--help` output into JSON.\n- Prefer exact command strings in `hint` (agents can paste/run).\n\n## Acceptance criteria\n- [ ] Every `--json` command returns a JSON object with top-level `success: boolean`.\n- [ ] Every JSON error uses the flat schema (`success:false`, `code`, `error`, optional `hint`/`details`).\n- [ ] `src/cm.ts handleError()` matches the same error schema (no nested `error` object).\n- [ ] README + quickstart examples match the implemented schema.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T21:42:05.624856Z","updated_at":"2025-12-15T23:19:35.674519Z","closed_at":"2025-12-15T23:19:35.674519Z","close_reason":"All commands now use printJsonResult() for success and printJsonError() for errors. Standardized JSON envelope with success:boolean. handleError() in cm.ts already uses correct schema.","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-58xr","title":"Remove duplicate RULE_CATEGORIES from onboard.ts","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-15T16:47:57.406019Z","updated_at":"2025-12-15T16:50:35.926641Z","closed_at":"2025-12-15T16:50:35.926641Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-5cru","title":"[UX][docs] Fix README drift (config paths, dev command, defaults, binaries)","description":"Problem\n- README contains several copy/paste flows that don’t match the current codebase. Examples observed:\n  - Repo config path/format: README references `.cass/config.json` but code reads `.cass/config.yaml`.\n  - Dev command entrypoint: README references `src/cass-memory.ts` but actual entry is `src/cm.ts`.\n  - Default model values drift from runtime defaults.\n  - Binary asset naming in install docs may not match build outputs.\n\nWhat to do\n- Do a “docs trust pass”:\n  - Ensure all commands, paths, defaults, and examples match the current implementation.\n  - Prefer `cm` in examples (but ensure `cass-memory` still works).\n  - Keep recovery instructions accurate and safe (no hidden data loss).\n\nNotes\n- Do not add any “contributing/contributors” section back into README (project policy).","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-13T10:19:58.417469Z","updated_at":"2025-12-13T21:28:01.373246Z","closed_at":"2025-12-13T21:28:01.373246Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-5cru","depends_on_id":"cass_memory_system-1ojv","type":"parent-child","created_at":"2026-01-21T09:28:49Z","created_by":"import"},{"issue_id":"cass_memory_system-5cru","depends_on_id":"cass_memory_system-2yzr","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"},{"issue_id":"cass_memory_system-5cru","depends_on_id":"cass_memory_system-9rni","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"},{"issue_id":"cass_memory_system-5cru","depends_on_id":"cass_memory_system-czfe","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"},{"issue_id":"cass_memory_system-5cru","depends_on_id":"cass_memory_system-zdx8","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"}]}
{"id":"cass_memory_system-5cxf","title":"E2E: Full Reflection Cycle","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-08T01:23:11.692549Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-5cxf","depends_on_id":"cass_memory_system-ejyo","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"},{"issue_id":"cass_memory_system-5cxf","depends_on_id":"cass_memory_system-l1ft","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"}]}
{"id":"cass_memory_system-5eh","title":"Phase 1: Foundation + High-ROI Core","description":"# EPIC: Foundation + High-ROI Core\n\n## Purpose\nEstablish the core infrastructure and implement the highest-ROI features that provide immediate value. This phase creates the skeleton upon which all other features build.\n\n## Background & Reasoning\nThe ACE (Agentic Context Engineering) framework emphasizes three key innovations:\n1. **Generator** - Pre-task context hydration\n2. **Reflector** - LLM-powered insight extraction  \n3. **Curator** - Deterministic delta merging (NO LLM rewriting)\n\nThis phase implements the Generator (context command) and foundational types needed for all subsequent phases.\n\n## Priority Features (from ROI analysis)\n- P1: Confidence decay + event timestamps (20× impact)\n- P2: Structured JSON context output (10× impact)\n- P4: Effective score (4× harmful multiplier) (5× impact)\n- P10: State lifecycle draft/active/retired (10× impact)\n- P12: Secret sanitization (∞ security-critical)\n- P14: Kind enum categorization (3× impact)\n\n## Key Deliverables\n1. `cass-memory init` - Initialize configuration and playbook\n2. `cass-memory context --json` - Pre-flight task hydration\n3. Complete type system with all enhancements\n4. cass integration wrapper with error handling\n5. Secret sanitization pipeline\n\n## Architecture Decisions\n- Use Bun for all JS/TS operations (per AGENTS.md rules)\n- Vercel AI SDK for LLM provider abstraction\n- Zod for runtime type validation and LLM structured output\n- YAML for playbook storage (human-readable, git-friendly)\n\n## Success Criteria\n- An agent can run `cass-memory context \"task\"` and receive relevant bullets\n- Bullets have proper decay-adjusted scores\n- No secrets leak into stored diary entries or playbook\n- Configuration cascades from global to repo-level\n\n## Dependencies\nNone - this is the foundation phase","status":"closed","priority":0,"issue_type":"epic","created_at":"2025-12-07T21:16:01.370891Z","updated_at":"2025-12-14T00:11:39.417385Z","closed_at":"2025-12-14T00:11:39.417385Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-5eh.1","title":"Project Setup: Bun + TypeScript + Dependencies","description":"# Feature: Project Setup\n\n## Purpose\nInitialize the project with Bun, TypeScript, and all required dependencies.\n\n## Technical Decisions\n- **Runtime**: Bun (per AGENTS.md: \"Use bun for everything JS/TS\")\n- **LLM SDK**: Vercel AI SDK (supports OpenAI, Anthropic, Google)\n- **Validation**: Zod (structured LLM output, runtime type safety)\n- **YAML**: yaml package (for playbook read/write)\n- **Output**: chalk (terminal colors for human-readable output)\n\n## Files to Create\n1. `package.json` - Dependencies, scripts, bin entry\n2. `tsconfig.json` - TypeScript configuration\n3. `src/` directory structure\n\n## Package.json Specifics\n```json\n{\n  \"name\": \"cass-memory\",\n  \"version\": \"0.1.0\",\n  \"type\": \"module\",\n  \"bin\": { \"cass-memory\": \"./dist/cass-memory.js\" },\n  \"scripts\": {\n    \"dev\": \"bun run src/cass-memory.ts\",\n    \"build\": \"bun build src/cass-memory.ts --compile --outfile dist/cass-memory\",\n    \"typecheck\": \"tsc --noEmit\",\n    \"test\": \"bun test\"\n  },\n  \"dependencies\": {\n    \"ai\": \"^4.0.0\",\n    \"@ai-sdk/openai\": \"^1.0.0\",\n    \"@ai-sdk/anthropic\": \"^1.0.0\", \n    \"@ai-sdk/google\": \"^1.0.0\",\n    \"zod\": \"^3.23.0\",\n    \"yaml\": \"^2.3.0\",\n    \"chalk\": \"^5.3.0\"\n  },\n  \"devDependencies\": {\n    \"@types/bun\": \"latest\",\n    \"typescript\": \"^5.0.0\"\n  }\n}\n```\n\n## Acceptance Criteria\n- `bun install` succeeds\n- `bun run dev --help` shows CLI help\n- `bun run typecheck` passes\n- Directory structure matches plan\n\n## No Dependencies\nThis is the first task.","status":"tombstone","priority":0,"issue_type":"feature","created_at":"2025-12-07T21:17:15.519346Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"feature","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-5eh.1","depends_on_id":"cass_memory_system-5eh","type":"parent-child","created_at":"2026-01-21T09:28:49Z","created_by":"import"}]}
{"id":"cass_memory_system-5eh.1.1","title":"[Setup] Create package.json with exact dependencies","description":"# Task: Create package.json\n\n## Exact File Content\n```json\n{\n  \"name\": \"cass-memory\",\n  \"version\": \"0.1.0\",\n  \"type\": \"module\",\n  \"description\": \"Agent-agnostic reflection and memory system implementing ACE framework\",\n  \"author\": \"Your Name\",\n  \"license\": \"MIT\",\n  \"bin\": {\n    \"cass-memory\": \"./dist/cass-memory.js\"\n  },\n  \"main\": \"./dist/cass-memory.js\",\n  \"scripts\": {\n    \"dev\": \"bun run src/cass-memory.ts\",\n    \"build\": \"bun build src/cass-memory.ts --compile --outfile dist/cass-memory\",\n    \"build:linux\": \"bun build src/cass-memory.ts --compile --target=bun-linux-x64 --outfile dist/cass-memory-linux-x64\",\n    \"build:macos-arm\": \"bun build src/cass-memory.ts --compile --target=bun-darwin-arm64 --outfile dist/cass-memory-darwin-arm64\",\n    \"build:macos-x64\": \"bun build src/cass-memory.ts --compile --target=bun-darwin-x64 --outfile dist/cass-memory-darwin-x64\",\n    \"build:windows\": \"bun build src/cass-memory.ts --compile --target=bun-windows-x64 --outfile dist/cass-memory-windows-x64.exe\",\n    \"build:all\": \"bun run build:linux && bun run build:macos-arm && bun run build:macos-x64 && bun run build:windows\",\n    \"typecheck\": \"tsc --noEmit\",\n    \"test\": \"bun test\",\n    \"test:watch\": \"bun test --watch\"\n  },\n  \"dependencies\": {\n    \"ai\": \"^4.0.0\",\n    \"@ai-sdk/openai\": \"^1.0.0\",\n    \"@ai-sdk/anthropic\": \"^1.0.0\",\n    \"@ai-sdk/google\": \"^1.0.0\",\n    \"zod\": \"^3.23.0\",\n    \"yaml\": \"^2.3.0\",\n    \"chalk\": \"^5.3.0\"\n  },\n  \"devDependencies\": {\n    \"@types/bun\": \"latest\",\n    \"typescript\": \"^5.0.0\"\n  },\n  \"engines\": {\n    \"bun\": \">=1.0.0\"\n  }\n}\n```\n\n## Why These Dependencies\n- **ai**: Vercel AI SDK - unified interface for LLM providers\n- **@ai-sdk/openai**: OpenAI provider (GPT-4, GPT-3.5)\n- **@ai-sdk/anthropic**: Anthropic provider (Claude models)\n- **@ai-sdk/google**: Google provider (Gemini models)\n- **zod**: Runtime type validation + LLM structured output\n- **yaml**: Parse/write YAML playbooks (human-readable, git-friendly)\n- **chalk**: Terminal colors for human-readable output\n\n## Acceptance Criteria\n- [ ] File created at project root\n- [ ] `bun install` completes without errors\n- [ ] All dependencies resolve correctly\n- [ ] `bun run dev --help` executes (even if shows placeholder)","notes":"package.json added per spec; bun install succeeded; bun run dev --help works.","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:32:59.788546Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-5eh.1.1","depends_on_id":"cass_memory_system-5eh.1","type":"parent-child","created_at":"2026-01-21T09:28:49Z","created_by":"import"}]}
{"id":"cass_memory_system-5eh.1.2","title":"[Setup] Create tsconfig.json for strict TypeScript","description":"# Task: Create tsconfig.json\n\n## Exact File Content\n```json\n{\n  \"compilerOptions\": {\n    \"target\": \"ESNext\",\n    \"module\": \"ESNext\",\n    \"moduleResolution\": \"bundler\",\n    \"lib\": [\"ESNext\"],\n    \"types\": [\"bun-types\"],\n    \"strict\": true,\n    \"skipLibCheck\": true,\n    \"noEmit\": true,\n    \"esModuleInterop\": true,\n    \"allowSyntheticDefaultImports\": true,\n    \"forceConsistentCasingInFileNames\": true,\n    \"resolveJsonModule\": true,\n    \"isolatedModules\": true,\n    \"verbatimModuleSyntax\": true,\n    \"noUnusedLocals\": true,\n    \"noUnusedParameters\": true,\n    \"noFallthroughCasesInSwitch\": true,\n    \"exactOptionalPropertyTypes\": true,\n    \"noImplicitReturns\": true,\n    \"noUncheckedIndexedAccess\": true\n  },\n  \"include\": [\"src/**/*.ts\"],\n  \"exclude\": [\"node_modules\", \"dist\"]\n}\n```\n\n## Why These Options\n- **strict: true**: Enables all strict type checking\n- **noUnusedLocals/Parameters**: Catch dead code\n- **noUncheckedIndexedAccess**: Force null checks on array access\n- **exactOptionalPropertyTypes**: Stricter optional property handling\n- **verbatimModuleSyntax**: Modern ESM handling\n\n## Acceptance Criteria\n- [ ] File created at project root\n- [ ] `bun run typecheck` passes with no errors\n- [ ] Strict mode catches type errors properly","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:33:01.022879Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-5eh.1.2","depends_on_id":"cass_memory_system-5eh.1","type":"parent-child","created_at":"2026-01-21T09:28:49Z","created_by":"import"}]}
{"id":"cass_memory_system-5eh.1.3","title":"[Setup] Create src/ directory structure","description":"# Task: Create src/ Directory Structure\n\n## Directory Layout\n```\nsrc/\n├── cass-memory.ts    # Main CLI entry point\n├── types.ts          # All TypeScript interfaces + Zod schemas\n├── utils.ts          # Shared utility functions\n├── config.ts         # Configuration loading/saving\n├── cass.ts           # cass CLI wrapper\n├── sanitize.ts       # Secret sanitization\n├── scoring.ts        # Decay + effective score algorithms\n├── playbook.ts       # Playbook read/write/merge\n├── llm.ts            # LLM provider abstraction\n├── diary.ts          # Diary generation\n├── reflect.ts        # Reflector pipeline\n├── validate.ts       # Scientific validation\n├── curate.ts         # Deterministic delta application\n└── commands/         # Command implementations\n    ├── init.ts\n    ├── context.ts\n    ├── diary.ts\n    ├── reflect.ts\n    ├── mark.ts\n    ├── forget.ts\n    ├── doctor.ts\n    ├── stats.ts\n    ├── validate.ts\n    ├── audit.ts\n    └── project.ts\n```\n\n## File Stubs\nEach file should start with a minimal stub:\n```typescript\n// src/types.ts\nexport {}; // Placeholder\n\n// src/utils.ts\nexport {}; // Placeholder\n// etc.\n```\n\n## Acceptance Criteria\n- [ ] All directories created\n- [ ] All file stubs created\n- [ ] `bun run typecheck` passes (empty files are valid)\n- [ ] Import structure works: `import { x } from \"./types\"`","notes":"Waiting for FuchsiaBear reservation on src/**; skeleton appears present. Ready to resume when available.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T21:33:02.373506Z","updated_at":"2025-12-14T02:31:25.833524Z","closed_at":"2025-12-14T02:31:25.833524Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-5eh.1.3","depends_on_id":"cass_memory_system-5eh.1","type":"parent-child","created_at":"2026-01-21T09:28:49Z","created_by":"import"}]}
{"id":"cass_memory_system-5eh.10","title":"CLI Scaffolding: src/cass-memory.ts","description":"# Feature: CLI Scaffolding (src/cass-memory.ts)\n\n## Purpose\nMain CLI entry point with command parsing, help text, and routing to\ncommand handlers.\n\n## CLI Structure\n```\ncass-memory <command> [options]\n\nCommands:\n  init              Initialize configuration and playbook\n  context <task>    Get relevant context for a task (Phase 1)\n  diary <path>      Generate structured diary from a session (Phase 2)\n  reflect           Run reflection cycle on recent sessions (Phase 2)\n  validate <rule>   Validate proposed rule against history (Phase 3)\n  curate            Apply deltas to playbook (Phase 2)\n  mark <id>         Record bullet usage (helpful/harmful) (Phase 2)\n  forget <id>       Permanently block a pattern (Phase 2)\n  audit             Check sessions for rule violations (Phase 4)\n  playbook          Manage playbook entries (Phase 2)\n  project           Export playbook to AGENTS.md (Phase 4)\n  stats             Show playbook health metrics (Phase 3)\n  doctor            Check system health (Phase 2)\n\nGlobal Options:\n  --json            Output in JSON format\n  --verbose         Enable verbose logging\n  --config <path>   Use custom config file\n  --help            Show help\n  --version         Show version\n```\n\n## Implementation Approach\nUse simple argument parsing (no heavy dependencies):\n```typescript\nconst args = process.argv.slice(2);\nconst command = args[0];\nconst flags = parseFlags(args.slice(1));\n\nswitch (command) {\n  case \"init\": return initCommand(flags);\n  case \"context\": return contextCommand(args[1], flags);\n  // ...\n  default: showHelp();\n}\n```\n\n## Global Flag Handling\n```typescript\ninterface GlobalFlags {\n  json: boolean;\n  verbose: boolean;\n  config?: string;\n  help: boolean;\n  version: boolean;\n}\n\nfunction parseFlags(args: string[]): GlobalFlags & Record<string, any>;\n```\n\n## Output Formatting\n```typescript\n// JSON output (for agents)\nfunction outputJson(data: any): void {\n  console.log(JSON.stringify(data, null, 2));\n}\n\n// Human output (for developers)\nfunction outputHuman(data: any, formatter: (d: any) => string): void {\n  console.log(formatter(data));\n}\n\n// Auto-select based on --json flag\nfunction output(data: any, formatter?: (d: any) => string, flags?: GlobalFlags): void {\n  if (flags?.json) outputJson(data);\n  else if (formatter) outputHuman(data, formatter);\n  else console.log(data);\n}\n```\n\n## Error Handling\n- Exit code 0: Success\n- Exit code 1: User error (bad input, missing file)\n- Exit code 2: System error (cass unavailable, API error)\n- Always output errors to stderr","status":"tombstone","priority":1,"issue_type":"feature","created_at":"2025-12-07T21:19:51.077755Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"feature","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-5eh.10","depends_on_id":"cass_memory_system-5eh","type":"parent-child","created_at":"2026-01-21T09:28:49Z","created_by":"import"},{"issue_id":"cass_memory_system-5eh.10","depends_on_id":"cass_memory_system-5eh.3","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"},{"issue_id":"cass_memory_system-5eh.10","depends_on_id":"cass_memory_system-5eh.7","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"}]}
{"id":"cass_memory_system-5eh.11","title":"Init Command: cass-memory init","description":"# Feature: Init Command\n\n## Purpose\nInitialize cass-memory for first-time users:\n1. Create directory structure\n2. Create default config\n3. Create empty playbook\n4. Verify cass availability\n5. Offer to run initial index\n\n## Usage\n```bash\ncass-memory init [--force] [--json]\n```\n\n## Behavior\n```typescript\nasync function initCommand(flags: InitFlags): Promise<void> {\n  // 1. Check if already initialized\n  const configExists = await fileExists(\"~/.cass-memory/config.json\");\n  if (configExists && !flags.force) {\n    error(\"Already initialized. Use --force to reinitialize.\");\n    return;\n  }\n  \n  // 2. Create directories\n  await ensureDir(\"~/.cass-memory/diary\");\n  await ensureDir(\"~/.cass-memory/reflections\");\n  await ensureDir(\"~/.cass-memory/embeddings\");\n  await ensureDir(\"~/.cass-memory/cost\");\n  \n  // 3. Create default config\n  const config = getDefaultConfig();\n  await saveConfig(config);\n  \n  // 4. Create empty playbook\n  const playbook = createEmptyPlaybook(\"global\");\n  await savePlaybook(playbook, config.playbookPath);\n  \n  // 5. Check cass availability\n  const cassOk = cassAvailable(config.cassPath);\n  if (!cassOk) {\n    warn(\"cass is not available. Some features will not work.\");\n    warn(\"Install cass: https://github.com/your/cass\");\n  }\n  \n  // 6. Output result\n  output({\n    success: true,\n    configPath: expandPath(\"~/.cass-memory/config.json\"),\n    playbookPath: expandPath(config.playbookPath),\n    cassAvailable: cassOk\n  }, formatInitResult, flags);\n}\n```\n\n## Directory Structure Created\n```\n~/.cass-memory/\n├── config.json           # Tool configuration\n├── playbook.yaml         # Global playbook (empty)\n├── diary/                # Diary entries (empty)\n├── reflections/          # Reflection logs\n├── embeddings/           # Embedding cache (Phase 3)\n└── cost/                 # LLM cost tracking\n```\n\n## Output Formats\n\n### JSON (--json)\n```json\n{\n  \"success\": true,\n  \"configPath\": \"/Users/x/.cass-memory/config.json\",\n  \"playbookPath\": \"/Users/x/.cass-memory/playbook.yaml\",\n  \"cassAvailable\": true\n}\n```\n\n### Human-readable\n```\n✓ Created ~/.cass-memory/config.json\n✓ Created ~/.cass-memory/playbook.yaml\n✓ Created directories: diary/, reflections/, embeddings/\n✓ cass available: yes\n\ncass-memory initialized successfully!\n\nNext steps:\n  cass-memory context \"your task\" --json  # Get context for a task\n  cass-memory doctor                       # Check system health\n```","status":"tombstone","priority":1,"issue_type":"feature","created_at":"2025-12-07T21:19:52.268384Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"feature","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-5eh.11","depends_on_id":"cass_memory_system-5eh","type":"parent-child","created_at":"2026-01-21T09:28:49Z","created_by":"import"},{"issue_id":"cass_memory_system-5eh.11","depends_on_id":"cass_memory_system-5eh.10","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"},{"issue_id":"cass_memory_system-5eh.11","depends_on_id":"cass_memory_system-5eh.4","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"},{"issue_id":"cass_memory_system-5eh.11","depends_on_id":"cass_memory_system-5eh.7","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"},{"issue_id":"cass_memory_system-5eh.11","depends_on_id":"cass_memory_system-5eh.8","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"}]}
{"id":"cass_memory_system-5eh.12","title":"Context Command: cass-memory context (P2 - Generator)","description":"# Feature: Context Command (The Generator)\n\n## Purpose\nThe \"Generator\" phase of ACE: retrieve relevant context BEFORE starting a task.\nThis is the primary interface for agents to access accumulated knowledge.\n\n## Usage\n```bash\ncass-memory context \"Fix authentication timeout bug\" --json\ncass-memory context \"Add dark mode support\" --top 10 --days 30\n```\n\n## Process Flow\n```\n1. Parse task description\n2. Generate search keywords (LLM or heuristic)\n3. Score playbook bullets by relevance\n4. Query cass for relevant history\n5. Check deprecated patterns for warnings\n6. Format output (JSON or human)\n```\n\n## Implementation\n```typescript\nasync function contextCommand(task: string, flags: ContextFlags): Promise<void> {\n  const config = await loadConfig();\n  const playbook = await loadMergedPlaybook(config);\n  \n  // 1. Extract keywords from task\n  const keywords = extractKeywords(task);\n  \n  // 2. Score and filter bullets\n  const scoredBullets = playbook.bullets\n    .filter(b => !b.deprecated && b.state !== \"retired\")\n    .map(b => ({\n      ...b,\n      relevanceScore: scoreBulletRelevance(b.content, b.tags, keywords),\n      effectiveScore: getEffectiveScore(b, config)\n    }))\n    .filter(b => b.relevanceScore > 0)\n    .sort((a, b) => (b.relevanceScore * b.effectiveScore) - (a.relevanceScore * a.effectiveScore))\n    .slice(0, flags.top || config.maxBulletsInContext);\n  \n  // 3. Query cass for history\n  const cassHits = await safeCassSearch(keywords.join(\" \"), {\n    limit: flags.history || config.maxHistoryInContext,\n    days: flags.days || config.sessionLookbackDays\n  }, config.cassPath);\n  \n  // 4. Check deprecated patterns\n  const warnings = checkDeprecatedPatterns(task, playbook.deprecatedPatterns);\n  \n  // 5. Format output\n  const result: ContextResult = {\n    task,\n    bullets: scoredBullets.map(b => ({\n      id: b.id,\n      content: b.content,\n      category: b.category,\n      kind: b.kind,\n      relevanceScore: b.relevanceScore,\n      effectiveScore: b.effectiveScore\n    })),\n    history: cassHits,\n    warnings,\n    formattedPrompt: formatContextPrompt(scoredBullets, cassHits, warnings)\n  };\n  \n  output(result, formatContextHuman, flags);\n}\n```\n\n## JSON Output Format (P2)\n```json\n{\n  \"task\": \"Fix authentication timeout bug\",\n  \"bullets\": [\n    {\n      \"id\": \"b-abc123\",\n      \"content\": \"For auth timeout issues, check session TTL in config...\",\n      \"category\": \"debugging\",\n      \"kind\": \"workflow_rule\",\n      \"relevanceScore\": 8.5,\n      \"effectiveScore\": 12.3\n    }\n  ],\n  \"history\": [\n    {\n      \"source_path\": \"~/.claude/sessions/abc.jsonl\",\n      \"line_number\": 142,\n      \"agent\": \"claude\",\n      \"snippet\": \"Fixed auth timeout by increasing session TTL...\",\n      \"score\": 0.85\n    }\n  ],\n  \"warnings\": [\n    \"Deprecated: AuthHandler - use AuthService from @/lib/auth\"\n  ],\n  \"formattedPrompt\": \"## PLAYBOOK CONTEXT\\n...\"\n}\n```\n\n## Human Output Format\n```\n═══════════════════════════════════════════════════════════════\nCONTEXT FOR: Fix authentication timeout bug\n═══════════════════════════════════════════════════════════════\n\nRELEVANT PLAYBOOK RULES (5 bullets):\n\n[b-abc123] debugging/workflow_rule (score: 12.3)\n  For auth timeout issues, check session TTL in config first.\n  Set TTL to match your expected session duration.\n\n[b-def456] debugging/stack_pattern (score: 8.7)\n  When debugging timeouts, enable DEBUG=auth:* for verbose logs.\n\nHISTORICAL CONTEXT (3 sessions):\n\n1. ~/.claude/sessions/abc.jsonl:142 (claude, 2 days ago)\n   \"Fixed auth timeout by increasing session TTL from 3600 to 7200\"\n\n⚠️ WARNINGS:\n  • Deprecated: AuthHandler - use AuthService from @/lib/auth\n\nSUGGESTED SEARCHES:\n  cass search \"auth timeout session\" --days 30\n  cass search \"TTL configuration\" --agent claude\n```","status":"tombstone","priority":0,"issue_type":"feature","created_at":"2025-12-07T21:19:52.707712Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"feature","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-5eh.12","depends_on_id":"cass_memory_system-5eh","type":"parent-child","created_at":"2026-01-21T09:28:49Z","created_by":"import"},{"issue_id":"cass_memory_system-5eh.12","depends_on_id":"cass_memory_system-5eh.10","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"},{"issue_id":"cass_memory_system-5eh.12","depends_on_id":"cass_memory_system-5eh.4","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"},{"issue_id":"cass_memory_system-5eh.12","depends_on_id":"cass_memory_system-5eh.6","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"},{"issue_id":"cass_memory_system-5eh.12","depends_on_id":"cass_memory_system-5eh.8","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"}]}
{"id":"cass_memory_system-5eh.2","title":"Type System: Complete TypeScript Interfaces + Zod Schemas","description":"# Feature: Type System (src/types.ts)\n\n## Purpose\nDefine all TypeScript interfaces and Zod schemas that form the contract for\nthe entire system. This is the most critical file - everything depends on it.\n\n## Key Data Models\n\n### PlaybookBullet (Enhanced)\n```typescript\ninterface PlaybookBullet {\n  // Identity\n  id: string;                    // \"b-{timestamp36}-{random}\"\n  \n  // Scope\n  scope: \"global\" | \"workspace\";\n  workspace?: string;\n  \n  // Content\n  category: string;\n  content: string;               // 10-500 chars\n  searchPointer?: string;        // Optional cass query\n  \n  // Kind (NEW - P14)\n  kind: \"project_convention\" | \"stack_pattern\" | \"workflow_rule\" | \"anti_pattern\";\n  \n  // State Lifecycle (NEW - P10)\n  state: \"draft\" | \"active\" | \"retired\";\n  \n  // Tracking with decay (NEW - P1)\n  feedbackEvents: FeedbackEvent[];  // Timestamped events\n  \n  // Legacy counts (computed from feedbackEvents)\n  helpfulCount: number;\n  harmfulCount: number;\n  \n  // Lifecycle timestamps\n  createdAt: string;\n  updatedAt: string;\n  deprecated: boolean;\n  replacedBy?: string;\n  deprecationReason?: string;\n  \n  // Provenance\n  sourceSessions: string[];\n  sourceAgents: string[];\n  \n  // Tagging\n  tags: string[];\n  \n  // Computed (optional, cached)\n  embedding?: number[];\n}\n```\n\n### FeedbackEvent (NEW - P1)\n```typescript\ninterface FeedbackEvent {\n  type: \"helpful\" | \"harmful\";\n  timestamp: string;              // ISO 8601\n  sessionPath?: string;\n  reason?: string;                // For harmful\n  decayedValue?: number;          // Cached after decay calculation\n}\n```\n\n### DiaryEntry\n- id, sessionPath\n- timestamp, agent, workspace, duration\n- status: success | failure | mixed\n- accomplishments, decisions, challenges, preferences, keyLearnings\n- relatedSessions (cross-agent enrichment)\n- tags, searchAnchors\n\n### Delta Types\n- add, helpful, harmful, replace, deprecate, merge\n\n### Configuration\n- Provider settings (openai/anthropic/google)\n- Path settings (playbookPath, diaryDir)\n- Thresholds (dedup, prune, maxIterations)\n- Feature flags\n\n## Zod Schemas\nAll interfaces must have corresponding Zod schemas for:\n1. Runtime validation\n2. LLM structured output (generateObject)\n3. YAML parsing validation\n\n## Acceptance Criteria\n- All types from plan implemented\n- Zod schemas match interfaces\n- Export all types for use across modules\n- TSDoc comments on complex types","status":"tombstone","priority":0,"issue_type":"feature","created_at":"2025-12-07T21:17:16.768077Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"feature","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-5eh.3","title":"Utility Functions: src/utils.ts","description":"# Feature: Utility Functions (src/utils.ts)\n\n## Purpose\nShared utility functions used across all modules. Extracted to avoid duplication\nand ensure consistent behavior.\n\n## Function Categories\n\n### Path Utilities\n- `expandPath(p)` - Expand ~ to homedir\n- `ensureDir(dir)` - Create directory recursively\n- `fileExists(path)` - Check file existence\n\n### Content Hashing & Deduplication\n- `hashContent(content)` - SHA256 hash for content comparison\n- `jaccardSimilarity(a, b)` - Token-based similarity (0-1)\n- `tokenize(text)` - Split text into searchable tokens\n\n### ID Generation\n- `generateBulletId()` - \"b-{timestamp36}-{random}\"\n- `generateDiaryId(sessionPath)` - \"diary-{hash}\"\n\n### Date/Time Utilities\n- `now()` - ISO 8601 timestamp\n- `daysAgo(n)` - Date n days in the past\n- `formatRelativeTime(iso)` - \"2 days ago\", \"3 weeks ago\"\n\n### Text Utilities\n- `extractKeywords(text)` - Extract searchable keywords (stopwords removed)\n- `truncate(text, maxLen)` - Truncate with \"...\"\n\n### Scoring\n- `scoreBulletRelevance(content, tags, keywords)` - Keyword-based relevance score\n\n### Logging\n- `log(msg, verbose)` - Conditional stderr logging\n- `error(msg)` - Error logging to stderr\n\n## Design Decisions\n- All functions are pure where possible\n- No side effects except logging\n- Consistent error handling\n\n## Testing Notes\nThese utilities should have unit tests since they're foundational.","status":"tombstone","priority":1,"issue_type":"feature","created_at":"2025-12-07T21:17:55.017717Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"feature","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-5eh.3","depends_on_id":"cass_memory_system-5eh.2","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"}]}
{"id":"cass_memory_system-5eh.4","title":"cass Integration Wrapper: src/cass.ts","description":"# Feature: cass Integration Wrapper (src/cass.ts)\n\n## Purpose\nRobust wrapper around the cass CLI for searching, exporting, and managing\nagent session history. Handles errors gracefully with automatic recovery.\n\n## Functions to Implement\n\n### Health & Availability\n- `cassAvailable(cassPath)` - Check if cass is in PATH\n- `cassNeedsIndex(cassPath)` - Check if index needs rebuild\n\n### Index Management\n- `cassIndex(cassPath, opts)` - Run full or incremental index rebuild\n\n### Search\n- `cassSearch(query, opts, cassPath)` - Execute search, return hits\n- `safeCassSearch(query, opts, cassPath)` - With automatic error recovery\n\n### Export & View\n- `cassExport(sessionPath, format, cassPath)` - Export session to markdown/json\n- `cassExpand(sessionPath, lineNum, context, cassPath)` - Get context around line\n\n### Stats\n- `cassStats(cassPath)` - Get overall cass statistics\n- `cassTimeline(days, cassPath)` - Get session timeline\n\n## Error Handling (CRITICAL)\nThe cass CLI has specific exit codes that we must handle:\n- 0: success\n- 2: usage_error (non-retryable)\n- 3: index_missing (retryable: rebuild index)\n- 4: not_found (non-retryable)\n- 5: idempotency_mismatch (non-retryable)\n- 9: unknown (non-retryable)\n- 10: timeout (retryable: reduce limit)\n\n## Implementation Details\n- Use execSync for synchronous calls (simpler, avoids callback hell)\n- maxBuffer: 50MB (cass can return large results)\n- Default timeout: 30s per search\n- Always use --robot flag for machine-readable JSON output\n\n## Example Usage\n```typescript\nconst hits = await safeCassSearch(\"authentication error\", {\n  limit: 10,\n  days: 30,\n  agent: [\"claude\", \"cursor\"]\n});\n```","status":"tombstone","priority":0,"issue_type":"feature","created_at":"2025-12-07T21:17:56.366967Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"feature","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-5eh.4","depends_on_id":"cass_memory_system-5eh","type":"parent-child","created_at":"2026-01-21T09:28:49Z","created_by":"import"}]}
{"id":"cass_memory_system-5eh.5","title":"Secret Sanitization Pipeline (P12 - Security Critical)","description":"# Feature: Secret Sanitization (SECURITY CRITICAL)\n\n## Purpose\nPrevent secrets (API keys, tokens, passwords, private keys) from being stored\nin diary entries, playbook bullets, or any persistent storage.\n\n## Risk Assessment\n- **Impact**: Critical - leaked secrets could compromise systems\n- **Likelihood**: High - agent sessions often contain env vars, configs\n- **Priority**: P12 rated ∞ (security-critical, non-negotiable)\n\n## High-Yield Patterns to Detect\n```typescript\nconst SECRET_PATTERNS = [\n  // AWS\n  { pattern: /AKIA[0-9A-Z]{16}/g, replacement: \"[AWS_ACCESS_KEY]\" },\n  { pattern: /[A-Za-z0-9/+=]{40}(?=\\s|$|\")/g, replacement: \"[AWS_SECRET_KEY]\" },\n  \n  // Generic API keys/tokens\n  { pattern: /Bearer\\s+[A-Za-z0-9\\-\\._~\\+\\/]+=*/g, replacement: \"[BEARER_TOKEN]\" },\n  { pattern: /api[_-]?key[\"\\s:=]+[\"']?[A-Za-z0-9\\-_]{20,}[\"']?/gi, replacement: \"[API_KEY]\" },\n  { pattern: /token[\"\\s:=]+[\"']?[A-Za-z0-9\\-_]{20,}[\"']?/gi, replacement: \"[TOKEN]\" },\n  \n  // Private keys\n  { pattern: /-----BEGIN.*PRIVATE KEY-----[\\s\\S]+?-----END.*PRIVATE KEY-----/g, replacement: \"[PRIVATE_KEY]\" },\n  \n  // Passwords\n  { pattern: /password[\"\\s:=]+[\"'][^\"']{8,}[\"']/gi, replacement: 'password=\"[REDACTED]\"' },\n  \n  // GitHub tokens\n  { pattern: /ghp_[A-Za-z0-9]{36}/g, replacement: \"[GITHUB_PAT]\" },\n  { pattern: /github_pat_[A-Za-z0-9_]{22,}/g, replacement: \"[GITHUB_PAT]\" },\n  \n  // Slack tokens\n  { pattern: /xox[baprs]-[A-Za-z0-9-]+/g, replacement: \"[SLACK_TOKEN]\" },\n  \n  // Database URLs with credentials\n  { pattern: /(postgres|mysql|mongodb):\\/\\/[^:]+:[^@]+@/gi, replacement: \"$1://[USER]:[PASS]@\" }\n];\n```\n\n## Sanitization Points (WHERE to apply)\n1. After cassExport(), before passing to LLM\n2. Before writing DiaryEntry to disk\n3. Before storing content in PlaybookBullet\n4. In context output (already sanitized if stored sanitized)\n\n## Configuration\n```json\n{\n  \"sanitization\": {\n    \"enabled\": true,\n    \"extraPatterns\": [\"INTERNAL_[A-Z_]+_KEY\"]\n  }\n}\n```\n\n## API\n```typescript\nfunction sanitize(text: string, config: SanitizationConfig): string\n```\n\n## Testing Requirements\n- Test each pattern category\n- Test that sanitization is idempotent\n- Test edge cases (partial matches, nested patterns)\n- Verify no false positives on common code patterns","status":"tombstone","priority":0,"issue_type":"feature","created_at":"2025-12-07T21:17:56.611313Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"feature","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-5eh.5","depends_on_id":"cass_memory_system-5eh","type":"parent-child","created_at":"2026-01-21T09:28:49Z","created_by":"import"},{"issue_id":"cass_memory_system-5eh.5","depends_on_id":"cass_memory_system-5eh.3","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"}]}
{"id":"cass_memory_system-5eh.6","title":"Confidence Decay + Effective Score Algorithms (P1, P4)","description":"# Feature: Confidence Decay + Effective Score Algorithms\n\n## Purpose\nImplement the highest-ROI feature (20× impact): confidence decay based on\nevent timestamps. Old feedback matters less than recent feedback, preventing\n\"fossilization\" where stale rules persist indefinitely.\n\n## The Problem Being Solved\nWithout decay:\n- A rule marked helpful 50 times 2 years ago stays \"proven\" forever\n- Even if it's now causing problems, its historical weight dominates\n- The playbook becomes fossilized with outdated rules\n\nWith decay:\n- Recent feedback (last 30 days) has full weight\n- Older feedback decays exponentially (half-life: 90 days)\n- Rules must continue proving useful to maintain high scores\n\n## Decay Algorithm\n```typescript\nfunction calculateDecayedValue(\n  event: FeedbackEvent,\n  now: Date,\n  halfLifeDays: number = 90\n): number {\n  const eventDate = new Date(event.timestamp);\n  const ageMs = now.getTime() - eventDate.getTime();\n  const ageDays = ageMs / (1000 * 60 * 60 * 24);\n  \n  // Exponential decay: value = 1 * (0.5)^(age/halfLife)\n  const decayFactor = Math.pow(0.5, ageDays / halfLifeDays);\n  return decayFactor;\n}\n\nfunction getDecayedCounts(bullet: PlaybookBullet, config: Config): {\n  decayedHelpful: number;\n  decayedHarmful: number;\n} {\n  const now = new Date();\n  let decayedHelpful = 0;\n  let decayedHarmful = 0;\n  \n  for (const event of bullet.feedbackEvents) {\n    const decayed = calculateDecayedValue(event, now, config.decayHalfLifeDays);\n    if (event.type === \"helpful\") decayedHelpful += decayed;\n    else decayedHarmful += decayed;\n  }\n  \n  return { decayedHelpful, decayedHarmful };\n}\n```\n\n## Effective Score Algorithm (P4 - 4× harmful multiplier)\n```typescript\nfunction getEffectiveScore(bullet: PlaybookBullet, config: Config): number {\n  const { decayedHelpful, decayedHarmful } = getDecayedCounts(bullet, config);\n  \n  // Key insight: harmful feedback weighs 4× more than helpful\n  // This surfaces problematic rules FAST\n  const rawScore = decayedHelpful - (4 * decayedHarmful);\n  \n  // Maturity multiplier (proven rules get slight boost)\n  const maturityMultiplier = {\n    draft: 0.8,\n    active: 1.0,\n    proven: 1.2,\n    retired: 0.1\n  }[bullet.state] || 1.0;\n  \n  return rawScore * maturityMultiplier;\n}\n```\n\n## Why 4× Harmful Multiplier?\n- A rule that helps 3 times but hurts once is NET NEGATIVE\n- This matches intuition: one bad recommendation erodes trust\n- Forces rules to be consistently helpful, not just occasionally useful\n\n## Maturity State Calculation\n```typescript\nfunction calculateMaturityState(bullet: PlaybookBullet, config: Config): State {\n  const { decayedHelpful, decayedHarmful } = getDecayedCounts(bullet, config);\n  const total = decayedHelpful + decayedHarmful;\n  const harmfulRatio = total > 0 ? decayedHarmful / total : 0;\n  \n  // Transitions\n  if (bullet.deprecated) return \"retired\";\n  if (harmfulRatio > 0.3) return \"retired\";  // Too harmful\n  if (total < 3) return \"draft\";              // Not enough data\n  if (decayedHelpful >= 10 && harmfulRatio < 0.1) return \"proven\";\n  return \"active\";\n}\n```\n\n## Configuration\n```json\n{\n  \"scoring\": {\n    \"decayHalfLifeDays\": 90,\n    \"harmfulMultiplier\": 4,\n    \"minFeedbackForActive\": 3,\n    \"minHelpfulForProven\": 10,\n    \"maxHarmfulRatioForProven\": 0.1\n  }\n}\n```","status":"tombstone","priority":0,"issue_type":"feature","created_at":"2025-12-07T21:18:47.062937Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"feature","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-5eh.7","title":"Configuration Management: Load/Save/Cascade","description":"# Feature: Configuration Management\n\n## Purpose\nHandle configuration loading, saving, and cascading from global to repo-level.\n\n## Configuration Locations (in priority order)\n1. CLI flags (highest priority)\n2. `.cass/config.yaml` (repo-level)\n3. `~/.cass-memory/config.json` (user-level)\n4. Built-in defaults (lowest priority)\n\n## Config Schema\n```typescript\ninterface Config {\n  // Schema version for migrations\n  schema_version: number;\n  \n  // LLM Provider\n  provider: \"openai\" | \"anthropic\" | \"google\";\n  model: string;\n  \n  // Paths\n  playbookPath: string;\n  diaryDir: string;\n  cassPath: string;\n  \n  // Reflection settings\n  maxReflectorIterations: number;  // 1-3\n  dedupSimilarityThreshold: number; // 0.0-1.0\n  pruneHarmfulThreshold: number;    // Auto-prune if harmful > N\n  \n  // Context settings\n  maxBulletsInContext: number;\n  maxHistoryInContext: number;\n  \n  // Scoring settings\n  decayHalfLifeDays: number;\n  harmfulMultiplier: number;\n  \n  // Session settings\n  sessionLookbackDays: number;\n  validationLookbackDays: number;\n  \n  // Feature flags\n  validationEnabled: boolean;\n  autoReflect: boolean;\n  enrichWithCrossAgent: boolean;\n  semanticSearchEnabled: boolean;\n  \n  // Sanitization\n  sanitization: {\n    enabled: boolean;\n    extraPatterns: string[];\n  };\n  \n  // Logging\n  verbose: boolean;\n  jsonOutput: boolean;\n}\n```\n\n## Functions to Implement\n```typescript\n// Load config with cascading priority\nasync function loadConfig(cliOverrides?: Partial<Config>): Promise<Config>;\n\n// Save config (only to user-level)\nasync function saveConfig(config: Config): Promise<void>;\n\n// Get default config\nfunction getDefaultConfig(): Config;\n\n// Merge configs (used internally)\nfunction mergeConfigs(...configs: Partial<Config>[]): Config;\n\n// Validate config against schema\nfunction validateConfig(config: unknown): Config;\n```\n\n## YAML Normalization\nAccept both snake_case and camelCase in YAML, always emit camelCase:\n```typescript\nfunction normalizeYamlKeys(obj: any): any {\n  // snake_case → camelCase\n  // e.g., \"helpful_count\" → \"helpfulCount\"\n}\n```","status":"tombstone","priority":1,"issue_type":"feature","created_at":"2025-12-07T21:18:48.457336Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"feature","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-5eh.7","depends_on_id":"cass_memory_system-5eh.2","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"},{"issue_id":"cass_memory_system-5eh.7","depends_on_id":"cass_memory_system-5eh.3","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"}]}
{"id":"cass_memory_system-5eh.8","title":"Playbook YAML Read/Write: src/playbook.ts","description":"# Feature: Playbook YAML Read/Write (src/playbook.ts)\n\n## Purpose\nHandle all playbook operations: loading, saving, creating new playbooks,\nand cascading global + repo-level playbooks.\n\n## Playbook File Format\n```yaml\nschema_version: 2\nname: \"project-playbook\"\ndescription: \"Auto-generated from cass-memory reflections\"\n\nmetadata:\n  createdAt: \"2025-12-01T00:00:00Z\"\n  lastReflection: \"2025-12-07T10:00:00Z\"\n  totalReflections: 42\n  totalSessionsProcessed: 156\n\ndeprecatedPatterns:\n  - pattern: \"AuthHandler\"\n    deprecatedAt: \"2025-10-01\"\n    reason: \"Moved to AuthService v2\"\n    replacement: \"Use AuthService from @/lib/auth\"\n\nbullets:\n  - id: \"b-1a2b3c4d-x7y8\"\n    category: \"testing\"\n    scope: \"global\"\n    kind: \"stack_pattern\"\n    state: \"proven\"\n    content: |\n      For React hooks, test returned values and effects separately\n      using renderHook from @testing-library/react-hooks\n    searchPointer: \"cass search 'react hook testing renderHook'\"\n    feedbackEvents:\n      - type: \"helpful\"\n        timestamp: \"2025-12-05T09:00:00Z\"\n        sessionPath: \"~/.claude/sessions/abc.jsonl\"\n    helpfulCount: 8\n    harmfulCount: 1\n    tags: [\"react\", \"testing\", \"hooks\"]\n    sourceSessions:\n      - \"~/.claude/projects/app/session-001.jsonl:142\"\n    sourceAgents: [\"claude\", \"cursor\"]\n    createdAt: \"2025-11-15T14:30:00Z\"\n    updatedAt: \"2025-12-05T09:00:00Z\"\n```\n\n## Functions to Implement\n```typescript\n// Load single playbook from path\nasync function loadPlaybook(path: string): Promise<Playbook>;\n\n// Load merged playbook (global + repo)\nasync function loadMergedPlaybook(config: Config): Promise<Playbook>;\n\n// Save playbook to path\nasync function savePlaybook(playbook: Playbook, path: string): Promise<void>;\n\n// Create empty playbook\nfunction createEmptyPlaybook(name?: string): Playbook;\n\n// Merge two playbooks (for cascading)\nfunction mergePlaybooks(global: Playbook, repo: Playbook | null): Playbook;\n\n// Find bullet by ID\nfunction findBullet(playbook: Playbook, id: string): PlaybookBullet | undefined;\n\n// Add bullet to playbook (with dedup check)\nfunction addBullet(playbook: Playbook, bullet: NewBulletData): PlaybookBullet;\n\n// Update bullet\nfunction updateBullet(playbook: Playbook, id: string, updates: Partial<PlaybookBullet>): boolean;\n```\n\n## Cascading Logic (\"Memory as Code\")\nWhen in a git repo with `.cass/playbook.yaml`:\n1. Load global playbook from ~/.cass-memory/playbook.yaml\n2. Load repo playbook from .cass/playbook.yaml\n3. Merge with repo taking precedence for same-ID bullets\n4. Filter out toxic bullets from both levels\n5. Return merged playbook\n\nThis enables \"team brain\" - new developers inherit project rules automatically.\n\n## Toxic Bullet Filtering\n```typescript\nconst globalToxic = await loadToxicLog(\"~/.cass-memory/toxic_bullets.log\");\nconst repoToxic = await loadToxicLog(\"./.cass/toxic.log\");\nmerged.bullets = merged.bullets.filter(b =>\n  !isSemanticallyToxic(b.content, [...globalToxic, ...repoToxic])\n);\n```","notes":"Reserved src/playbook.ts; implementing load/save/merge cascade, fixing schema mismatches.","status":"tombstone","priority":0,"issue_type":"feature","created_at":"2025-12-07T21:18:49.646748Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"feature","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-5eh.8","depends_on_id":"cass_memory_system-5eh.2","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"},{"issue_id":"cass_memory_system-5eh.8","depends_on_id":"cass_memory_system-5eh.3","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"},{"issue_id":"cass_memory_system-5eh.8","depends_on_id":"cass_memory_system-5eh.6","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"}]}
{"id":"cass_memory_system-5eh.9","title":"LLM Provider Abstraction: src/llm.ts","description":"# Feature: LLM Provider Abstraction (src/llm.ts)\n\n## Purpose\nAbstract LLM interactions using Vercel AI SDK, supporting multiple providers\n(OpenAI, Anthropic, Google) with a unified interface.\n\n## Why Vercel AI SDK?\n1. Provider-agnostic: Same code works with any provider\n2. Structured output: generateObject with Zod schemas\n3. Streaming: Built-in support (useful for future MCP server)\n4. Type safety: Full TypeScript support\n\n## Provider Setup\n```typescript\nimport { createOpenAI } from \"@ai-sdk/openai\";\nimport { createAnthropic } from \"@ai-sdk/anthropic\";\nimport { createGoogleGenerativeAI } from \"@ai-sdk/google\";\nimport { generateObject, generateText } from \"ai\";\n\nfunction getModel(config: Config) {\n  const apiKey = getApiKeyFromEnv(config.provider);\n  \n  switch (config.provider) {\n    case \"openai\": return createOpenAI({ apiKey })(config.model);\n    case \"anthropic\": return createAnthropic({ apiKey })(config.model);\n    case \"google\": return createGoogleGenerativeAI({ apiKey })(config.model);\n  }\n}\n```\n\n## Environment Variables\n- `OPENAI_API_KEY` for OpenAI\n- `ANTHROPIC_API_KEY` for Anthropic\n- `GOOGLE_GENERATIVE_AI_API_KEY` for Google\n\n## Functions to Implement\n\n### Structured Output (for reflection pipeline)\n```typescript\nasync function extractDiary<T>(\n  schema: z.ZodSchema<T>,\n  sessionContent: string,\n  metadata: SessionMetadata,\n  config: Config\n): Promise<T>;\n\nasync function runReflector<T>(\n  schema: z.ZodSchema<T>,\n  diary: DiaryEntry,\n  existingBullets: string,\n  cassHistory: string,\n  iteration: number,\n  config: Config\n): Promise<T>;\n\nasync function runValidator<T>(\n  schema: z.ZodSchema<T>,\n  proposedRule: string,\n  evidence: string,\n  config: Config\n): Promise<T>;\n```\n\n### Text Generation (for context)\n```typescript\nasync function generateContext(\n  task: string,\n  bullets: string,\n  history: string,\n  deprecatedPatterns: string,\n  config: Config\n): Promise<string>;\n\nasync function generateSearchQueries(\n  task: string,\n  config: Config\n): Promise<string[]>;\n```\n\n## Prompt Templates\nDefined in PROMPTS constant:\n- `PROMPTS.diary` - Extract structured diary from session\n- `PROMPTS.reflector` - Generate delta proposals\n- `PROMPTS.validator` - Validate rules against evidence\n- `PROMPTS.context` - Generate pre-task briefing\n- `PROMPTS.audit` - Check session for rule violations\n\n## Error Handling\n- Rate limit handling with exponential backoff\n- Token limit checking before sending\n- Graceful degradation if API unavailable","status":"tombstone","priority":0,"issue_type":"feature","created_at":"2025-12-07T21:19:49.140355Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"feature","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-5eh.9","depends_on_id":"cass_memory_system-5eh.2","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"},{"issue_id":"cass_memory_system-5eh.9","depends_on_id":"cass_memory_system-5eh.7","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"}]}
{"id":"cass_memory_system-5fop","title":"[UX][output] Refactor context human output for premium readability","description":"Problem\n- `cm context` is the flagship command. Current human output uses hard-coded rulers, mixed iconography, and truncates history without stating “showing 3 of N”.\n- The information hierarchy could be clearer (rules vs pitfalls vs history vs warnings).\n\nWhat to do\n- Rework the human output using the shared design system:\n  - Width-aware headers and consistent section separators\n  - Clear “showing N of M” semantics when truncating\n  - Consistent labels for score/confidence/relevance\n  - Degraded-mode summary and next-step commands\n\nConstraints\n- JSON output must remain unchanged (or strictly additive) and must not include human formatting.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-13T10:17:05.986066Z","updated_at":"2025-12-13T23:15:43.200078Z","closed_at":"2025-12-13T23:15:43.200078Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-5fop","depends_on_id":"cass_memory_system-2erm","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"},{"issue_id":"cass_memory_system-5fop","depends_on_id":"cass_memory_system-3tds","type":"parent-child","created_at":"2026-01-21T09:28:49Z","created_by":"import"},{"issue_id":"cass_memory_system-5fop","depends_on_id":"cass_memory_system-dtqi","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"},{"issue_id":"cass_memory_system-5fop","depends_on_id":"cass_memory_system-r1hq","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"}]}
{"id":"cass_memory_system-5iw","title":"[Utils] ensureDir - Recursive directory creation","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:44:46.300190Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-5l2","title":"[LLM] PROMPTS.audit - Rule violation detection prompt","description":"Prompt template for rule violation detection:\n\nVariables: {sessionSummary}, {rules}\n\nInstructions:\n- Identify clear violations where session contradicted playbook rule\n- Only report CLEAR violations, not minor deviations\n- For each violation provide: bulletId, evidence quote, severity assessment\n\nOutput schema:\n{\n  violations: Array<{\n    bulletId: string,\n    evidence: string,\n    severity: 'low' | 'medium' | 'high'\n  }>\n}\n\n---\n\nTemperature: 0.3 (consistency)\nUsed in audit workflows to detect when agents ignore playbook guidance.\n\nThis feeds into the HARMFUL delta mechanism - if rules are consistently violated, they may be wrong or poorly worded.","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:44:56.106782Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-5oro","title":"[Unit] playbook.ts - CRUD Operations & Merging (Part 1)","description":"## Target: src/playbook.ts (697 LOC) - ZERO CURRENT COVERAGE\n\n### Part 1: Basic CRUD Operations\n\n1. **createEmptyPlaybook()** - Factory function\n   - Returns valid PlaybookSchema object\n   - Has empty bullets array\n   - Has metadata fields initialized\n\n2. **loadPlaybook(path)** - Load from disk\n   - Valid YAML file → parsed playbook\n   - Missing file → null or error\n   - Invalid YAML → graceful error\n   - Empty file → empty playbook or error\n   - File with BOM handling\n   - Permission denied → appropriate error\n\n3. **savePlaybook(playbook, path)** - Save to disk\n   - Writes valid YAML\n   - Creates parent directories if needed\n   - Atomic write (temp file + rename)\n   - Preserves existing file permissions\n   - Handles concurrent access (file locking)\n\n4. **addBullet(playbook, bullet)** - Add new bullet\n   - Bullet added to array\n   - ID generated if missing\n   - Validates bullet schema\n   - Duplicate ID handling\n\n5. **updateBullet(playbook, id, updates)** - Update existing\n   - Finds by ID and updates\n   - Returns updated playbook\n   - Missing ID → error or no-op\n   - Partial updates work correctly\n   - feedbackEvents merge properly\n\n6. **removeBullet(playbook, id)** - Remove bullet\n   - Removes by ID\n   - Returns updated playbook\n   - Missing ID → no-op or error\n   - Cascading effects (if any)\n\n### File I/O Patterns:\n- Test with real temp files (no mocks)\n- Use bun's temp directory APIs\n- Clean up after tests\n- Test concurrent operations","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-08T01:27:49.322438Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-5ss3","title":"[Docs] LICENSE file","description":"Create LICENSE file for the project.\n\nRecommended: MIT License\n- Permissive and widely used\n- Compatible with most projects\n- Allows commercial use\n- Simple and clear\n\nLicense text:\nMIT License\n\nCopyright (c) 2025 [Your Name/Organization]\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\n[Full MIT license text]\n\nInclude copyright notice in:\n- LICENSE file\n- README.md footer\n- Source file headers (optional)\n\nAlternative licenses to consider: Apache 2.0, BSD 3-Clause","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-07T21:49:45.349116Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-5szc","title":"[Unit] Commands - init.ts, context.ts, doctor.ts","description":"## Target: src/commands/*.ts - CLI Commands (Part 1)\n\n### init.ts Tests:\n\n1. **initCommand(options)** - Global initialization\n   - Creates ~/.cass-memory/ structure\n   - Creates config.json\n   - Creates playbook.yaml\n   - --force flag reinitializes\n   - --json flag outputs JSON\n   - Already initialized message\n\n2. **initRepoCommand(options)** - Repo initialization\n   - Creates .cass/ in git repo\n   - Creates repo playbook.yaml\n   - Creates toxic.log\n   - --force flag for reinit\n   - Not in git repo → error\n\n### context.ts Tests:\n\n1. **contextCommand(query, options)** - Main context\n   - Returns context for query\n   - Scope filtering works\n   - Limit parameter works\n   - --json output valid\n   - No results case\n\n2. **buildContextResult(bullets, query)** - Result building\n   - Formats context properly\n   - Includes metadata\n   - Scores included\n\n### doctor.ts Tests:\n\n1. **doctorCommand(options)** - Health check\n   - Checks all components\n   - Reports issues clearly\n   - --json output structured\n   - Exit code reflects health\n   - Suggests fixes\n\n### CLI Testing Pattern:\n- Capture stdout/stderr\n- Test exit codes\n- Use temp directories\n- Clean up after tests","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-08T01:29:16.660059Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-5szc","depends_on_id":"cass_memory_system-anqj","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"},{"issue_id":"cass_memory_system-5szc","depends_on_id":"cass_memory_system-mmxv","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"}]}
{"id":"cass_memory_system-5wrs","title":"[CLI:init] createDefaultConfig - Generate config.json","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:51:31.211890Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-5zf","title":"[Security] Sanitization audit logging","description":"Implement sanitization audit logging to track when secrets are redacted.\n\nRequirements:\n1. When sanitization replaces something, log count of replacements\n2. NEVER log actual secrets or matched text\n3. Log format: \"[sanitize] Replaced N potential secrets in <context>\"\n4. Make logging optional via config flag\n\nLog levels:\n- INFO: Summary of replacements (\"Replaced 3 potential secrets\")\n- DEBUG: Which pattern types matched (\"Replaced: 2 AWS keys, 1 Bearer token\")\n- NEVER: Actual secret values or surrounding context\n\nExample logs:\n```\n[sanitize] Replaced 3 potential secrets in session-abc123\n[sanitize] Patterns matched: AWS_ACCESS_KEY(1), BEARER_TOKEN(2)\n[sanitize] No secrets detected in session-xyz789\n```\n\nConfiguration:\n```json\n{\n  \"sanitization\": {\n    \"enabled\": true,\n    \"auditLog\": true,  // Enable audit logging\n    \"auditLevel\": \"info\"  // \"info\" or \"debug\"\n  }\n}\n```\n\nPurpose:\n- Understand what's being caught\n- Verify sanitization is working\n- Debug pattern effectiveness\n- Compliance/security auditing\n\nPriority: 0 (Security Critical - P12)","notes":"Implemented audit logging for sanitization; added auditLog/auditLevel config defaults and schema; sanitize now counts replacements and logs summary/debug without exposing secrets.","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:44:53.427417Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-5zt","title":"[Diary] extractDiaryFields - LLM structured extraction","description":"Use LLM to extract structured diary fields from raw session content.\n\nFunction Signature:\nasync function extractDiaryFields(\n  sessionContent: string,\n  metadata: { sessionPath: string; agent: string; workspace?: string },\n  config: Config\n): Promise<DiaryExtraction>\n\nExtraction Schema (DiaryExtractionSchema):\n- status: 'success' | 'failure' | 'mixed' - Overall session outcome\n- accomplishments: string[] - What was completed/achieved\n- decisions: string[] - Design choices and rationale\n- challenges: string[] - Problems encountered and how addressed\n- preferences: string[] - User style and preference revelations\n- keyLearnings: string[] - Reusable insights and patterns\n- suggestedTags: string[] - Topic/domain tags for categorization\n\nProcess:\n1. Load diary prompt from PROMPTS.diary\n2. Inject session content and metadata into prompt\n3. Call LLM with structured output mode\n4. Validate response against DiaryExtractionSchema\n5. Return structured extraction\n\nKey Features:\n- Structured output guarantees valid schema\n- Rich prompt engineering for quality extraction\n- Metadata context improves accuracy\n- Configurable LLM model selection\n- Schema validation for type safety\n\nPrompt Engineering:\n- Extract actionable insights, not raw transcription\n- Focus on reusable knowledge over session details\n- Identify patterns in user preferences\n- Categorize by meaningful topics\n\nOutput:\nReturns DiaryExtraction object with all fields populated per schema.","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:45:09.944826Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-60ts","title":"[CLI] reflect command - Full reflection cycle","description":"Entry point for the reflect command that runs the full reflection cycle.\n\nCommand signature:\n```bash\ncass-memory reflect [options]\n\nOptions:\n  --days N           Look back N days (default: 7)\n  --max-sessions N   Max sessions to process (default: 20)\n  --agent AGENTS     Filter by agent (comma-separated)\n  --dry-run          Show deltas without applying\n  --json             Output as JSON\n```\n\nImplementation flow:\n1. Find unprocessed sessions (within day range, agent filter)\n2. For each session:\n   - Generate diary entry\n   - Run reflector to get deltas\n   - Run validator on add deltas\n3. Batch curate all validated deltas\n4. Update processed log\n5. Display results (deltas proposed/applied)\n\nThe reflect command orchestrates: find sessions → diary → reflect → validate → curate\n\nDependencies:\n- findUnprocessedSessions()\n- processSession()\n- batchCurate()\n- updateProcessedLog()\n- ProcessedLog management\n- Output formatting (human-readable and JSON)\n\nOutput format:\n```\nProcessed 12 sessions\n- 8 deltas proposed\n- 5 deltas applied after validation\n- 3 deltas rejected (low confidence)\n```","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:49:20.259235Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-646b","title":"Unit tests for cass.ts - Main orchestration","description":"Complete unit test coverage for cass.ts:\n- Main CLI orchestration logic\n- Command dispatch\n- Config loading and merging\n- Error handling at top level\n- Exit code handling\n- spawnSync integration points\nNO MOCKS - use real command invocations with fixtures","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-08T01:25:46.378265Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-646b","depends_on_id":"cass_memory_system-ai52","type":"blocks","created_at":"2026-01-21T09:28:49Z","created_by":"import"}]}
{"id":"cass_memory_system-653r","title":"Project Hot Stove: Visceral Error Prevention & Mechanical Safety","description":"Implementing a system to detect, handle, and mechanically prevent catastrophic agent errors. Based on the principle that 'hot stove' moments (severe mistakes) should leave a permanent, non-decaying 'scar' that results in both high-priority warnings and physical blocks (guards) against repeating the action.\n\nKey Components:\n1. Trauma Memory Layer: Non-decaying, high-severity records of past failures.\n2. Mechanical Guards: Auto-generated hooks (Python/Bash) to physically block dangerous commands.\n3. Forensics: Scanning history for apologies and known bad patterns.\n4. Pain Injection: 'cm context' screaming warnings when near a hot stove.\n\nReferences:\n- simultaneous_launch_button (List of Doom patterns)\n- git_safety_guard.py (Mechanical enforcement)","status":"closed","priority":0,"issue_type":"epic","created_at":"2025-12-18T03:58:56.396645Z","updated_at":"2025-12-28T03:35:14.826048Z","closed_at":"2025-12-28T03:35:14.826048Z","close_reason":"All 6 discovered tasks completed: TraumaEntry schema, Dynamic Guard, Context warnings, CLI management, Audit forensics, and Auto-Install guards","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-65cx","title":"[Testing:Integration] playbook-persistence.test.ts - Save/load tests","description":"Use temp directory for isolation:\nbeforeEach: create temp dir\nafterEach: rm temp dir\n\nTest cases:\n- Save and load roundtrip\n- Creates new if not exists\n- Handles corrupt YAML (backup + recreate)\n- Preserves all fields through cycle","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-07T21:49:37.637060Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-65lf","title":"[CLI:reflect] batchCurate - Apply all validated deltas","description":"Aggregate and apply validated deltas from multiple sessions.\n\nFunction signature:\n```typescript\nfunction batchCurate(\n  playbook: Playbook,\n  allDeltas: PlaybookDelta[],\n  config: Config\n): CurationResult\n```\n\nImplementation:\n1. Aggregate deltas from all processed sessions:\n   - Combine validated deltas from each processSession() call\n   - Deduplicate similar deltas (same content/intent)\n   - Group by operation type (add/remove/modify)\n\n2. Run curator on aggregated deltas:\n   - Curator makes final decisions on what to apply\n   - Considers: playbook size limits, maturity rules, conflicts\n   - Returns accepted and rejected deltas\n\n3. Apply accepted deltas to playbook:\n   - For 'add': create new bullets (as candidates)\n   - For 'remove': deprecate or delete bullets\n   - For 'modify': update bullet fields\n   - Update playbook timestamps\n\n4. Return CurationResult:\n   ```typescript\n   {\n     applied: PlaybookDelta[];\n     rejected: PlaybookDelta[];\n     playbook: Playbook;  // updated\n     stats: {\n       totalProposed: number;\n       totalApplied: number;\n       byOperation: { add: number; remove: number; modify: number; }\n     }\n   }\n   ```\n\nDry-run mode:\n- If --dry-run flag: skip actual application\n- Return what *would* be applied\n- Don't save playbook changes\n\nThis is the final step before updating the processed log.","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:50:05.765118Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-65n","title":"[Validator] findDiaryBySession - Correlate session with diary","description":"$(cat /tmp/fix_65n.txt)","status":"tombstone","priority":3,"issue_type":"task","created_at":"2025-12-07T21:44:55.776907Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-699","title":"[Validator] generateValidationReport - Detailed validation output","description":"Implement the generateValidationReport function - Create comprehensive validation reports for audit and transparency.\n\nSIGNATURE:\n```typescript\nfunction generateValidationReport(\n  proposedRule: string,\n  gateResult: EvidenceGateResult,\n  llmResult?: ValidationResult\n): ValidationReport\n```\n\nVALIDATION REPORT TYPE:\n```typescript\ninterface ValidationReport {\n  proposedRule: string;\n  verdict: \"ACCEPT\" | \"REJECT\" | \"ACCEPT_WITH_CAUTION\";\n  confidence: number;         // 0.0 to 1.0\n  evidence: Array<{\n    sessionPath: string;\n    agent: string;\n    supports: boolean;        // Does this evidence support the rule?\n    snippet: string;\n  }>;\n  gateResult: EvidenceGateResult;\n  llmResult?: ValidationResult;\n  reason: string;             // Combined reasoning\n  refinedRule?: string;       // If LLM suggests improvement\n  timestamp: string;\n  metadata: {\n    sessionCount: number;\n    successCount: number;\n    failureCount: number;\n    llmUsed: boolean;\n  };\n}\n```\n\nREPORT GENERATION LOGIC:\n1. Combine gate result and LLM result\n2. Determine final verdict:\n   - Gate failed → REJECT\n   - Gate passed + LLM INVALID → REJECT\n   - Gate passed + LLM VALID → ACCEPT\n   - Gate passed + LLM VALID_WITH_CAUTION → ACCEPT_WITH_CAUTION\n   - Gate passed + no LLM (strong evidence) → ACCEPT\n3. Calculate confidence score\n4. Format evidence with support indicators\n5. Combine reasoning from gate and LLM\n6. Include metadata for debugging\n\nCONFIDENCE CALCULATION:\n```typescript\nif (gateResult.successCount >= 5 && gateResult.failureCount === 0) {\n  confidence = 0.95;  // High confidence, no LLM needed\n} else if (llmResult) {\n  confidence = llmResult.confidence;\n} else {\n  confidence = 0.5;  // Default for edge cases\n}\n```\n\nOUTPUT FORMATS:\n- JSON: Full structured report\n- Markdown: Human-readable summary\n- CLI: Colored terminal output with verdict\n\nWHY THIS MATTERS:\n- Provides audit trail for all validation decisions\n- Makes scientific method transparent\n- Helps debug validation logic\n- Builds trust in automated rule acceptance\n\nDEPENDENCIES:\n- EvidenceGateResult type\n- ValidationResult type\n- CassHit type\n\nLOCATION:\n- src/validator/report.ts","status":"tombstone","priority":3,"issue_type":"task","created_at":"2025-12-07T21:44:56.952411Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-69v","title":"[Foundation] package.json with exact dependency versions","description":"Create package.json with exact dependency versions and build configuration for the CASS Memory System CLI tool.\n\n## Context\nThe CASS Memory System requires a well-defined package.json that supports cross-platform binary compilation, ESM modules, and integration with multiple LLM providers through the Vercel AI SDK.\n\n## Technical Specification\n\n### Dependencies:\n- ai@^4.0.0 - Vercel AI SDK core for provider-agnostic LLM integration\n- @ai-sdk/openai@^1.0.0 - OpenAI provider (GPT-4, GPT-3.5)\n- @ai-sdk/anthropic@^1.0.0 - Anthropic provider (Claude models)\n- @ai-sdk/google@^1.0.0 - Google provider (Gemini models)\n- zod@^3.23.0 - Runtime type validation for structured LLM outputs\n- yaml@^2.3.0 - YAML parsing for playbook and config files\n- chalk@^5.3.0 - Terminal output styling for user-friendly CLI\n\n### DevDependencies:\n- @types/bun@latest - TypeScript types for Bun runtime\n- typescript@^5.0.0 - TypeScript compiler for type checking\n\n### Scripts:\n- dev: bun run src/cass-memory.ts - Development mode with hot reload\n- build: bun build src/cass-memory.ts --compile --outfile dist/cass-memory - Build for current platform\n- build:all: Build for linux, macos, and windows\n- build:linux: bun build src/cass-memory.ts --compile --target=linux-x64 --outfile dist/cass-memory-linux\n- build:macos: bun build src/cass-memory.ts --compile --target=darwin-arm64 --outfile dist/cass-memory-macos\n- build:windows: bun build src/cass-memory.ts --compile --target=windows-x64 --outfile dist/cass-memory-windows.exe\n- typecheck: tsc --noEmit - Type checking without compilation\n- test: bun test - Run test suite\n\n### Configuration:\n- type: module - Enable ES modules\n- bin: cass-memory -> ./dist/cass-memory.js - CLI entry point\n- name: cass-memory\n- version: 0.1.0 - Initial version\n- private: true - Not published to npm (distributed as binary)\n\n## Reasoning\n\n### Why Vercel AI SDK:\n1. Provider Agnostic: Single interface for OpenAI, Anthropic, Google - users choose their preferred LLM\n2. Structured Output: Native Zod integration for reliable structured responses (critical for playbook rule extraction)\n3. Streaming Support: Real-time output for long-running operations\n4. TypeScript-First: Excellent type safety and IntelliSense\n5. Active Development: Well-maintained with regular updates\n\n### Why Bun:\n1. Single Binary: Bun can compile TypeScript to standalone executables\n2. Fast: Native speed for file operations and process management\n3. Built-in TypeScript: No transpilation needed during development\n4. Cross-platform: Compile once, run anywhere\n\n### Why ESM:\n1. Modern Standard: ES modules are the future of JavaScript\n2. Better Tree Shaking: Smaller bundle sizes\n3. AI SDK Requirement: Vercel AI SDK v4 requires ESM\n\n## Acceptance Criteria\n\n- package.json exists in project root\n- All dependencies listed with correct versions\n- All devDependencies listed\n- All build scripts present and functional\n- type: module is set\n- bin entry points to correct file\n- bun install works without errors\n- bun run dev starts development mode\n- bun run build creates executable binary\n- bun run typecheck passes with no errors\n\n## How This Serves the Universal Agent Memory System\n\nThe package.json is the foundation contract for the entire CASS Memory System. It ensures:\n\n1. Multi-Provider Support: Agents can use any LLM provider their organization prefers\n2. Reliable Distribution: Compiled binaries mean no dependency hell for end users\n3. Type Safety: Zod validation ensures LLM outputs conform to expected schemas\n4. Developer Experience: Clear scripts and tooling enable rapid iteration\n5. Cross-Platform: Agents on any OS can use CASS Memory System\n\nWithout proper dependency management, the system cannot reliably integrate with LLMs or provide consistent behavior across environments.","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:45:21.842607Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-6gdd","title":"Review and close PR #3 - cass wrapper format (already fixed)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-16T05:30:04.220068Z","updated_at":"2025-12-16T05:30:44.523448Z","closed_at":"2025-12-16T05:30:44.523448Z","close_reason":"PR #3 closed - fix was already in codebase","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-6jdf","title":"[Foundation] Define .cass/ repo-level directory structure","description":"Define and implement the .cass/ repository-level directory structure for project-specific CASS Memory System data.\n\n## Context\nThe .cass/ directory contains project-specific memory that is committed to version control and shared with the entire team. This enables 'memory as code' - the team's collective knowledge about the project is versioned alongside the codebase.\n\n## Technical Specification\n\n### Directory Structure:\n.cass/\n├── playbook.yaml            # Project-specific playbook (shared with team)\n├── config.yaml              # Project-level configuration overrides\n└── toxic.log                # Project-level blocked patterns\n\n### File Specifications:\n\n#### playbook.yaml (Project Playbook):\n- Project-specific rules that apply to this repository only\n- Merged with user's global playbook (~/.cass-memory/playbook.yaml)\n- Project rules take precedence over global rules\n- Categories: PROJECT_SETUP, BUILD, TEST, DEPLOY, ARCHITECTURE, etc.\n- Each bullet has:\n  - content: The rule itself\n  - context: When/why this rule applies\n  - priority: 0-10 (higher = more important)\n  - state: PROVEN, TESTING, CANDIDATE\n  - created_at: ISO timestamp\n  - created_by: User/agent who added it\n  - tags: [backend, frontend, ci, etc.]\n\nExample:\nyaml\nbullets:\n  - content: Always run tests with --coverage flag\n    context: Team requires 80% coverage for all PRs\n    priority: 9\n    state: PROVEN\n    created_at: 2025-12-01T10:00:00Z\n    created_by: cass-memory\n    tags: [test, ci]\n  \n  - content: Use Bun instead of npm for package management\n    context: Project uses Bun for faster installs and built-in TypeScript support\n    priority: 10\n    state: PROVEN\n    created_at: 2025-12-01T10:00:00Z\n    created_by: cass-memory\n    tags: [setup, deps]\n\n\n#### config.yaml (Project Configuration):\n- Overrides for project-specific settings\n- Does NOT contain API keys (those stay in ~/.cass-memory/config.json)\n- Can specify:\n  - preferred_model: Override user's default model for this project\n  - enable_curation: Project-level curation toggle\n  - evidence_threshold: Custom threshold for this project\n  - excluded_paths: Paths to ignore in reflections (e.g., generated/, vendor/)\n  - custom_categories: Project-specific bullet categories\n\nExample:\nyaml\npreferred_model: gpt-4  # This project uses GPT-4 for complex reasoning\nenable_curation: true\nevidence_threshold: 5\nexcluded_paths:\n  - generated/\n  - vendor/\n  - node_modules/\ncustom_categories:\n  - ARCHITECTURE\n  - API_DESIGN\n  - DATABASE\n\n\n#### toxic.log (Project Blocklist):\n- Newline-delimited list of blocked bullet content\n- Project-specific patterns to block\n- Committed to git so entire team blocks same patterns\n- Case-insensitive matching\n- Merged with user's global toxic_bullets.log\n\nExample:\ntext\nAlways use var for variables\nDisable all linting rules\nSkip writing tests for this file\n\n\n## Reasoning\n\n### Why .cass/ (Hidden Directory):\n1. Unix Convention: Hidden directories for metadata\n2. Doesn't Clutter: Not visible in normal directory listings\n3. Tool Convention: Like .git/, .github/, .vscode/\n\n### Why playbook.yaml in Git:\n1. Memory as Code: Team knowledge is versioned\n2. Shared Learning: New team members inherit project wisdom\n3. Code Review: Changes to playbook go through PR review\n4. Reproducibility: Same rules apply to all developers\n5. Time Travel: git log shows how project knowledge evolved\n\n### Why config.yaml Separate from config.json:\n1. Security: config.json (global) has API keys, never committed\n2. Team Settings: config.yaml (repo) has project settings, always committed\n3. Overrides: Repo settings override user settings\n\n### Why toxic.log in Git:\n1. Team Safety: Everyone blocks the same bad patterns\n2. Onboarding: New devs see what NOT to do\n3. Historical Record: Track why certain patterns were blocked\n4. Consistency: Entire team learns from mistakes\n\n### Why Project Playbook Takes Precedence:\n1. Specificity: Project needs override general preferences\n2. Team Alignment: Everyone follows project standards\n3. Flexibility: Users keep their personal rules for other projects\n\n## Acceptance Criteria\n\n- .cass/ directory is created on cass-memory init (repo mode)\n- playbook.yaml created with empty bullets array\n- config.yaml created with sensible defaults (or omitted if no overrides)\n- toxic.log created as empty file\n- .cass/ directory is NOT in .gitignore (should be committed)\n- Helper functions in utils.ts: resolveRepoDir(), ensureRepoStructure()\n- Playbook loading merges global + repo playbooks (repo takes precedence)\n- Config loading merges global + repo configs (repo takes precedence)\n- Toxic patterns merged from both global and repo logs\n- cass-memory doctor verifies .cass/ structure\n\n## How This Serves the Universal Agent Memory System\n\nThe .cass/ directory enables team-level memory sharing:\n\n1. Memory as Code: Team knowledge is versioned alongside code\n2. Collective Learning: Entire team benefits from lessons learned\n3. Onboarding: New team members inherit project wisdom immediately\n4. Consistency: All agents follow same project-specific rules\n5. Code Review: Memory changes go through same review process as code\n6. Time Travel: git history shows evolution of team knowledge\n7. Multi-Agent Coordination: Multiple agents share same memory layer\n\nThis is the key innovation that makes CASS Memory a universal system - memory persists not just per user, but per project, and is versioned in git like any other critical project artifact.\n\nWithout repo-level playbooks, teams would constantly reinvent the wheel, onboarding would be slow, and agents would have inconsistent behavior across team members.","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:47:57.986910Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-6ob","title":"[Playbook] findSimilarBullet - Find most similar existing bullet","description":"## Function Signature\n```typescript\nfunction findSimilarBullet(\n  bullets: PlaybookBullet[],\n  content: string,\n  threshold: number\n): { found: boolean; bullet?: PlaybookBullet; similarity?: number }\n```\n\n## Purpose\nFind the most similar existing bullet above a threshold. Returns similarity score for logging and decision-making.\n\n## Algorithm\n1. Filter out deprecated bullets\n2. Calculate similarity for ALL non-deprecated bullets\n3. Find bullet with highest similarity\n4. If highest >= threshold:\n   - Return { found: true, bullet, similarity }\n5. Else:\n   - Return { found: false }\n\n## Difference from isDuplicateBullet\n- **isDuplicateBullet**: Returns first match, boolean check, prevents duplicates\n- **findSimilarBullet**: Returns highest match, includes score, suggests similar\n\n## Return Value Usage\n```typescript\nconst result = findSimilarBullet(bullets, newContent, 0.7);\nif (result.found) {\n  console.log(`Found similar bullet (${result.similarity.toFixed(2)}): ${result.bullet.content}`);\n  // Ask user: merge, replace, or add anyway?\n}\n```\n\n## Threshold Selection\n- **High threshold (0.85+)**: Only very similar bullets\n- **Medium threshold (0.70-0.85)**: Suggest as related\n- **Low threshold (0.50-0.70)**: Broad similarity search\n\n## Implementation Notes\n- Must search ALL bullets to find highest\n- Skip deprecated bullets (outdated)\n- Include similarity score in result\n- Useful for merge suggestions\n\n## Usage Scenarios\n1. **Interactive add**: Show similar bullets to user\n2. **Merge suggestions**: Find candidates for combining\n3. **Search**: Find bullets related to query\n4. **Analytics**: Measure playbook clustering\n\n## Dependencies\n- jaccardSimilarity() utility function\n\n## Related Functions\n- isDuplicateBullet() - simpler boolean check\n- findMergeCandidates() - finds multiple similar groups\n- getBulletsByCategory() - category-based filtering","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:45:00.773781Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-6r0k","title":"[Bug][curation] Avoid flakey inversion near prune threshold (decayed float drift)","description":"# Problem\n`curatePlaybook()` uses **decayed** helpful/harmful counts (floating point) and compares them to integer thresholds (e.g. `pruneHarmfulThreshold = 3`).\n\nBecause feedback timestamps and `now` differ by milliseconds/seconds, each “recent” event can decay to slightly under `1.0` (e.g. `0.9999999`). This makes sums like `3 events` become `2.9999997`, causing strict `>= 3` comparisons to fail unpredictably.\n\n## Why it matters\n- Inversion/deprecation behavior can be non-deterministic near thresholds (especially in tests and rapid feedback loops).\n- A rule marked harmful N times “right now” should behave like N, not N-ε.\n\n## Fix\n- Use a small epsilon in threshold comparisons where we treat integer thresholds as “count-like”.\n- Add a deterministic regression test that uses timestamps slightly in the past (e.g. 1s old) so the bug would reproduce without the epsilon.\n\n## Acceptance Criteria\n- [ ] Inversion triggers at the configured prune threshold even with slight decay (covered by test).\n- [ ] No behavior change for genuinely stale/decayed events.\n- [ ] `bun test` + `bun run typecheck` pass.\n","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-14T03:18:32.972734Z","updated_at":"2025-12-14T03:19:42.432535Z","closed_at":"2025-12-14T03:19:42.432535Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-6s8f","title":"Add E2E tests for trauma command","description":"# Add E2E Tests for trauma Command\n\n## Context\nThe `cm trauma` command allows managing trauma entries (hot stove patterns). It has NO dedicated E2E test.\n\n## Current State\n- File: `src/commands/trauma.ts`\n- Functionality: add/list/remove/heal trauma entries\n- Tests: NONE (trauma module core tested indirectly via context tests)\n\n## Scope\nCreate E2E tests for:\n1. `cm trauma add` - Add a new trauma pattern\n2. `cm trauma list` - List all traumas\n3. `cm trauma show <id>` - Show trauma details\n4. `cm trauma heal <id>` - Mark trauma as healed\n5. `cm trauma remove <id>` - Delete trauma\n6. Integration with context command (warnings)\n\n## Test Strategy\n- Use temp home directories\n- Test YAML persistence\n- Verify trauma warnings appear in context output\n- Test healing workflow\n\n## Acceptance Criteria\n- [ ] Test file: `test/cli-trauma.e2e.test.ts` exists\n- [ ] All trauma subcommands tested\n- [ ] Integration with context verified\n- [ ] Uses E2ELogger for detailed output","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T17:05:18.584212Z","updated_at":"2025-12-28T02:10:22.824279Z","closed_at":"2025-12-28T02:10:22.824279Z","close_reason":"27 E2E tests passing - covers list/add/heal/remove/import subcommands with JSON and human-readable output","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-6syf","title":"[Critical] Fix types.ts to match scoring.ts and cass.ts requirements","status":"tombstone","priority":0,"issue_type":"bug","created_at":"2025-12-07T23:47:34.297635Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"bug","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-6u3","title":"[Utils] truncateForContext - Large content truncation for LLM","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:45:16.512693Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-6voo","title":"UX polish: global --no-emoji/--no-color/--width and nicer stats output","description":"Improve CLI UX: add global output style flags (no-emoji/no-color/width) and refresh statsCommand human output to be width-aware, structured, and action-oriented while keeping existing key headings.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-16T10:05:26.696444Z","updated_at":"2025-12-16T10:10:58.953602Z","closed_at":"2025-12-16T10:10:58.953602Z","close_reason":"Added global output style flags (--no-emoji/--no-color/--width) with argv hoisting, plus refreshed stats human dashboard formatting; added regression test.","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-6xl2","title":"Add unit tests for trauma.ts module","description":"# Add Unit Tests for trauma.ts\n\n## Context\nThe `trauma.ts` module implements the \"hot stove\" pattern prevention system - a CRITICAL safety feature that prevents repeating painful mistakes. It has NO dedicated test file.\n\n## Current State\n- File: `src/trauma.ts`\n- Exports: `loadTraumas`, `saveTrauma`, `findMatchingTrauma`, `TraumaEntry` type\n- Used by: context.ts for injecting warnings, guard command\n- Tests: NONE (only indirectly via E2E context tests)\n\n## Scope\nCreate comprehensive unit tests WITHOUT mocks for:\n1. `loadTraumas()` - Loading from YAML file\n2. `saveTrauma()` - Atomic persistence with locking\n3. `findMatchingTrauma()` - Pattern matching against task descriptions\n4. `TraumaEntry` schema validation\n5. Edge cases: empty file, corrupt YAML, missing file, permission errors\n6. Concurrent access (file locking)\n\n## Test Strategy\n- Use temp directories for file operations\n- Use real YAML serialization\n- Test pattern matching with various inputs\n- Verify atomic write behavior\n\n## Acceptance Criteria\n- [ ] Test file: `test/trauma.test.ts` exists\n- [ ] All exported functions have test coverage\n- [ ] No mock.module() usage\n- [ ] Tests cover happy path and error cases\n- [ ] File locking behavior is tested\n\n## Priority: P1\nThis is a critical safety feature - untested trauma handling could allow dangerous patterns to slip through.\n\n## Dependencies\n- Requires understanding of trauma entry schema\n- May need test fixtures for sample trauma entries","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T17:03:39.014307Z","updated_at":"2025-12-28T02:01:48.812825Z","closed_at":"2025-12-28T02:01:48.812825Z","close_reason":"Tests already exist - 1000+ lines in test/trauma.test.ts","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-6xsg","title":"[P1] Create E2E test logging infrastructure","description":"# Task: E2E Test Logging Infrastructure\n\n## Goal\nAdd detailed, structured logging to E2E tests for debugging failures and understanding test execution.\n\n## Features Required\n\n### Step Logging\n```typescript\nconst log = createE2ELogger(\"cli-context\");\nlog.step(\"Creating test playbook\");\nlog.step(\"Running context command\", { args: [\"--json\"] });\nlog.step(\"Verifying output\", { expected: {...} });\n```\n\n### State Snapshots\n```typescript\nlog.snapshot(\"playbook\", playbook);\nlog.snapshot(\"config\", config);\n```\n\n### Timing\n```typescript\nlog.startTimer(\"command-execution\");\n// ... run command ...\nlog.endTimer(\"command-execution\"); // Logs: \"command-execution: 234ms\"\n```\n\n### Failure Reports\nOn test failure, automatically:\n- Dump all logged steps\n- Dump all state snapshots\n- Show timing breakdown\n- Provide reproduction command\n\n## Implementation\n- New file: test/helpers/e2e-logger.ts\n- Update all E2E tests to use logger\n- Integrate with Bun test reporter\n\n## Acceptance\n- [ ] Logger helper created\n- [ ] At least 3 E2E tests updated to use it\n- [ ] Failure reports include reproduction steps","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-16T15:31:51.728104Z","updated_at":"2025-12-16T23:49:23.104809Z","closed_at":"2025-12-16T23:49:23.104809Z","close_reason":"Implemented test/helpers/e2e-logger.ts and updated 3 E2E tests to use it","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-70sd","title":"[Unit Tests] config.ts - Configuration loading and merging","description":"## Unit Tests: config.ts - Configuration Loading and Merging\n\n### Test Categories\n\n#### 1. loadGlobalConfig()\n- Returns default config when ~/.cass/config.yaml missing\n- Parses valid YAML with all fields\n- Handles partial configs (missing optional fields)\n- Logs warning for malformed YAML but returns defaults\n\n#### 2. loadRepoConfig()\n- Returns null when .cass/config.yaml missing\n- Parses valid repo config\n- Respects working directory parameter\n- Handles nested playbook_paths array\n\n#### 3. mergeConfigs()\n- Global config provides base values\n- Repo config overrides global values\n- Nested objects merge correctly (llm settings)\n- Arrays concatenate (playbook_paths)\n- Explicit nulls in repo override global values\n- Empty repo config returns global unchanged\n\n#### 4. findRepoRoot()\n- Finds .cass directory in current path\n- Walks up directory tree to find .cass\n- Returns undefined at filesystem root\n- Handles symlinked directories\n\n#### 5. Edge Cases\n- Unicode content in YAML files\n- Very large config files\n- Read-only file permissions\n- Config with unknown keys (forward compatibility)\n\n### Test Data Requirements\n- Sample config YAML files in test/fixtures/configs/\n- Both valid and malformed examples\n- Configs with various merge scenarios","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-08T01:23:23.219085Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-70t2","title":"Fix undo hard-delete safety + why diary lookup path","description":"Two small but high-safety fixes: (1) prevent undo --hard from splicing the wrong bullet if findIndex ever fails; (2) make why command pass resolved session path into findDiaryBySession to avoid inconsistent relative-path resolution.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-16T07:34:50.258715Z","updated_at":"2025-12-16T07:36:07.572690Z","closed_at":"2025-12-16T07:36:07.572690Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-72k","title":"[Validator] runLLMValidation - Scientific validation via LLM","description":"Implement the runLLMValidation function - Scientific validation via LLM using historical evidence.\n\nSIGNATURE:\n```typescript\nasync function runLLMValidation(\n  proposedRule: string,\n  history: CassHit[],\n  config: Config\n): Promise<ValidationResult>\n```\n\nVALIDATION RESULT:\n```typescript\ninterface ValidationResult {\n  verdict: \"VALID\" | \"INVALID\" | \"VALID_WITH_CAUTION\";\n  confidence: number;          // 0.0 to 1.0\n  reason: string;              // LLM explanation\n  evidence: string[];          // Citations from history\n  refinedRule?: string;        // Optional improved wording\n}\n```\n\nUSES PROMPTS.validator TEMPLATE:\n```\nYou are a scientific validator for agent playbook rules.\n\nPROPOSED RULE:\n{proposedRule}\n\nHISTORICAL EVIDENCE:\n{formattedEvidence}\n\nTASK:\nAnalyze whether this rule is supported by the historical evidence.\nConsider:\n- Does the evidence show this pattern worked?\n- Are there counter-examples (failures)?\n- Is the rule too generic or too specific?\n- Is the wording actionable?\n\nRESPOND WITH:\n- VALID: Strong evidence supports this rule\n- INVALID: Evidence contradicts or doesn't support this rule\n- VALID_WITH_CAUTION: Some support but concerns exist\n\nInclude:\n1. Your verdict\n2. Confidence score (0.0-1.0)\n3. Reasoning based on evidence\n4. Optional refined wording if the concept is valid but phrasing needs work\n```\n\nVALIDATION CRITERIA:\n- Pattern appears in successful sessions\n- Few or no counter-examples in failed sessions\n- Rule is specific and actionable\n- Rule is not overly generic\n- Wording is clear and unambiguous\n\nWHY THIS MATTERS:\n- Provides deep analysis beyond simple counting\n- Can identify nuanced patterns humans might miss\n- Suggests improvements to rule wording\n- Adds scientific rigor to rule acceptance\n\nDEPENDENCIES:\n- formatEvidenceForLLM() - Format cass hits for prompt\n- PROMPTS.validator - Validation prompt template\n- LLM API (OpenAI, Anthropic, etc.)\n- CassHit type\n\nLOCATION:\n- src/validator/llm-validation.ts","status":"tombstone","priority":3,"issue_type":"task","created_at":"2025-12-07T21:44:53.067317Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-7486","title":"MCP serve: align tool schemas + args with README and CLI","description":"Deep review found MCP server (`cm serve`) TOOL_DEFS + argument handling drifted from README and recent CLI changes: cm_feedback schema doesn’t match (booleans vs type string), cm_outcome requires sessionId/outcome while README documents status/rules/summary, cm_context doesn’t support limit/minScore/noHistory. Fix server schemas and handlers to match documented/CLI behavior; also align serve stats staleCount with config-aware staleness threshold.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-16T08:37:50.356240Z","updated_at":"2025-12-16T08:41:25.090503Z","closed_at":"2025-12-16T08:41:25.090503Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-74ar","title":"Feature: Remote cass via SSH (tag remote hits + distinct output)","description":"## Goal\nEnable *optional* remote cass history via SSH, so agents can pull in context from other machines without copying indexes. Remote hits must be clearly labeled and filterable (JSON), and visually distinct (human output) without adding noisy/ambiguous guidance.\n\n## Why\nUsers often work across multiple machines (laptop + server). Their cass history is split, so `cm context` can miss relevant prior work. The user request: leverage existing SSH config/keys, treat remote logs separately via metadata, and render them distinct (e.g. darker shade).\n\n## Scope (v1)\n- Add a config-driven list of SSH targets to query with `cass search` remotely.\n- Merge remote hits into the existing history pipeline with explicit origin metadata.\n- Keep `--json` output stable and semantically unambiguous.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-16T00:07:38.975731Z","updated_at":"2025-12-16T00:20:10.530539Z","closed_at":"2025-12-16T00:20:10.530539Z","close_reason":"Implemented opt-in remote cass history via SSH (config.remoteCass), tagged hits with origin, dim-styled remote history output, and surfaced per-host degraded info in JSON","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-75kt","title":"Task: Context output - separate remediation from suggestedCassQueries","description":"## Problem\n`cm context` includes two different kinds of “next step” suggestions:\n\n1) **Remediation** when the system is degraded (cass missing, index missing, timeout):\n- These are actionable fix commands (e.g. `cargo install cass`, `cass index`, `cass health`).\n\n2) **Search follow-ups** for deeper investigation:\n- These are `cass search ...` commands tailored to the current task.\n\nToday, the implementation merges remediation commands into `suggestedCassQueries` (because degraded mode provides a `suggestedFix` list and `context.ts` unions it into the queries list). This is semantically confusing for agents:\n- The field name says “Queries”, but it may contain install/index commands.\n- Agents may treat every entry as runnable `cass search ...` and fail in degraded scenarios.\n\n## Goal\nKeep suggestion fields **semantically pure** so agents can reliably interpret them:\n\n- `degraded.*.suggestedFix` (or similar) = remediation commands to restore missing capabilities\n- `suggestedCassQueries` = only `cass search ...` (or query-like suggestions)\n\n## Proposed change\n- In `src/commands/context.ts`, stop merging `degraded.cass.suggestedFix` into `suggestedCassQueries`.\n- Instead:\n  - always surface remediation only under `result.degraded.cass.suggestedFix` (already exists)\n  - keep `suggestedCassQueries` as “search follow-ups” only\n\nIf we still want a single “what should I run next?” list, create a **new** field with an explicit name (e.g. `suggestedNextCommands`) rather than overloading `suggestedCassQueries`.\n\n## Agent-integration guidance\n- Do not overload one array with multiple intent types.\n- Stable semantics beats fewer fields: a small additional field is less confusing than a misleading name.\n- Keep ordering deterministic: remediation first (if present), then query suggestions.\n\n## Acceptance criteria\n- [ ] `suggestedCassQueries` never contains remediation commands like `cargo install`, `cm doctor`, `cass index`, `cass health`.\n- [ ] Degraded remediation commands remain available under `degraded.cass.suggestedFix`.\n- [ ] README/quickstart examples reflect where to find remediation vs query suggestions.\n\n## Related context\n- Earlier degraded-mode UX work added `degraded.*.suggestedFix` (see older [UX][degraded] beads). This task is about preventing semantic overload in agent-facing JSON.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T21:42:43.213418Z","updated_at":"2025-12-15T23:35:25.436834Z","closed_at":"2025-12-15T23:35:25.436834Z","close_reason":"suggestedCassQueries now contains only search commands. Remediation commands stay in degraded.cass.suggestedFix.","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-75lr","title":"[Docs] Installation instructions for all platforms","description":"Document installation methods for all platforms with clear, tested instructions.\n\nMethods:\n1. Pre-built binaries (recommended):\n   - macOS (arm64): curl -L https://github.com/.../cass-memory-darwin-arm64 -o cass-memory && chmod +x cass-memory\n   - macOS (x64): Same for darwin-x64\n   - Linux (x64): curl for linux-x64\n   - Windows: Download .exe from releases\n   \n2. From source:\n   - git clone https://github.com/.../cass-memory.git\n   - cd cass-memory\n   - bun install\n   - bun run build\n   - Binary in dist/\n   \n3. Global install (npm/bun):\n   - bun install -g cass-memory\n   - OR: npm install -g cass-memory\n\nPrerequisites: \n- cass CLI installed and configured\n- API key for LLM provider (OpenAI/Anthropic)\n\nVerification:\n- cass-memory --version\n- cass-memory doctor (health check)\n\nInclude troubleshooting for common install issues","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-07T21:49:26.553392Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-79k5","title":"[Tracking] ProcessedLog class - Track processed sessions","description":"Class implementation:\n```typescript\nclass ProcessedLog {\n  private entries: Map<string, ProcessedEntry>;\n  private logPath: string;\n\n  constructor(logPath: string);\n  async load(): Promise<void>;\n  async save(): Promise<void>;\n  isProcessed(sessionPath: string): boolean;\n  markProcessed(entry: ProcessedEntry): void;\n  getUnprocessedSessions(allSessions: string[]): string[];\n}\n```\n\nPurpose: Tracks which sessions have been reflected on to avoid duplicate processing\n\nMethods:\n- load(): Read TSV file into entries map\n- save(): Write entries map to TSV file (atomically)\n- isProcessed(): Check if sessionPath exists in entries\n- markProcessed(): Add new entry to map\n- getUnprocessedSessions(): Filter out already-processed sessions\n\nUsed by `cm reflect` to identify new sessions needing reflection.\nSeparate logs per workspace or global scope.","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:50:31.118371Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-7dlg","title":"[E2E] Implement CLI smoke: init->context->mark->playbook (no cass/LLM)","description":"Automate minimal e2e script (Bun) that runs cm init, cm context 'hello', cm mark b-demo helpful, cm playbook list with assertions. Run with cass/LLM disabled to verify offline/degraded path. Emit structured log (JSONL) per step.","notes":"Improved e2e-smoke robustness: uses node to extract bullet id, exits if missing; portable timestamps already set.","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-08T01:30:05.007227Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-7g0","title":"[Playbook] deprecateBullet - Mark bullet as deprecated","description":"## Function Signature\n```typescript\nfunction deprecateBullet(\n  playbook: Playbook,\n  bulletId: string,\n  reason: string,\n  replacedBy?: string\n): void\n```\n\n## Purpose\nMark a bullet as deprecated/retired. Used when rules become obsolete or are replaced by better rules.\n\n## Implementation Steps\n1. Find bullet by ID\n2. Set state: \"retired\"\n3. Set maturity: \"deprecated\"\n4. Set deprecationReason to provided reason\n5. Set replacedBy if provided (ID of replacement bullet)\n6. Set updatedAt to now()\n\n## Deprecation vs Deletion\n**Never delete bullets**:\n- Preserves history and context\n- Allows rollback if needed\n- Maintains source session references\n- Enables learning from past mistakes\n\nDeprecated bullets:\n- Excluded from active context\n- Shown in stats with deprecation reason\n- Can be searched for historical analysis\n\n## Common Deprecation Reasons\n- \"Superseded by more specific rule\"\n- \"No longer applicable to current architecture\"\n- \"Merged into {bulletId}\"\n- \"Contradicted by proven evidence\"\n- \"Too broad - split into multiple rules\"\n\n## Replacement Tracking\nIf replacedBy is provided:\n- Creates chain: old → new\n- Stats can show evolution\n- Prevents re-adding deprecated patterns\n\n## Usage Scenarios\n1. **Manual deprecation**: User runs `forget` command\n2. **Merge operation**: Old bullets point to merged result\n3. **Auto-prune**: Harmful bullets beyond threshold\n4. **Refactoring**: Rule split or restructuring\n\n## Dependencies\n- findBullet()\n\n## Related Functions\n- getActiveBullets() - filters out deprecated\n- findMergeCandidates() - may create deprecations\n- autoPrune() - deprecates harmful bullets","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:44:58.353949Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-7hok","title":"[Critical] Privacy-First Cross-Agent - Opt-in with Clear Data Flow","description":"# Privacy-First Cross-Agent Enrichment\n\n## The Problem\nCurrent plan enables cross-agent learning by default. This means:\n- Claude Code sessions inform Cursor behavior\n- Personal coding patterns shared across tools\n- No clear visibility into what's being shared\n\nUsers may not want this. Privacy-conscious users will reject the tool entirely.\n\n## The Solution\nMake cross-agent COMPLETELY opt-in with explicit consent:\n\n### Default: Single-Agent Mode\n```typescript\nconst DEFAULT_CONFIG = {\n  crossAgent: {\n    enabled: false,  // OFF by default\n    consentGiven: false,\n    consentDate: null,\n    agents: []  // No agents enabled\n  }\n};\n```\n\n### Explicit Consent Flow:\n```bash\n$ cm init\n\nWelcome to CASS Memory System!\n\nCross-Agent Learning (Optional):\nCASS can learn from ALL your coding agents (Claude Code, Cursor, Codex, etc.)\nThis means patterns from one tool improve others.\n\nEnable cross-agent learning? [y/N]: n\n\nOK, running in single-agent mode.\nYou can enable later with: cm config set crossAgent.enabled true\n```\n\n### Data Flow Visibility:\n```bash\n$ cm privacy status\n\nCross-Agent Learning: DISABLED\nData shared: None\n\nIf enabled, these agents would contribute:\n  - Claude Code: 45 sessions\n  - Cursor: 12 sessions\n  - Codex: 3 sessions\n\nTo enable: cm config set crossAgent.enabled true\n```\n\n## Implementation Requirements\n- [ ] Default crossAgent.enabled = false\n- [ ] Consent prompt during init\n- [ ] `cm privacy` command suite\n- [ ] Per-agent enable/disable\n- [ ] Audit logging of data flow\n\n## Why This Is Critical\n- Privacy is non-negotiable for many users\n- Trust requires transparency\n- Opt-in > Opt-out for sensitive features\n- Single-agent mode must be fully functional","status":"closed","priority":3,"issue_type":"feature","created_at":"2025-12-07T22:14:04.803971Z","updated_at":"2025-12-13T09:10:38.192413Z","closed_at":"2025-12-13T09:10:38.192413Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-7my","title":"[Types] PlaybookBullet Schema Part 5 - Provenance and Verification","description":"## Overview\nDefine provenance tracking and verification system for PlaybookBullet. Answers: Where did this rule come from? Why does it exist? How can we verify it's still valid?\n\n## Temporal Provenance\n\n### createdAt: string\n- Type: Required ISO 8601 timestamp\n- Purpose: When rule was first added to playbook\n- Usage: Calculate rule age / Audit rule creation timeline / Sort playbook by creation date\n- Example: '2025-12-07T14:30:00Z'\n- Immutable: Never changes after creation\n\n### updatedAt: string\n- Type: Required ISO 8601 timestamp\n- Purpose: When rule was last modified (content, state, feedback)\n- Usage: Detect stale rules (long time since update) / Track edit history / Trigger revalidation\n- Example: '2025-12-07T16:45:00Z'\n- Updates: On any field change (content, helpful marks, state transitions)\n\n## Protection from Auto-Pruning\n\n### pinned: boolean\n- Type: Boolean flag (default: false)\n- Purpose: Protect rule from automatic retirement/deletion\n- Behavior: Immune to harmful threshold pruning / Immune to low-confidence cleanup / Immune to deduplication merging / Still participates in feedback and decay\n- Use Cases: Critical security rules / Team mandates / Legal/compliance requirements\n- Override: Manual deletion still possible\n\n### pinnedReason: string | undefined\n- Type: Optional explanation\n- Purpose: Document WHY rule is protected\n- Required: Should be set when pinned = true\n- Examples: 'Security compliance requirement' / 'Team mandate from 2025-11-01 standup' / 'Critical bug prevention - see incident #1234'\n- Display: Shown with pinned indicator in UI\n\n## Source Tracking\n\n### sourceSessions: string[]\n- Type: Array of session file paths\n- Purpose: Which cass sessions contributed to creating this rule\n- Usage: Trace rule origins / Find supporting evidence / Link rules to historical work\n- Population: Added by reflector from analyzed sessions / Added by manual creation with --session flag\n- Example: ['/Users/dev/.cass/sessions/2025-12-07-auth-fix.jsonl', '/Users/dev/.cass/sessions/2025-12-05-token-validation.jsonl']\n\n### sourceAgents: string[]\n- Type: Array of agent identifiers\n- Purpose: Which agents contributed to creating this rule\n- Usage: Multi-agent collaboration tracking / Agent-specific rule analysis / Cross-agent pattern detection\n- Values: 'claude', 'codex', 'cursor', 'human', etc.\n- Example: ['claude', 'cursor'] (Rule emerged from Claude and Cursor sessions)\n\n## Reasoning and Derivation\n\n### reasoning: string | undefined\n- Type: Optional free-form explanation\n- Purpose: WHY this rule was created\n- Source: Generated by reflector or provided manually\n- Content: Problem it solves / Context of creation / Design rationale\n- Example: 'Created after authentication bypass incident. Multiple sessions showed confusion about JWT validation. This rule prevents insecure token handling.'\n\n### derivedFrom: object | undefined\n- Type: Optional structured provenance\n- Purpose: Detailed evidence trail from diary/sessions\n- Structure: { diaryIds: string[], keyEvidence: string[] }\n- Example: { diaryIds: ['diary-a3f8b2c1', 'diary-d9e4f7b2'], keyEvidence: ['Session showed JWT validation failure led to security bug', 'Team discussion confirmed need for centralized token validation'] }\n\n## Automated Verification\n\n### verification: object | undefined\n- Type: Optional verification specification\n- Purpose: Programmatic check that rule is still applicable\n- Structure: { type: 'regex' | 'file_exists' | 'cass_query', pattern: string, mode: 'exists' | 'absent' }\n\nVerification Types:\n\nregex - Check if code pattern exists/absent in codebase\nExample: { type: 'regex', pattern: 'TokenValidator', mode: 'exists' } (Fail if TokenValidator not found)\n\nfile_exists - Check if specific file/module exists\nExample: { type: 'file_exists', pattern: 'lib/auth.ts', mode: 'exists' } (Fail if file doesn't exist)\n\ncass_query - Check if cass search returns results\nExample: { type: 'cass_query', pattern: 'vitest configuration', mode: 'exists' } (Fail if no vitest usage found)\n\nVerification Workflow:\n1. Periodic Checks: Run during 'cass memory validate --all'\n2. On-Demand: Run 'cass memory verify <bulletId>'\n3. Results: PASS (update lastValidatedAt) or FAIL (suggest deprecation)\n4. Actions on Failure: Move to draft state / Add deprecation warning / Notify user\n\n## Complete Example\n\n{\n  createdAt: '2025-11-15T10:00:00Z',\n  updatedAt: '2025-12-07T14:30:00Z',\n  pinned: true,\n  pinnedReason: 'Critical security requirement per audit #2024-11',\n  sourceSessions: ['/Users/dev/.cass/sessions/2025-11-15-auth-refactor.jsonl', '/Users/dev/.cass/sessions/2025-11-20-token-validation.jsonl'],\n  sourceAgents: ['claude', 'cursor'],\n  reasoning: 'After security audit revealed JWT validation gaps, consolidated token validation into single service to prevent bypass attacks.',\n  derivedFrom: { diaryIds: ['diary-a3f8b2c1', 'diary-d9e4f7b2'], keyEvidence: ['Security audit found 3 instances of unsafe JWT handling', 'Team decision to centralize auth in TokenValidator service'] },\n  verification: { type: 'file_exists', pattern: 'lib/auth/TokenValidator.ts', mode: 'exists' }\n}\n\n## Use Cases\n- Security Compliance: Pin critical rules, verify dependencies, track audit trail\n- Team Collaboration: Show agent contributions, link to discussions, explain decisions\n- Maintenance: Detect outdated rules (verification fails), find stale rules (old updatedAt), protect important rules\n- Debugging: Trace rule origins, find supporting evidence, understand reasoning\n\n## Acceptance Criteria\n- createdAt required timestamp field\n- updatedAt required timestamp field\n- pinned boolean field (default false)\n- pinnedReason optional string field\n- sourceSessions array field\n- sourceAgents array field\n- reasoning optional string field\n- derivedFrom optional structured field\n- verification optional structured field\n- Verification runner implementation\n- Auto-update updatedAt on changes\n- Pin protection in prune logic\n- Examples for all verification types\n- JSDoc for all fields","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:45:01.583813Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-7r6y","title":"[P2] Add unit tests for project.ts command","description":"# Task: Unit tests for project.ts command (71 lines)\n\n## What to Test\n- [ ] Project export format correct\n- [ ] --format flag works (agents.md, claude.md, raw)\n- [ ] --top parameter limits rules per category\n- [ ] Category filtering works\n- [ ] Output validates against expected format\n\n## Files\n- Source: src/commands/project.ts (71 lines)\n- Test: test/project.test.ts (new)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T15:30:48.127557Z","updated_at":"2025-12-17T08:31:00.706850Z","closed_at":"2025-12-17T08:31:00.706850Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-7rz","title":"[Decay] checkForDemotion - Automatic maturity regression","description":"Automatically demote or deprecate bullets that accumulate harmful marks or whose scores decay into negative territory.\n\nCOMPLETE IMPLEMENTATION:\n```typescript\n/**\n * Check if bullet should be demoted or auto-deprecated.\n * Allows rules to 'fall' in maturity if they accumulate harmful marks.\n */\nfunction checkForDemotion(bullet: PlaybookBullet): BulletMaturity | 'auto-deprecate' {\n  const score = getEffectiveScore(bullet);\n\n  // If score goes negative, consider demotion\n  if (score < 0 && !bullet.pinned) {\n    if (score < -3) {\n      return 'auto-deprecate';  // Signals auto-deprecation\n    }\n    \n    // Demote proven → established, established → candidate\n    if (bullet.maturity === 'proven') return 'established';\n    if (bullet.maturity === 'established') return 'candidate';\n  }\n\n  return bullet.maturity;\n}\n```\n\nDEMOTION CRITERIA:\n\nEffective score < 0 (negative):\n- proven → established\n- established → candidate\n- Pinned bullets are PROTECTED from demotion\n\nEffective score < -3 (severely negative):\n- Any maturity → auto-deprecate\n- Signals bullet should be moved to deprecated state\n- Pinned bullets are PROTECTED\n\nWHY DEMOTION MATTERS:\nRules can become toxic over time as codebase evolves. A rule that was once helpful might now be harmful. Demotion provides graceful degradation before full deprecation.\n\nEXAMPLE SCENARIOS:\n\n1. DEMOTE proven → established:\n   - Was helpful 10 times last year (now decayed to ~2.5)\n   - Marked harmful 1 time recently\n   - Score = 2.5 - 4 = -1.5\n   - Proven maturity multiplier = 1.5\n   - Effective score = -1.5 × 1.5 = -2.25\n   - Demoted to established\n\n2. AUTO-DEPRECATE:\n   - 3 recent harmful marks\n   - 1 old helpful mark (decayed to 0.25)\n   - Score = 0.25 - (4 × 3) = -11.75\n   - Score < -3 → auto-deprecate\n   - Bullet moved to deprecated state\n\n3. PINNED PROTECTION:\n   - Manually curated rule with pinned: true\n   - Score = -5 (would normally auto-deprecate)\n   - Returns current maturity (no change)\n   - Human review required via forget command\n\nINTEGRATION:\n- Called by applyMaturityTransitions()\n- Called after each curate cycle\n- Returns 'auto-deprecate' string (not BulletMaturity type) to signal deprecation\n- Pinned bullets bypass all automatic demotion\n\nPROTECTION MECHANISM:\nPinned bullets cannot be auto-demoted or auto-deprecated. This allows humans to override the algorithm for critical rules. Use sparingly.\n\nDEPENDENCIES:\n- getEffectiveScore()\n- PlaybookBullet.pinned field\n- PlaybookBullet.maturity field\n\nUSED BY:\n- applyMaturityTransitions()\n- Auto-deprecation workflow","status":"tombstone","priority":3,"issue_type":"task","created_at":"2025-12-07T21:45:47.886037Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-7s8","title":"[Foundation] package.json with exact dependency versions","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:45:02.758403Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-7yy","title":"[Diary] extractSessionMetadata - Parse path for agent/workspace","description":"Extract agent and workspace metadata from session file paths.\n\nFunction Signature:\nfunction extractSessionMetadata(sessionPath: string): { agent: string; workspace?: string }\n\nSupported Path Patterns:\n- ~/.claude/projects/{workspace}/session-*.jsonl → agent: 'claude', workspace extracted\n- ~/.cursor/state.vscdb:* → agent: 'cursor', no workspace\n- ~/.codex/sessions/*.jsonl → agent: 'codex', no workspace\n- ~/.aider.chat/*.md → agent: 'aider', no workspace\n- Unknown paths → agent: 'unknown', no workspace\n\nAlgorithm:\n1. Normalize path (resolve ~, resolve symlinks)\n2. Match against known agent patterns using regex\n3. Extract workspace from path if pattern includes it\n4. Return { agent, workspace } metadata object\n\nKey Features:\n- Pattern-based agent detection\n- Workspace extraction from hierarchical paths\n- Graceful handling of unknown agents\n- Path normalization for consistency\n\nUse Cases:\n- Categorizing sessions by agent in diary entries\n- Cross-agent session discovery\n- Agent-specific behavior customization\n- Statistics and reporting by agent type\n\nOutput:\nReturns metadata object with agent name (required) and workspace (optional).","notes":"Implementing extractSessionMetadata and wiring into diary generation","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:44:55.946799Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-7zbj","title":"[CLI] forget command - Permanently block toxic rule","description":"Implements the main entry point for the 'cass-memory forget' command - the nuclear option for permanently blocking toxic rules.\n\nCOMMAND SYNTAX:\n```bash\ncass-memory forget <bullet-id> [options]\n\nOptions:\n  --reason TEXT      Why this rule is toxic (required)\n  --invert           Convert to anti-pattern instead of just blocking\n  --global           Add to global toxic log (default: repo-level)\n```\n\nPURPOSE:\nProvides a safety mechanism to permanently block rules that caused production issues or demonstrated harmful patterns. Once forgotten, similar rules will be automatically rejected during future extraction.\n\nUSE CASES:\n- Rule caused production incident\n- Rule represents outdated/dangerous practice\n- Rule conflicts with security policy\n- Rule was proven fundamentally wrong\n\nIMPLEMENTATION REQUIREMENTS:\n1. Parse command-line arguments\n2. Validate bullet-id exists in playbook\n3. Require --reason (cannot be empty)\n4. Add entry to toxic_bullets.log\n5. Mark bullet as deprecated in playbook\n6. If --invert: create anti-pattern version\n7. Generate embedding for semantic blocking\n\nWORKFLOW:\n1. Confirm action with user (destructive)\n2. Add to toxic log (with reason, timestamp)\n3. Update playbook status to deprecated\n4. If --invert: create new anti-pattern bullet\n5. Rebuild semantic index if using embeddings\n\nSAFETY:\n- Require explicit confirmation for destructive action\n- Log all forget actions with audit trail\n- Support undo via toxic log inspection\n- Warn if forgetting high-score bullets\n\nDEPENDENCIES:\n- Toxic log storage (toxic_bullets.log)\n- Playbook update utilities\n- Embedding generation (optional)\n- Anti-pattern creation (if --invert)\n\nSUCCESS CRITERIA:\n- Toxic log updated with hash and embedding\n- Playbook marks bullet as deprecated\n- Future similar rules blocked automatically\n- Audit trail complete and reversible","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:52:23.375969Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-81t","title":"[Utils] daysAgo - Calculate past date","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:45:02.020032Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-81vv","title":"[CLI] Fix repo .cass path resolution in commands","description":"Several commands still treat repo-local files under .cass/ as relative to process.cwd(), which breaks when running from subdirectories (and can cause crashes when .cass/playbook.yaml is missing). Fix by resolving repo root via resolveRepoDir() and only using repo paths when the underlying file/dir exists.\n\nTargets:\n- src/commands/forget.ts: fall back to repo playbook using resolveRepoDir + fileExists\n- src/orchestrator.ts: repo playbook path + hasRepo should use resolveRepoDir (git root), not cwd\n- src/outcome.ts: resolveOutcomeLogPath/resolveContextLogPath/applyOutcomeFeedback repo paths should use resolveRepoDir and existence checks\n- src/commands/playbook.ts: remove branch should not attempt to load repo playbook unless it exists; add branch currently has dead/untyped scope handling (clean up).\n\nAcceptance:\n- Running commands from a subdirectory behaves the same as from repo root\n- Missing repo .cass/ does not crash; it cleanly falls back or reports not found\n- bun test passes","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-13T11:37:50.411262Z","updated_at":"2025-12-13T11:44:52.338891Z","closed_at":"2025-12-13T11:44:52.338891Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-81x","title":"[Curator] autoInvertHarmfulBullets - Batch inversion check","description":"Post-processing phase that automatically inverts bullets with consistently negative feedback.\n\nSignature:\nfunction autoInvertHarmfulBullets(\n  playbook: Playbook,\n  pruneThreshold: number\n): InversionReport[]\n\nAlgorithm:\n1. Initialize inversions array\n2. For each active bullet in playbook:\n   a. Skip if bullet.pinned === true\n   b. Skip if bullet.maturity === 'deprecated'\n   c. Skip if bullet.kind === 'anti_pattern'\n   d. Calculate effectiveScore = helpfulCount - harmfulCount\n   e. If effectiveScore < -pruneThreshold:\n      - Create anti-pattern using invertToAntiPattern(bullet)\n      - Add anti-pattern to playbook.bullets\n      - Deprecate original bullet:\n        * state: 'retired'\n        * maturity: 'deprecated'\n        * deprecationReason: 'auto-inverted due to consistent negative feedback'\n        * replacedBy: anti-pattern ID\n      - Create InversionReport:\n        * originalId: bullet.id\n        * originalContent: bullet.content\n        * antiPatternId: antiPattern.id\n        * antiPatternContent: antiPattern.content\n      - Add to inversions array\n3. Return inversions\n\nWhen does auto-inversion trigger?\n- Default pruneThreshold: 3\n- Bullet needs net -3 score (e.g., 0 helpful, 3 harmful)\n- Consistent pattern across sessions\n- Not a single-session fluke\n\nWhy this matters:\n- Converts mistakes into institutional knowledge\n- Prevents deletion of learning opportunities\n- Creates explicit anti-pattern section in playbook\n- Maintains accountability and history\n\nThis is called AFTER all deltas are processed in curatePlaybook.","status":"tombstone","priority":3,"issue_type":"task","created_at":"2025-12-07T21:45:05.550937Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-84gh","title":"Improve outcome command UX with positional arguments","description":"## Context\n\nThe `outcome` command records implicit feedback from session outcomes. Currently it requires multiple options:\n\n```bash\ncm outcome --status success --rules b-123,b-456 --session /path/to/session\n```\n\nBoth `--status` and `--rules` are required, making them awkward as options.\n\n## Current State\n\n```typescript\nprogram.command(\"outcome\")\n  .requiredOption(\"--status <status>\", \"Outcome status: success|failure|mixed\")\n  .requiredOption(\"--rules <ids>\", \"Comma-separated rule ids that were shown\")\n```\n\n## Proposed Change\n\nConvert to positional arguments:\n\n```bash\ncm outcome <status> <rule-ids> [--session /path/to/session]\n```\n\nExample:\n```bash\ncm outcome success b-123,b-456 --session /path/to/session\n```\n\n## Why This Is Low Priority\n\n1. The `outcome` command is in the \"Advanced/rare\" category\n2. Most agents use inline comments `[cass: helpful ...]` instead\n3. The current API works, it's just slightly awkward\n4. This would be a breaking change\n\n## Implementation (if pursued)\n\n```typescript\nprogram.command(\"outcome\")\n  .description(\"Record implicit feedback from a session outcome\")\n  .argument(\"<status>\", \"Outcome status: success|failure|mixed\")\n  .argument(\"<rules>\", \"Comma-separated rule ids that were shown\")\n  .option(\"--session <path>\", \"Session path for provenance\")\n  // ... other options ...\n```\n\n## Backwards Compatibility\n\nIf implemented, should probably support both:\n- New: `cm outcome success b-123,b-456`\n- Old: `cm outcome --status success --rules b-123,b-456`\n\n## Decision\n\nThis is optional and low priority. Only implement if:\n1. We're doing a major version bump anyway\n2. User feedback indicates confusion with current syntax\n\n## Part of Epic\n\ncass_memory_system-ulu7 (Agent UX Improvements)","status":"closed","priority":4,"issue_type":"task","created_at":"2025-12-15T17:18:18.520564Z","updated_at":"2025-12-15T17:51:14.258354Z","closed_at":"2025-12-15T17:51:14.258354Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-87l","title":"[Reflector] extractSearchAnchors - Generate SEO for agents","description":"function extractSearchAnchors(diary: DiaryExtraction): string[]\n\n\"SEO for agents\" - terms optimized for future search:\n- Combine key terms from all diary fields\n- Include technical terms, error messages, file patterns\n- Limit to 10-15 anchors\n\nEXTRACTION STRATEGY:\n1. From accomplishments: action verbs + tech terms\n2. From challenges: error types + problem domains\n3. From keyLearnings: concepts + patterns\n4. From decisions: technology names + approaches\n\nEXAMPLES:\n- \"React Testing Library\"\n- \"async/await\"\n- \"JWT authentication\"\n- \"CORS configuration\"\n- \"TypeScript generics\"\n\nFILTERING:\n- Remove common words (the, a, and, etc.)\n- Remove duplicates\n- Prioritize technical terms\n- Include version numbers if present\n\nPURPOSE:\nThese help future context searches find this diary\n\nALGORITHM:\n1. Extract noun phrases from all fields\n2. Score by technical relevance\n3. Sort by score\n4. Take top 15\n\nUsed when saving diary to cass","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:44:58.975745Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-894x","title":"Chore: Consider refactoring doctor.ts when adding new functionality","description":"# Chore: Doctor.ts Refactoring (Backlog)\n\n## Context\n`src/commands/doctor.ts` is **38KB** (~1000 lines). This is large but not problematic yet.\n\n## Current State\nThe file is well-structured internally with:\n- Health checks (config, playbook, cass, LLM providers, storage)\n- Fix capabilities (auto-fix recoverable issues)\n- Self-test mode\n- JSON output contract\n- Detailed diagnostics\n\n## When to Refactor\nOnly address this when:\n- Adding significant new doctor functionality\n- Test coverage becomes difficult\n- Multiple developers need to work on it simultaneously\n\n## Refactoring Strategy (for future maintainers)\nIf/when refactoring is needed:\n\n1. **Extract check functions** into `src/doctor/checks/`\n   - `checkConfig.ts`\n   - `checkPlaybook.ts`\n   - `checkCass.ts`\n   - `checkLLM.ts`\n   - `checkStorage.ts`\n\n2. **Extract fix functions** into `src/doctor/fixes/`\n   - Each check's corresponding fix logic\n\n3. **Keep main orchestration** in `doctor.ts`\n   - Import and compose checks/fixes\n   - Handle CLI flags and output formatting\n\n4. **Follow the playbook.ts pattern**\n   - Core logic in `src/playbook.ts`\n   - CLI wrapper in `src/commands/playbook.ts`\n\n## Priority\nP4 (backlog) - Not blocking, not urgent, address opportunistically.\n\n## Origin\nExtracted from closed feature `fqzc` (Code Quality Cleanup) to preserve architectural guidance.","status":"closed","priority":4,"issue_type":"chore","created_at":"2025-12-15T21:22:37.436608Z","updated_at":"2025-12-15T23:57:12.829300Z","closed_at":"2025-12-15T23:57:12.829300Z","close_reason":"Fixed doctor recommended-actions lookups and sanitization detail printing; full refactor deferred until new doctor functionality warrants splitting","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-8dxr","title":"Integration Tests Epic - Pipeline integration tests","description":"Integration tests for multi-component pipelines.\nTests real interactions between modules without mocks.\nCovers: Curator pipeline, Reflector pipeline, Full ACE pipeline.\nMust use real fixtures, real file I/O, real LLM calls (with test API key).\nDetailed logging at each pipeline stage for debugging.","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-12-08T01:26:02.099716Z","updated_at":"2025-12-14T01:42:50.051637Z","closed_at":"2025-12-14T01:42:50.051637Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-8dxr","depends_on_id":"cass_memory_system-u64s","type":"blocks","created_at":"2026-01-21T09:28:50Z","created_by":"import"}]}
{"id":"cass_memory_system-8ift","title":"[Test] Unit: playbook.ts - CRUD and bullet management","description":"# Unit Tests for playbook.ts\n\n## Functions to Test\n\n### loadPlaybook(path)\nTest Cases:\n- Valid YAML file → returns Playbook object\n- Empty file → returns default playbook\n- Missing file → creates default playbook\n- Invalid YAML → throws with helpful error\n- Schema validation failure → throws with details\n- File with deprecated patterns → loads correctly\n\n### savePlaybook(playbook, path)\nTest Cases:\n- Saves valid playbook to file\n- Creates parent directories if needed\n- Overwrites existing file\n- Uses atomic write (temp file + rename)\n- Preserves YAML formatting\n\n### addBullet(playbook, data, sourceSession)\nTest Cases:\n- Adds bullet with generated ID\n- Sets createdAt/updatedAt timestamps\n- Adds to sourceSessions array\n- Extracts agent from sourceSession path\n- Validates content length\n- Returns updated playbook (immutable)\n\n### findBullet(playbook, id)\nTest Cases:\n- Finds existing bullet by ID\n- Returns undefined for missing ID\n- Case-sensitive ID matching\n\n### deprecateBullet(playbook, bulletId, reason)\nTest Cases:\n- Sets deprecated = true\n- Sets deprecatedAt timestamp\n- Sets deprecationReason\n- Adds to deprecatedPatterns list\n- Returns undefined for missing bullet\n\n### getBulletsByCategory(playbook, category)\nTest Cases:\n- Returns bullets matching category\n- Empty array for no matches\n- Case-sensitive matching\n\n### findSimilarBullet(playbook, content, threshold)\nTest Cases:\n- Finds exact match\n- Finds similar content (Jaccard similarity)\n- Returns null below threshold\n- Handles empty playbook\n\n### isDuplicateBullet(playbook, content)\nTest Cases:\n- True for exact duplicate\n- True for very similar content\n- False for unique content\n\n### recordFeedbackEvent(playbook, bulletId, type, sessionPath, reason?)\nTest Cases:\n- Adds event to feedbackEvents array\n- Updates helpfulCount/harmfulCount\n- Handles harmful reason field\n- Returns updated playbook\n\n## Test Approach\n- Use withTempDir for file operations\n- Use createTestPlaybook for setup\n- Verify file contents after writes","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-08T01:23:40.892472Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-8ift","depends_on_id":"cass_memory_system-ai52","type":"blocks","created_at":"2026-01-21T09:28:50Z","created_by":"import"}]}
{"id":"cass_memory_system-8mb","title":"[Security] verifySanitization - Test sanitization effectiveness","description":"Implement verifySanitization() to test sanitization effectiveness.\n\nFunction signature:\n```typescript\nfunction verifySanitization(text: string): {\n  containsPotentialSecrets: boolean;\n  warnings: string[];\n}\n```\n\nImplementation:\n1. Run patterns in DETECT mode (test, don't replace)\n2. Return warnings about potential missed secrets\n3. Check for common secret indicators not caught by patterns\n\nDetection heuristics:\n- Look for \"key=\", \"token=\", \"password=\" with non-redacted values\n- Check for long base64 strings (40+ chars)\n- Detect PEM headers without [PRIVATE_KEY] replacement\n- Find Bearer tokens that weren't caught\n\nExample usage:\n```typescript\nconst text = \"API_KEY=[API_KEY] secret=abc123\";\nconst result = verifySanitization(text);\n// result.containsPotentialSecrets = true\n// result.warnings = [\"Found potential secret: 'secret=abc123'\"]\n```\n\nUsed in:\n- doctor command for self-test\n- Development/debug mode to verify sanitization\n- Testing to ensure patterns are working\n\nPriority: 0 (Security Critical - P12)","notes":"Added verifySanitization heuristics plus pattern detection in src/sanitize.ts","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:44:52.739713Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-8nsd","title":"[Critical] MCP Server is P1 Not P3 - Agent Integration First","description":"# MCP Server Priority Elevation: P3 → P1\n\n## The Problem\nCurrent plan has MCP server as P3 (future/nice-to-have).\nThis is BACKWARDS. MCP integration is HOW agents will use CASS.\n\nWithout MCP:\n- Users must manually run `cm context` before each task\n- Agents can't automatically benefit from memory\n- Integration is friction-heavy\n\nWith MCP:\n- Claude Code auto-receives context on task start\n- Zero manual intervention required\n- Memory is seamlessly integrated\n\n## The Solution\nElevate MCP server to P1 priority. Build it alongside CLI.\n\n### MCP Server Provides:\n```typescript\n// Tool: Get context for a task\nmcpServer.tool(\"cm_context\", {\n  description: \"Get relevant rules and history for a task\",\n  parameters: { task: \"string\" },\n  handler: async ({ task }) => {\n    const context = await generateContext(task);\n    return formatForAgent(context);\n  }\n});\n\n// Tool: Record session outcome\nmcpServer.tool(\"cm_record_outcome\", {\n  description: \"Record that a task succeeded or failed\",\n  parameters: { \n    sessionId: \"string\",\n    outcome: \"success | failure | partial\",\n    rulesUsed: \"string[]\"\n  },\n  handler: async (params) => {\n    await recordOutcome(params);\n    return { recorded: true };\n  }\n});\n```\n\n### Agent Integration Flow:\n```\n1. Agent starts task\n2. Agent calls cm_context MCP tool\n3. CASS returns relevant rules + history\n4. Agent includes in system prompt\n5. Agent completes task\n6. Agent calls cm_record_outcome\n7. CASS updates confidence scores\n```\n\n### Minimal MCP Server (V1):\n```typescript\nconst TOOLS = [\n  \"cm_context\",     // Get context for task\n  \"cm_feedback\",    // Record helpful/harmful\n  \"cm_outcome\"      // Record session success/failure\n];\n\nconst RESOURCES = [\n  \"cm://playbook\",  // Current rules\n  \"cm://diary\"      // Recent diary entries\n];\n```\n\n## Why This Is Critical\n- MCP is the PRIMARY interface for agents\n- CLI is for humans to manage/debug\n- Without MCP, agents can't self-serve memory","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T22:14:10.237240Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-8okk","title":"[Design] Minimal AGENTS.md Blurb Specification","description":"# Minimal AGENTS.md Blurb Specification\n\n## Purpose\nDesign the ready-to-paste blurb that humans add to their AGENTS.md files. This blurb teaches agents how to use cass-memory and must be:\n\n1. **Self-contained**: Agent understands everything from just this blurb\n2. **Minimal**: Under 60 lines (ideally 40-50)\n3. **Actionable**: Clear protocol, not just documentation\n4. **Copy-paste ready**: No customization needed\n\n## Reference Examples\n\nThe cass blurb (coding_agent_session_search) is ~45 lines and includes:\n- What it does (1-2 sentences)\n- Critical warning (don't run bare `cass`)\n- Quick start commands (4-5 examples)\n- Why to use it (3 bullet points)\n- Key flags table\n- Output contract (stdout/stderr/exit codes)\n\n## Design Constraints\n\n**Must Include:**\n- What cass-memory does (persistent memory for agents)\n- The ONE essential command: `cm context \"<task>\" --json`\n- How to provide feedback (simplest possible mechanism)\n- Protocol summary (START/WORK/END)\n- Exit code contract\n\n**Should Include:**\n- 2-3 common flags\n- Brief explanation of rule IDs\n- Note that learning is automatic\n\n**Must NOT Include:**\n- Human-operator commands (init, reflect, etc.)\n- Verbose explanations\n- ASCII art or decorative elements\n- Optional/advanced features\n\n## Deliverables\n- [ ] Draft blurb text\n- [ ] Review against reference examples\n- [ ] Validate fits in ~50 lines","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-08T17:46:31.564087Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-8oy","title":"[Curator] isToxic - Check against toxic bullet log","description":"$(cat /tmp/fix_8oy.txt)","status":"tombstone","priority":3,"issue_type":"task","created_at":"2025-12-07T21:45:03.932369Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-8pf9","title":"[CLI:forget] invertAndForget - Convert to anti-pattern","description":"Implements the invertAndForget function that converts a toxic rule into an anti-pattern.\n\nFUNCTION SIGNATURE:\n```typescript\nasync function invertAndForget(\n  playbook: Playbook,\n  bulletId: string,\n  reason: string\n): Promise<{ deprecatedId: string; antiPatternId: string }>\n```\n\nPURPOSE:\nInstead of just blocking a toxic rule, this creates a permanent anti-pattern to actively teach against the harmful behavior. Useful for common mistakes that need explicit warning.\n\nWORKFLOW:\n1. Retrieve original bullet from playbook\n2. Mark original as deprecated (keep for history)\n3. Create new anti-pattern bullet with inverted content\n4. Add original to toxic log with invertedTo reference\n5. Return both IDs for tracking\n\nANTI-PATTERN TRANSFORMATION:\nOriginal: \"Cache API responses in localStorage for performance\"\nAnti-Pattern: \"AVOID: Caching API responses in localStorage without expiration/size limits\"\n\nRules:\n- Prefix with \"AVOID: \" marker\n- Add specific context about WHY it's harmful\n- Reference the reason in bullet metadata\n- Link back to original bullet ID\n\nIMPLEMENTATION REQUIREMENTS:\n1. Load original bullet content\n2. Generate anti-pattern content:\n   - Add \"AVOID: \" prefix\n   - Enhance with context from reason\n   - Preserve original category/tags\n3. Create new bullet with type=antiPattern\n4. Update original bullet:\n   - Set maturity=deprecated\n   - Add deprecationReason\n   - Link to anti-pattern ID\n5. Add to toxic log with invertedTo field\n6. Persist both changes atomically\n\nMETADATA LINKAGE:\nOriginal bullet:\n```json\n{\n  \"id\": \"abc-123\",\n  \"maturity\": \"deprecated\",\n  \"deprecatedAt\": \"2025-01-15T10:30:00Z\",\n  \"deprecationReason\": \"Caused production incident - see antiPatternId\",\n  \"antiPatternId\": \"xyz-789\"\n}\n```\n\nAnti-pattern bullet:\n```json\n{\n  \"id\": \"xyz-789\",\n  \"type\": \"antiPattern\",\n  \"content\": \"AVOID: Caching API responses...\",\n  \"originalBulletId\": \"abc-123\",\n  \"reason\": \"Security vulnerability...\"\n}\n```\n\nERROR HANDLING:\n- Bullet not found → error\n- Bullet already deprecated → warn and skip\n- Anti-pattern already exists → error\n\nDEPENDENCIES:\n- Playbook update utilities\n- Anti-pattern creation logic\n- Toxic log (addToToxicLog)\n- Atomic transaction support\n\nSUCCESS CRITERIA:\n- Original marked deprecated with proper linkage\n- New anti-pattern created and indexed\n- Toxic log contains both IDs\n- Changes persisted atomically\n- Future sessions show anti-pattern in PITFALLS section","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:52:59.256992Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-8pqd","title":"Unit tests for reflect.ts - Reflector iteration logic","description":"Complete unit test coverage for reflect.ts:\n- shouldExitEarly() with all 3 exit conditions\n- MAX_DELTAS boundary testing (19, 20, 21 deltas)\n- Multi-iteration reflection accumulation\n- Delta deduplication within iterations\n- Stats tracking (newPatterns, mergedPatterns, antiPatterns)\n- Config-driven maxReflectorIterations\n- Empty session handling\n- Large session handling (many deltas)\nNO MOCKS - use real diary/playbook fixtures","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-08T01:25:15.922343Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-8tpz","title":"[Integration] Context Pipeline - Full Flow Tests","description":"## Target: Integration tests for context retrieval pipeline\n\n### Test Scenarios:\n\n1. **Basic Context Flow**\n   - Initialize cass-memory\n   - Add bullets to playbook\n   - Query for context\n   - Verify relevant bullets returned\n\n2. **Scoring Integration**\n   - Bullets with different feedback history\n   - Query returns highest-scored first\n   - Decay affects ordering\n   - Recent feedback weighted higher\n\n3. **Scope Filtering Integration**\n   - Global and project-scoped bullets\n   - Query with specific scope\n   - Only matching scope returned\n   - Wildcard scope handling\n\n4. **CASS Integration (when available)**\n   - If cass installed, include results\n   - Merge CASS and playbook results\n   - Deduplicate appropriately\n   - Ranking across sources\n\n5. **LLM Enhancement (when available)**\n   - If API key present, enhance context\n   - Verify prompt construction\n   - Handle API errors gracefully\n   - Timeout handling\n\n6. **Empty/Edge Cases**\n   - No matching bullets\n   - Query matches everything\n   - Very long query\n   - Special characters in query\n\n### Performance Logging:\n- Time for each pipeline stage\n- Number of candidates at each stage\n- Final result count\n- Memory usage if large","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-08T01:30:10.195659Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-8v4","title":"[Reflector] hashDelta - Deterministic delta hashing","description":"function hashDelta(delta: PlaybookDelta): string\n\nHash based on:\n- delta.type\n- For \"add\": content hash\n- For \"helpful\": bulletId\n- For \"harmful\": bulletId\n- For \"replace\": bulletId + newContent hash\n- For \"deprecate\": bulletId\n\nIMPLEMENTATION:\n```typescript\nswitch (delta.type) {\n  case 'add':\n    return hash(delta.content + delta.category)\n  case 'helpful':\n  case 'harmful':\n  case 'deprecate':\n    return hash(delta.bulletId + delta.type)\n  case 'replace':\n    return hash(delta.bulletId + delta.newContent)\n}\n```\n\nWHY DETERMINISTIC:\n- Same delta = same hash\n- Enables Set-based deduplication\n- Works across iterations\n\nHASH FUNCTION:\nUse crypto.createHash('sha256') for consistency\n\nUsed in deduplicateDeltas()","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:44:55.651509Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-8vr","title":"[Generator] extractBulletReasoning - Get creation context","description":"Extract reasoning/origin story for why a playbook bullet exists.\n\nSIGNATURE:\nfunction extractBulletReasoning(bullet: PlaybookBullet): string\n\nPURPOSE:\nProvide context about HOW and WHY a rule was created. Helps the agent understand the origin story and gives more weight to the guidance.\n\nSOURCES (in priority order):\n1. bullet.reasoning (if explicitly set)\n2. bullet.derivedFrom.keyEvidence (if derived from session)\n3. Fallback: From {agent} session on {date}\n\nLOGIC:\nCheck reasoning field first, then keyEvidence, then fallback to session metadata, finally return No reasoning available if nothing found.\n\nEXAMPLE OUTPUTS:\n1. Explicit: Learned when JWT expiry caused silent auth failures in production\n2. Key evidence: Debugging session showed token refresh interval was too short\n3. Fallback: From claude session on 2025-11-15\n4. No data: No reasoning available\n\nFIELD STRUCTURE:\nbullet.derivedFrom contains sessionPath, timestamp, keyEvidence, extractedBy\n\nUSE CASE:\nHelps agent understand: This rule exists because we hit this bug before, This was learned from a successful fix, This came from a painful debugging session\n\nDISPLAY:\nAppears in context markdown after score and last helpful time, provides memorable context about why the rule was created.\n\nTRUNCATION:\nIf reasoning exceeds 200 chars, truncate with ellipsis. Preserve first sentence if possible.\n\nVALUE:\nContext with reasoning is much more valuable than bare rules. Example: Use async/await for DB calls - blocking calls in event loop caused 5s latencies in production explains WHY and provides memorable context.","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:45:03.754093Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-8zaj","title":"[P1] Standardize JSON output schema across commands","description":"# Task: Standardize JSON Output Schema\n\n## Problem\nEach command returns different JSON structures:\n- context: { success, task, relevantBullets, antiPatterns, ... }\n- stats: { success, total, byScope, topPerformers, ... }\n- doctor: { success, checks, fixableIssues, ... }\n\nScripts must handle each command specially.\n\n## Solution\n\n### 1. Standard Envelope\n```typescript\ninterface JsonResponse<T> {\n  success: boolean;\n  command: string;           // \"context\" | \"stats\" | \"doctor\"\n  timestamp: string;         // ISO8601\n  data: T;                   // Command-specific payload\n  warnings?: string[];       // Non-fatal issues\n  metadata: {\n    executionMs: number;\n    version: string;\n  };\n}\n```\n\n### 2. Standard Error Envelope\n```typescript\ninterface JsonError {\n  success: false;\n  command: string;\n  timestamp: string;\n  error: {\n    message: string;\n    code: ErrorCode;\n    cause?: string;\n    recovery?: string[];\n  };\n  metadata: {\n    executionMs: number;\n    version: string;\n  };\n}\n```\n\n### 3. Create Response Builders\n```typescript\n// src/json-response.ts\nfunction jsonSuccess<T>(command: string, data: T, options?: { warnings?: string[] }): JsonResponse<T>\nfunction jsonError(command: string, error: RecoverableError): JsonError\n```\n\n### 4. Update All Commands\nReplace direct JSON.stringify with response builders.\n\n## Files\n- src/json-response.ts (new)\n- src/utils.ts (deprecate old helpers)\n- All src/commands/*.ts\n\n## Acceptance\n- [ ] All commands use envelope format\n- [ ] All responses include metadata\n- [ ] Error responses include recovery\n- [ ] TypeScript types exported for consumers","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-16T15:33:13.067774Z","updated_at":"2025-12-17T03:48:55.353340Z","closed_at":"2025-12-17T03:48:55.353340Z","close_reason":"Standardized --json output across commands with a consistent envelope; migrated command outputs + tests; added project --json and import unwrap for exported envelopes.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-8zaj","depends_on_id":"cass_memory_system-oe0g","type":"blocks","created_at":"2026-01-21T09:28:50Z","created_by":"import"}]}
{"id":"cass_memory_system-8zpe","title":"Implement redirect-based resolve_version() in install.sh","description":"# Task: Implement the Redirect-Based Version Resolution\n\n## Context\n\nThis task implements the core change to install.sh, replacing the GitHub API-based version resolution with the redirect-based approach.\n\n## File to Modify\n\n`install.sh` - lines 26-43 (the `resolve_version()` function)\n\n## Current Implementation\n\n```bash\nresolve_version() {\n  if [ -n \"$VERSION\" ]; then return 0; fi\n\n  info \"Resolving latest version...\"\n  local latest_url=\"https://api.github.com/repos/${OWNER}/${REPO}/releases/latest\"\n  local tag\n  if ! tag=$(curl -fsSL -H \"Accept: application/vnd.github.v3+json\" \"$latest_url\" 2>/dev/null | grep '\"tag_name\":' | sed -E 's/.*\"([^\"]+)\".*/\\1/'); then\n    tag=\"\"\n  fi\n\n  if [ -n \"$tag\" ]; then\n    VERSION=\"$tag\"\n    info \"Resolved latest version: $VERSION\"\n  else\n    VERSION=\"v0.1.0\"\n    warn \"Could not resolve latest version from GitHub API; defaulting to $VERSION\"\n  fi\n}\n```\n\n## New Implementation\n\n```bash\nresolve_version() {\n  if [ -n \"$VERSION\" ]; then return 0; fi\n\n  info \"Resolving latest version...\"\n  \n  # Use redirect-based resolution instead of GitHub API\n  # GitHub redirects /releases/latest → /releases/tag/{version}\n  # This avoids API rate limits (60/hr) and fragile JSON parsing\n  local releases_url=\"https://github.com/${OWNER}/${REPO}/releases/latest\"\n  local final_url\n  final_url=\"$(curl -fsSL -o /dev/null -w '%{url_effective}' \"$releases_url\" 2>/dev/null || true)\"\n  \n  # Extract tag from final URL: https://github/.../releases/tag/v0.2.1 → v0.2.1\n  local tag=\"${final_url##*/}\"\n  \n  # Validate: tag should start with 'v' and final_url should contain '/releases/tag/'\n  if [ -n \"$tag\" ] && [[ \"$final_url\" == *\"/releases/tag/\"* ]]; then\n    VERSION=\"$tag\"\n    info \"Resolved latest version: $VERSION\"\n  else\n    # Fallback to a reasonable recent version (not ancient v0.1.0)\n    VERSION=\"v0.2.1\"\n    warn \"Could not resolve latest version; defaulting to $VERSION\"\n  fi\n}\n```\n\n## Key Changes\n\n1. **Replace API URL with releases/latest URL**\n   - Old: `https://api.github.com/repos/.../releases/latest`\n   - New: `https://github.com/.../releases/latest`\n\n2. **Use curl redirect tracking instead of JSON parsing**\n   - Old: `curl ... | grep | sed`\n   - New: `curl -o /dev/null -w '%{url_effective}'`\n\n3. **Use shell parameter expansion instead of regex**\n   - Old: `sed -E 's/.*\"([^\"]+)\".*/\\1/'`\n   - New: `${final_url##*/}`\n\n4. **Add validation that redirect happened correctly**\n   - Check that final_url contains `/releases/tag/`\n   - Prevents false positives if redirect fails silently\n\n5. **Update fallback version**\n   - Old: `v0.1.0` (ancient, may not even work)\n   - New: `v0.2.1` (current version as of this writing)\n\n## Implementation Notes\n\n### Why `-o /dev/null`?\nDiscards the response body (we only want the URL, not the HTML page).\n\n### Why `|| true`?\nPrevents the script from exiting on curl failure (we handle errors manually).\n\n### Why validate `/releases/tag/` in URL?\nIf GitHub changes behavior or there's a redirect loop, we want to detect it rather than extract garbage.\n\n### Why not just check `[ -n \"$tag\" ]`?\nThe tag extraction `${final_url##*/}` will return something even if the URL is wrong. Checking for `/releases/tag/` ensures we actually followed the expected redirect.\n\n## Considerations\n\n### Bash Version Compatibility\n\nThe implementation uses:\n- `${var##pattern}` - POSIX-compliant, works in bash 3.x+\n- `[[ ... == *pattern* ]]` - Bash-specific, but install.sh already uses `#!/usr/bin/env bash`\n\nIf we need strict POSIX sh compatibility, replace:\n```bash\n# From (bash-specific):\nif [[ \"$final_url\" == *\"/releases/tag/\"* ]]; then\n\n# To (POSIX-compliant):\ncase \"$final_url\" in\n  */releases/tag/*) : ;;  # Valid\n  *) tag=\"\" ;;            # Invalid, clear tag\nesac\n```\n\n### Error Message Clarity\n\nThe warning message is intentionally vague (\"Could not resolve\") because:\n- Network errors and \"no releases\" look the same\n- Users don't need to know implementation details\n- The important part is the fallback version\n\n## Testing After Implementation\n\n```bash\n# Test 1: Normal operation\n./install.sh --version \"\"  # Should resolve to latest\n\n# Test 2: Explicit version (bypass resolution)\n./install.sh --version v0.1.0\n\n# Test 3: Simulate network failure\n# (temporarily break the URL in the script)\n```\n\n## Rollback Plan\n\nIf issues are discovered post-deployment:\n1. The old implementation is in git history\n2. Can revert with: `git checkout HEAD~1 -- install.sh`\n3. Users can still use `--version vX.Y.Z` to bypass resolution","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T18:38:17.353762Z","created_by":"jemanuel","updated_at":"2026-01-05T19:12:56.876980Z","closed_at":"2026-01-05T19:12:56.876980Z","close_reason":"Consolidating into single implementation task","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-8zpe","depends_on_id":"cass_memory_system-xmdx","type":"blocks","created_at":"2026-01-21T09:28:50Z","created_by":"import"}]}
{"id":"cass_memory_system-92jv","title":"[E2E Tests] CLI init command - project initialization","description":"## E2E Test: CLI init Command - Project Initialization\n\n### Test Scenario\nTest the `cm init` command creates proper project structure\n\n### Test Steps\n\n#### 1. Fresh Init\n- Create empty temp directory\n- Run `cm init`\n- Verify .cass/ directory created\n- Verify config.yaml created with defaults\n- Verify playbook.yaml created (empty)\n\n#### 2. Init with Options\n- Run `cm init --provider anthropic --model claude-3-5-sonnet`\n- Verify config has specified provider/model\n- Verify other defaults preserved\n\n#### 3. Init Idempotent\n- Run init twice in same directory\n- Second run should not overwrite existing config\n- Should warn about existing initialization\n\n#### 4. Init in Nested Directory\n- Create nested project structure\n- Run init in subdirectory\n- Verify creates local .cass (not in parent)\n\n### Verbose Logging\n- Log: 'Initializing cass-memory in <path>'\n- Log: 'Creating .cass directory...'\n- Log: 'Writing default config.yaml...'\n- Log: 'Writing empty playbook.yaml...'\n- Log: 'Initialization complete'\n\n### Error Cases\n- Read-only directory (should fail gracefully)\n- Existing corrupt config (should warn, not overwrite)","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-08T01:24:31.109699Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-92xd","title":"[Unit Tests] cass.ts - Cass binary integration functions","description":"## Unit Tests: cass.ts - Cass Binary Integration Functions\n\n### Test Categories\n\n#### 1. cassAvailable()\n- Returns true when cass binary exists\n- Returns false when cass not in PATH\n- Handles timeout gracefully\n- Uses 'cass health' check\n\n#### 2. cassNeedsIndex()\n- Returns true for INDEX_MISSING exit code\n- Returns false for healthy index\n- Handles timeout\n- Treats unknown errors as needing rebuild\n\n#### 3. cassIndex()\n- Calls cass index command\n- Supports --full flag\n- Supports --incremental flag\n- Returns promise that resolves on success\n- Rejects on non-zero exit\n\n#### 4. cassSearch()\n- Parses JSON output correctly\n- Handles --robot flag\n- Passes limit, days, agent options\n- Validates hits against CassHitSchema\n- Returns empty array for NOT_FOUND\n\n#### 5. safeCassSearch()\n- Returns empty array when cass unavailable\n- Rebuilds index on INDEX_MISSING\n- Reduces limit on TIMEOUT\n- Logs appropriate warnings\n\n#### 6. cassExport()\n- Exports session to markdown/json/text\n- Handles NOT_FOUND gracefully\n- Returns null on error\n\n#### 7. cassExpand()\n- Expands context around line number\n- Passes context lines parameter\n- Returns null on error\n\n#### 8. cassTimeline()\n- Parses timeline JSON structure\n- Returns groups with sessions\n- Handles empty timeline\n\n#### 9. findUnprocessedSessions()\n- Filters against processed set\n- Respects agent filter\n- Respects maxSessions limit\n\n### Test Approach\n- Mock cass binary responses via fixtures\n- Test error handling paths\n- Verify command line argument construction\n- Use child_process mock for unit tests\n\n### Note on Integration\n- Full integration tests require actual cass binary\n- Unit tests focus on parsing and error handling","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-08T01:24:08.958254Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-931","title":"[Generator] buildContextResult - Assemble final output","description":"Assemble final ContextResult from all gathered components.\n\nSIGNATURE:\nfunction buildContextResult(task: string, rules: ScoredBullet[], antiPatterns: ScoredBullet[], history: CassHit[], warnings: string[]): ContextResult\n\nPURPOSE:\nCombine all context components into a structured JSON output optimized for agent consumption. This is what gets returned to the LLM as the 'mission briefing'.\n\nOUTPUT STRUCTURE:\n{\n  task: string,                    // Original task description\n  relevantBullets: Array<{         // Top-scored rules\n    id: string,\n    content: string,\n    category: string,\n    type: string,\n    maturity: number,\n    effectiveScore: number,\n    lastHelpful: string,           // Formatted timestamp\n    reasoning: string              // Why this rule exists\n  }>,\n  antiPatterns: Array<{            // Pitfalls to avoid\n    id: string,\n    content: string,\n    type: 'anti-pattern',\n    effectiveScore: number\n  }>,\n  historySnippets: Array<{         // Relevant past sessions\n    sessionPath: string,\n    agent: string,\n    snippet: string,\n    relevance: number\n  }>,\n  deprecatedWarnings: string[],    // Warnings about old patterns\n  suggestedCassQueries: string[]   // Human-readable search suggestions\n}\n\nTRANSFORMATIONS:\n- rules/antiPatterns → Extract only needed fields (strip internal metadata)\n- lastHelpful → formatLastHelpful(bullet) for human readability\n- reasoning → extractBulletReasoning(bullet) for context\n- history → Map to simpler structure (remove line numbers, etc)\n- suggestedCassQueries → generateSuggestedQueries(task, keywords)\n\nFIELD DESCRIPTIONS:\n- maturity: Confidence score (0-100) based on event count\n- effectiveScore: Net helpful score with decay\n- lastHelpful: 'Never' or relative time ('2 days ago')\n- reasoning: Origin story of the rule\n\nSORTING:\n- relevantBullets: Already sorted by finalScore\n- antiPatterns: Already sorted by finalScore\n- historySnippets: Already sorted by relevance\n\nSIZE LIMITS:\n- relevantBullets: config.maxBulletsInContext (default 10)\n- antiPatterns: config.maxBulletsInContext (default 10)\n- historySnippets: config.maxHistorySnippets (default 10)\n\nThis structure is designed to be directly embeddable in LLM context.","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:44:59.484609Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-94c5","title":"[Tracking] Workspace-specific processed log","description":"Purpose: Separate processed session logs per workspace for workspace-scoped reflection\n\nFile path pattern: ~/.cass-memory/reflections/ws-{hash}.processed.log\n\nHash generation:\n- hash = first 8 characters of SHA256(workspace absolute path)\n- Example: /Users/dev/myapp → SHA256 → a1b2c3d4 → ws-a1b2c3d4.processed.log\n\nThis keeps workspace sessions separate from global sessions.\n\nImplementation:\n```typescript\nfunction getWorkspaceLogPath(workspacePath: string): string {\n  const hash = crypto.createHash('sha256')\n    .update(workspacePath)\n    .digest('hex')\n    .substring(0, 8);\n  return path.join(\n    os.homedir(),\n    '.cass-memory',\n    'reflections',\n    `ws-${hash}.processed.log`\n  );\n}\n```\n\nFormat: Same TSV format as global.processed.log\nBenefits:\n- Workspace-specific reflection history\n- Independent processing of workspace vs global sessions\n- Easy cleanup when workspace deleted","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:51:00.368578Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-95b","title":"[Utils] now - Current ISO 8601 timestamp","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:45:01.127777Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-96sv","title":"serve: respect --port 0 and log bound port","description":"Bug: src/commands/serve.ts uses || for port selection, so --port 0 (and MCP_HTTP_PORT=0) are ignored. Also baseUrl log uses the requested port, not the actual bound port when port=0. Fix by using nullish coalescing + robust env parsing and logging server.address().","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-16T09:38:22.789096Z","updated_at":"2025-12-16T09:42:09.382791Z","closed_at":"2025-12-16T09:42:09.382791Z","close_reason":"Fixed port selection to respect 0 and log actual bound port; added regression tests.","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-9786","title":"Remove fake hardcoded stats from onboard status","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-15T16:47:55.694196Z","updated_at":"2025-12-15T16:50:35.925938Z","closed_at":"2025-12-15T16:50:35.925938Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-9787","title":"Add MCP stdio transport for cm serve (spec-compliant)","description":"cm serve currently only exposes a custom HTTP JSON-RPC endpoint; MCP spec 2025-11-25 says clients SHOULD support stdio and stdio messages are newline-delimited JSON-RPC with no embedded newlines. Add a stdio transport (default or flag), keep HTTP optional, and update README MCP client config to match. Add tests for stdio framing/routeRequest.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-17T22:59:47.607528523Z","updated_at":"2025-12-17T23:13:03.609464164Z","closed_at":"2025-12-17T23:13:03.609464164Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-9788","title":"Increase src/commands/context.ts coverage (contextWithoutCass + keyword scoring)","description":"Goal: improve Bun coverage for src/commands/context.ts by adding deterministic in-process tests for:\\n- contextWithoutCass(): playbook-only degraded mode + deprecated pattern warnings + error branch\\n- scoreBulletsEnhanced(): keyword-only scoring/sorting when semantic search is disabled\\n\\nAcceptance\\n- New/updated tests cover these code paths without network access\\n- bun test + bun run typecheck pass\\n- Coverage summary shows higher src/commands/context.ts and increased total lines headroom","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T05:15:23.018153258Z","updated_at":"2025-12-18T05:20:42.182118814Z","closed_at":"2025-12-18T05:20:42.182118814Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-9788","depends_on_id":"cass_memory_system-sdt1.4","type":"parent-child","created_at":"2026-01-21T09:28:50Z","created_by":"import"}]}
{"id":"cass_memory_system-9789","title":"Harden YAML key normalization against prototype pollution","description":"normalizeYamlKeys / camelToSnakeKeys used assignment when copying keys from YAML/JSON-parsed objects. A malicious config containing a __proto__ key could mutate the returned object's prototype and potentially bypass repo-config security stripping (delete only removes own props) or cause weird behavior.\n\nFix should ensure magic keys like __proto__ are treated as normal data properties (no prototype mutation) and underscore-prefixed keys round-trip correctly.","notes":"Done:\n- src/utils.ts: normalizeYamlKeys + camelToSnakeKeys now use Object.defineProperty when copying keys to avoid triggering __proto__ setter / prototype mutation.\n- src/utils.ts: camelToSnake now preserves leading underscores (e.g., _privateField -> _private_field, __proto__ stays __proto__).\n- test/utils.normalizeYamlKeys.test.ts adds regression coverage for __proto__ pollution for both directions.\n\nValidation:\n- bun run typecheck\n- bun test test/utils.normalizeYamlKeys.test.ts\n- bun test test/config.test.ts\n- bun test test/config-security.test.ts\n- bun test test/doctor-fixes.test.ts","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-18T07:39:19.301556112Z","updated_at":"2025-12-18T07:39:46.391537020Z","closed_at":"2025-12-18T07:39:46.391537020Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-9790","title":"Security: Prevent __proto__ keys from polluting stats maps","description":"Prototype-pollution hardening: several string-keyed maps used plain {} + obj[key]=... with user-controlled keys (e.g., playbook category/scope/agent names/keywords). Keys like '__proto__' can mutate the accumulator's prototype and corrupt behavior/output. Use null-prototype dictionaries (Object.create(null)) or safe defineProperty when copying keys.","notes":"Fixes: src/commands/stats.ts countBy; src/commands/serve.ts countBy; src/utils.ts extractKeywords counts; src/reflect.ts category grouping; src/playbook.ts category groupings; src/gap-analysis.ts categoryCounts/byCategory; src/commands/privacy.ts agent counts. Regression: test/serve-stats.test.ts. Validation: bun run typecheck; KEEP_TEMP=1 bun test test/serve-stats.test.ts; KEEP_TEMP=1 bun test test/utils.normalizeYamlKeys.test.ts.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-18T07:58:43.635455917Z","updated_at":"2025-12-18T08:01:53.856832454Z","closed_at":"2025-12-18T08:01:53.856832454Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-9791","title":"MCP serve stdio: strict JSON-RPC validation + error codes","description":"Tighten MCP stdio server request validation so invalid JSON-RPC shapes return correct errors (-32600/-32601/-32602) without emitting non-JSON on stdout. Ensure notifications (id:null) never get responses.","notes":"Done. routeRequest() now validates envelope shape (object), jsonrpc (when present), id type, and method type; returns -32600 invalid request, -32602 invalid params, -32601 method not found. Added unit coverage in test/serve-stdio.e2e.test.ts.\nValidation: bun run typecheck; KEEP_TEMP=1 bun test test/serve-stdio.e2e.test.ts.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-18T08:11:15.143721312Z","updated_at":"2025-12-18T08:15:25.398726319Z","closed_at":"2025-12-18T08:15:25.398726319Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-9791","depends_on_id":"cass_memory_system-jkpj","type":"discovered-from","created_at":"2026-01-21T09:28:50Z","created_by":"import"}]}
{"id":"cass_memory_system-9hf1","title":"[UX][safety] Add dry-run/preview mode for destructive operations","description":"Problem\n- Even with confirmations, users need to see exactly what will change before committing to a destructive action.\n\nWhat to do\n- Add a `--dry-run` (or `--preview`) mode to destructive paths:\n  - playbook remove --hard\n  - undo --hard\n  - any future “reset config / rebuild” operations\n- The preview should include:\n  - bullet id + a short content preview\n  - target file path (global vs repo)\n  - the exact flags/command to apply for real\n\nNotes\n- Preview output should be safe for JSON mode as well (structured plan object).","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-13T10:19:08.089348Z","updated_at":"2025-12-13T22:35:10.790817Z","closed_at":"2025-12-13T22:35:10.790817Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-9hf1","depends_on_id":"cass_memory_system-jfc5","type":"parent-child","created_at":"2026-01-21T09:28:50Z","created_by":"import"}]}
{"id":"cass_memory_system-9iuc","title":"Task: Fix validation error exits to produce JSON in --json mode","description":"# Task: Fix validation + error exits to produce JSON in `--json` mode\n\n## Problem\nEven after the JSON-helper migration, there are still agent-hostile paths where `--json` is set but stdout is **not** a valid JSON payload:\n- validation guards print human text and call `process.exit(1)`\n- some catch blocks log to stderr and exit without emitting JSON\n- some commands emit JSON errors but omit `code` or use inconsistent shapes\n\nThis breaks generic agent integrations that expect:\n1) parseable JSON on stdout, and 2) a stable error contract with `code`.\n\n## Evidence (as of Dec 15, 2025)\nA quick grep shows remaining hard-exits:\n\n- `src/cm.ts:107` — `playbook add` missing content prints plain text + `process.exit(1)` (NO JSON)\n- `src/commands/outcome.ts:34,38,44` — validation errors print chalk text + `process.exit(1)` (NO JSON)\n- `src/commands/mark.ts:124` — catch block logs error + `process.exit(1)` (NO JSON)\n- `src/commands/why.ts:83` — prints JSON but missing `code`, then `process.exit(1)`\n- `src/commands/forget.ts:16` — validation exit\n- `src/commands/init.ts:281` — validation exit\n- `src/commands/diary.ts:41,55` — validation exits\n- `src/commands/playbook.ts:360,370,390,404,437,496,518,680,706,784,796` — multiple validation exits\n- `src/cm.ts:441` — `handleError()` prints a *different* JSON error shape (`error: { message, code }`)\n\n(There are also places that hand-roll `printJson({ success:false, ... })` without consistent `code` usage.)\n\n## Target behavior (robot contract)\nWhen JSON output is requested (use `isJsonOutput(flags)` when available):\n\n- **Always emit a JSON error payload to stdout**, even for validation failures.\n- Use the shared helpers:\n  - `printJsonError(\"...\", { code: ErrorCode.MISSING_REQUIRED, details?, hint? })`\n  - `printJsonResult(...)` for success / soft success.\n- Prefer `process.exitCode = 1; return;` over `process.exit(1)` inside command modules.\n  - Rationale: programmatic callers/tests shouldn’t be forcibly terminated.\n\n## Agent-integration guidance (don’t confuse agents)\n\n### 1) Keep the error schema flat and consistent\nPrefer:\n```json\n{ \"success\": false, \"code\": \"MISSING_REQUIRED\", \"error\": \"…\", \"hint\": \"…\", \"details\": {…} }\n```\nAvoid introducing new shapes like:\n```json\n{ \"success\": false, \"error\": { \"message\": \"…\", \"code\": \"…\" } }\n```\n\n### 2) Make `details` machine-actionable\nGood `details` examples:\n- `{ \"missing\": \"status\", \"usage\": \"cm outcome <status> <rules>\" }`\n- `{ \"file\": \"~/.cass-memory/playbook.yaml\" }`\n- `{ \"bulletId\": \"b-…\" }`\n\nAvoid putting long help text blobs in `details` (token-bloat + hard to parse).\n\n### 3) Don’t invent ad-hoc codes\nUse `ErrorCode` from `src/types.ts`. If a new code is genuinely needed, add it once to `ErrorCode` + `CMErrorCodeEnum`.\n\n## Acceptance criteria\n- [ ] Every required-arg validation failure returns JSON when `--json` is set (no human-only exits).\n- [ ] Every JSON error includes `success: false`, a stable `code`, and a short `error` message.\n- [ ] `src/cm.ts handleError()` uses the same JSON error schema as `printJsonError()`.\n- [ ] No remaining `process.exit(1)` in command modules that can execute in JSON mode **without** emitting JSON first.\n\n## Manual spot-checks\n- `cm playbook add --json` (missing args)\n- `cm outcome --json` (missing args)\n- `cm why does-not-exist --json`\n- `cm mark does-not-exist --json`","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T21:18:57.484204Z","updated_at":"2025-12-15T22:52:31.626702Z","closed_at":"2025-12-15T22:52:31.626702Z","close_reason":"Fixed all validation error exits to produce JSON in --json mode. Changed process.exit(1) to process.exitCode=1;return for better programmatic behavior. Used printJsonError() helper with ErrorCode for consistent output. Fixed 8 tests that were mocking process.exit.","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-9jgu","title":"[E2E] Team Workflow - Repo Setup and Collaboration","description":"## Target: E2E test simulating team usage\n\n### Scenario: Team Setting Up Shared Rules\n\n```\nLead creates git repo\nLead runs init --repo\nLead adds project rules to .cass/playbook.yaml\nLead commits and pushes\nDev clones repo\nDev runs cm doctor (sees repo rules)\nDev gets context (uses merged rules)\n```\n\n### Test Script:\n\n```typescript\ndescribe('E2E: Team Workflow', () => {\n  let repoDir: string;\n  let cloneDir: string;\n\n  it('step 1: lead creates repo with .cass/', async () => {\n    repoDir = await createTempGitRepo();\n    log('Created repo:', repoDir);\n    \n    const result = await runCLI(['init', '--repo', '--json'], { cwd: repoDir });\n    log('Init result:', result.stdout);\n    \n    expect(result.exitCode).toBe(0);\n    \n    // Add custom rule\n    await runCLI(['playbook', '--add', 'Always use TypeScript strict mode', '--scope', 'project:test'], { cwd: repoDir });\n    log('Added project rule');\n    \n    // Commit\n    await execAsync('git add .cass/ && git commit -m \"Add cass config\"', { cwd: repoDir });\n    log('Committed .cass/');\n  });\n\n  it('step 2: dev clones and sees rules', async () => {\n    cloneDir = await cloneRepo(repoDir);\n    log('Cloned to:', cloneDir);\n    \n    const doctor = await runCLI(['doctor', '--json'], { cwd: cloneDir });\n    log('Doctor result:', doctor.stdout);\n    \n    const output = JSON.parse(doctor.stdout);\n    expect(output.repoPlaybook).toBe(true);\n  });\n\n  it('step 3: context includes repo rules', async () => {\n    const context = await runCLI(['context', 'typescript config', '--json'], { cwd: cloneDir });\n    log('Context result:', context.stdout);\n    \n    const output = JSON.parse(context.stdout);\n    expect(output.bullets.some(b => b.content.includes('TypeScript strict'))).toBe(true);\n  });\n});\n```\n\n### Logging:\n- Full git command output\n- File contents at each step\n- Merge resolution details","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T01:31:12.508002Z","updated_at":"2025-12-14T01:41:37.199656Z","closed_at":"2025-12-14T01:41:37.199656Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-9jgu","depends_on_id":"cass_memory_system-ke2x","type":"blocks","created_at":"2026-01-21T09:28:50Z","created_by":"import"}]}
{"id":"cass_memory_system-9n7f","title":"[Tracking] ProcessedEntry type - Session processing record","description":"Type definition:\n```typescript\ninterface ProcessedEntry {\n  id: string;              // Unique entry ID (diary-{uuid})\n  sessionPath: string;     // Original session path (absolute or provider-specific)\n  processedAt: string;     // ISO 8601 timestamp\n  diaryId?: string;        // Generated diary ID (if diary was created)\n  deltasProposed: number;  // How many deltas reflector proposed\n  deltasApplied: number;   // How many passed validation + curation\n}\n```\n\nField details:\n- id: Unique identifier for this processing event\n- sessionPath: Original session file/database path\n  * Claude: ~/.claude/projects/{name}/session-{id}.jsonl\n  * Cursor: ~/.cursor/state.vscdb:session-{id}\n  * Aider: .aider.input.history\n- processedAt: When reflection happened (for audit trail)\n- diaryId: Optional diary entry ID (may not create diary if no insights)\n- deltasProposed: LLM suggested this many changes\n- deltasApplied: Only this many made it through validation\n\nUsed to populate ProcessedLog entries and track reflection effectiveness.","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:50:41.792015Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-9ni","title":"[Types] FeedbackEvent - Individual feedback with timestamp for decay","description":"## Overview\nDefine the FeedbackEvent type - the foundational data structure enabling time-based confidence decay. Each event represents a single instance of helpful/harmful feedback with timestamp.\n\n## Purpose\nThis type is CRITICAL for the confidence decay algorithm. Unlike simple counters, event-level tracking enables:\n1. Recency weighting - Recent feedback matters more than old feedback\n2. Decay calculation - Exponential decay based on time since event\n3. Trend analysis - Detect if rule is improving/degrading over time\n4. Provenance - Track which sessions triggered feedback\n\n## Schema Fields\n\n### Required\n- timestamp: string (ISO 8601 format) - When feedback occurred\n  - Example: '2025-12-07T14:30:00Z'\n  - Used for decay calculation: effectiveScore = baseScore * exp(-λ * age)\n  - λ = ln(2) / halfLifeDays\n\n### Optional\n- sessionPath: string | undefined - Which cass session triggered this feedback\n  - Links feedback to specific work session\n  - Enables session-level analysis (which sessions benefit from which rules)\n  - Example: '/path/to/cass/sessions/2025-12-07-auth-fix.jsonl'\n\n- reason: HarmfulReason | undefined - For harmful events only\n  - Structured categorization of WHY rule failed\n  - Enables pattern detection (e.g., 'mostly fails due to wrong_context')\n  - See HarmfulReason type for enum values\n\n- context: string | undefined - Free-form explanation\n  - Human-readable description of feedback\n  - Example: 'Rule helped avoid authentication bug by suggesting token validation'\n  - Used in audit reports and debugging\n\n## Usage Examples\n\n### Helpful Event\nconst helpfulEvent: FeedbackEvent = { timestamp: '2025-12-07T14:30:00Z', sessionPath: '/path/to/session.jsonl', context: 'Rule prevented duplicate API call' }\n\n### Harmful Event\nconst harmfulEvent: FeedbackEvent = { timestamp: '2025-12-06T10:15:00Z', sessionPath: '/path/to/session.jsonl', reason: 'caused_bug', context: 'Rule suggested wrong import path for new codebase structure' }\n\n## Integration Points\n- Stored in PlaybookBullet.helpfulEvents and PlaybookBullet.harmfulEvents arrays\n- Used by confidence decay algorithm in scoring/ranking\n- Analyzed in stats command for trend detection\n- Displayed in audit reports with timeline visualization\n\n## Acceptance Criteria\n- TypeScript interface with all 4 fields\n- timestamp is required, others optional\n- reason field typed as HarmfulReason enum\n- JSDoc explaining decay algorithm usage\n- Example usage in documentation","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:44:55.964583Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-9of6","title":"[UX] Degraded Mode & Fallback Messaging","description":"Why this matters\n- Users frequently run without some dependencies (cass not installed, cass index missing, offline embedding model not cached, no API key).\n- Premium UX means: 1) do the best possible work anyway, 2) avoid noisy errors for expected states, 3) provide exact next-step commands.\n\nScope\n- Normalize degraded-mode detection and messaging across commands.\n- Make fallbacks explicit in JSON output (so agents/tools can react).\n- Ensure degraded-mode warnings never pollute stdout JSON.","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-13T10:12:59.073928Z","updated_at":"2025-12-13T22:26:56.568595Z","closed_at":"2025-12-13T22:26:56.568595Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-9of6","depends_on_id":"cass_memory_system-q6uv","type":"parent-child","created_at":"2026-01-21T09:28:50Z","created_by":"import"}]}
{"id":"cass_memory_system-9qcu","title":"[CLI:validate] formatValidationReport - Human-readable output","description":"Format ValidationReport for human consumption.\n\nFunction signature:\n```typescript\nfunction formatValidationReport(\n  report: ValidationReport,\n  options: { verbose?: boolean }\n): string\n```\n\nValidationReport structure:\n```typescript\ninterface ValidationReport {\n  proposedRule: string;\n  verdict: 'accept' | 'reject' | 'unclear';\n  confidence: number;  // 0-1\n  evidence: Evidence[];\n  reason: string;\n  stats: {\n    sessionsScanned: number;\n    supporting: number;\n    contradicting: number;\n    neutral: number;\n  }\n}\n\ninterface Evidence {\n  sessionPath: string;\n  classification: 'supports' | 'contradicts' | 'neutral';\n  excerpt: string;\n  timestamp: string;\n}\n```\n\nOutput format:\n```\nPROPOSED RULE: \"{proposedRule}\"\n\nVERDICT: {✓ ACCEPT | ✗ REJECT | ? UNCLEAR} (confidence: {0.XX})\n\nEVIDENCE:\n- [{classification}] {sessionPath}\n  \"{excerpt}\"\n  {timestamp}\n{... more evidence ...}\n\nREASON: {reason}\n\nSTATISTICS:\n- Sessions scanned: {N}\n- Supporting: {N}\n- Contradicting: {N}\n- Neutral: {N}\n```\n\nFormatting rules:\n- Verdict symbols: ✓ (accept), ✗ (reject), ? (unclear)\n- Confidence as 2 decimal places\n- Truncate session paths to last 2 components if verbose=false\n- Show max 5 evidence items unless verbose=true\n- Color coding (if terminal supports):\n  - Green for accept/supports\n  - Red for reject/contradicts\n  - Yellow for unclear/neutral\n\nThis makes validation results easy to read and actionable.","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:50:44.421676Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-9qi4","title":"[ErrorHandling] setupGracefulShutdown - Handle SIGINT/SIGTERM","description":"Register signal handlers for graceful shutdown on interruption.\n\nFunction signature:\nfunction setupGracefulShutdown(): void\n\nImplementation:\nRegister handlers for:\n- SIGINT (Ctrl+C)\n- SIGTERM (system termination)\n\nCleanup actions on shutdown:\n- Release all acquired locks\n- Save any pending playbook changes\n- Flush buffers and close file handles\n- Log shutdown event\n- Exit with appropriate code (130 for SIGINT)\n\nExecution flow:\n1. User presses Ctrl+C\n2. SIGINT handler triggered\n3. Set global abort flag\n4. Perform cleanup\n5. Log 'Operation cancelled by user'\n6. Exit with code 130\n\nPrevents data corruption and orphaned locks on interruption.","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:51:56.274073Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-9rkn","title":"UX: support -j as shorthand for --json","description":"hasJsonFlag() treats -j as JSON mode, but CLI does not currently define -j anywhere, leading to confusing \"unknown option\" errors. Add -j alias for --json across CLI commands/subcommands and add a smoke test to prevent regression.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-16T08:23:58.665995Z","updated_at":"2025-12-16T08:28:03.849791Z","closed_at":"2025-12-16T08:28:03.849791Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-9rni","title":"[UX][trust] Repo config format parity (.cass/config.json vs .yaml)","description":"Problem\n- README says repo config is `.cass/config.json`, but `loadConfig()` only reads `.cass/config.yaml`.\n- This causes “it doesn’t work” moments during onboarding and undermines confidence.\n\nWhat to do\n- Support `.cass/config.json` and `.cass/config.yaml` (and `.yml`) for repo config.\n- Define precedence rules (recommended):\n  1) CLI flags\n  2) repo config (json preferred if both exist; or error with guidance)\n  3) global config\n  4) schema defaults\n- Keep the existing security restriction: repo config must not override sensitive paths (`cassPath`, `playbookPath`, `diaryDir`).\n\nDoc impact\n- Update README config section to reflect the supported formats + precedence.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-13T10:14:29.183548Z","updated_at":"2025-12-13T20:27:54.442173Z","closed_at":"2025-12-13T20:27:54.442173Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-9rni","depends_on_id":"cass_memory_system-c10q","type":"parent-child","created_at":"2026-01-21T09:28:50Z","created_by":"import"}]}
{"id":"cass_memory_system-9ruj","title":"Epic: Comprehensive Test Coverage","description":"# Epic: Comprehensive Test Coverage\n\n## Goal\nAchieve comprehensive test coverage for cass-memory with:\n1. **Unit tests** - Pure function tests WITHOUT mocks/fakes\n2. **Integration tests** - Cross-module tests with real dependencies\n3. **E2E tests** - Full CLI tests with detailed logging\n\n## Philosophy: No Mocks Where Possible\n- Test REAL behavior, not mocked behavior\n- Use actual file I/O with temp directories\n- Use actual YAML parsing/serialization\n- Only mock external services (LLM APIs) when absolutely necessary\n- Prefer integration tests over unit tests with mocks\n\n## Structure\n1. Test Infrastructure (fixtures, helpers, logging)\n2. Unit Tests - Per-module (scoring, playbook, config, etc.)\n3. Integration Tests - Cross-module (curator pipeline, reflect pipeline)\n4. E2E Tests - Full CLI commands with logging\n\n## Success Criteria\n- All exported functions have tests\n- All CLI commands have e2e tests\n- Test output includes detailed logging for debugging\n- No flaky tests (deterministic)\n- Tests run in <30 seconds total","status":"tombstone","priority":0,"issue_type":"epic","created_at":"2025-12-08T01:21:29.725254Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"epic","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-9s5","title":"[Reflector] validateReflectorOutput - Schema validation","description":"function validateReflectorOutput(output: unknown): PlaybookDelta[]\n\n- Parse with ReflectorOutputSchema\n- Filter out malformed deltas\n- Ensure bulletIds exist for helpful/harmful/replace/deprecate\n- Log warnings for invalid deltas\n- Return valid deltas only\n\nVALIDATION STEPS:\n1. Parse JSON (if string)\n2. Validate against Zod schema\n3. For each delta:\n   - Verify required fields present\n   - For helpful/harmful/replace/deprecate: verify bulletId exists\n   - For add: verify content and category\n   - For replace: verify newContent\n4. Collect valid deltas\n5. Log warnings for invalid ones\n6. Return valid deltas\n\nSCHEMA (Zod):\n```typescript\nconst PlaybookDeltaSchema = z.discriminatedUnion('type', [\n  z.object({ type: z.literal('add'), content: z.string(), category: z.string() }),\n  z.object({ type: z.literal('helpful'), bulletId: z.string() }),\n  z.object({ type: z.literal('harmful'), bulletId: z.string() }),\n  z.object({ type: z.literal('replace'), bulletId: z.string(), newContent: z.string() }),\n  z.object({ type: z.literal('deprecate'), bulletId: z.string() })\n])\n```\n\nERROR HANDLING:\n- Malformed JSON: log error, return []\n- Invalid delta: log warning, skip delta\n- Missing bulletId: log error, skip delta\n\nUsed in reflectOnSession()","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:45:01.329012Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-9sjh","title":"Add unit tests for onboard-state.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T05:17:28.221329Z","updated_at":"2025-12-16T05:26:02.576812Z","closed_at":"2025-12-16T05:26:02.576812Z","close_reason":"Added 22 unit tests covering: createEmptyState, loadOnboardState (missing/valid/invalid files), saveOnboardState (stats recompute, timestamp update), isSessionProcessed, markSessionProcessed, resetOnboardState, getOnboardProgress, filterUnprocessedSessions","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-9sp","title":"[Diary] generateDiary - Main diary generation","description":"Main diary generation function that orchestrates the entire diary creation process.\n\nFunction Signature:\nasync function generateDiary(sessionPath: string, config: Config): Promise<DiaryEntry>\n\nProcess Flow:\n1. Export session content via cass command\n2. Sanitize content to remove secrets/sensitive data\n3. Extract metadata (agent, workspace) from session path\n4. Use LLM extraction to get structured diary fields\n5. Query cass for related sessions (cross-agent enrichment)\n6. Assemble complete DiaryEntry object\n7. Save diary to diary directory\n8. Return the generated diary\n\nKey Features:\n- Central orchestration of all diary generation steps\n- Error handling with graceful degradation\n- Cross-agent session discovery for context\n- Persistent storage in diary directory\n\nDependencies:\n- exportSessionSafe for content retrieval\n- extractSessionMetadata for path parsing\n- extractDiarySafe for LLM extraction\n- enrichWithRelatedSessions for cross-agent context\n- saveDiaryEntry for persistence\n\nOutput:\nReturns complete DiaryEntry with all fields populated, including related sessions and metadata.","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:44:41.674408Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-9stx","title":"[Unit] scoring.ts - Decay Algorithm & Score Computation","description":"## Target: src/scoring.ts (157 LOC) - ZERO CURRENT COVERAGE\n\n### Functions to Test:\n\n1. **computeDecayedScore(feedbackEvents, options)** - Core decay algorithm\n   - Single helpful event → positive score\n   - Single harmful event → negative score\n   - Multiple events → aggregated score\n   - Old events decay more than recent events\n   - 90-day half-life verification\n   - Empty events array → 0 or baseline\n   - Events at exact half-life boundary\n   - Events from future (edge case)\n\n2. **calculateHalfLife(event, baseHalfLife)** - Half-life calculation\n   - Default 90-day half-life\n   - Custom half-life values\n   - Boundary conditions\n\n3. **scoreWithContext(bullet, queryContext)** - Contextual scoring\n   - Scope match bonus\n   - Keyword overlap bonus\n   - Recency bonus\n   - Combined factors\n   - Missing context gracefully handled\n\n4. **rankBullets(bullets, query, options)** - Bullet ranking\n   - Sort by score descending\n   - Ties broken consistently\n   - Empty array → empty array\n   - Single bullet → single result\n   - Limit parameter respected\n\n5. **normalizeScores(bullets)** - Score normalization\n   - Scores in 0-1 range\n   - Max score becomes 1\n   - Min score becomes 0\n   - All same scores → all equal\n\n### Mathematical Properties to Verify:\n- Decay is exponential, not linear\n- Score(t) = Score(0) * 0.5^(t/halfLife)\n- Helpful and harmful don't simply cancel\n- Temporal ordering affects result\n\n### Test Data Patterns:\n- Use fixed timestamps, not Date.now()\n- Create event generators for various scenarios\n- Verify floating-point edge cases","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-08T01:27:47.579668Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-9tv6","title":"[UX][output] Polish reflect UX (progress + dry-run output)","description":"Problem\n- `cm reflect` is a long-running operation that benefits from a premium progress narrative (what it’s doing, how many sessions, what changed).\n- `--dry-run` currently prints raw JSON even in human mode, which is jarring and hard to read.\n\nWhat to do\n- Add clear progress reporting for reflect (without spamming):\n  - sessions discovered / processed\n  - per-scope summary (global/repo)\n  - error summary + next steps\n- Improve `--dry-run` human output: render deltas using the output design system (with a JSON option preserved).\n\nConstraints\n- Keep `--json` output stable and machine-readable.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-13T10:32:50.954879Z","updated_at":"2025-12-14T00:12:20.081275Z","closed_at":"2025-12-14T00:12:20.081275Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-9tv6","depends_on_id":"cass_memory_system-3tds","type":"parent-child","created_at":"2026-01-21T09:28:50Z","created_by":"import"},{"issue_id":"cass_memory_system-9tv6","depends_on_id":"cass_memory_system-r1hq","type":"blocks","created_at":"2026-01-21T09:28:50Z","created_by":"import"}]}
{"id":"cass_memory_system-9ui","title":"[Cass] cassAvailable - Check if cass is installed and working","description":"Implement cassAvailable() to check if cass CLI is installed and functional.\n\n## Signature\n```typescript\nfunction cassAvailable(cassPath = \"cass\"): boolean\n```\n\n## CLI Command\n`cass health`\n\n## Implementation\n- Use execSync() with 200ms timeout\n- Set stdio: \"pipe\" to suppress output\n- Return true if exit code 0\n- Return false on any error (timeout, non-zero exit, not found)\n- Catch and suppress all exceptions\n\n## Error Handling\n- No exceptions thrown - always returns boolean\n- Logs error at debug level only\n- Safe to call frequently without performance impact\n\n## Usage\nCalled before any cass operation to fail fast:\n```typescript\nif (!cassAvailable()) {\n  console.error(\"cass CLI not found\");\n  return null;\n}\n```\n\n## Exit Codes\n- 0: cass is healthy and available\n- Any other: cass unavailable or not working","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:44:53.647353Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-9xoi","title":"[Bug][reliability] Stabilize CLI robustness (cass parsing, warn(), no process.exit)","description":"# Context\n\nWe have a few CLI-facing reliability footguns that can cause hangs, confusing output parsing, or hard process exits when these modules are used programmatically (e.g., MCP server / tests).\n\n## Problems\n- `cassAvailable()` can hang indefinitely if the `cass` binary is present but unresponsive.\n- `cassSearch()` parsing is brittle when `cass` prints logs/warnings before JSON, returns NDJSON, or embeds JSON after a log prefix (e.g., `[INFO] ...`).\n- LLM/key validation and retry warnings were using raw `console.warn`, producing inconsistent formatting and making tests brittle.\n- Some command modules call `process.exit(1)` on validation errors, which is hostile to programmatic callers/tests.\n\n## Goals\n- Never hang on `cass --version`.\n- Robustly parse `cass` output across: JSON array/object, leading logs, NDJSON, and inline log prefixes.\n- Centralize warning output through the shared logger helper (`warn()`), keeping consistent CLI prefixing.\n- Prefer throwing errors over `process.exit()` inside command modules.\n\n## Acceptance Criteria\n- [ ] `cassAvailable()` uses a short timeout and treats ENOENT quietly.\n- [ ] `cassSearch()` parsing handles: leading log lines + JSON, NDJSON, and log-prefix + JSON (covered by tests).\n- [ ] LLM warnings/retry logs go through `warn()` (not raw `console.warn`).\n- [ ] `auditCommand()` / `validateCommand()` throw instead of exiting.\n- [ ] `bun run typecheck` and `bun test` pass.\n","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-14T03:09:39.098905Z","updated_at":"2025-12-14T03:16:37.440297Z","closed_at":"2025-12-14T03:16:37.440297Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-a0k1","title":"[CLI:playbook] stats - Playbook statistics","description":"Display playbook health and statistics.\n\nCommand signature:\n```bash\ncass-memory playbook stats [--json]\n```\n\nImplementation:\n1. Load playbook\n2. Calculate statistics:\n   - Total bullets by scope (global/workspace)\n   - Distribution by maturity\n   - Distribution by category\n   - Top performers (highest scores)\n   - At-risk bullets (low scores, old age)\n   - Deprecated count\n   - Time-based metrics\n\nOutput format:\n```\nPLAYBOOK STATISTICS\n\nOverview:\n  Total bullets: 42\n  Global: 35\n  Workspace-scoped: 7\n  Deprecated: 3\n\nMaturity Distribution:\n  Proven: 5 (12%)\n  Accepted: 18 (43%)\n  Candidates: 19 (45%)\n\nCategory Distribution:\n  best-practice: 15\n  tools: 12\n  workflow: 8\n  pitfall: 5\n  patterns: 2\n\nTop Performers (highest scores):\n  1. b-abc123 (0.95) - Always run tests before committing\n  2. b-def456 (0.92) - Use TypeScript strict mode\n  3. b-ghi789 (0.88) - Prefer composition over inheritance\n\nAt Risk (need attention):\n  1. b-jkl012 (0.32, 120 days old) - Use jQuery for DOM manipulation\n     → Low score, may need deprecation\n  2. b-mno345 (0.41, 90 days old) - Avoid async/await\n     → Contradicted by recent evidence\n\nHealth Score: 78/100\n  ✓ Good maturity distribution\n  ✓ Active curation (last update: 2 days ago)\n  ⚠ 2 bullets at risk\n  ✓ No duplicate content detected\n```\n\nStatistics calculated:\n- Maturity distribution (percentages)\n- Category breakdown\n- Top 5 highest scores\n- Bottom 5 scores with age (at-risk)\n- Overall health score (0-100)\n- Last update timestamp\n- Duplicates detection (similar content)\n\nHealth score factors:\n- Maturity pyramid (more proven than candidates = good)\n- Recent updates (active curation)\n- Low at-risk count\n- No duplicates\n- Balanced category distribution\n\nThis provides quick playbook health check and actionable insights.","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:52:56.170391Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-a2y3","title":"[Semantic] findSemanticDuplicates - Embedding-based dedup","description":"Detect semantic duplicates for merge candidates.\n\nImplementation:\n```typescript\nasync function findSemanticDuplicates(\n  bullets: PlaybookBullet[],\n  threshold: number = 0.85\n): Promise<{ pair: [string, string]; similarity: number }[]>\n```\n\nProcess:\n1. Ensure all bullets have embeddings\n2. Compare all pairs (O(n²) but n is small)\n3. For each pair:\n   - Calculate cosine similarity\n   - If > threshold, record as duplicate\n4. Return pairs sorted by similarity\n\nUse cases:\n- Stats command: Show merge candidates\n- Playbook cleanup: Identify duplicates\n- Quality assurance: Find redundant rules\n\nExample output:\n```typescript\n[\n  {\n    pair: [\"b-123\", \"b-456\"],\n    similarity: 0.94,\n    bullets: [\n      \"Use async/await for all DB calls\",\n      \"Always use async/await when calling database\"\n    ]\n  },\n  {\n    pair: [\"b-789\", \"b-012\"],\n    similarity: 0.87,\n    bullets: [\n      \"Mock external APIs in tests\",\n      \"Use mocks for third-party services in unit tests\"\n    ]\n  }\n]\n```\n\nThreshold selection:\n- 0.95+: Almost identical (definite merge)\n- 0.85-0.95: Very similar (probable merge)\n- 0.75-0.85: Similar (review for merge)\n- <0.75: Different enough to keep\n\nPerformance:\n- 100 bullets: ~500ms (4950 comparisons)\n- 500 bullets: ~12s (124750 comparisons)\n- Could optimize with clustering (future)\n\nPresented in stats command as:\n\"3 merge candidate pairs detected\"","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-07T21:49:47.408942Z","updated_at":"2025-12-13T20:11:28.335926Z","closed_at":"2025-12-13T20:11:28.335926Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-a3y4","title":"[Semantic] EmbeddingCache type - Cached embeddings storage","description":"Cache structure for storing pre-computed embeddings.\n\nFile: ~/.cass-memory/embeddings/bullets.json\n\nStructure:\n```typescript\ninterface EmbeddingCache {\n  version: string;           // Cache format version\n  model: string;             // Model used (for invalidation)\n  bullets: Record<string, {\n    contentHash: string;     // Hash of content when computed\n    embedding: number[];     // 384-dimensional vector\n    computedAt: string;      // ISO timestamp\n  }>;\n}\n```\n\nInvalidation logic:\n- If content hash changed → recompute\n- If model changed → recompute all\n- If cache version changed → rebuild cache\n\nCache benefits:\n- Embeddings computed once\n- Startup time: ~50ms vs ~300ms\n- Model stays loaded in memory\n\nCache size:\n- 100 bullets × 384 dims × 8 bytes = ~300KB\n- Negligible disk space\n- Fast to load/save\n\nExample:\n```json\n{\n  \"version\": \"1.0\",\n  \"model\": \"Xenova/all-MiniLM-L6-v2\",\n  \"bullets\": {\n    \"b-abc123\": {\n      \"contentHash\": \"sha256:...\",\n      \"embedding\": [0.123, -0.456, ...],\n      \"computedAt\": \"2025-12-07T10:00:00Z\"\n    }\n  }\n}\n```","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-07T21:49:32.970005Z","updated_at":"2025-12-13T09:31:43.555698Z","closed_at":"2025-12-13T09:31:43.555698Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-a4g","title":"[Utils] formatRelativeTime - Human-readable relative time","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:45:11.043941Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-afjz","title":"[Design] Low-Friction Feedback Mechanism","description":"# Design: Inline Feedback Comment Format\n\n## Purpose\nDecide on the EXACT format for inline feedback comments that agents can use.\nThis unblocks y1d4 (implementation) with a clear specification.\n\n## Decision Needed\nWhat regex pattern should we parse from session logs?\n\n## Proposed Format\n\\`\\`\\`\n// [cass: helpful b-xyz123]\n// [cass: helpful b-xyz123] reason text here\n// [cass: harmful b-abc456] this advice didn't work\n# [cass: helpful b-xyz] (support # for non-JS)\n\\`\\`\\`\n\n## Regex Pattern\n\\`\\`\\`\n\\[cass:\\s*(helpful|harmful)\\s+(b-[a-z0-9]+)\\](?:\\s+(.+))?\n\\`\\`\\`\n\n## Questions to Decide\n1. Is this format clear enough for agents to use?\n2. Should we support other comment styles (/* */, --, etc.)?\n3. How do we handle multi-line reasons?\n4. What about false positives in code that contains literal \\\"[cass:\\\"?\n\n## Deliverable\n- Documented format specification\n- Regex pattern for implementation\n- Edge case handling rules\n\n## NO BLOCKERS\nThis task can start immediately. The format decision doesn't depend on other analysis.","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-08T17:47:48.819946Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-ai52","title":"[Test] Infrastructure: Fixtures, Helpers, Logging","description":"# Test Infrastructure Epic\n\n## Overview\nBuild foundational test infrastructure that enables comprehensive, readable tests with excellent debugging capabilities.\n\n## Components\n\n### 1. Test Fixtures (test/fixtures/)\n- Sample playbook YAML files (empty, minimal, complex)\n- Sample diary entries (success, failure, mixed)\n- Sample session exports (various agents)\n- Sample config files (default, custom)\n\n### 2. Test Helpers (test/helpers/)\n- createTempDir() - Create isolated temp directory for test\n- cleanupTempDir() - Remove temp directory after test\n- createTestPlaybook() - Generate playbook with configurable bullets\n- createTestDiary() - Generate diary entry with configurable fields\n- createTestConfig() - Generate config with sensible defaults\n- assertBulletMatches() - Deep equality for bullet comparison\n\n### 3. Test Logger (test/helpers/logger.ts)\n- Structured logging during test execution\n- Log levels: DEBUG, INFO, WARN, ERROR\n- Timestamp each log entry\n- Capture and display on test failure\n- Option to write to file for CI analysis\n\n### 4. Test Reporter\n- Custom Bun test reporter for detailed output\n- Show test duration per test\n- Show file I/O operations\n- Highlight slow tests (>100ms)\n\n## Acceptance Criteria\n- [ ] Fixtures directory with sample data\n- [ ] Helper functions exported from test/helpers/index.ts\n- [ ] Logger captures all test activity\n- [ ] Tests can opt-in to detailed logging\n- [ ] CI-friendly output format","status":"tombstone","priority":0,"issue_type":"epic","created_at":"2025-12-08T01:21:54.216703Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"epic","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-ajkn","title":"[Analysis] Audit Current Command Set for Agent Usability","description":"# Audit Current Command Set for Agent Usability\n\n## Purpose\nReview every `cm` command and categorize it by who should use it and when.\n\n## Current Commands (from README)\n- `cm init` - Initialize configuration\n- `cm context <task>` - Get relevant rules + history\n- `cm mark <rule> <feedback>` - Record helpful/harmful\n- `cm playbook` - List, add, remove rules\n- `cm stats` - Playbook health metrics\n- `cm doctor` - System health check\n- `cm reflect` - Extract rules from sessions\n- `cm audit` - Check for rule violations\n- `cm project` - Export playbook formats\n- `cm serve` - MCP server mode\n\n## Categorization Framework\n\n**Agent-Essential** (agents call these directly, frequently):\n- Must be dead simple\n- Output must be LLM-optimized\n- Should \"just work\" with minimal flags\n\n**Agent-Occasional** (agents might call, but not routine):\n- Still needs good ergonomics\n- Can have more options\n\n**Automated** (should be run by hooks, not agents):\n- Agents shouldn't need to remember to call these\n- Background processing\n\n**Human-Only** (operators use for setup/monitoring):\n- Can be more complex\n- Rich human-readable output is fine\n\n## Deliverables\n- [ ] Categorized command list with justification\n- [ ] Recommendations for command changes (simplify, deprecate, merge)\n- [ ] List of commands that need output format improvements","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-08T17:46:31.349758Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-alcn","title":"[CLI:reflect] updateProcessedLog - Track processed sessions","description":"Record processed sessions to prevent reprocessing.\n\nFunction signature:\n```typescript\nasync function updateProcessedLog(\n  log: ProcessedLog,\n  entries: ProcessedEntry[]\n): Promise<void>\n```\n\nImplementation:\n1. Load existing processed.log:\n   - File location: ${memoryDir}/processed.log\n   - Tab-delimited format\n   - Create if doesn't exist\n\n2. Add new entries:\n   - Each entry represents one processed session\n   - Format: {id}\\t{timestamp}\\t{sessionPath}\\t{deltasProposed}\\t{deltasApplied}\\n\n   - Example: sess-abc123\\t2025-01-15T10:30:00Z\\t/Users/x/.claude/sessions/001.jsonl\\t5\\t3\n\n3. Write to disk:\n   - Append mode (don't overwrite)\n   - Atomic write (temp file + rename)\n   - Ensure proper permissions\n\nProcessedEntry type:\n```typescript\ninterface ProcessedEntry {\n  id: string;              // session ID\n  timestamp: string;       // ISO 8601\n  sessionPath: string;     // absolute path\n  deltasProposed: number;  // from reflector\n  deltasApplied: number;   // from curator\n}\n```\n\nProcessedLog class:\n```typescript\nclass ProcessedLog {\n  private entries: Map<string, ProcessedEntry>;\n  \n  load(): Promise<void>\n  has(sessionPath: string): boolean\n  add(entry: ProcessedEntry): void\n  save(): Promise<void>\n}\n```\n\nThe log prevents duplicate processing and provides audit trail.","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:50:18.282321Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-ank","title":"[Diary] loadDiaryEntry - Read from disk","description":"Read and validate diary entry from disk.\n\nFunction Signature:\nasync function loadDiaryEntry(diaryPath: string): Promise<DiaryEntry>\n\nProcess:\n1. Verify file exists at diaryPath\n2. Read file contents as UTF-8 string\n3. Parse JSON string to object\n4. Validate against DiaryEntrySchema using Zod\n5. Return validated DiaryEntry\n\nValidation Features:\n- Type checking for all fields\n- Required field validation\n- Date format validation for timestamp\n- Array content validation\n- Status enum validation (success/failure/mixed)\n\nError Handling:\n- FileNotFoundError if path doesn't exist\n- JSONParseError if invalid JSON\n- SchemaValidationError if missing/invalid fields\n- Detailed error messages for debugging\n\nSchema Migration:\n- If old diary version detected, apply migration\n- Add default values for new optional fields\n- Preserve backward compatibility\n\nKey Features:\n- Full schema validation ensures type safety\n- Detailed validation errors for debugging\n- Migration support for schema evolution\n- UTF-8 encoding handling\n\nUse Cases:\n- Loading diary for evidence correlation\n- Reading diaries for stats computation\n- Fetching diary for display in UI\n- Validating diary integrity\n\nOutput:\nReturns fully validated DiaryEntry object ready for use.","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:46:09.388329Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-anqj","title":"[Unit] utils.ts - Pure Function Tests (Part 1: Path & File Utilities)","description":"# [Unit] utils.ts - Path & File Utilities\n\n## Functions to Test (test/utils.path.test.ts)\n\n### expandPath(p: string)\n- [ ] Expand ~ to home directory\n- [ ] Expand relative paths to absolute\n- [ ] Handle already-absolute paths (no change)\n- [ ] Handle empty string\n- [ ] Handle paths with spaces\n- [ ] Handle Windows-style paths (if applicable)\n\n### resolveRepoDir(startDir?: string)\n- [ ] Find .git directory walking up\n- [ ] Return null when not in git repo\n- [ ] Handle nested git repos\n- [ ] Handle startDir parameter\n\n### resolveGlobalDir()\n- [ ] Return ~/.cass-memory\n- [ ] Expand ~ correctly\n\n### ensureDir(dir: string)\n- [ ] Create directory if not exists\n- [ ] No-op if already exists\n- [ ] Create nested directories\n- [ ] Handle permission errors gracefully\n\n### fileExists(path: string)\n- [ ] Return true for existing file\n- [ ] Return false for non-existent\n- [ ] Return false for directory\n- [ ] Handle permission errors\n\n### atomicWrite(filePath: string, content: string)\n- [ ] Write to temp then rename\n- [ ] Set correct permissions (0o600)\n- [ ] Clean up temp on failure\n- [ ] Handle directory not exists\n\n## Test Approach\n- Use real file system with temp directories\n- beforeAll: create temp dir\n- afterAll: cleanup temp dir\n- Each test isolated to subdirectory\n\n## Expected: 25+ test cases","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-08T01:24:22.127287Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-anri","title":"Reflect writes to repo playbook when present","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-08T03:17:51.718977Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-ap27","title":"Task: Add warning icon to ICONS table and fix hardcoded emoji in onboard.ts","description":"Add warning to ICONS table in output.ts, then replace hardcoded emoji in onboard.ts:522 with icon(warning). This ensures CASS_MEMORY_NO_EMOJI is respected.","notes":"Closed as duplicate/superseded by cass_memory_system-shs3 (more detailed + accurate). Note: the warning icon already exists in src/output.ts; the remaining work is to remove the hardcoded ⚠ in src/commands/onboard.ts and (optionally) add an ASCII fallback for warning.","status":"tombstone","priority":3,"issue_type":"task","created_at":"2025-12-15T21:18:42.766160Z","updated_at":"2025-12-15T22:05:07.951952Z","closed_at":"2025-12-15T22:05:07.951952Z","source_repo":".","deleted_at":"2025-12-15T22:05:07.951952Z","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-apt","title":"[Cass] cassSearch - Execute cass search with options","description":"Implement cassSearch() to execute cass search with comprehensive options.\n\n## Signature\n```typescript\ninterface CassSearchOptions {\n  limit?: number;\n  days?: number;\n  agent?: string;\n  workspace?: string;\n  fields?: string;\n  maxTokens?: number;\n  highlight?: boolean;\n  timeout?: number;\n}\n\ninterface CassHit {\n  sessionPath: string;\n  lineNumber: number;\n  content: string;\n  timestamp?: string;\n  score?: number;\n}\n\nasync function cassSearch(\n  query: string, \n  options: CassSearchOptions = {},\n  cassPath = \"cass\"\n): Promise<CassHit[]>\n```\n\n## CLI Command\n`cass search \"{query}\" --robot [--limit N] [--days N] [--agent A] [--workspace W] [--fields F] [--max-tokens N] [--highlight] [--timeout N]`\n\n## Implementation\n- Build command with all provided options\n- Use execFile() with maxBuffer: 50MB for large results\n- Parse JSON output from --robot flag\n- Return array of CassHit objects\n\n## Error Handling\nCheck exit code and handle intelligently:\n- Exit 0: Success, parse and return hits\n- Exit 3: Index missing - rebuild index, then retry once\n- Exit 10: Timeout - reduce limit by 50%, retry once\n- Exit 4: Not found - return empty array\n- Other errors: Log and return empty array\n\n## Options Details\n- limit: Max hits to return (default: 10)\n- days: Only search last N days\n- agent: Filter by agent name (e.g., \"claude-code\")\n- workspace: Filter by workspace path\n- fields: Comma-separated fields to search\n- maxTokens: Truncate results to N tokens\n- highlight: Include highlighting markers in results\n- timeout: Command timeout in seconds\n\n## Usage\n```typescript\nconst hits = await cassSearch(\"bug fix\", { \n  limit: 20, \n  days: 7, \n  agent: \"claude-code\" \n});\n```","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:44:57.153732Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-ar2","title":"[Curator] invertToAntiPattern - Convert harmful rule to pitfall","description":"Convert a harmful bullet into an anti-pattern (learning from mistakes).\n\nSignature:\nfunction invertToAntiPattern(bullet: PlaybookBullet): PlaybookBullet\n\nKEY INNOVATION: Instead of deleting harmful rules, INVERT them to preserve learning.\n\nProcess:\n1. Create new bullet with inverted semantics:\n   - content: Prefix with 'AVOID: ' or 'DON\\'T: '\n   - Example: 'Use any type' → 'AVOID: Using any type without explicit reason'\n   \n2. Set bullet fields:\n   - type: 'anti-pattern'\n   - kind: 'anti_pattern'\n   - category: same as original\n   - maturity: 'candidate' (starts fresh)\n   - state: 'active'\n   \n3. Preserve provenance:\n   - source: copy from original\n   - originalId: link back to harmful bullet\n   - createdAt: current timestamp\n   - derivedFrom: original bullet ID\n   \n4. Reset feedback (fresh start):\n   - helpfulCount: 0\n   - harmfulCount: 0\n   - helpfulEvents: []\n   - harmfulEvents: []\n   \n5. Return new anti-pattern bullet\n\nWhy inversion matters:\n- Preserves WHAT NOT TO DO\n- Prevents future developers from making same mistake\n- Converts negative experience into positive guidance\n- Maintains complete learning history\n\nExample transformation:\nOriginal (harmful): 'Always use any type for flexibility'\nAnti-pattern: 'AVOID: Using any type without explicit reason. Prefer specific types for type safety.'\n\nThe anti-pattern must earn trust like any other candidate bullet.","status":"tombstone","priority":3,"issue_type":"task","created_at":"2025-12-07T21:45:04.707658Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-aray","title":"Harden loadUsageEvents against partial JSONL writes","description":"loadUsageEvents() reads usage.jsonl without taking the writer lock; if it reads mid-append, the last event line can be truncated and gets skipped. Detect malformed trailing line and re-read once under withLock().","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-16T06:34:47.526845Z","updated_at":"2025-12-16T06:37:04.771668Z","closed_at":"2025-12-16T06:37:04.771668Z","close_reason":"loadUsageEvents detects truncated trailing JSONL line and re-reads once under withLock; added regression test","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-b5q","title":"[Security] compileExtraPatterns - User pattern compilation","description":"Implement compileExtraPatterns() to convert user pattern strings to RegExp objects.\n\nFunction signature:\n```typescript\nfunction compileExtraPatterns(patterns: string[]): RegExp[]\n```\n\nImplementation requirements:\n1. Parse string patterns into RegExp objects\n2. Add 'gi' flags automatically (global, case-insensitive)\n3. Catch and warn on invalid regex syntax\n4. Return only valid patterns (skip invalid ones)\n\nError handling:\n- Log warning for invalid patterns: \"[sanitize] Invalid regex pattern: <pattern>\"\n- Continue processing remaining patterns\n- Never throw - return partial results\n\nExample:\n```typescript\nconst patterns = [\n  \"INTERNAL_[A-Z_]+_KEY\",\n  \"[invalid(regex\",  // syntax error\n  \"MY_SECRET_\\\\w+\"\n];\nconst compiled = compileExtraPatterns(patterns);\n// Returns: [/INTERNAL_[A-Z_]+_KEY/gi, /MY_SECRET_\\w+/gi]\n// Logs: \"[sanitize] Invalid regex pattern: [invalid(regex\"\n```\n\nCalled at startup to pre-compile user patterns from config.\n\nPriority: 0 (Security Critical - P12)","notes":"Implemented compileExtraPatterns in src/sanitize.ts with gi flags, error handling, and warnings","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:44:51.253402Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-b82i","title":"E2E Tests Epic - CLI command end-to-end tests","description":"End-to-end tests for all CLI commands.\nTests complete user workflows from command invocation to output.\nReal subprocess execution with bun run.\nReal file I/O and realistic fixture directories.\nDetailed structured logging for debugging test failures.\nCommands to test: context, mark, playbook, stats, doctor, reflect, init","status":"tombstone","priority":2,"issue_type":"epic","created_at":"2025-12-08T01:26:46.908302Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"epic","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-b8bp","title":"[Test] Fixtures: Sample diary entries","description":"Create test/fixtures/diaries/ with:\n\n1. success-diary.yaml - Successful session with accomplishments\n2. failure-diary.yaml - Failed session with challenges\n3. mixed-diary.yaml - Session with mixed outcomes\n4. rich-diary.yaml - All fields populated (relatedSessions, searchAnchors, etc.)\n5. minimal-diary.yaml - Only required fields\n6. multi-agent-diary.yaml - Related sessions from different agents\n\nEach should:\n- Be valid against DiaryEntrySchema\n- Have realistic timestamps\n- Include realistic session paths\n- Cover the 5 structured content arrays (accomplishments, decisions, challenges, preferences, keyLearnings)","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-08T01:22:16.201911Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-b96","title":"[Generator] generateSuggestedQueries - Follow-up search suggestions","description":"Generate human-readable cass search suggestions for follow-up investigation.\n\nSIGNATURE:\nfunction generateSuggestedQueries(task: string, keywords: string[]): string[]\n\nPURPOSE:\nProvide ready-to-run cass commands that the user can execute to dig deeper if the provided context isn't sufficient. Helps with iterative investigation.\n\nOUTPUT:\nArray of 3-5 formatted cass command strings\n\nFORMAT:\n'cass search \"{query}\" --days {days} [--agent {agent}]'\n\nEXAMPLE:\nTask: 'Fix authentication timeout bug'\nKeywords: ['authentication', 'timeout', 'token', 'session', 'jwt']\n\nOutput: [\n  'cass search \"authentication timeout\" --days 30',\n  'cass search \"token refresh\" --days 60',\n  'cass search \"session expiry\" --agent claude',\n  'cass search \"jwt validation error\" --days 90'\n]\n\nQUERY GENERATION STRATEGY:\n1. Use top 2-3 keyword combinations from keywords array\n2. Add task-derived queries (extract noun phrases)\n3. Vary --days parameter (30, 60, 90) for different time scopes\n4. Include --agent filter if config.preferredAgent is set\n5. Prioritize error/problem-oriented queries ('error', 'fix', 'bug')\n\nIMPLEMENTATION NOTES:\n- Escape quotes in query strings\n- Limit to 5 suggestions (avoid overwhelming)\n- Include at least one broad query (first keyword only)\n- Include at least one specific query (multi-keyword phrase)\n\nUSE CASE:\nUser receives context but wants to explore more:\n'The context you provided is helpful, but I want to see more examples of token refresh handling.'\n→ They can run: cass search \"token refresh\" --days 60\n\nINTEGRATION:\nThese queries appear at the end of markdown output under '### Dig Deeper' section\nAlso included in JSON output for programmatic access\n\nALTERNATIVE NAMES:\n- 'Suggested Searches'\n- 'Follow-up Queries'\n- 'Explore More'","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:45:00.569423Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-b96v","title":"[CLI] mark command - Record bullet feedback","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:51:41.369847Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-b9dr","title":"Document HarmfulReason enum values in mark --help","description":"## Context\n\nThe `cm mark <id> --harmful --reason <text>` command accepts specific enum values for the reason parameter, but these aren't documented in the --help output.\n\n## Current State\n\n```\n.option(\"--reason <text>\", \"Reason for feedback\")\n```\n\nThe valid values are defined in `src/types.ts` as `HarmfulReasonEnum`:\n- `caused_bug` - The rule caused a bug to be introduced\n- `wasted_time` - Following the rule wasted time without benefit\n- `contradicted_requirements` - The rule contradicted actual requirements\n- `wrong_context` - The rule was correct but wrong for this context\n- `outdated` - The rule is no longer accurate/relevant\n- `other` - Freeform reason (fallback)\n\nIf an agent passes an unrecognized value, it silently falls back to \"other\", losing semantic information.\n\n## Proposed Change\n\nUpdate `src/cm.ts` line 79:\n```typescript\n.option(\"--reason <text>\", \"Reason: caused_bug|wasted_time|contradicted_requirements|wrong_context|outdated|other\")\n```\n\n## Why This Matters\n\n- Agents can provide more precise feedback\n- Aggregated feedback data is more useful when reasons are categorized\n- No breaking changes - purely additive documentation\n\n## Implementation\n\n1. Edit src/cm.ts line 79 to include enum values in description\n2. Optionally: add validation that warns if unrecognized value is passed (currently silent)\n\n## Acceptance Criteria\n\n- [ ] `cm mark --help` shows valid reason values\n- [ ] Documentation matches actual enum in types.ts\n\n## Effort Estimate\n\n~5 minutes - trivial string change\n\n## Part of Epic\n\ncass_memory_system-ulu7 (Agent UX Improvements)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T17:16:36.196814Z","updated_at":"2025-12-15T17:44:27.007596Z","closed_at":"2025-12-15T17:44:27.007596Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-bb9","title":"[Cass] findUnprocessedSessions - Get sessions not yet reflected on","description":"Implement findUnprocessedSessions() to get sessions not yet reflected on.\n\n## Signature\n```typescript\ninterface ProcessedLog {\n  processedSessions: Set<string>;\n  lastProcessedAt?: string;\n}\n\nasync function findUnprocessedSessions(\n  processedLog: ProcessedLog,\n  options: { days?: number; agents?: string[] },\n  cassPath = \"cass\"\n): Promise<string[]>\n```\n\n## Implementation Flow\n1. Call cassTimeline(days) to get recent sessions\n2. Extract all session paths from timeline groups\n3. Filter out paths already in processedLog.processedSessions\n4. Optionally filter by agent names\n5. Return unprocessed session paths\n\n## Error Handling\n- Return empty array if timeline fails\n- Handle missing timeline gracefully\n- Log filtering progress at debug level\n\n## Parameters\n- processedLog: Tracks which sessions have been reflected on\n- options.days: How far back to look (default: 7)\n- options.agents: Filter by agent names (e.g., [\"claude-code\"])\n\n## Algorithm\n```typescript\nconst timeline = await cassTimeline(options.days || 7);\nconst allSessions = timeline.groups.flatMap(g => \n  g.sessions.map(s => s.path)\n);\n\nlet unprocessed = allSessions.filter(path => \n  \\!processedLog.processedSessions.has(path)\n);\n\nif (options.agents) {\n  unprocessed = unprocessed.filter(path => {\n    const session = timeline.groups\n      .flatMap(g => g.sessions)\n      .find(s => s.path === path);\n    return options.agents.includes(session?.agent);\n  });\n}\n\nreturn unprocessed;\n```\n\n## Usage\nCore function for reflect command:\n```typescript\nconst processedLog = loadProcessedLog();\nconst unprocessed = await findUnprocessedSessions(\n  processedLog, \n  { days: 7, agents: [\"claude-code\"] }\n);\n\nfor (const sessionPath of unprocessed) {\n  await reflectOnSession(sessionPath);\n  processedLog.processedSessions.add(sessionPath);\n}\n\nsaveProcessedLog(processedLog);\n```","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:45:04.582356Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-bbb","title":"[Utils] hashContent - Normalized content hashing for deduplication","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:44:48.046449Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-bblo","title":"[P2] Eliminate silent defaults - fail fast on invalid input","description":"Eliminate silent fallbacks where invalid input is ignored and defaults are used. All inputs must be validated upfront with clear error messages showing valid options. Create validation helpers in src/validate.ts. Audit all commands for silent fallbacks.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T15:34:09.171798Z","updated_at":"2025-12-17T10:18:03.602070Z","closed_at":"2025-12-17T10:18:03.602070Z","close_reason":"Completed (fail-fast CLI validation + strict numeric parsing)","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-bcj","title":"[Generator] executeSearchPlan - Parallel cass searches","description":"Parallel execution of cass searches with deduplication.\n\nSIGNATURE:\nasync function executeSearchPlan(queries: string[], config: Config): Promise<CassHit[]>\n\nPURPOSE:\nExecute all generated queries against cass in parallel, combine results, deduplicate, and return top hits sorted by relevance score.\n\nFLOW:\n1. Map queries to cass search promises with config.sessionLookbackDays\n2. Execute all with Promise.all (parallel for speed)\n3. Flatten results into single array\n4. Deduplicate by source_path + line_number (same snippet from multiple queries)\n5. Sort by relevance score descending\n6. Return top N results (config.maxHistorySnippets or default 10)\n\nCASS SEARCH PARAMETERS:\n- limit: 5 per query\n- days: config.sessionLookbackDays (default 90)\n- agent: config.preferredAgent (optional filter)\n\nDEDUPLICATION LOGIC:\nTwo hits are duplicates if:\n  hit1.source_path === hit2.source_path && hit1.line_number === hit2.line_number\nKeep the one with higher relevance score.\n\nRESULT SHAPE:\nArray<{\n  session_path: string,\n  agent: string,\n  snippet: string,\n  relevance: number,\n  source_path: string,\n  line_number: number\n}>\n\nERROR HANDLING:\n- If cass binary not found, throw error (caught by generateTaskContext)\n- If individual query fails, log warning but continue with other queries\n- Return empty array if all queries fail","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:44:54.025102Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-be2","title":"[Decay] analyzeScoreDistribution - Playbook health metrics","description":"Analyze the distribution of effective scores across all bullets in a playbook. Provides health metrics showing how many rules are excellent, good, neutral, or at-risk. Used by stats command to show playbook quality.\n\nCOMPLETE IMPLEMENTATION:\n```typescript\n/**\n * Analyze score distribution across all bullets.\n * Provides playbook health metrics and identifies problematic rules.\n */\nfunction analyzeScoreDistribution(bullets: PlaybookBullet[]): {\n  excellent: number;      // score > 10\n  good: number;          // score 5-10\n  neutral: number;       // score 0-5\n  atRisk: number;        // score < 0\n  distribution: number[]; // histogram buckets\n  avgScore: number;\n  medianScore: number;\n  totalBullets: number;\n} {\n  const scores = bullets.map(b => getEffectiveScore(b));\n  \n  // Category counts\n  const excellent = scores.filter(s => s > 10).length;\n  const good = scores.filter(s => s > 5 && s <= 10).length;\n  const neutral = scores.filter(s => s >= 0 && s <= 5).length;\n  const atRisk = scores.filter(s => s < 0).length;\n\n  // Histogram: buckets from -5 to 15 in steps of 2\n  const buckets = Array(11).fill(0);\n  scores.forEach(score => {\n    const bucketIndex = Math.min(10, Math.max(0, Math.floor((score + 5) / 2)));\n    buckets[bucketIndex]++;\n  });\n\n  // Statistics\n  const avgScore = scores.reduce((sum, s) => sum + s, 0) / scores.length;\n  const sorted = [...scores].sort((a, b) => a - b);\n  const medianScore = scores.length % 2 === 0\n    ? (sorted[scores.length / 2 - 1] + sorted[scores.length / 2]) / 2\n    : sorted[Math.floor(scores.length / 2)];\n\n  return {\n    excellent,\n    good,\n    neutral,\n    atRisk,\n    distribution: buckets,\n    avgScore: Math.round(avgScore * 100) / 100,\n    medianScore: Math.round(medianScore * 100) / 100,\n    totalBullets: bullets.length\n  };\n}\n```\n\nSCORE CATEGORIES:\n\nExcellent (score > 10):\n- Highly proven rules with strong positive signal\n- Typically proven maturity with 8+ helpful, 0 harmful\n- Core playbook rules that define best practices\n\nGood (score 5-10):\n- Solid established or proven rules\n- Consistent positive feedback\n- Reliable guidance with few issues\n\nNeutral (score 0-5):\n- New candidates or low-feedback rules\n- Neither strongly positive nor negative\n- May need more time to prove value\n\nAt Risk (score < 0):\n- Rules with harmful marks outweighing helpful\n- Candidates for demotion or deprecation\n- Need review - may be toxic or obsolete\n\nHISTOGRAM BUCKETS:\n```\nBucket 0: score < -5\nBucket 1: -5 to -3\nBucket 2: -3 to -1\nBucket 3: -1 to 1\nBucket 4: 1 to 3\nBucket 5: 3 to 5\nBucket 6: 5 to 7\nBucket 7: 7 to 9\nBucket 8: 9 to 11\nBucket 9: 11 to 13\nBucket 10: score > 13\n```\n\nUSAGE IN STATS COMMAND:\n```typescript\nconst analysis = analyzeScoreDistribution(playbook.bullets);\n\nconsole.log('📊 Playbook Health Report');\nconsole.log(`Total rules: ${analysis.totalBullets}`);\nconsole.log(`Excellent (>10): ${analysis.excellent} (${pct(analysis.excellent)}%)`);\nconsole.log(`Good (5-10): ${analysis.good} (${pct(analysis.good)}%)`);\nconsole.log(`Neutral (0-5): ${analysis.neutral} (${pct(analysis.neutral)}%)`);\nconsole.log(`At Risk (<0): ${analysis.atRisk} (${pct(analysis.atRisk)}%)`);\nconsole.log(`Average score: ${analysis.avgScore}`);\nconsole.log(`Median score: ${analysis.medianScore}`);\n\n// ASCII histogram\nconsole.log('\\nScore Distribution:');\nanalysis.distribution.forEach((count, i) => {\n  const scoreRange = `${i*2-5} to ${i*2-3}`;\n  const bar = '█'.repeat(Math.floor(count / 2));\n  console.log(`${scoreRange.padEnd(10)} ${bar} (${count})`);\n});\n```\n\nEXAMPLE OUTPUT:\n```\n📊 Playbook Health Report\nTotal rules: 42\nExcellent (>10): 8 (19%)\nGood (5-10): 15 (36%)\nNeutral (0-5): 16 (38%)\nAt Risk (<0): 3 (7%)\nAverage score: 6.23\nMedian score: 5.50\n\nScore Distribution:\n-5 to -3   ██ (2)\n-3 to -1   █ (1)\n-1 to 1    ████ (4)\n1 to 3     ████████ (8)\n3 to 5     ██████ (6)\n5 to 7     ██████████ (10)\n7 to 9     ████ (4)\n9 to 11    ████ (4)\n11 to 13   ██ (2)\n>13        █ (1)\n```\n\nHEALTH INDICATORS:\n\nHealthy Playbook:\n- 60%+ in good/excellent\n- <10% at risk\n- Median score > 5\n- Distribution skews right (positive)\n\nWarning Signs:\n- 20%+ at risk\n- Median score < 2\n- Many rules in -3 to 1 range\n- Few or no excellent rules\n\nCritical Issues:\n- 50%+ at risk\n- Average score < 0\n- Distribution skews left (negative)\n- Indicates playbook decay or mismatch with codebase\n\nDEPENDENCIES:\n- getEffectiveScore()\n- PlaybookBullet array\n\nUSED BY:\n- stats command\n- Playbook health dashboard (future)\n- Automated alerts (future)\n- Quality metrics API (future)","status":"tombstone","priority":3,"issue_type":"task","created_at":"2025-12-07T21:46:59.865436Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-bjz","title":"[LLM] llmWithRetry - Exponential backoff retry wrapper","description":"Function signature:\nasync function llmWithRetry<T>(\n  operation: () => Promise<T>,\n  operationName: string\n): Promise<T>\n\nConfiguration:\n- maxRetries: 3\n- baseDelayMs: 1000\n- maxDelayMs: 30000\n- retryableErrors: ['rate_limit_exceeded', 'server_error', 'timeout', 'overloaded']\n\nLogic:\n1. Try operation\n2. If error thrown:\n   a. Check if error type is retryable\n   b. If yes and retries < maxRetries:\n      - Calculate delay: min(baseDelayMs * 2^attempt, maxDelayMs)\n      - Log retry attempt with delay\n      - Wait\n      - Retry operation\n   c. If not retryable or max retries exceeded, throw error\n3. Return result on success\n\nLogging example:\n'LLM operation extractDiary failed (rate_limit_exceeded). Retrying in 2000ms... (attempt 2/3)'\n\nUse this wrapper around all LLM operations for resilience against transient failures.","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:46:09.625399Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-bm7","title":"[Reflector] getIterationNote - Context for subsequent iterations","description":"function getIterationNote(iteration: number): string\n\n- iteration 0: empty string\n- iteration 1+: \"This is iteration {N+1}. Focus on insights you may have missed in previous passes. Consider edge cases, anti-patterns, and subtle preferences.\"\n\nPURPOSE:\nHelps LLM find additional insights on subsequent passes\n\nEXAMPLES:\n- iteration 0: \"\" (first pass is broad)\n- iteration 1: \"This is iteration 2. Focus on insights you may have missed in previous passes. Consider edge cases, anti-patterns, and subtle preferences.\"\n- iteration 2: \"This is iteration 3. Focus on insights you may have missed in previous passes. Consider edge cases, anti-patterns, and subtle preferences.\"\n\nWHY THIS WORKS:\n- Iteration 0: LLM finds obvious patterns\n- Iteration 1+: Prompt guides LLM to look deeper\n- Specific guidance: \"edge cases, anti-patterns, subtle preferences\"\n\nIMPLEMENTATION:\n```typescript\nif (iteration === 0) return ''\nreturn `This is iteration ${iteration + 1}. Focus on insights you may have missed in previous passes. Consider edge cases, anti-patterns, and subtle preferences.`\n```\n\nUsed in buildReflectorPrompt()","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:45:00.162020Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-bnpt","title":"Add unit tests for trauma_guard_script.ts","description":"# Add Unit Tests for trauma_guard_script.ts\n\n## Context\nThe `trauma_guard_script.ts` module generates shell scripts that act as pre-commit guards to prevent traumatic patterns. It has NO dedicated test file.\n\n## Current State\n- File: `src/trauma_guard_script.ts`\n- Exports: Script generation utilities for shell guards\n- Used by: guard command, git hook installation\n- Tests: NONE\n\n## Scope\nCreate comprehensive unit tests WITHOUT mocks for:\n1. Guard script generation\n2. Shell script syntax validity\n3. Pattern escaping for shell safety\n4. Script installation/uninstallation logic\n5. Edge cases: special characters in patterns, empty patterns\n\n## Test Strategy\n- Generate scripts to temp files\n- Validate shell syntax with `bash -n`\n- Test pattern matching in generated scripts\n- Verify idempotent installation\n\n## Acceptance Criteria\n- [ ] Test file: `test/trauma-guard-script.test.ts` exists\n- [ ] All exported functions have test coverage\n- [ ] No mock.module() usage\n- [ ] Generated scripts pass shell syntax validation\n- [ ] Pattern escaping prevents injection\n\n## Security Note\nThis module generates shell code - testing is critical to prevent shell injection vulnerabilities.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T17:03:51.400458Z","updated_at":"2025-12-28T02:10:38.862449Z","closed_at":"2025-12-28T02:10:38.862449Z","close_reason":"Added comprehensive unit tests for trauma_guard_script.ts - 31 tests covering export validation, Python syntax, hook I/O, trauma file loading, and edge cases","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-bor","title":"[LLM] PROMPTS.validator - Scientific validation prompt","description":"Full prompt template for scientific validation:\n\nPROPOSED RULE: '{proposedRule}'\n\nHISTORICAL EVIDENCE FROM CASS (last 90 days):\n{evidence}\n\nINSTRUCTIONS:\nAnalyze whether the evidence supports or contradicts this rule.\n\nCriteria:\n- INVALID: Evidence shows this pattern FAILED multiple times\n- INVALID: Rule is too generic/obvious to be useful\n- VALID: Evidence supports it OR is neutral\n- Consider refining the wording if evidence suggests improvements\n\nBe specific in your reasoning, citing session paths when relevant.\n\n---\n\nGPT Pro innovation - validate against historical data before accepting.\n\nTemperature: 0.2 (low for consistency)\nUsed in runValidator function.\n\nThis is the scientific method applied to playbook rules - test hypotheses against empirical data from cass sessions.","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:44:53.957778Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-bp09","title":"UX polish: better ascii icon fallbacks + premium privacy status output","description":"Improve CLI UX/polish: provide non-emoji (ascii) equivalents for all icons so output stays structured when CASS_MEMORY_NO_EMOJI=1; rework cm privacy status human output to be width-aware, sectioned, and consistent with other premium commands (dividers, key/value formatting, copy/paste next steps).","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-16T08:18:55.437818Z","updated_at":"2025-12-16T08:22:06.027637Z","closed_at":"2025-12-16T08:22:06.027637Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-bpzd","title":"[MCP:Future] serve command - Start MCP server","description":"Implement serve command to start MCP server:\n\n```bash\ncass-memory serve [options]\n\nOptions:\n  --port N         HTTP port (default: stdio)\n  --stdio          Use stdio transport (default)\n```\n\nStarts the MCP server for agent connection. Default is stdio transport for local communication, but can optionally run on HTTP port for remote connections.","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:49:36.007573Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-bq3a","title":"[Semantic] scoreBulletsEnhanced - Keyword + semantic scoring","description":"Enhanced bullet scoring combining keyword matching with semantic similarity.\n\nImplementation:\n```typescript\nasync function scoreBulletsEnhanced(\n  bullets: PlaybookBullet[],\n  task: string,\n  config: Config\n): Promise<ScoredBullet[]>\n```\n\nSteps:\n1. Keyword scoring (fast, existing)\n2. Get task embedding\n3. For each bullet:\n   - Load or compute bullet embedding\n   - Calculate cosine similarity\n4. Combined score: 40% keyword + 60% semantic\n5. Final: combined × effective score × maturity multiplier\n6. Sort and return\n\nWhy hybrid scoring:\n- Keywords catch exact matches\n- Semantics catch conceptual matches\n- Combined provides best relevance\n\nExample:\nTask: \"fix authentication bug\"\n- Keyword match: \"auth\" → score 2\n- Semantic match: \"login session handling\" → similarity 0.82\n- Combined: (2 * 0.4) + (8.2 * 0.6) = 5.72\n\nPerformance:\n- 100 bullets: ~300ms (including embeddings)\n- With cache: ~50ms (embeddings pre-computed)\n\nConfig:\n- semanticSearchEnabled: true/false\n- semanticWeight: 0.6 (adjustable)","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-07T21:49:30.813559Z","updated_at":"2025-12-13T20:03:54.433768Z","closed_at":"2025-12-13T20:03:54.433768Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-btx8","title":"[Integration] Playbook Merging - Global + Repo Combination","description":"## Target: Integration tests for playbook merging\n\n### Test Scenarios:\n\n1. **Basic Merge**\n   - Global playbook with 3 bullets\n   - Repo playbook with 2 bullets\n   - Merged result has 5 bullets\n   - No ID conflicts\n\n2. **Override Merge**\n   - Global bullet ID: 'proj-a1b2'\n   - Repo bullet same ID, different content\n   - Repo content wins\n   - Metadata merged appropriately\n\n3. **FeedbackEvents Merge**\n   - Global bullet with 2 helpful events\n   - Repo bullet same ID with 1 harmful event\n   - Merged has all 3 events\n   - Chronological order preserved\n\n4. **Scope-Based Filtering**\n   - Global bullets with scope: 'global'\n   - Repo bullets with scope: 'project:myrepo'\n   - Query with project scope\n   - Only relevant bullets returned\n\n5. **Pinned Bullet Handling**\n   - Global has pinned bullet\n   - Repo has unpinned version\n   - Pinned status preserved\n   - Or: repo can unpin?\n\n6. **Empty Playbook Edge Cases**\n   - Global empty, repo has content\n   - Repo empty, global has content\n   - Both empty\n   - One missing, one exists\n\n### Test Setup:\n```typescript\n// Create temp git repo with .cass/\n// Create temp ~/.cass-memory/\n// Run merge operation\n// Verify results\n```\n\n### Detailed Logging:\n- Source of each bullet\n- Conflict resolution decisions\n- Timing information","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-08T01:30:07.298726Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-bxrn","title":"Define TraumaEntry Schema & Storage","description":"Define the 'TraumaEntry' TypeScript interface and persistent storage mechanism.\n\nKey Optimizations:\n- **Scope Awareness:** Traumas can be Global (machine-wide) or Project-Specific (repo-scoped).\n- **Status:** 'active' vs 'healed' (resolved traumas kept for history/warnings but don't block).\n- **Format:** Patterns must be regex-compatible across TS (Context) and Python (Guard).\n\nSchema:\ninterface TraumaEntry {\n  id: string;\n  severity: 'CRITICAL' | 'FATAL';\n  pattern: string; // Regex\n  scope: 'global' | 'project';\n  projectPath?: string; // If project-scoped\n  status: 'active' | 'healed';\n  trigger_event: {\n    session_path: string;\n    timestamp: string;\n    human_message?: string; // The scream/apology\n  };\n  created_at: string;\n}\n\nStorage: '~/.cass-memory/traumas.jsonl' (Global) and merged with project config.","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-12-18T03:59:10.482166Z","updated_at":"2025-12-20T22:39:47.995979Z","closed_at":"2025-12-20T22:39:47.995979Z","close_reason":"Implemented TraumaEntry schema + JSONL storage (global + project)","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-bxrn","depends_on_id":"cass_memory_system-653r","type":"discovered-from","created_at":"2026-01-21T09:28:50Z","created_by":"import"}]}
{"id":"cass_memory_system-by51","title":"[CLI] why command - Show bullet origin evidence","description":"Implements the 'cass-memory why' command to show the origin evidence for a specific bullet.\n\nCOMMAND SYNTAX:\n```bash\ncass-memory why <bullet-id> [options]\n\nArguments:\n  bullet-id      The bullet ID to explain\n\nOptions:\n  --verbose      Show full session transcripts\n  --json         Output as JSON\n```\n\nPURPOSE:\nAnswers \"Why was this rule learned?\" by showing the original reasoning, source sessions, evidence quotes, and diary entries that contributed to creating this bullet.\n\nOUTPUT FORMAT (Terminal):\n```\nWHY WAS THIS RULE LEARNED?\n===========================\n\nBullet: abc-123\nContent: \"Use React.memo for expensive renders\"\nCategory: Performance | Maturity: proven\nCreated: 2024-11-15 (83 days ago)\n\nORIGINAL REASONING:\n  Agent noticed repeated performance issues with re-rendering in\n  session 45a3b. Pattern of wrapping expensive components in React.memo\n  led to 3x speedup. Validated across 2 subsequent sessions.\n\nSOURCE SESSIONS (3):\n  1. Session 45a3b (2024-11-15): Performance optimization\n     \"Wrapped DataTable in React.memo, renders dropped from 120ms to 40ms\"\n     \n  2. Session 6f2c9 (2024-11-18): Similar pattern applied\n     \"Used same memo pattern for ChartWidget, similar improvement\"\n     \n  3. Session 8d1e4 (2024-11-22): Validation\n     \"React.memo approach confirmed effective for list components\"\n\nKEY EVIDENCE QUOTES:\n  • \"massive performance improvement after memoization\"\n  • \"prevents unnecessary re-renders when props unchanged\"\n  • \"measured 3x speedup on heavy components\"\n\nDIARY ENTRIES:\n  2024-11-15: \"Learned to wrap expensive renders in React.memo\"\n  2024-11-18: \"React.memo pattern continues to be effective\"\n\nFEEDBACK HISTORY (8 helpful, 0 harmful):\n  2024-11-20: Marked helpful (session 7a4d2)\n  2024-11-25: Marked helpful (session 9c3e1)\n  2024-12-01: Marked helpful (session 2f5b8)\n  ... (5 more)\n\nCURRENT STATUS:\n  Score: 12.4 (proven)\n  Last applied: 2 days ago\n  Effectiveness: Very high\n```\n\nIMPLEMENTATION REQUIREMENTS:\n\n1. Load bullet by ID from playbook\n2. Retrieve original reasoning/justification\n3. Find source sessions (sessions that contributed to this bullet)\n4. Extract evidence quotes from source sessions\n5. Find related diary entries by date range\n6. Show feedback history\n7. Display current status\n\nDATA SOURCES:\n\nBullet Metadata:\n```typescript\ninterface Bullet {\n  id: string;\n  content: string;\n  reasoning?: string;  // Original LLM reasoning\n  sourceSessions?: string[];  // Session IDs that led to this\n  evidence?: string[];  // Key quotes\n  createdAt: string;\n  feedback: FeedbackEvent[];\n}\n```\n\nSession Lookup:\n- Query cass for sessions by ID\n- Extract relevant conversation snippets\n- Show context around evidence\n\nDiary Lookup:\n- Find entries within ±7 days of creation\n- Match by keywords from bullet content\n- Show contributing diary insights\n\nVERBOSE MODE:\nWith --verbose flag:\n- Show full session transcripts\n- Include all evidence (not just key quotes)\n- Show complete diary entries\n- Display LLM's full reasoning chain\n\nJSON OUTPUT:\n```json\n{\n  \"bullet\": {\n    \"id\": \"abc-123\",\n    \"content\": \"Use React.memo for expensive renders\",\n    \"score\": 12.4,\n    \"maturity\": \"proven\"\n  },\n  \"reasoning\": \"Agent noticed repeated performance...\",\n  \"sourceSessions\": [\n    {\n      \"id\": \"45a3b\",\n      \"date\": \"2024-11-15\",\n      \"summary\": \"Performance optimization\",\n      \"evidenceQuote\": \"Wrapped DataTable in React.memo...\"\n    }\n  ],\n  \"evidence\": [\n    \"massive performance improvement after memoization\",\n    ...\n  ],\n  \"diaryEntries\": [\n    {\n      \"date\": \"2024-11-15\",\n      \"content\": \"Learned to wrap expensive renders...\"\n    }\n  ],\n  \"feedbackHistory\": [...]\n}\n```\n\nUSE CASES:\n- Understanding why a rule was created\n- Validating bullet relevance\n- Debugging incorrect rules\n- Auditing learning process\n- Building trust in the system\n\nEDGE CASES:\n- Bullet has no source sessions → show reasoning only\n- Source sessions deleted/pruned → show warning\n- No evidence available → show creation metadata\n- Very old bullet → warn if cass index pruned\n\nDEPENDENCIES:\n- Playbook loader\n- Cass session retrieval\n- Diary loader\n- Text highlighting/formatting\n- Date utilities\n\nSUCCESS CRITERIA:\n- Complete provenance chain shown\n- Evidence is compelling and relevant\n- Easy to understand why rule was created\n- Helps validate or question bullet accuracy\n- Performance <2 seconds even with verbose mode","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-07T21:57:48.117272Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-c0kc","title":"E2E tests: onboard command","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T03:28:20.510648808Z","created_by":"ubuntu","updated_at":"2026-01-07T03:32:17.818782961Z","closed_at":"2026-01-07T03:32:17.818782961Z","close_reason":"Added E2E tests for onboard command","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-c0kc","depends_on_id":"cass_memory_system-sdt1.4","type":"discovered-from","created_at":"2026-01-21T09:28:50Z","created_by":"import"}]}
{"id":"cass_memory_system-c0t","title":"[Validator] formatEvidenceForLLM - Structure hits for prompt","description":"Implement the formatEvidenceForLLM function - Structure cass hits for LLM validation prompt.\n\nSIGNATURE:\n```typescript\nfunction formatEvidenceForLLM(hits: CassHit[], maxHits: number = 10): string\n```\n\nFORMAT EACH HIT:\n```\nSession: {source_path}\nAgent: {agent}\nStatus: {diary_status}  // if available\nSnippet: {snippet}\n---\n```\n\nEXAMPLE OUTPUT:\n```\nSession: ~/.cass/sessions/2024-01-15-api-refactor.md\nAgent: claude-opus-4\nStatus: success\nSnippet: Implemented strict TypeScript checks with noImplicitAny enabled. This caught 12 type errors before they reached production.\n---\n\nSession: ~/.cass/sessions/2024-01-20-auth-bug.md\nAgent: claude-sonnet-3.5\nStatus: success\nSnippet: TypeScript strict mode flagged incorrect token type assumption, preventing security vulnerability.\n---\n\nSession: ~/.cass/sessions/2024-02-01-migration.md\nAgent: claude-opus-4\nStatus: failure\nSnippet: Attempted to add strict mode but broke existing codebase. Reverted changes.\n---\n```\n\nLOGIC:\n1. Sort hits by relevance score (if available)\n2. Take top maxHits (default 10)\n3. For each hit:\n   - Extract session path\n   - Get agent name\n   - Correlate with diary for status\n   - Format snippet (truncate if > 200 chars)\n4. Join with separator (---)\n5. Return formatted string\n\nTRUNCATION:\n- If snippet > 200 chars, truncate and add \"...\"\n- If total output > 4000 chars, reduce maxHits\n- Ensure LLM prompt stays within token limits\n\nWHY THIS MATTERS:\n- Provides structured evidence for LLM analysis\n- Includes success/failure context from diaries\n- Makes validation transparent and auditable\n- Optimizes token usage while preserving signal\n\nDEPENDENCIES:\n- CassHit type\n- findDiaryBySession() - For status correlation\n\nLOCATION:\n- src/validator/format-evidence.ts","status":"tombstone","priority":3,"issue_type":"task","created_at":"2025-12-07T21:44:54.766002Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-c10q","title":"[UX] Trust & Consistency","description":"Why this matters\n- In a CLI, “trust” is UX: docs, defaults, and flags must match reality.\n- Today we have drift across README vs code (config path/format, dev entrypoint), and multiple competing default values (ConfigSchema vs DEFAULT_CONFIG vs README).\n\nScope\n- Make docs, runtime defaults, and schemas consistent.\n- Make command naming/branding consistent (`cm` vs `cass-memory`).\n\nOut of scope\n- Large refactors; keep changes surgical and reversible.","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-13T10:12:13.279780Z","updated_at":"2025-12-13T22:26:37.414424Z","closed_at":"2025-12-13T22:26:37.414424Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-c10q","depends_on_id":"cass_memory_system-q6uv","type":"parent-child","created_at":"2026-01-21T09:28:50Z","created_by":"import"}]}
{"id":"cass_memory_system-c16i","title":"[ErrorHandling] acquireLock/releaseLock - Prevent concurrent access","description":"Implement file-based locking to prevent concurrent access issues.\n\nFunction signatures:\nfunction acquireLock(lockDir: string, operation: string): { \n  acquired: boolean;\n  holder?: { pid: number; operation: string; timestamp: number }\n}\nfunction releaseLock(lockDir: string): void\n\nImplementation:\n- Lock file: {lockDir}/cass-memory.lock\n- Lock file contains JSON: { pid, operation, timestamp }\n- Check if lock is stale (>30 seconds old)\n- Verify holder process is still alive (kill -0 on Unix)\n- If stale or process dead, acquire lock\n- If active lock exists, return holder info\n- Auto-release on process exit\n\nPrevents race conditions when multiple processes access playbook or sessions.","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:51:23.763732Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-c2aa","title":"[E2E Tests] Playbook merge - global plus repo playbooks","description":"## E2E Test: Playbook Merge - Global Plus Repo Playbooks\n\n### Test Scenario\nTest merging bullets from multiple playbook sources\n\n### Test Steps\n\n#### 1. Global + Repo Merge\n- Global playbook: 3 bullets\n- Repo playbook: 2 bullets\n- Verify all 5 bullets available\n- No duplicates\n\n#### 2. Deduplication\n- Global: 'Use TypeScript' (conf: 0.7)\n- Repo: 'Use TypeScript' (conf: 0.9)\n- Verify single bullet kept\n- Higher confidence preserved\n\n#### 3. Scope Priority\n- Global bullet: scope='*'\n- Repo bullet: scope='src/**'\n- Verify repo-scoped takes precedence in src/\n- Global applies elsewhere\n\n#### 4. Toxic List Merge\n- Global toxic: ['eval', 'any']\n- Repo toxic: ['console.log']\n- Verify all toxic items merged\n\n#### 5. Load Order\n- Test explicit playbook_paths array\n- Verify later files override earlier\n- Verify missing files skipped gracefully\n\n### Verbose Logging\n- Log: 'Loading playbooks from N paths'\n- Log: 'Loading: <path1>'\n- Log: 'Loaded M bullets from <path1>'\n- Log: 'Loading: <path2>'\n- Log: 'Loaded K bullets from <path2>'\n- Log: 'Merging playbooks...'\n- Log: 'Deduplicating: removed X duplicates'\n- Log: 'Final playbook: Y bullets, Z toxic'\n\n### Conflict Resolution\n- Same content, different confidence: keep higher\n- Same content, different scope: keep more specific\n- Same content, different maturity: keep higher","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-08T01:24:55.303965Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-c4aw","title":"[UX][degraded] Make cass failures quiet + actionable (safeCassSearch)","description":"Problem\n- `safeCassSearch()` currently logs hard errors for many common states, including “cass not ready / index missing”, producing noisy stderr output.\n- In onboarding, this reads like a crash even though the system can still provide playbook-only context.\n\nWhat to do\n- Classify cass failure modes into buckets:\n  - NOT_FOUND (cass missing)\n  - INDEX_MISSING / NEEDS_INDEX\n  - TIMEOUT\n  - OTHER\n- For common onboarding states, emit a single warning (or return structured degraded info) with exact remediation commands, e.g. `cass index` or `cm doctor`.\n- Avoid “auto-repair” that surprises users (like implicitly running a full index) unless explicitly requested.\n\nDeliverable\n- A clean degraded-mode behavior that downstream commands can consume without extra ad-hoc logging.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-13T10:18:14.065511Z","updated_at":"2025-12-13T21:36:19.057523Z","closed_at":"2025-12-13T21:36:19.057523Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-c4aw","depends_on_id":"cass_memory_system-9of6","type":"parent-child","created_at":"2026-01-21T09:28:50Z","created_by":"import"}]}
{"id":"cass_memory_system-c72","title":"[Utils] tokenize - Text tokenization for similarity","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:44:57.420862Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-c72r","title":"Handle array content blocks in raw diary formatting","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-07T05:27:27.869897298Z","created_by":"ubuntu","updated_at":"2026-01-07T05:27:50.382441607Z","closed_at":"2026-01-07T05:27:50.382441607Z","close_reason":"Handled raw JSON/JSONL array content blocks","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-c7p7","title":"[Semantic] cosineSimilarity - Vector similarity calculation","description":"Calculate cosine similarity between two embedding vectors.\n\nImplementation:\n```typescript\nfunction cosineSimilarity(a: number[], b: number[]): number {\n  let dot = 0, normA = 0, normB = 0;\n  for (let i = 0; i < a.length; i++) {\n    dot += a[i] * b[i];\n    normA += a[i] * a[i];\n    normB += b[i] * b[i];\n  }\n  return dot / (Math.sqrt(normA) * Math.sqrt(normB));\n}\n```\n\nMath:\n- Dot product divided by product of magnitudes\n- For normalized vectors: just dot product\n- Range: [-1, 1] (text embeddings typically [0, 1])\n- Higher = more similar\n\nPerformance:\n- O(n) where n = dimension count (384)\n- ~0.01ms for 384-dimensional vectors\n- No external dependencies\n\nInterpretation:\n- 0.9-1.0: Very similar (potential duplicates)\n- 0.7-0.9: Related content\n- 0.5-0.7: Somewhat related\n- <0.5: Unrelated\n\nUsed by:\n- Semantic bullet scoring\n- Duplicate detection\n- Similar bullet search","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-07T21:49:29.634174Z","updated_at":"2025-12-13T09:31:43.554372Z","closed_at":"2025-12-13T09:31:43.554372Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-c8w5","title":"[Critical] Graceful Degradation - Work When Components Fail","description":"# Graceful Degradation - Work When Components Fail\n\n## The Problem\nCurrent plan assumes all components work:\n- cass (the search tool) is installed and working\n- LLM API is available\n- Playbook exists and is valid\n- Network is available\n\nReality: Components will fail. The system should degrade gracefully.\n\n## The Solution\nImplement progressive fallback for each component:\n\n### When cass (search) is unavailable:\n```typescript\nasync function getContext(task: string): Promise<Context> {\n  try {\n    const history = await cassSearch(task);\n    return { history, source: \"cass\" };\n  } catch (e) {\n    console.warn(\"cass unavailable, using playbook only\");\n    return { history: [], source: \"playbook-only\" };\n  }\n}\n```\n\n### When LLM is unavailable:\n```typescript\nasync function reflect(sessionPath: string): Promise<void> {\n  try {\n    const diary = await extractDiaryWithLLM(sessionPath);\n    await saveDiary(diary);\n  } catch (e) {\n    console.warn(\"LLM unavailable, using basic extraction\");\n    const diary = extractDiaryBasic(sessionPath);\n    await saveDiary(diary);\n  }\n}\n```\n\n### User Feedback:\n```bash\n$ cm context \"fix auth bug\"\n\n⚠️  Running in degraded mode (LLM unavailable)\n   - Context will use keyword matching only\n   - Run 'cm status --full' for details\n\n## Relevant Rules (3 found):\n...\n```\n\n### Degradation Levels:\n```typescript\nenum OperationMode {\n  FULL,         // All components working\n  NO_LLM,       // LLM unavailable - basic extraction\n  NO_CASS,      // cass unavailable - playbook only\n  OFFLINE,      // No network - cached only\n  MINIMAL       // Multiple failures - read-only mode\n}\n```\n\n## Why This Is Critical\n- Users will encounter failures\n- System shouldn't break completely when one thing fails\n- \"Works partially\" > \"Crashes completely\"\n- Builds trust through resilience","status":"tombstone","priority":0,"issue_type":"feature","created_at":"2025-12-07T22:16:44.544531Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"feature","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-c95r","title":"[Test Epic] Comprehensive Unit & E2E Test Coverage","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-08T01:23:31.482248Z","updated_at":"2025-12-14T00:25:49.049234Z","closed_at":"2025-12-14T00:25:49.049234Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-c95r","depends_on_id":"cass_memory_system-ke2x","type":"blocks","created_at":"2026-01-21T09:28:50Z","created_by":"import"}]}
{"id":"cass_memory_system-cal7","title":"Tests: Add E2E tests for audit command","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-07T00:49:43.730005851Z","created_by":"ubuntu","updated_at":"2026-01-07T00:56:42.184789334Z","closed_at":"2026-01-07T00:56:42.184789334Z","close_reason":"Added 15 E2E tests for audit command covering trauma mode, audit mode, JSON output, error handling, and severity classification. All tests pass.","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-caug","title":"E2E test: 'cass init' command","description":"E2E test for 'cass init' CLI command:\n- Real subprocess execution via bun\n- Test initialization in empty directory\n- Verify created directory structure\n- Verify default playbook.yaml content\n- Verify config file creation\n- Test --force to reinitialize\n- Test error cases: already initialized, permission errors\n- Detailed logging: files created, content verification\nSetup: temp directory for each test case","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-08T01:27:22.601661Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-cax8","title":"[EPIC] Comprehensive E2E Integration Test Suite","description":"# Epic: Comprehensive E2E Integration Tests\n\n## Goal\nCreate a complete end-to-end test suite that exercises real workflows with detailed logging, covering all user-facing commands and multi-command workflows.\n\n## Current State\n- 20 E2E test files exist\n- Good coverage: context, doctor, init, mark, playbook, reflect, similar, stats\n- **Missing**: why, top, stale, privacy, project commands\n- **Missing**: Cross-command workflow integration tests\n- **Missing**: Detailed logging/tracing infrastructure\n\n## Success Criteria\n- [ ] Every command has at least one E2E test\n- [ ] Critical workflows have dedicated test scenarios\n- [ ] Test output includes detailed timing/step logs\n- [ ] Failures include reproduction steps\n- [ ] CI can run full suite in < 5 minutes\n\n## Subtasks\n1. Add E2E tests for why command\n2. Add E2E tests for top command  \n3. Add E2E tests for stale command\n4. Add E2E tests for privacy command\n5. Add E2E tests for project command\n6. Create detailed logging infrastructure for E2E tests\n7. Add workflow tests: new-user-first-week scenario\n8. Add workflow tests: team-onboarding scenario\n9. Add workflow tests: playbook-migration scenario\n10. Add performance regression tests with baselines","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-16T15:31:05.891762Z","updated_at":"2025-12-28T03:37:47.638685Z","closed_at":"2025-12-28T03:37:47.638685Z","close_reason":"All 6 dependency tasks completed: why E2E, top/stale/privacy/project E2E, logging infra, workflow tests, guard E2E, trauma E2E","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-cax8","depends_on_id":"cass_memory_system-6s8f","type":"blocks","created_at":"2026-01-21T09:28:50Z","created_by":"import"},{"issue_id":"cass_memory_system-cax8","depends_on_id":"cass_memory_system-6xsg","type":"blocks","created_at":"2026-01-21T09:28:50Z","created_by":"import"},{"issue_id":"cass_memory_system-cax8","depends_on_id":"cass_memory_system-fii6","type":"blocks","created_at":"2026-01-21T09:28:50Z","created_by":"import"},{"issue_id":"cass_memory_system-cax8","depends_on_id":"cass_memory_system-rsgy","type":"blocks","created_at":"2026-01-21T09:28:50Z","created_by":"import"},{"issue_id":"cass_memory_system-cax8","depends_on_id":"cass_memory_system-x133","type":"blocks","created_at":"2026-01-21T09:28:50Z","created_by":"import"},{"issue_id":"cass_memory_system-cax8","depends_on_id":"cass_memory_system-xex1","type":"blocks","created_at":"2026-01-21T09:28:50Z","created_by":"import"}]}
{"id":"cass_memory_system-cdqp","title":"[CLI] project command - Export to AGENTS.md","description":"Implements the main entry point for the 'cass-memory project' command.\n\nCOMMAND SYNTAX:\n```bash\ncass-memory project [options]\n\nOptions:\n  --format FORMAT    agents.md, claude.md, or raw (default: agents.md)\n  --output PATH      Output file path (default: stdout)\n  --top N            Top N bullets per category (default: all)\n  --show-counts      Include helpful counts in output (default: true)\n```\n\nPURPOSE:\nExports the playbook to agent-readable formats for integration with AI coding assistants. The primary format is AGENTS.md which provides a structured view of rules organized by category with effectiveness metrics.\n\nIMPLEMENTATION REQUIREMENTS:\n1. Parse command-line options\n2. Load current playbook from storage\n3. Route to appropriate formatter based on --format flag\n4. Handle output (file or stdout)\n5. Apply filters (top N, scope, etc.)\n\nOUTPUT FORMATS:\n- agents.md: Markdown format with categories and ranked bullets\n- claude.md: Claude-specific format with context sections\n- raw: JSON export of full playbook data\n\nDEPENDENCIES:\n- Playbook loader\n- Format renderers (formatAgentsMd, formatClaudeMd)\n- Config system for defaults\n\nSUCCESS CRITERIA:\n- Command exports valid markdown/JSON\n- Filters (top N) work correctly\n- Counts reflect current effectiveness scores\n- Output is immediately usable by AI assistants","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-07T21:49:20.748309Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-cg1l","title":"[CLI:mark] validateBulletId - Check ID format and existence","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:51:43.245502Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-cj41","title":"[UX][doctor] Fast default; self-test only via --self-test/--full","description":"Problem\n- `cm doctor` currently runs end-to-end self-tests by default (when not `--json`).\n- This makes a simple health check feel slow/surprising, and can hit flaky dependencies (cass, disk, model download) at the worst time.\n\nWhat to do\n- Make the default doctor run fast and deterministic.\n- Run `runSelfTest()` only when explicitly requested (`--self-test` or `--full`).\n- Ensure both human and JSON modes can include self-test results when requested.\n\nUser experience goal\n- `cm doctor` answers: “Is the system healthy? If not, what do I do next?” in one screen, quickly.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-13T10:15:43.200614Z","updated_at":"2025-12-13T11:19:33.600057Z","closed_at":"2025-12-13T11:19:33.600057Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-cj41","depends_on_id":"cass_memory_system-dq7w","type":"parent-child","created_at":"2026-01-21T09:28:50Z","created_by":"import"},{"issue_id":"cass_memory_system-cj41","depends_on_id":"cass_memory_system-jis4","type":"blocks","created_at":"2026-01-21T09:28:50Z","created_by":"import"}]}
{"id":"cass_memory_system-ck9","title":"[Playbook] getActiveBullets - Get non-deprecated bullets","description":"## Function Signature\n```typescript\nfunction getActiveBullets(playbook: Playbook): PlaybookBullet[]\n```\n\n## Purpose\nGet all non-deprecated bullets from the playbook. Most common filtering operation for context generation.\n\n## Implementation\n```typescript\nreturn playbook.bullets.filter(b => \n  b.state !== \"retired\" && \n  b.maturity !== \"deprecated\"\n);\n```\n\n## Active vs Deprecated\n**Active bullets**:\n- state: \"draft\" or \"active\" (not \"retired\")\n- maturity: \"candidate\", \"established\", or \"proven\" (not \"deprecated\")\n- Used in agent context\n- Subject to feedback and promotion\n\n**Deprecated bullets**:\n- state: \"retired\"\n- maturity: \"deprecated\"\n- Excluded from context\n- Kept for historical record\n\n## Usage Frequency\nThis is one of the MOST frequently called functions:\n- Every context generation: getActiveBullets()\n- Every markdown export: getActiveBullets()\n- Every stats calculation: getActiveBullets()\n- Every search: getActiveBullets()\n\n## Performance Considerations\n- Simple filter operation: O(n)\n- Consider caching for repeated calls\n- Most playbooks have < 100 bullets\n- Filter is fast enough for real-time use\n\n## Return Value\n```typescript\nPlaybookBullet[]  // Unsorted - caller should sort as needed\n```\n\n## Common Post-Processing\n```typescript\n// Sort by effective score\nconst active = getActiveBullets(playbook)\n  .sort((a, b) => calculateEffectiveScore(b) - calculateEffectiveScore(a));\n\n// Group by category\nconst byCategory = groupBy(getActiveBullets(playbook), \"category\");\n\n// Top N rules\nconst topRules = getActiveBullets(playbook)\n  .sort(byScore)\n  .slice(0, 10);\n```\n\n## Dependencies\n- None (pure function)\n\n## Related Functions\n- getBulletsByCategory() - filtered active bullets\n- exportToMarkdown() - uses this for export\n- generateContext() - uses this for LLM context\n- calculatePlaybookStats() - uses this for metrics","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:45:12.297655Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-clne","title":"[Test] Fixtures: Sample session exports","description":"Create test/fixtures/sessions/ with:\n\n1. claude-session.jsonl - Claude format session\n2. cursor-session.jsonl - Cursor format session  \n3. codex-session.jsonl - Codex format session\n4. short-session.jsonl - <10 lines\n5. long-session.jsonl - 100+ lines\n6. sensitive-session.jsonl - Contains secrets that should be sanitized\n\nEach JSONL file should:\n- Follow actual agent session format\n- Be parseable by cass export simulation\n- Include realistic tool calls, code snippets\n- Have identifiable agent patterns","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-08T01:22:16.025181Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-cm3g","title":"Update fallback version to v0.2.1 in install.sh","description":"# Task: Update Fallback Version in install.sh\n\n## Context\n\nThe current install.sh falls back to `v0.1.0` when version resolution fails. This is problematic because:\n1. v0.1.0 is ancient and may not work correctly\n2. Users who hit the fallback get a very outdated version\n3. The fallback should be a known-good recent version\n\n## Current Code (install.sh:40-42)\n\n```bash\n  else\n    VERSION=\"v0.1.0\"\n    warn \"Could not resolve latest version from GitHub API; defaulting to $VERSION\"\n  fi\n```\n\n## Proposed Change\n\n```bash\n  else\n    # Fallback to a known-good recent version\n    # Update this when releasing new major versions\n    VERSION=\"v0.2.1\"\n    warn \"Could not resolve latest version; defaulting to $VERSION\"\n  fi\n```\n\n## Why v0.2.1?\n\n- **Current release**: v0.2.1 is the latest release as of this writing\n- **Known working**: Has been tested and released\n- **Recent features**: Includes all recent improvements\n- **Stable**: Not a pre-release or experimental version\n\n## Maintenance Consideration\n\nThe fallback version should be updated:\n- When releasing a new major version (v0.3.0, v1.0.0, etc.)\n- When the current fallback has known issues\n- Periodically (every few releases) to keep it reasonably current\n\n**Alternative approach**: Some projects use a fixed \"known stable\" version (like an LTS). For cass-memory, we can simply keep it updated to \"latest stable\".\n\n## Implementation Notes\n\nThis change is bundled with the redirect-based resolution refactor, not a separate commit. The reason:\n1. Both changes are to `resolve_version()`\n2. The fallback version is part of the new implementation\n3. Avoids multiple small commits to the same function\n\n## Verification\n\nAfter implementation, verify fallback works:\n\n```bash\n# Simulate resolution failure by using invalid repo\nOWNER=\"nonexistent\" REPO=\"repo\" ./install.sh --verify\n\n# Should warn about fallback and use v0.2.1\n```\n\n## Acceptance Criteria\n\n- [ ] Fallback version updated from v0.1.0 to v0.2.1\n- [ ] Comment explains why this version was chosen\n- [ ] Comment reminds to update on major releases\n- [ ] Warning message is clear and helpful","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T18:41:21.270952Z","created_by":"jemanuel","updated_at":"2026-01-05T19:12:57.292486Z","closed_at":"2026-01-05T19:12:57.292486Z","close_reason":"Consolidating into single implementation task","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-cm3g","depends_on_id":"cass_memory_system-yea2","type":"blocks","created_at":"2026-01-21T09:28:50Z","created_by":"import"}]}
{"id":"cass_memory_system-cnk1","title":"[Unit] utils.ts - Pure Function Tests (Part 3: Keyword & Scoring Utilities)","description":"## Target: src/utils.ts - Part 3: Keyword, Scoring & Formatting Utilities\n\n### Functions to Test:\n1. **extractKeywords(text)** - Extract meaningful keywords\n   - Basic: 'The quick brown fox' → ['quick', 'brown', 'fox']\n   - Stop words removed: 'the', 'a', 'is', etc.\n   - Code identifiers: 'getUserById' → ['get', 'user', 'by', 'id'] or ['getUserById']\n   - Deduplication: repeated words → single entry\n   - Case normalization\n   - Minimum word length filtering\n   - Empty/whitespace input\n\n2. **normalizeScore(score, min, max)** - Normalize to 0-1 range\n   - Value in range → proportional result\n   - Value at min → 0\n   - Value at max → 1\n   - Value below min → 0 or clamped\n   - Value above max → 1 or clamped\n   - min === max edge case\n\n3. **formatLastHelpful(bullet)** - Format last helpful date\n   - Empty bullet → 'Never'\n   - No feedbackEvents → 'Never'\n   - Has helpful event → formatted date\n   - Multiple events → most recent\n   - Invalid date handling\n\n4. **formatRelativeTime(date)** - Relative time strings\n   - Just now (< 1 min)\n   - Minutes ago\n   - Hours ago\n   - Days ago\n   - Weeks ago\n   - Months ago\n   - Years ago\n   - Future dates handling\n\n5. **warn(msg)** / **log(msg, verbose)** - Logging utilities\n   - Basic output\n   - Verbose flag respected\n   - Color formatting (if applicable)\n\n### Test File Already Exists:\n- test/format-last-helpful.test.ts has 1 test\n- EXPAND to cover all edge cases\n- Add tests for other functions in same category\n\n### Test Patterns:\n- Date mocking NOT needed - use fixed dates in test data\n- Test all boundary conditions\n- Verify stop word list coverage","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-08T01:24:28.434951Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-cry","title":"[LLM] getApiKey - Environment variable resolution","description":"Function signature:\nfunction getApiKey(provider: string): string\n\nEnvironment variable mapping:\n- openai → OPENAI_API_KEY\n- anthropic → ANTHROPIC_API_KEY\n- google → GOOGLE_GENERATIVE_AI_API_KEY\n\nImplementation requirements:\n- Throw descriptive error if missing with suggestion to set env var\n- Error message should specify which env var is needed for the requested provider\n\nExample error: 'ANTHROPIC_API_KEY environment variable not found. Set it with: export ANTHROPIC_API_KEY=sk-ant-...'\n\nThis is the foundation for all LLM operations - must fail fast with clear guidance.","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:44:49.059302Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-crz","title":"[LLM] runReflector - Delta generation","description":"Function signature:\nasync function runReflector<T extends z.ZodSchema>(\n  schema: T,\n  diary: DiaryEntry,\n  existingBullets: string,\n  cassHistory: string,\n  iteration: number,\n  config: Config\n): Promise<z.infer<T>>\n\nImplementation:\n1. Build prompt from PROMPTS.reflector template\n2. Substitute variables:\n   - status, accomplishments, decisions, challenges, preferences, keyLearnings (from diary)\n   - existingBullets (current playbook rules)\n   - cassHistory (relevant sessions from cass)\n   - iterationNote (if iteration > 1, remind to focus on novel insights)\n3. Call generateObject with:\n   - schema: provided Zod schema (deltas array)\n   - temperature: 0.5 (slightly higher for creativity)\n4. Return deltas array\n\nUsed by: reflect command to generate playbook updates.\n\nNote: May be called multiple times (iterations) to get more deltas - iteration param tracks this.","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:45:59.175790Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-csi8","title":"[Testing] tests/setup.ts - Global test setup","description":"import { beforeAll, afterAll } from \"bun:test\";\n\nbeforeAll(() => {\n  process.env.CASS_MEMORY_TEST = \"1\";\n  process.env.CASS_MEMORY_VERBOSE = \"0\";\n});\n\nafterAll(() => {\n  delete process.env.CASS_MEMORY_TEST;\n});","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-07T21:49:50.603056Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-ct1","title":"[LLM] generateContext - Pre-task briefing generation","description":"Function signature:\nasync function generateContext(\n  task: string,\n  bullets: string,\n  history: string,\n  deprecatedPatterns: string,\n  config: Config\n): Promise<string>\n\nImplementation:\n1. Build prompt from PROMPTS.context template\n2. Substitute variables:\n   - task: what the agent is about to do\n   - bullets: relevant playbook rules\n   - history: relevant sessions from cass\n   - deprecatedPatterns: patterns to avoid\n3. Call generateText (not generateObject - free-form output) with:\n   - temperature: 0.3\n   - maxTokens: 2000\n4. Return formatted text briefing\n\nOutput format (structured for agent consumption):\n- Relevant rules (with IDs for citation)\n- Historical solutions (with session paths)\n- Warnings about deprecated patterns\n- Suggested search queries\n\nUsed by: hydrate command before agent starts work.","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:46:02.029450Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-cvuv","title":"Implement context usage logging","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-08T06:09:22.314413Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-cy6","title":"[Utils] jaccardSimilarity - Token-based similarity for deduplication","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:44:49.576174Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-czfe","title":"[UX][trust] Single source of truth for config defaults","description":"Problem\n- Defaults are currently inconsistent across:\n  - `src/types.ts` (ConfigSchema defaults)\n  - `src/config.ts` (DEFAULT_CONFIG hard-coded)\n  - README configuration table\n- This is a trust killer and makes bug reports hard (two users with “defaults” may actually differ).\n\nWhat to do\n- Choose a single source of truth for defaults (prefer ConfigSchema).\n- Ensure runtime defaults, generated config.json, and docs all match.\n- Remove duplicated/conflicting defaults (or generate DEFAULT_CONFIG from schema).\n\nConcrete examples to reconcile\n- `model` default (schema vs DEFAULT_CONFIG vs README)\n- `dedupSimilarityThreshold` default (schema/docs vs DEFAULT_CONFIG)\n- `pruneHarmfulThreshold` default mismatch\n\nNotes\n- Preserve repo security constraints (repo config cannot override sensitive paths).\n- Changes should be accompanied by tests that lock in the final defaults.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-13T10:14:09.344945Z","updated_at":"2025-12-13T21:18:56.672582Z","closed_at":"2025-12-13T21:18:56.672582Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-czfe","depends_on_id":"cass_memory_system-c10q","type":"parent-child","created_at":"2026-01-21T09:28:50Z","created_by":"import"}]}
{"id":"cass_memory_system-d06","title":"[Security] Sanitization config schema","description":"Define the sanitization configuration schema in config.json.\n\nSchema:\n```typescript\nsanitization: {\n  enabled: boolean;           // Global kill switch for sanitization\n  extraPatterns: string[];    // Additional regex patterns (user-defined)\n}\n```\n\nExample config.json:\n```json\n{\n  \"sanitization\": {\n    \"enabled\": true,\n    \"extraPatterns\": [\n      \"INTERNAL_[A-Z_]+_KEY\",\n      \"MY_COMPANY_SECRET_\\\\w+\",\n      \"ACME_CORP_[A-Za-z0-9]{16}\"\n    ]\n  }\n}\n```\n\nPurpose:\n- Allow users to add company-specific or project-specific patterns\n- Provide global on/off switch (enabled flag)\n- Patterns are strings that will be compiled to RegExp with 'gi' flags\n\nDefault config (if not specified):\n```json\n{\n  \"sanitization\": {\n    \"enabled\": true,\n    \"extraPatterns\": []\n  }\n}\n```\n\nPriority: 0 (Security Critical - P12)","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:44:50.233383Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-d1r","title":"[Diary] listRecentDiaries - Get diaries by age","description":"List diary entries modified within specified number of days.\n\nFunction Signature:\nasync function listRecentDiaries(\n  days: number,\n  config: Config\n): Promise<DiaryEntry[]>\n\nProcess:\n1. Calculate cutoff date: now - days\n2. List all files in diary directory\n3. Filter for JSON files matching diary filename pattern\n4. Check file modification time (mtime)\n5. Keep only files modified after cutoff\n6. Load each matching diary using loadDiaryEntry\n7. Sort by diary.timestamp descending (newest first)\n8. Return sorted array\n\nSorting:\n- Primary: timestamp descending (newest first)\n- Secondary: agent alphabetically (for same timestamp)\n\nError Handling:\n- Skip corrupted/unreadable diaries\n- Log warnings for skipped files\n- Never fail entire operation due to single bad file\n\nKey Features:\n- Time-based filtering for recency\n- Sorted results for consistency\n- Resilient to corrupted entries\n- Efficient file stat usage\n\nUse Cases:\n- Stats command: 'cass stats --days 7'\n- Recent activity summary\n- Trend analysis over time windows\n- Dashboard recent entries display\n\nExample Usage:\n// Get last week's diaries\nconst recentDiaries = await listRecentDiaries(7, config);\nconsole.log();\n\n// Get today's diaries\nconst todayDiaries = await listRecentDiaries(1, config);\n\nPerformance:\n- O(n log n) due to sorting where n = matching diaries\n- File stat is fast (no content reading until filter passes)\n- Consider pagination for very large results\n\nOutput:\nReturns array of DiaryEntry objects sorted newest first.","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:46:37.928906Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-d6yl","title":"Enhance Doctor: Auto-fix and self-test","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-08T05:16:37.173901Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-da6p","title":"[Bug][reliability] Ensure all cass invocations are timeout-safe + parse logs","description":"# Problem\nSome cass helper functions still call `spawnSync`/`JSON.parse` directly without a timeout or log-tolerant parsing. If the `cass` binary is present but wedged (or emits log prefixes), these codepaths can hang or break in surprising ways.\n\n## Current risky spots\n- `cassNeedsIndex()` uses `spawnSync(..., [\"health\"])` without a timeout.\n- `safeCassSearchWithDegraded(..., { force: true })` fallback uses `spawnSync` without a timeout and does a raw `JSON.parse(text)` (ignores leading logs/NDJSON/inline prefix).\n- `cassStats()` / `cassTimeline()` do raw `JSON.parse(stdout)` even though CLIs sometimes emit log lines before JSON.\n\n## Fix\n- Add timeouts to remaining `spawnSync` calls (health + force fallback).\n- Reuse the robust cass JSON parsing helper for the `force` fallback and for stats/timeline parsing.\n- Add regression tests covering:\n  - `cassTimeline()` parsing when logs precede JSON\n  - `safeCassSearch(..., { force: true })` parsing when logs/NDJSON appear\n\n## Acceptance Criteria\n- [ ] No `spawnSync` cass calls without a timeout.\n- [ ] Stats/timeline parsing tolerates leading logs.\n- [ ] Force fallback parsing tolerates leading logs + NDJSON.\n- [ ] `bun run typecheck` and `bun test` pass.\n","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-14T04:43:11.044465Z","updated_at":"2025-12-14T04:46:51.856432Z","closed_at":"2025-12-14T04:46:51.856432Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-di7y","title":"Add unit tests for info command","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-07T06:04:17.278698884Z","created_by":"ubuntu","updated_at":"2026-01-07T06:04:33.895601866Z","closed_at":"2026-01-07T06:04:33.895601866Z","close_reason":"Added 9 tests covering infoCommand and formatInfoHuman, coverage improved from 49% to 93%","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-dke","title":"[Playbook] isDuplicateBullet - Semantic duplicate detection","description":"## Function Signature\n```typescript\nfunction isDuplicateBullet(\n  newContent: string,\n  existingBullets: PlaybookBullet[],\n  threshold: number = 0.85\n): { isDuplicate: boolean; matchingBullet?: PlaybookBullet }\n```\n\n## Purpose\nDetect semantic duplicates before adding new bullets. Prevents near-identical rules from cluttering the playbook.\n\n## Algorithm\n1. Filter out deprecated bullets (state === \"retired\")\n2. For each active bullet:\n   - Calculate jaccardSimilarity(newContent, bullet.content)\n   - If similarity >= threshold: return match\n3. If no match found: return { isDuplicate: false }\n\n## Jaccard Similarity\n```typescript\njaccard(A, B) = |A ∩ B| / |A ∪ B|\n```\n- Tokenize both strings (split on whitespace/punctuation)\n- Calculate intersection size\n- Calculate union size\n- Return intersection / union\n\nRange: 0.0 (completely different) to 1.0 (identical)\n\n## Threshold Guidelines\n- **0.85 (default)**: Very similar, likely duplicate\n- **0.75**: Moderately similar, manual review needed\n- **0.90**: Almost identical, definitely duplicate\n\n## Example Duplicates (similarity > 0.85)\n- \"Always run tests before committing\"\n- \"Run all tests before you commit\"\n→ Same meaning, different wording\n\n## Implementation Notes\n- Case-insensitive comparison\n- Ignore punctuation differences\n- Skip deprecated bullets (may be outdated versions)\n- Return first match (don't search all)\n\n## Usage Scenarios\n1. **Curator**: Check before adding extracted rule\n2. **Manual add**: Warn user if duplicate exists\n3. **Merge detection**: Find similar rules to combine\n\n## Dependencies\n- jaccardSimilarity() utility function\n\n## Related Functions\n- findSimilarBullet() - returns similarity score\n- findMergeCandidates() - uses similarity for grouping\n- addBullet() - should check duplicates first","status":"tombstone","priority":3,"issue_type":"task","created_at":"2025-12-07T21:44:59.274031Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-dofz","title":"[Critical] Simplified Diary Schema for V1","description":"# Simplified Diary Schema for V1\n\n## The Problem\nCurrent DiaryEntry schema has 15+ fields including:\n- decisions, problems, solutions, tools, patterns\n- filesModified, filesByImpact, dependencies\n- architectureChanges, codeQuality, testingApproach\n- performanceConsiderations, securityNotes, technicalDebt\n\nThis is MASSIVELY over-engineered for v1. \nExtracting all this requires multiple LLM calls and complex prompts.\nMost fields will be empty most of the time.\n\n## The Solution\nStart with a minimal diary schema that covers 80% of value:\n\n### V1 Diary Schema (Minimal):\n```typescript\ninterface DiaryEntryV1 {\n  id: string;\n  sessionPath: string;\n  timestamp: Date;\n  \n  // Core fields only\n  summary: string;         // What happened in 1-2 sentences\n  outcome: \"success\" | \"partial\" | \"failure\" | \"unknown\";\n  \n  // Optional simple fields\n  task?: string;           // What was the user trying to do\n  keyInsight?: string;     // One key learning (if any)\n  filesChanged?: string[]; // Just the paths\n  \n  // Metadata\n  duration?: number;       // Seconds\n  agent: string;           // Which agent\n}\n```\n\n### Comparison:\n| V1 (Minimal) | Current Plan (Full) |\n|--------------|---------------------|\n| 7 fields | 18+ fields |\n| 1 LLM call | 3-5 LLM calls |\n| Simple extraction | Complex multi-step |\n| Fast (~2s) | Slow (~10s) |\n| Works local-only | Requires LLM |\n\n### V1 Extraction (No LLM Required):\n```typescript\nasync function extractDiaryV1(sessionPath: string): Promise<DiaryEntryV1> {\n  const session = await loadSession(sessionPath);\n  \n  return {\n    id: generateId(),\n    sessionPath,\n    timestamp: session.startTime,\n    \n    // Extract from session metadata (no LLM)\n    summary: session.title || \"Coding session\",\n    outcome: inferOutcome(session),  // From exit code, errors\n    task: session.userMessages[0]?.slice(0, 200),  // First user message\n    filesChanged: extractFilePaths(session),\n    duration: session.duration,\n    agent: session.agent\n  };\n}\n\nfunction inferOutcome(session: Session): Outcome {\n  if (session.exitCode === 0 && !session.hasErrors) return \"success\";\n  if (session.exitCode !== 0) return \"failure\";\n  if (session.hasErrors) return \"partial\";\n  return \"unknown\";\n}\n```\n\n### Upgrade Path to Full Schema:\n```typescript\n// V2 adds more fields (with LLM)\ninterface DiaryEntryV2 extends DiaryEntryV1 {\n  decisions?: string[];\n  patterns?: string[];\n  problems?: string[];\n}\n\n// V3 adds rich fields\ninterface DiaryEntryV3 extends DiaryEntryV2 {\n  architectureChanges?: ArchChange[];\n  testingApproach?: TestApproach;\n  // ... etc\n}\n\n// Migration is additive - old entries still valid\n```\n\n## Why This Is Critical\n- Simpler = faster to implement\n- Simpler = less LLM cost\n- Simpler = works offline\n- Simpler = fewer bugs\n- Can always add fields later (additive)\n- Full schema is over-engineering for v1","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T22:14:07.657850Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-dpuu","title":"[CLI:context] parseTaskInput - Handle stdin and args","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:51:35.865376Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-dq7w","title":"[UX] Doctor & Health Workflow","description":"Why this matters\n- `cm doctor` is the first “trust check” after install and the first stop when anything breaks.\n- Current UX has mismatched flags (mentions `--force` but CLI does not expose it), surprising behavior (self-test runs by default), and JSON output that lacks a summary/remediation plan.\n\nScope\n- Align CLI flags with actual behavior.\n- Make default doctor run fast and predictable; push slow checks behind `--full`/`--self-test`.\n- Produce a stable JSON contract for automation (overall status, fixable issues, recommended actions).","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-13T10:12:28.638732Z","updated_at":"2025-12-13T22:36:00.724512Z","closed_at":"2025-12-13T22:36:00.724512Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-dq7w","depends_on_id":"cass_memory_system-q6uv","type":"parent-child","created_at":"2026-01-21T09:28:50Z","created_by":"import"}]}
{"id":"cass_memory_system-drrs","title":"[ErrorHandling] handleSessionExportFailure - Fallback parsing","description":"Implement fallback parsing when cass session export fails.\n\nFunction signature:\nasync function handleSessionExportFailure(\n  sessionPath: string,\n  error: Error\n): Promise<string | null>\n\nImplementation:\n- If file exists but cass cannot export, try direct file parsing\n- For .jsonl: parse lines as JSON messages, extract content\n- For .json: parse as message array, extract content\n- For .md: return raw markdown as-is\n- Return null if file unreadable or unrecoverable\n\nFallback strategies:\n1. Try cass session export (primary)\n2. Parse file directly (fallback)\n3. Return null (graceful failure)\n\nThis ensures session data can be accessed even if cass has parsing issues.","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:50:51.124946Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-dtqi","title":"[UX][degraded] Context output: structured degraded summary + remediation","description":"Problem\n- When cass/history is unavailable, `cm context` falls back but the messaging is generic and sometimes noisy, and doesn’t provide a concrete next step.\n- Human output also truncates history without explicitly stating it.\n\nWhat to do\n- Extend the context result to include a structured degraded-mode summary, e.g.\n  - `degraded`: { cass: { available, reason, suggestedFix }, semantic: {...}, llm: {...} }\n- In human output, show a single concise “Degraded mode” callout with exact commands the user should run.\n- Ensure suggestedCassQueries remain useful even when cass is unavailable (e.g., suggest installing/indexing cass).\n\nNotes\n- Keep backward compatibility in JSON by only adding fields (don’t rename existing keys).\n- Warnings should be deduplicated and ordered by user impact.","notes":"Superseded note: we no longer want remediation commands mixed into suggestedCassQueries. Follow-up task cass_memory_system-75kt keeps suggestedCassQueries type-pure (cass search commands only) and surfaces remediation only under degraded.cass.suggestedFix / cm doctor.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-13T10:18:30.685903Z","updated_at":"2025-12-15T23:04:26.251012Z","closed_at":"2025-12-13T21:36:23.011071Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-dtqi","depends_on_id":"cass_memory_system-9of6","type":"parent-child","created_at":"2026-01-21T09:28:50Z","created_by":"import"},{"issue_id":"cass_memory_system-dtqi","depends_on_id":"cass_memory_system-c4aw","type":"blocks","created_at":"2026-01-21T09:28:50Z","created_by":"import"}]}
{"id":"cass_memory_system-dvki","title":"[Unit Tests] lock.ts - File locking mechanisms","description":"## Unit Tests: lock.ts - File Locking Mechanisms\n\n### Test Categories\n\n#### 1. acquireLock()\n- Creates lock file on first acquisition\n- Returns lock handle with release function\n- Sets correct PID in lock file\n- Creates parent directories if needed\n- Respects timeout parameter\n\n#### 2. Lock Contention\n- Second acquire waits for release\n- Timeout triggers after specified ms\n- Stale lock detection (dead PID)\n- Lock file cleanup on stale detection\n\n#### 3. releaseLock()\n- Removes lock file on release\n- Idempotent (double-release safe)\n- Handles missing lock file gracefully\n- Cleans up empty parent directories\n\n#### 4. withLock() Higher-Order Function\n- Acquires before callback execution\n- Releases after callback completes\n- Releases on callback exception\n- Returns callback result\n- Propagates callback errors after release\n\n#### 5. Edge Cases\n- Process crash simulation (orphaned locks)\n- Concurrent acquires from same process\n- Lock file permissions issues\n- Network filesystem considerations (no atomicity)\n- Very long lock paths\n\n### Test Approach\n- Use real temp directories (no mocks)\n- Test concurrent access with Promise.all\n- Verify file existence/contents at each step\n- Use process.pid for PID verification","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-08T01:23:24.540366Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-dwew","title":"[Config] loadMergedPlaybook - Combine global + repo","description":"Function signature:\n```typescript\nasync function loadMergedPlaybook(config: Config): Promise<Playbook>\n```\n\nSteps:\n1. Load global playbook (~/.cass-memory/playbook.yaml)\n2. Load repo playbook (./.cass/playbook.yaml) - may not exist\n3. Merge bullets:\n   - Same ID → repo wins\n   - Different IDs → keep both (dedupe by content)\n4. Load toxic logs from both levels\n5. Filter bullets against combined toxic log\n6. Return merged playbook\n\nEdge cases:\n- Repo playbook may not exist (use global only)\n- Both playbooks may have same bullet ID (repo wins)\n- Content-based deduplication to avoid semantic duplicates\n- Toxic log filtering happens AFTER merge\n\nReturns: Combined playbook with repo-level overrides applied","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:49:38.937664Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-e21","title":"[Security] Sanitization application points documentation","description":"Document WHERE to apply the sanitize() function throughout the codebase.\n\nApplication points (in order of data flow):\n1. After cassExport, BEFORE passing to LLM (in diary generation)\n   - Raw session content from CASS is untrusted\n   - Must sanitize before LLM sees it\n\n2. Before writing DiaryEntry to disk\n   - Prevent secrets from persisting in diary files\n   - Apply sanitize() to entry.content\n\n3. Before storing content in PlaybookBullet\n   - Sanitize before creating bullet objects\n   - Apply to bullet.content and bullet.evidence\n\n4. In context output (should already be sanitized if stored sanitized)\n   - Defense in depth: verify sanitization at output time\n   - Shouldn't find anything if earlier stages worked\n\nGOLDEN RULE: NEVER pass unsanitized session content to LLM or disk\n\nImplementation checklist:\n- [ ] Sanitize in diary generation flow\n- [ ] Sanitize before DiaryEntry persistence\n- [ ] Sanitize before PlaybookBullet creation\n- [ ] Add verification at context output\n\nPriority: 0 (Security Critical - P12)","notes":"Added sanitization application points under README Security/Secret Sanitization; communicated to agents. No sanitize.ts changes to avoid conflict with WhiteCat reservation.","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:44:49.167852Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-e63w","title":"[Docs] Architecture documentation - How it works","description":"Document system architecture and how cass-memory works internally.\n\nTopics to cover:\n- Three-layer memory model with diagram (Diary → Playbook → Project)\n- ACE pipeline: Generator → Reflector → Validator → Curator\n- Data flow diagrams showing session → diary → playbook → project\n- Schema explanations for each data structure\n- Why deterministic curation matters (reproducibility, auditability)\n- Confidence decay algorithm explanation\n- Semantic classification system\n- Evidence-based decision making\n\nInclude visual diagrams (ASCII art or mermaid.js) and concrete examples","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-07T21:49:30.515929Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-e6o7","title":"Refactor onboard command from flags to subcommands","description":"## Context\n\nThe `onboard` command currently uses ~12 mutually exclusive flags to represent different operations:\n\n| Current Flag | Purpose |\n|-------------|---------|\n| --status | Check onboarding progress |\n| --sample | Sample sessions for analysis |\n| --read <path> | Export a session for agent to analyze |\n| --prompt | Show extraction instructions |\n| --guided | Full guided workflow |\n| --mark-done <path> | Mark session as processed |\n| --reset | Clear onboarding progress |\n| --gaps | Show category gap analysis |\n| --fill-gaps | Prioritize gap-filling in sample |\n| --template | Rich output mode for --read |\n\nThis is inconsistent with `playbook` and `privacy` which use subcommands:\n- `playbook list`, `playbook add`, `playbook remove`\n- `privacy status`, `privacy enable`, `privacy disable`\n\n## Problem\n\n1. **Discoverability**: Running `cm onboard --help` shows a wall of flags. Hard to understand workflow.\n2. **Consistency**: Breaks the pattern established by other commands\n3. **Cognitive Load**: Agents must remember flag names vs being able to explore subcommands\n\n## Proposed Structure\n\n```\ncm onboard status          # Check status and progress (was --status)\ncm onboard gaps            # Show category gap analysis (was --gaps)\ncm onboard sample          # Sample sessions for analysis (was --sample)\ncm onboard read <path>     # Export session for analysis (was --read)\ncm onboard prompt          # Show extraction instructions (was --prompt)\ncm onboard guided          # Full guided workflow (was --guided)\ncm onboard mark-done <path> # Mark session processed (was --mark-done)\ncm onboard reset           # Clear progress (was --reset)\n```\n\nModifiers become options on the relevant subcommand:\n- `cm onboard sample --fill-gaps` (was --sample --fill-gaps)\n- `cm onboard read <path> --template` (was --read <path> --template)\n\n## Backwards Compatibility\n\nThe old flag syntax MUST continue to work with deprecation warnings:\n\n```\n$ cm onboard --status\n⚠️ Deprecation: `--status` flag is deprecated. Use `cm onboard status` instead.\n[... normal output ...]\n```\n\nTimeline:\n- v1.x: Both syntaxes work, old syntax shows warning\n- v2.0: Remove deprecated flag syntax\n\n## Implementation Strategy\n\n1. Keep existing `onboardCommand()` function as internal implementation\n2. Create new subcommand handlers that call into existing logic\n3. Add deprecation detection layer that translates old flags to new subcommands\n4. Update cm.ts to define subcommand structure\n\n## Files to Modify\n\n- `src/cm.ts` - Add subcommand definitions (like playbook/privacy pattern)\n- `src/commands/onboard.ts` - Refactor to export individual handlers\n- `src/commands/quickstart.ts` - Update command examples\n\n## Acceptance Criteria\n\n- [ ] `cm onboard --help` shows subcommand list (not flag wall)\n- [ ] All subcommands work: status, gaps, sample, read, prompt, guided, mark-done, reset\n- [ ] Old flag syntax works with deprecation warning\n- [ ] JSON output unchanged (backwards compatible)\n- [ ] `cm onboard sample --fill-gaps --limit 5` works as expected\n\n## Effort Estimate\n\n2-3 hours\n\n## Risks & Mitigations\n\n**Risk**: Users have scripts using old syntax\n**Mitigation**: Deprecation warnings, not hard breaks. Document migration.\n\n**Risk**: Complex deprecation layer adds bugs\n**Mitigation**: Comprehensive test coverage for both syntaxes\n\n## Part of Epic\n\ncass_memory_system-ulu7 (Agent UX Improvements)","status":"closed","priority":3,"issue_type":"feature","created_at":"2025-12-15T17:17:14.087076Z","updated_at":"2025-12-15T17:50:11.740475Z","closed_at":"2025-12-15T17:50:11.740475Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-e6o7","depends_on_id":"cass_memory_system-yee2","type":"blocks","created_at":"2026-01-21T09:28:50Z","created_by":"import"}]}
{"id":"cass_memory_system-e8x","title":"[Playbook] loadPlaybook - Load and validate playbook from YAML","description":"## Function Signature\n```typescript\nasync function loadPlaybook(config: Config): Promise<Playbook>\n```\n\n## Purpose\nLoad and validate playbook from YAML file. Handles missing files, corruption, and schema validation with automatic recovery.\n\n## Algorithm\n1. Expand playbookPath from config\n2. Check if file exists\n3. If not exists: create empty playbook and return\n4. Read file content\n5. If empty: create new playbook and return\n6. Parse YAML content\n7. Normalize keys (snake_case → camelCase for compatibility)\n8. Validate with PlaybookSchema.safeParse()\n9. If invalid: backup to .backup.{timestamp} and create new\n10. Return validated playbook\n\n## Error Handling\n- **ENOENT**: File doesn't exist → create empty\n- **EACCES**: Permission denied → throw error\n- **Parse errors**: YAML syntax errors → backup and recreate\n- **Validation errors**: Schema mismatch → backup and recreate\n\n## Backup Strategy\nWhen corruption detected:\n- Backup to: `{playbookPath}.backup.{timestamp}`\n- Log warning with backup location\n- Create fresh empty playbook\n- Never lose user data\n\n## Implementation Notes\n- Use fs.promises for async file operations\n- Use yaml.parse() for YAML parsing\n- Normalize keys for backward compatibility\n- Always validate against current schema version\n\n## Dependencies\n- fs/promises\n- yaml library\n- PlaybookSchema (Zod schema)\n- createEmptyPlaybook()\n\n## Related Functions\n- createEmptyPlaybook() - creates new structure\n- savePlaybook() - writes loaded playbook back","notes":"Existing playbook helper implementations already present; no code changes made. Released reservation; feel free to take over.","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:44:45.760512Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-eefl","title":"[Critical] Type System Alignment - Multiple Files","description":"Type System Alignment - In Progress\n\n## Current Status\n- Typecheck shows 13 errors (down from 27+)\n- Main conflict: External linter/sync process reverts schema changes\n\n## Core Issue\nThe linter removes `helpfulEvents`/`harmfulEvents` arrays from PlaybookBulletSchema, but code (mark.ts, curate.ts, scoring.ts) requires them.\n\n## Options\n1. Keep arrays: Update schema (being reverted by linter)\n2. Remove arrays: Refactor all code to use feedbackEvents.filter()\n\n## Fixes Applied (may be reverted)\n- types.ts: Added helpfulEvents/harmfulEvents arrays\n- playbook.ts: loadPlaybook now accepts Config|string\n- sanitize.ts: SanitizationConfig accepts string[] extraPatterns\n\n## Remaining Errors\n- config.ts: auditLog field missing in sanitization default\n- types.ts: BulletMaturitySchema should be BulletMaturityEnum\n- validate.ts: supportingEvidence/contradictingEvidence missing\n\n## Next Steps\nNeed project-level decision on helpfulEvents/harmfulEvents architecture before proceeding.","status":"tombstone","priority":0,"issue_type":"bug","created_at":"2025-12-07T23:57:28.306163Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"bug","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-efd","title":"[Types] PlaybookBullet Schema Part 1 - Identity and Scope","description":"## Overview\nDefine identity and scope fields for PlaybookBullet schema. These fields establish bullet uniqueness and applicability hierarchy.\n\n## Identity Field\n\n### id: string\n- Format: 'b-{timestamp36}-{random}'\n- Example: 'b-l7k9m2p4-a3f8'\n- Generation: timestamp in base36 + 4-char random suffix\n- Purpose: Globally unique, sortable identifier\n- Immutable: Never changes after creation\n\n## Scope Hierarchy (5 Levels)\n\n### scope: enum\nType: 'global' | 'workspace' | 'language' | 'framework' | 'task'\n\nHierarchy (broadest to narrowest):\n\n1. global - Universal rules (e.g., 'Write clear commit messages')\n   - Applies: Always\n   - scopeKey: Not used\n   - workspace: Not used\n\n2. workspace - Repository-specific rules\n   - Applies: When in matching workspace directory\n   - scopeKey: Not used (workspace field holds path)\n   - workspace: '/path/to/project'\n   - Example: 'Use AuthService from @/lib/auth in this project'\n\n3. language - Language-specific rules\n   - Applies: When working in files of that language\n   - scopeKey: Language identifier (e.g., 'typescript', 'python', 'rust')\n   - workspace: Optional (can be workspace + language)\n   - Example: 'For TypeScript, prefer interfaces over types for objects'\n\n4. framework - Framework/library-specific rules\n   - Applies: When project uses that framework\n   - scopeKey: Framework identifier (e.g., 'nextjs', 'react', 'django')\n   - workspace: Optional\n   - Example: 'For Next.js, use app router not pages router'\n\n5. task - Task-type specific rules\n   - Applies: When performing that category of work\n   - scopeKey: Task category (e.g., 'authentication', 'testing', 'api-design')\n   - workspace: Optional\n   - Example: 'For authentication tasks, validate JWT expiration'\n\n## Scope Filtering Logic\nWhen retrieving bullets for context:\n1. Include all 'global' scope bullets\n2. If in workspace, include matching 'workspace' bullets\n3. If file language detected, include matching 'language' bullets\n4. If framework detected, include matching 'framework' bullets\n5. If task category inferred, include matching 'task' bullets\n\nMultiple scopes can apply simultaneously (e.g., workspace + language + task).\n\n## Fields\n\n### Required\n- id: string - Unique identifier\n- scope: 'global' | 'workspace' | 'language' | 'framework' | 'task'\n\n### Optional\n- scopeKey: string | undefined\n  - Used for: language, framework, task scopes\n  - Not used for: global, workspace scopes\n  - Examples: 'typescript', 'react', 'testing'\n\n- workspace: string | undefined\n  - Used for: workspace scope (required)\n  - Optional for: other scopes (adds workspace constraint)\n  - Value: Absolute path to workspace root\n  - Example: '/Users/dev/projects/my-app'\n\n## Examples\n\nGlobal Rule: { id: 'b-l7k9m2p4-a3f8', scope: 'global', content: 'Write descriptive commit messages' }\n\nWorkspace Rule: { id: 'b-m8n3p5q7-b4g9', scope: 'workspace', workspace: '/Users/dev/projects/auth-service', content: 'Use TokenValidator from @/lib/auth for all token checks' }\n\nLanguage Rule: { id: 'b-n9o4q6r8-c5h0', scope: 'language', scopeKey: 'typescript', content: 'Prefer const assertions over enums for string literals' }\n\nFramework Rule: { id: 'b-o0p5r7s9-d6i1', scope: 'framework', scopeKey: 'nextjs', workspace: '/Users/dev/projects/web-app', content: 'Use server actions in app directory, not API routes' }\n\nTask Rule: { id: 'b-p1q6s8t0-e7j2', scope: 'task', scopeKey: 'testing', content: 'Use vitest for unit tests, playwright for e2e' }\n\n## Acceptance Criteria\n- id field with format specification\n- scope enum with 5 values\n- scopeKey optional field\n- workspace optional field\n- ID generation utility function\n- Scope filtering logic implemented\n- Examples for all 5 scope types\n- JSDoc explaining hierarchy","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:44:58.006278Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-ehaq","title":"[CLI:stats] computeFullStats - Calculate all metrics","description":"Implements the computeFullStats function that calculates comprehensive playbook metrics.\n\nFUNCTION SIGNATURE:\n```typescript\ninterface PlaybookStats {\n  total: number;\n  byScope: { global: number; workspace: number };\n  byMaturity: { \n    candidate: number; \n    established: number; \n    proven: number; \n    deprecated: number \n  };\n  byType: { rule: number; antiPattern: number };\n  scoreDistribution: { \n    excellent: number;    // score >= 8\n    good: number;         // score 4-7\n    neutral: number;      // score 0-3\n    atRisk: number;       // score < 0\n  };\n  topPerformers: { \n    id: string; \n    score: number; \n    preview: string \n  }[];\n  atRisk: { \n    id: string; \n    score: number; \n    reason: string \n  }[];\n  stale: { \n    id: string; \n    daysSinceLastFeedback: number \n  }[];\n  mergeCandidates: { \n    ids: string[];        // Array of 2+ similar bullet IDs\n    similarity: number;   // Semantic similarity score\n  }[];\n}\n\nfunction computeFullStats(playbook: Playbook): PlaybookStats\n```\n\nCOMPUTATION LOGIC:\n\n1. BASIC COUNTS:\n   - Iterate all bullets, count by scope/maturity/type\n   - Skip deprecated unless explicitly included\n\n2. SCORE DISTRIBUTION:\n   - Calculate effective score (with decay) for each bullet\n   - Bucket into excellent/good/neutral/atRisk\n   - Use consistent thresholds across system\n\n3. TOP PERFORMERS:\n   - Sort by effective score descending\n   - Take top 10\n   - Generate preview (first 60 chars of content)\n\n4. AT RISK BULLETS:\n   - Filter bullets with score < 0\n   - Include reason: \"Negative feedback\" or \"Declining effectiveness\"\n   - Sort by score ascending (worst first)\n\n5. STALE BULLETS:\n   - Calculate days since last helpful/harmful feedback\n   - Filter bullets with >90 days (configurable threshold)\n   - Include only active bullets (not deprecated)\n\n6. MERGE CANDIDATES:\n   - Compute pairwise semantic similarity (if embeddings available)\n   - Find pairs/groups with similarity > 0.90\n   - Exclude already-merged or deprecated bullets\n   - Limit to top 5 groups\n\nPERFORMANCE OPTIMIZATIONS:\n- Cache embeddings for similarity computation\n- Use single pass for multiple aggregations\n- Lazy compute merge candidates (expensive)\n- Parallel score calculations for large playbooks\n\nEDGE CASES:\n- Empty playbook → return zeros\n- No embeddings → skip merge candidates\n- All bullets deprecated → show warning\n- No feedback data → mark all as stale\n\nDEPENDENCIES:\n- Playbook data structure\n- Score calculation utilities\n- Embedding similarity (optional)\n- Date/time utilities for staleness\n\nSUCCESS CRITERIA:\n- All metrics accurate and consistent\n- Performance <500ms for 1000 bullets\n- Handles edge cases gracefully\n- Stats match reality when spot-checked","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:53:34.560049Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-ejyo","title":"Infra: Cass CLI Shim","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-08T01:23:02.667364Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-ekh","title":"[Types] Validation Types - Scientific Validation Results","description":"## Overview\nDefine types for scientific validation system - results from evidence-based rule validation before adding to playbook.\n\n## Purpose\nScientific validation prevents low-quality rules from entering the playbook by:\n1. Searching historical sessions for supporting evidence\n2. Analyzing success/failure patterns\n3. Providing confidence scores\n4. Suggesting state (active vs draft)\n5. Optionally refining rule text\n\n## ValidationResult (Simple)\n\nBasic validation outcome for quick checks.\n\nFields:\n- valid: boolean (pass or fail)\n- reason: string (explanation of verdict)\n- refinedContent: string | undefined (optional improved rule text)\n- confidence: number | undefined (0-1 confidence score)\n\nUsage: Quick validation checks, preliminary filtering\n\nExample:\n{ valid: true, reason: 'Found 5 supporting sessions with consistent pattern', confidence: 0.87 }\n\n{ valid: false, reason: 'No evidence found in recent sessions', confidence: 0.12 }\n\n## ValidationReport (Comprehensive)\n\nDetailed validation analysis with evidence and recommendations.\n\nFields:\n\nproposedRule: string\n- The rule being validated\n- Example: 'Use TokenValidator for JWT validation'\n\nverdict: 'ACCEPT' | 'REJECT' | 'ACCEPT_WITH_CAUTION'\n- ACCEPT: Strong evidence, add to playbook as active\n- REJECT: Insufficient/contradictory evidence, do not add\n- ACCEPT_WITH_CAUTION: Some evidence, add as draft or candidate\n\nconfidence: number\n- Range: 0-1\n- Based on: evidence quality, quantity, recency\n- Example: 0.85 (high confidence)\n\nevidence: Evidence[]\n- Array of supporting/contradicting evidence\n- Structure: { sessionPath: string, snippet: string, type: 'supporting' | 'contradicting', relevance: number }\n- Example: [{ sessionPath: '/cass/2025-12-07.jsonl', snippet: 'Used TokenValidator successfully', type: 'supporting', relevance: 0.92 }]\n\nreason: string\n- Detailed explanation of verdict\n- Includes: evidence summary, patterns observed, concerns\n- Example: 'Found 8 supporting sessions over 30 days showing consistent use of TokenValidator for JWT validation. No contradicting patterns. Recommend adding as active rule.'\n\nrefinedRule: string | undefined\n- Optional improved version of proposed rule\n- Enhanced with: specificity, context, examples\n- Example: 'Use TokenValidator from @/lib/auth for all JWT validation to prevent authentication bypass'\n\n## Evidence Structure\n\nSupporting evidence for validation.\n\nFields:\n- sessionPath: string (path to session file)\n- snippet: string (relevant excerpt from session)\n- type: 'supporting' | 'contradicting'\n- relevance: number (0-1, how relevant this evidence is)\n- timestamp: string | undefined (when session occurred)\n- agent: string | undefined (which agent)\n\n## EvidenceGateResult\n\nResult from pre-LLM evidence gate check.\n\nPurpose: Fast filtering before expensive LLM validation\n\nFields:\n\npassed: boolean\n- True if enough evidence to proceed to LLM validation\n- False if insufficient evidence (skip LLM, save cost)\n\nreason: string\n- Explanation of gate decision\n- Example: 'Found 8 sessions with 6 successes, 1 failure - sufficient for validation'\n\nsuggestedState: 'draft' | 'active'\n- Recommended initial state based on evidence\n- draft: Low evidence (1-2 sessions)\n- active: Strong evidence (5+ sessions)\n\nsessionCount: number\n- Total sessions found matching proposed rule\n- Example: 8\n\nsuccessCount: number\n- Sessions with positive outcomes\n- Example: 6\n\nfailureCount: number\n- Sessions with negative outcomes\n- Example: 1\n\nExample:\n{ passed: true, reason: '8 sessions found (6 success, 1 failure, 1 mixed)', suggestedState: 'active', sessionCount: 8, successCount: 6, failureCount: 1 }\n\n{ passed: false, reason: 'Only 1 session found - insufficient evidence', suggestedState: 'draft', sessionCount: 1, successCount: 1, failureCount: 0 }\n\n## Validation Workflow\n\n1. Evidence Gate: Run fast pre-check (EvidenceGateResult)\n2. Gate Decision:\n   - If passed: Proceed to LLM validation\n   - If not passed: Either reject or add as draft (configurable)\n3. LLM Validation: Detailed analysis (ValidationReport)\n4. Apply Result:\n   - ACCEPT: Add to playbook as active (or established if strong evidence)\n   - ACCEPT_WITH_CAUTION: Add as draft or candidate\n   - REJECT: Don't add, optionally log for future\n\n## Configuration\n\nvalidationEnabled: boolean (config, default true)\nvalidationLookbackDays: number (config, default 90)\nEvidence gate thresholds (configurable):\n- minSessionsForActive: 5\n- minSessionsForDraft: 2\n- maxFailureRatio: 0.3 (30% failures still acceptable)\n\n## Acceptance Criteria\n- ValidationResult interface with all fields\n- ValidationReport interface with comprehensive structure\n- Evidence interface for evidence items\n- EvidenceGateResult interface for pre-LLM gate\n- Zod schemas for all types\n- TypeScript exports\n- Example validation reports showing ACCEPT/REJECT/CAUTION\n- JSDoc documentation\n- Integration with validation command","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:45:06.532110Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-ekwp","title":"E2E test: 'cass context' command","description":"E2E test for 'cass context' CLI command:\n- Real subprocess execution via bun\n- Test with various query inputs\n- Test --robot and --json output formats\n- Test --limit and --fields options\n- Verify output structure matches expected schema\n- Test error cases: no playbook, invalid query\n- Detailed logging: command invoked, stdout, stderr, exit code\nSetup: fixture directory with playbook.yaml and sessions","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-08T01:27:11.087376Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-en73","title":"Security and Robustness Improvements","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-08T03:28:18.087122Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-eoba","title":"[CLI:doctor] checkCassIntegration - Verify cass setup","description":"Implements the checkCassIntegration function that verifies cass CLI setup and health.\n\nFUNCTION SIGNATURE:\n```typescript\ninterface HealthCheck {\n  category: string;\n  item: string;\n  status: 'pass' | 'warn' | 'fail';\n  message: string;\n  fixable?: boolean;\n  fix?: () => Promise<void>;\n}\n\nasync function checkCassIntegration(cassPath?: string): Promise<HealthCheck[]>\n```\n\nCHECKS PERFORMED:\n\n1. CASS BINARY:\n   - Check if cass exists in PATH\n   - Verify executable permissions\n   - Get version: `cass --version`\n   - Validate minimum version (if required)\n   - Status: FAIL if not found, PASS otherwise\n\n2. VERSION COMPATIBILITY:\n   - Parse cass version string\n   - Check against minimum required version\n   - Warn if version is very old/unsupported\n   - Status: WARN if old but functional, FAIL if incompatible\n\n3. INDEX HEALTH:\n   - Run: `cass index-info` (or equivalent)\n   - Check last update timestamp\n   - Warn if index >7 days stale\n   - Check for corruption markers\n   - Status: WARN if stale, FAIL if corrupted\n\n4. SESSION COUNT:\n   - Query total session count\n   - Report storage size\n   - Warn if very large (>5GB)\n   - Status: PASS or WARN (info only)\n\n5. AGENT BREAKDOWN:\n   - Analyze sessions by agent type\n   - Report usage distribution\n   - Identify most-used agents/tools\n   - Status: PASS (info only)\n\nIMPLEMENTATION DETAILS:\n\n```typescript\n// Check 1: Binary exists\nconst cassExists = await which('cass');\nif (!cassExists) {\n  return [{\n    category: 'Cass Integration',\n    item: 'Binary',\n    status: 'fail',\n    message: 'cass not found in PATH. Install from https://github.com/...',\n    fixable: false\n  }];\n}\n\n// Check 2: Version\nconst { stdout } = await exec('cass --version');\nconst version = parseVersion(stdout);\nif (version < MIN_VERSION) {\n  return [{\n    category: 'Cass Integration',\n    item: 'Version',\n    status: 'fail',\n    message: `cass version ${version} is too old. Minimum: ${MIN_VERSION}`,\n    fixable: false\n  }];\n}\n\n// Check 3: Index health\nconst indexInfo = await exec('cass index-info --json');\nconst data = JSON.parse(indexInfo.stdout);\nconst daysSinceUpdate = dateDiff(data.lastUpdate, now());\nif (daysSinceUpdate > 7) {\n  return [{\n    category: 'Cass Integration',\n    item: 'Index Freshness',\n    status: 'warn',\n    message: `Index last updated ${daysSinceUpdate} days ago`,\n    fixable: true,\n    fix: async () => exec('cass rebuild-index')\n  }];\n}\n```\n\nERROR HANDLING:\n- Gracefully handle missing cass binary\n- Parse errors → treat as WARN (cass might be old version)\n- Timeout on slow commands (5s max)\n- Sanitize error messages (hide sensitive paths if needed)\n\nDEPENDENCIES:\n- which (find binary in PATH)\n- child_process.exec (run cass commands)\n- Version parsing utilities\n- Date/time utilities\n\nSUCCESS CRITERIA:\n- Detects cass presence accurately\n- Version parsing works for all cass versions\n- Index health check is reliable\n- Performance: all checks complete in <2 seconds\n- Clear actionable messages for failures","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:54:49.813974Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-eov8","title":"[CLI:forget] addToToxicLog - Block future similar rules","description":"Implements the addToToxicLog function that appends toxic entries to the permanent block list.\n\nFUNCTION SIGNATURE:\n```typescript\ninterface ToxicEntry {\n  bulletId: string;           // Original bullet ID\n  content: string;            // Full bullet content\n  contentHash: string;        // SHA-256 hash for exact matching\n  embedding?: number[];       // Vector for semantic similarity\n  reason: string;             // Why this is toxic\n  timestamp: string;          // ISO 8601 timestamp\n  invertedTo?: string;        // ID of anti-pattern if inverted\n}\n\nasync function addToToxicLog(\n  entry: ToxicEntry,\n  path: string\n): Promise<void>\n```\n\nPURPOSE:\nMaintains a permanent log of toxic bullets that should never be re-learned. Future extraction checks against this log using both exact hash matching and semantic similarity.\n\nSTORAGE FORMAT (toxic_bullets.log):\n```jsonl\n{\"bulletId\":\"abc-123\",\"content\":\"Cache auth tokens in localStorage\",\"contentHash\":\"a1b2c3...\",\"reason\":\"Security vulnerability - tokens exposed to XSS\",\"timestamp\":\"2025-01-15T10:30:00Z\"}\n{\"bulletId\":\"def-456\",\"content\":\"Skip input validation for performance\",\"contentHash\":\"d4e5f6...\",\"embedding\":[0.12, -0.34, ...],\"reason\":\"Caused SQL injection in prod\",\"timestamp\":\"2025-01-16T14:22:00Z\",\"invertedTo\":\"ghi-789\"}\n```\n\nIMPLEMENTATION REQUIREMENTS:\n1. Generate SHA-256 hash of normalized content\n2. Generate embedding vector (if embeddings enabled)\n3. Validate entry has required fields\n4. Append to toxic_bullets.log (JSONL format)\n5. Ensure atomic writes (temp file + rename)\n6. Update in-memory toxic cache for fast lookups\n\nBLOCKING LOGIC:\nWhen new bullet extracted:\n1. Hash exact match → reject immediately\n2. Semantic similarity > 0.85 → flag for review\n3. Check reason/context from log\n\nPERFORMANCE:\n- Lazy load toxic log on first access\n- Cache in memory during session\n- Index by hash for O(1) exact lookups\n- Use FAISS/similar for fast semantic search\n\nFILE SAFETY:\n- Use file locking to prevent concurrent writes\n- Append-only (never modify existing entries)\n- Backup before first write in session\n\nDEPENDENCIES:\n- Hash generation (crypto.createHash)\n- Embedding generation (if enabled)\n- File I/O utilities with atomic writes\n- In-memory LRU cache for performance\n\nSUCCESS CRITERIA:\n- Entries persisted durably to disk\n- Future extractions blocked correctly\n- Semantic similarity catches variations\n- No data corruption under concurrent access","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:52:42.280397Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-ep5y","title":"[Test Infrastructure] Verbose test logging utility","description":"## Verbose Test Logging Utility\n\nCreate a test logging utility that outputs detailed, human-readable progress during test runs.\n\n### Logger Features:\n1. **Test Context**: Show test name, file, line number\n2. **Input Logging**: Pretty-print function inputs\n3. **Expected vs Actual**: Side-by-side comparison on failure\n4. **Timing**: Duration of each test step\n5. **Progress Indicators**: Visual progress for long-running tests\n\n### Output Format:\n```\n[TEST] playbook.test.ts > addBullet > should assign unique ID\n  INPUT: { content: 'Test rule', category: 'testing' }\n  STEP 1: Creating empty playbook... (2ms)\n  STEP 2: Adding bullet... (1ms)\n  EXPECTED: bullet.id matches /^b-[a-z0-9]+$/\n  ACTUAL: bullet.id = 'b-abc123'\n  ✓ PASS (3ms total)\n```\n\n### Integration:\n- Works with bun:test\n- Can be enabled/disabled via TEST_VERBOSE=1\n- Outputs to stderr (doesn't pollute test output)\n\n### File Location: test/utils/logger.ts","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-08T01:23:04.715036Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-etw2","title":"[UX][output] Enforce JSON-mode stdout purity (+ e2e tests)","description":"Problem\n- Premium automation requires `--json` commands to produce parseable JSON on stdout every time.\n- Today we mostly follow this, but it’s easy to regress (new logs, recovery messages, progress output).\n\nWhat to do\n- Establish a single helper for JSON output and error handling so commands don’t accidentally print extra stdout.\n- Add e2e tests that run key commands with `--json` and assert stdout parses as JSON and contains expected keys.\n\nScope\n- Start with: context, doctor, init, similar, usage.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-13T10:17:57.416746Z","updated_at":"2025-12-13T20:54:04.887514Z","closed_at":"2025-12-13T20:54:04.887514Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-etw2","depends_on_id":"cass_memory_system-3tds","type":"parent-child","created_at":"2026-01-21T09:28:50Z","created_by":"import"}]}
{"id":"cass_memory_system-f03p","title":"[CLI:playbook] add - Manually add bullet","description":"Manually add a new bullet to the playbook.\n\nCommand signature:\n```bash\ncass-memory playbook add [options] \"<content>\"\n\nOptions:\n  --category CAT     Category (required)\n  --tags TAGS        Comma-separated tags\n  --scope SCOPE      global or workspace (default: global)\n  --workspace PATH   Workspace path if scoped\n```\n\nImplementation:\n1. Validate inputs:\n   - Content must be non-empty\n   - Category must be valid (tools/workflow/best-practice/pitfall/etc)\n   - If scope=workspace: workspace path must be provided\n   \n2. Create new bullet:\n   ```typescript\n   const bullet: Bullet = {\n     id: generateBulletId(),  // b-{random}\n     content: content,\n     category: category,\n     maturity: 'candidate',  // always start as candidate\n     score: 0.5,             // neutral starting score\n     scope: scope,\n     workspacePath: workspacePath,\n     tags: parseTags(tags),\n     sourceSessions: [],     // no source for manual adds\n     createdAt: new Date().toISOString(),\n     lastUpdated: new Date().toISOString(),\n     deprecated: false\n   }\n   ```\n   \n3. Add to playbook:\n   - Load existing playbook\n   - Append new bullet\n   - Save to disk\n   \n4. Display confirmation:\n   ```\n   Added bullet b-abc123 as candidate\n   Content: {content}\n   Category: {category}\n   \n   Use 'cass-memory playbook get b-abc123' to view details\n   ```\n\nUse cases:\n- Seeding initial playbook before any sessions\n- Adding external best practices\n- Quick manual additions\n\nNote: Manually added bullets start as candidates and need evidence to mature.","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:52:12.696819Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-f1n5","title":"UX: align outcome CLI flag with README (--summary instead of --text)","description":"README documents `cm outcome ... --summary \"...\"`, but CLI currently exposes `--text <text>` and even describes status as success|failure|mixed while implementation allows partial. Rename option to --summary, update help text, and add a smoke test.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-16T08:30:51.320741Z","updated_at":"2025-12-16T08:33:29.724304Z","closed_at":"2025-12-16T08:33:29.724304Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-f4lo","title":"[ErrorHandling] normalizePlatformPath - Cross-platform paths","description":"Normalize file paths for cross-platform compatibility.\n\nFunction signature:\nfunction normalizePlatformPath(p: string): string\n\nImplementation:\n- Expand tilde (~) to user home directory\n- Handle Windows backslashes vs Unix forward slashes\n- Handle Windows drive letters (C:, D:, etc.)\n- Normalize to platform-appropriate separator (path.sep)\n- Handle UNC paths on Windows (\\\\server\\share)\n- Remove redundant separators\n- Resolve . and .. components\n\nExamples:\n- Unix: '~/docs' -> '/home/user/docs'\n- Windows: '~\\docs' -> 'C:\\Users\\user\\docs'\n- Windows UNC: '\\\\server\\share\\file' -> '\\\\server\\share\\file'\n- Cross-platform: '../file' -> absolute path\n\nEnsures consistent path handling across platforms.","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:51:29.132495Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-f60i","title":"[UX][onboarding] Improve init output (next steps, automation, privacy)","description":"Problem\n- After `cm init`, the “Next steps” output currently hard-codes the binary name and doesn’t clearly guide users through the ideal first-run workflow.\n- The system’s key behavior (reflection automation via cron/hook; privacy defaults; semantic enablement) is not surfaced at the moment users care most.\n\nWhat to do\n- Redesign the post-init output to be a high-signal onboarding card:\n  - Confirm what was created (paths)\n  - Show the 2-3 most important next commands (context + doctor + reflect automation setup)\n  - Mention privacy state (cross-agent) and how to change it\n  - Mention semantic search enablement and potential first-use download\n\nConstraints\n- Use invoked binary name (depends on the naming task).\n- Avoid overwhelming output; keep it “Stripe-level”: short, clear, actionable.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-13T10:20:15.407010Z","updated_at":"2025-12-13T23:12:19.536685Z","closed_at":"2025-12-13T23:12:19.536685Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-f60i","depends_on_id":"cass_memory_system-1ojv","type":"parent-child","created_at":"2026-01-21T09:28:50Z","created_by":"import"},{"issue_id":"cass_memory_system-f60i","depends_on_id":"cass_memory_system-2yzr","type":"blocks","created_at":"2026-01-21T09:28:50Z","created_by":"import"},{"issue_id":"cass_memory_system-f60i","depends_on_id":"cass_memory_system-r1hq","type":"blocks","created_at":"2026-01-21T09:28:50Z","created_by":"import"}]}
{"id":"cass_memory_system-f63a","title":"[Testing] Gap analysis: unit tests without mocks","notes":"Documented no-mock unit test gaps in test/GAP_ANALYSIS.md with priority order and target test files.","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-08T01:29:37.200561Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-f87n","title":"[Test] Helpers: Test logger with structured output","description":"Create test/helpers/logger.ts with:\n\n## TestLogger Class\n\n\\`\\`\\`typescript\ninterface LogEntry {\n  timestamp: string;\n  level: \"DEBUG\" | \"INFO\" | \"WARN\" | \"ERROR\";\n  message: string;\n  data?: unknown;\n  testName?: string;\n}\n\nclass TestLogger {\n  private logs: LogEntry[] = [];\n  private testName: string;\n  \n  constructor(testName: string);\n  \n  debug(message: string, data?: unknown): void;\n  info(message: string, data?: unknown): void;\n  warn(message: string, data?: unknown): void;\n  error(message: string, data?: unknown): void;\n  \n  // Get all logs for this test\n  getLogs(): LogEntry[];\n  \n  // Format logs as readable string\n  format(): string;\n  \n  // Clear logs (call in afterEach)\n  clear(): void;\n  \n  // Dump to console (call on test failure)\n  dump(): void;\n}\n\\`\\`\\`\n\n## Global Logger\n\n\\`\\`\\`typescript\n// Singleton for current test\nlet currentLogger: TestLogger | null = null;\n\nexport function setTestLogger(logger: TestLogger): void;\nexport function getTestLogger(): TestLogger;\nexport function log(level: LogLevel, message: string, data?: unknown): void;\n\\`\\`\\`\n\n## Integration with Bun Test\n\n\\`\\`\\`typescript\n// In test setup\nbeforeEach(() => {\n  const testName = expect.getState().currentTestName;\n  setTestLogger(new TestLogger(testName));\n});\n\nafterEach(() => {\n  if (expect.getState().assertionCalls !== expect.getState().numPassingAsserts) {\n    getTestLogger().dump(); // Dump on failure\n  }\n  getTestLogger().clear();\n});\n\\`\\`\\`\n\n## Output Format\n\\`\\`\\`\n[2025-12-07T20:15:30.123Z] [INFO] [test: creates playbook] Starting test\n[2025-12-07T20:15:30.125Z] [DEBUG] [test: creates playbook] Created temp dir: /tmp/cass-test-xxx\n[2025-12-07T20:15:30.130Z] [INFO] [test: creates playbook] Saved playbook with 5 bullets\n\\`\\`\\`","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-08T01:22:43.325359Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-faw9","title":"[Integration] Concurrent Access - File Locking Tests","description":"## Target: Integration tests for concurrent access handling\n\n### Test Scenarios:\n\n1. **Concurrent Playbook Writes**\n   - Start 5 parallel mark commands\n   - All target same playbook\n   - File locking prevents corruption\n   - All events recorded\n\n2. **Read During Write**\n   - Start long write operation\n   - Attempt read during write\n   - Read should wait or get consistent state\n   - No partial reads\n\n3. **Multiple Process Access**\n   - Spawn multiple cm processes\n   - All modify same files\n   - Verify final state consistent\n   - No lost updates\n\n4. **Lock Timeout Handling**\n   - Simulate stuck lock\n   - New process should timeout\n   - Error message helpful\n   - Recovery possible\n\n5. **Atomic Write Verification**\n   - Interrupt write mid-operation\n   - File should be unchanged OR complete\n   - No partial writes\n   - Temp files cleaned up\n\n### Test Implementation:\n```typescript\ndescribe('concurrent access', () => {\n  it('handles parallel writes', async () => {\n    const promises = Array(5).fill(null).map((_, i) => \n      runCommand(['mark', 'bullet-id', 'helpful', '--context', `writer-${i}`])\n    );\n    await Promise.all(promises);\n    \n    const playbook = await loadPlaybook(testPath);\n    expect(playbook.bullets[0].feedbackEvents).toHaveLength(5);\n  });\n});\n```\n\n### Logging:\n- Lock acquisition times\n- Lock wait times\n- Process IDs\n- Operation sequences","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-08T01:30:15.205956Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-fbye","title":"[P3] Add --info flag showing version and config","description":"# Task: Add --info Flag\n\n## Problem\nUsers need to check config locations and version for debugging.\n\n## Solution\n```bash\ncm --info\n# Shows:\n#\n# cass-memory v1.2.3\n#\n# Configuration:\n#   Global config: ~/.cass-memory/config.json (exists)\n#   Global playbook: ~/.cass-memory/playbook.yaml (42 rules)\n#   Workspace playbook: ./playbook.yaml (not found)\n#\n# Environment:\n#   OPENAI_API_KEY: set (sk-...xxx)\n#   CASS_HOME: not set (using default)\n#\n# Dependencies:\n#   cass CLI: v0.5.2 (healthy)\n#   Node.js: v20.10.0\n#\n# For health check: cm doctor\n```\n\n## Files\n- src/cm.ts (add --info handler)\n- src/info.ts (new - gather system info)\n\n## Acceptance\n- [ ] Shows version prominently\n- [ ] Shows all relevant paths\n- [ ] Shows environment status\n- [ ] Shows dependency versions","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-16T15:33:59.935637Z","updated_at":"2025-12-28T02:29:01.529031Z","closed_at":"2025-12-28T02:29:01.529031Z","close_reason":"Implemented --info flag","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-fem1","title":"[Unit] validate.ts - Input Validation & Sanitization","description":"## Target: src/validate.ts - Validation Module\n\n### Functions to Test:\n\n1. **validatePlaybookFile(path)** - File-level validation\n   - Valid file passes\n   - Invalid YAML fails with message\n   - Schema violations reported\n   - Missing file handled\n   - Returns detailed validation result\n\n2. **validateBullet(bullet)** - Bullet validation\n   - All required fields present\n   - Field types correct\n   - ID format valid\n   - Content not empty\n   - feedbackEvents valid\n\n3. **validateConfig(config)** - Config validation\n   - All paths valid\n   - Types correct\n   - Required fields present\n   - Returns validation errors\n\n4. **validateScope(scope)** - Scope string validation\n   - Valid formats pass\n   - Invalid formats fail with reason\n   - Reserved words handled\n\n5. **validateId(id)** - ID format validation\n   - project-xxxx format\n   - Length constraints\n   - Character restrictions\n   - Case sensitivity\n\n6. **sanitizeInput(input, type)** - Type-specific sanitization\n   - 'path' type → path sanitization\n   - 'content' type → XSS prevention\n   - 'id' type → ID normalization\n   - Unknown type → safe default\n\n### Validation Result Schema:\n- valid: boolean\n- errors: ValidationError[]\n- warnings: ValidationWarning[]\n\n### Test Patterns:\n- Positive cases (valid input)\n- Negative cases (each validation rule)\n- Boundary cases (min/max lengths)\n- Unicode and special characters","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-08T01:28:36.926670Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-fh0","title":"[LLM] llmWithFallback - Multi-provider fallback","description":"Function signature:\nasync function llmWithFallback<T>(\n  schema: z.ZodSchema<T>,\n  prompt: string,\n  config: Config\n): Promise<T>\n\nImplementation:\n1. Try primary provider (from config.provider)\n2. If fails:\n   a. Check which other providers have API keys set\n   b. Try them in order: anthropic → openai → google\n   c. Use same prompt and schema\n   d. Return first successful result\n3. If all providers fail, throw combined error\n\nProvider ordering rationale:\n- Anthropic: Strong reasoning, structured output\n- OpenAI: Fast, reliable\n- Google: Fallback option\n\nResilience: Protects against provider-specific outages.\n\nUse case: Production systems where uptime matters more than specific provider.\n\nNote: Config should have a 'fallbackEnabled' flag - only use this if user opts in.","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:46:10.574337Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-fh7i","title":"Harden sanitization: redact standalone API keys/JWTs","description":"Secrets can appear in session logs/prompts; sanitize() should redact standalone OpenAI (sk-*), Anthropic (sk-ant-*), Google (AIza*), and JWTs even when not labeled as api_key/token. Add safe regex patterns (avoid ReDoS and secret scanners) + regression tests.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-16T07:22:14.890412Z","updated_at":"2025-12-16T07:26:47.038540Z","closed_at":"2025-12-16T07:26:47.038540Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-fii6","title":"[P1] Add E2E tests for top/stale/privacy/project commands","description":"# Task: E2E tests for remaining commands\n\n## Commands to Cover\n\n### top command\n- [ ] Returns highest-scored bullets\n- [ ] --limit works correctly\n- [ ] Scope filtering works\n- [ ] Empty playbook case\n\n### stale command\n- [ ] Identifies bullets without recent activity\n- [ ] Age threshold works\n- [ ] Decay calculation correct\n- [ ] Empty result case\n\n### privacy command\n- [ ] Shows current settings\n- [ ] Changes persist correctly\n- [ ] Affects other commands appropriately\n\n### project command\n- [ ] agents.md format correct\n- [ ] claude.md format correct\n- [ ] raw format correct\n- [ ] --top limits per category\n\n## Files\n- test/cli-top.e2e.test.ts (new)\n- test/cli-stale.e2e.test.ts (new)\n- test/cli-privacy.e2e.test.ts (new)\n- test/cli-project.e2e.test.ts (new)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-16T15:31:49.299626Z","updated_at":"2025-12-17T06:35:40.879963Z","closed_at":"2025-12-17T06:35:40.879963Z","close_reason":"Added E2E tests for top/stale/privacy/project","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-fpo5","title":"[CLI:diary] validateSessionPath - Check session exists","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:51:39.037826Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-fqop","title":"Fix diary --raw parsing for Codex response_item entries","description":"Handle Codex JSONL response_item payload messages and skip session_meta in formatRawSession so --raw output includes assistant/user content instead of [unknown]/empty lines.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-07T05:39:33.989738229Z","created_by":"ubuntu","updated_at":"2026-01-07T05:41:21.872418906Z","closed_at":"2026-01-07T05:41:21.872418906Z","close_reason":"Implemented Codex response_item parsing + session_meta skip in formatRawSession; diary.fast tests pass.","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-fqzc","title":"Feature: Code Quality Cleanup (Low Priority)","description":"# Feature: Code Quality Cleanup (Low Priority)\n\n## Status: MOSTLY COMPLETE - One Item Remaining\n\n### ✅ COMPLETED (Dec 15, 2025)\n\n#### 1. Duplicate Sentiment Detection Logic (`qwdh`) - DONE\n- Moved `POSITIVE_PATTERNS`, `NEGATIVE_PATTERNS`, `detectSentiment()` to `src/outcome.ts`\n- Exported from canonical location\n- `src/commands/outcome.ts` now imports instead of defining locally\n- Re-exported for backward compatibility\n\n#### 2. Unused _task Parameter (`26k9`) - DONE\n- Removed unused `_task: string | undefined` parameter from `outcomeCommand()`\n- Updated call site in `src/cm.ts`\n- No functional change, just cleanup\n\n### ❌ REMAINING: Doctor Command Size\n\n**Current State**: `src/commands/doctor.ts` is **38KB** (~1000 lines)\n\n**Analysis**: This file has grown organically with many features:\n- Health checks (config, playbook, cass, LLM providers, storage)\n- Fix capabilities (auto-fix recoverable issues)\n- Self-test mode\n- JSON output contract\n- Detailed diagnostics\n\n**Options**:\n1. **Do Nothing** - It works, tests pass, not causing issues\n2. **Extract Sub-Modules** - Split into `doctor/checks.ts`, `doctor/fixes.ts`, etc.\n3. **Progressive Refactor** - Extract pieces during future doctor enhancements\n\n**Recommendation**: Option 1 (Do Nothing) for now. The file is well-structured internally. Refactoring is only valuable if:\n- We need to add significant new doctor functionality\n- Test coverage becomes difficult\n- Multiple developers need to work on it simultaneously\n\n**Priority**: P4 (backlog) - Address opportunistically, not as dedicated work.\n\n## Relationship to Parent Epic\nThis feature is part of `v8m5` (CLI Agent-Friendliness Improvements). The completed items (sentiment, parameter) were agent-facing code quality improvements discovered during the audit.\n\n## Notes for Future Maintainers\nIf doctor.ts becomes problematic:\n1. Start by extracting the check functions into `src/doctor/checks/`\n2. Keep the main orchestration in `doctor.ts`\n3. Follow the pattern used in playbook.ts (core logic) vs commands/playbook.ts (CLI wrapper)","status":"closed","priority":3,"issue_type":"feature","created_at":"2025-12-15T18:26:21.172529Z","updated_at":"2025-12-15T21:19:42.335909Z","closed_at":"2025-12-15T21:19:42.335909Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-fqzc","depends_on_id":"cass_memory_system-26k9","type":"blocks","created_at":"2026-01-21T09:28:50Z","created_by":"import"},{"issue_id":"cass_memory_system-fqzc","depends_on_id":"cass_memory_system-qwdh","type":"blocks","created_at":"2026-01-21T09:28:50Z","created_by":"import"}]}
{"id":"cass_memory_system-fubh","title":"Epic: Redirect-Based Version Resolution for install.sh","description":"# Epic: Redirect-Based Version Resolution for install.sh\n\n**GitHub Issue**: #11 (CasualDeveloper)\n**Related PR**: Dicklesworthstone/coding_agent_session_search#29\n\n---\n\n## Problem Statement\n\nThe `install.sh` script uses the GitHub API to resolve the latest release version. This is fragile:\n\n| Issue | Impact |\n|-------|--------|\n| API rate limit (60/hr) | Fails for users who run installer multiple times |\n| JSON parsing with grep+sed | `sed -E` differs between GNU (Linux) and BSD (macOS) |\n| Ancient fallback (v0.1.0) | Users get broken/outdated version on failure |\n\n---\n\n## Solution\n\nReplace API-based resolution with redirect-based approach:\n\n```bash\n# OLD (fragile):\ncurl ... api.github.com/.../releases/latest | grep | sed\n\n# NEW (robust):\nfinal_url=\"$(curl -o /dev/null -w '%{url_effective}' \\\n  \"https://github.com/.../releases/latest\")\"\ntag=\"${final_url##*/}\"\n```\n\n**Why this works**: GitHub redirects `/releases/latest` → `/releases/tag/v0.2.1`\n\n---\n\n## Tasks\n\n### P0: cass_memory_system-yea2\n**Verify v0.2.1 release assets are uploaded**\n- The release currently has NO assets (verified 2026-01-05)\n- Blocks: implementation task\n\n### P2: cass_memory_system-yf5m  \n**Replace API version resolution with redirect-based approach**\n- Single function change to `resolve_version()`\n- Includes: implementation, edge cases, testing, documentation\n- Depends on: yea2 (need valid fallback version)\n\n---\n\n## Cross-Project Context\n\nThe sibling project `cass` (coding_agent_session_search) has PR #29 with the same pattern. Once both are merged, both install scripts will be consistent.\n\n---\n\n## Success Criteria\n\n- [ ] v0.2.1 release has all expected assets\n- [ ] install.sh uses redirect-based resolution\n- [ ] Works on macOS (arm64, x64) and Linux (x64)\n- [ ] Fallback version is current and functional\n- [ ] GitHub Issue #11 closed\n\n---\n\n## References\n\n- GitHub Issue #11: Original suggestion from CasualDeveloper\n- cass PR #29: Same fix for sibling project\n- install.sh lines 26-43: Current implementation","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-01-05T18:37:30.123934Z","created_by":"jemanuel","updated_at":"2026-01-05T19:24:08.279515Z","closed_at":"2026-01-05T19:24:08.279515Z","close_reason":"All tasks complete: yea2 (release assets uploaded), yf5m (redirect-based resolution implemented). GitHub Issue #11 resolved.","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-fvxu","title":"Project Hot Stove: Visceral Error Prevention & Mechanical Safety","status":"closed","priority":0,"issue_type":"epic","created_at":"2025-12-18T03:58:46.921455Z","updated_at":"2025-12-28T03:35:40.763346Z","closed_at":"2025-12-28T03:35:40.763346Z","close_reason":"Duplicate of cass_memory_system-653r which is now complete","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-fyry","title":"[ErrorHandling] handleRateLimit - Backoff on rate limits","description":"Implement intelligent rate limit handling with exponential backoff.\n\nFunction signature:\nasync function handleRateLimit(\n  error: Error,\n  attempt: number\n): Promise<{ shouldRetry: boolean; delayMs: number }>\n\nImplementation:\n- Parse retry-after header from error if available\n- Otherwise use exponential backoff: baseDelay * 2^attempt\n- Cap at maxDelayMs (30 seconds)\n- Log wait time to user ('Rate limited, retrying in 4 seconds...')\n- Return false if max retries exceeded\n\nError detection:\n- HTTP 429 status\n- Error messages containing 'rate limit'\n- Provider-specific rate limit errors\n\nEnsures respectful API usage and automatic recovery from rate limits.","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:50:49.746686Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-g1wx","title":"Fix critical lock race condition and tracking file format","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-08T05:26:30.297719Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-g3of","title":"[Testing] bunfig.toml test configuration","description":"[test]\npreload = [\"./tests/setup.ts\"]\ntimeout = 30000\ncoverageThreshold = {\n  line = 80,\n  function = 80,\n  branch = 70\n}\n\n[test.coverage]\nskipFiles = [\"**/node_modules/**\", \"**/tests/**\"]","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-07T21:49:49.108928Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-g7bc","title":"[Docs] README.md - Main documentation","description":"Create comprehensive README.md as the main entry point for cass-memory documentation.\n\nSections to include:\n- What is cass-memory: Elevator pitch - A deterministic memory layer that transforms LLM session transcripts into reusable, validated knowledge for AI agents\n- The Problem: Knowledge is trapped in session transcripts, forcing agents to re-learn the same lessons repeatedly\n- The Solution: Three-layer memory system (Diary → Playbook → Project) with ACE pipeline for validation\n- Quick Start: 3-5 commands to get started immediately\n- Installation: Link to detailed installation docs\n- Usage: Examples for each major command (context, diary, reflect, mark, etc.)\n- Configuration: Overview of config options with link to reference\n- Integration with Agents: Reference AGENTS.md template, show how to integrate\n- How It Works: High-level pipeline diagram (Generator → Reflector → Validator → Curator)\n- Contributing: Link to CONTRIBUTING.md\n\nTarget: ~500 lines, clear markdown formatting, code examples that work copy-paste","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-07T21:49:25.595688Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-g7s7","title":"[E2E Tests] Config cascade - global, repo, session merging","description":"## E2E Test: Config Cascade - Global, Repo, Session Merging\n\n### Test Scenario\nTest configuration merging from multiple sources\n\n### Test Steps\n\n#### 1. Global Only\n- Create ~/.cass/config.yaml with provider=openai\n- No repo config\n- Verify global config used\n\n#### 2. Repo Overrides Global\n- Global: provider=openai, model=gpt-4\n- Repo: provider=anthropic\n- Verify provider=anthropic, model=gpt-4 (inherited)\n\n#### 3. Session Overrides All\n- Global and repo configs exist\n- Pass --provider gemini via CLI\n- Verify CLI takes precedence\n\n#### 4. Nested Object Merging\n- Global: llm.temperature=0.5\n- Repo: llm.max_tokens=1000\n- Verify both settings merged\n\n#### 5. Array Handling\n- Global: playbook_paths=[~/.cass/global.yaml]\n- Repo: playbook_paths=[./.cass/repo.yaml]\n- Verify arrays concatenated (or replaced per design)\n\n#### 6. Default Values\n- No configs exist\n- Verify sensible defaults applied\n- Verify no crashes\n\n### Verbose Logging\n- Log: 'Loading global config from ~/.cass/config.yaml'\n- Log: 'Global config: {summary}'\n- Log: 'Loading repo config from .cass/config.yaml'\n- Log: 'Repo config: {summary}'\n- Log: 'Merging configs...'\n- Log: 'Final config: {summary}'\n\n### Edge Cases\n- Config with env var references\n- Config with relative paths\n- Missing global config dir","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-08T01:24:53.693572Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-g81j","title":"[CLI] stale command - Bullets without recent feedback","description":"Implements the 'cass-memory stale' command to find bullets without recent feedback.\n\nCOMMAND SYNTAX:\n```bash\ncass-memory stale [options]\n\nOptions:\n  --days N       Stale threshold in days (default: 90)\n  --scope SCOPE  Filter by scope (global, workspace, all)\n  --json         Output as JSON\n```\n\nPURPOSE:\nIdentifies bullets that haven't received helpful/harmful feedback in N days. Useful for cleanup sessions and understanding which rules are no longer actively applied.\n\nOUTPUT FORMAT (Terminal):\n```\nSTALE BULLETS (no feedback in 90+ days)\n========================================\n\nFound 12 stale bullets:\n\n1. [123 days] abc-123: Use jQuery for DOM manipulation\n   Category: Frontend | Scope: global | Score: 2.1\n   Last feedback: 2024-10-05 (marked helpful)\n\n2. [98 days] def-456: Deploy on Fridays for quiet rollout\n   Category: DevOps | Scope: workspace | Score: -0.5\n   Last feedback: 2024-10-28 (marked harmful)\n\n3. [91 days] ghi-789: Store passwords in config file\n   Category: Security | Scope: global | Score: -3.2\n   Last feedback: 2024-11-01 (marked harmful)\n\n...\n\nRECOMMENDATIONS:\n  • Review these bullets for relevance\n  • Consider deprecating outdated practices (e.g., #1)\n  • Use 'cass-memory forget' for harmful rules (e.g., #3)\n  • Update content if still relevant but needs refresh\n```\n\nIMPLEMENTATION REQUIREMENTS:\n\n1. Load playbook from storage\n2. Calculate days since last feedback for each bullet\n3. Filter bullets with days >= threshold (default 90)\n4. Filter by scope if specified\n5. Sort by days descending (most stale first)\n6. Display with context\n\nSTALENESS CALCULATION:\n```typescript\nfunction calculateStaleness(bullet: Bullet): number | null {\n  const feedbackEvents = bullet.feedback || [];\n  if (feedbackEvents.length === 0) {\n    // Use creation date as baseline\n    return daysSince(bullet.createdAt);\n  }\n  \n  const lastFeedback = feedbackEvents\n    .sort((a, b) => b.timestamp - a.timestamp)[0];\n  \n  return daysSince(lastFeedback.timestamp);\n}\n```\n\nDISPLAYED INFORMATION:\n- Days since last feedback\n- Bullet ID and content preview\n- Category and scope\n- Current effective score\n- Last feedback action (helpful or harmful)\n- Last feedback date\n\nRECOMMENDATIONS:\nAuto-generate recommendations based on patterns:\n- Very stale + negative score → suggest forget\n- Very stale + outdated tech → suggest deprecate\n- Moderate stale + good score → suggest review\n- Many stale bullets → suggest cleanup session\n\nFILTERS:\n- --days: customize staleness threshold\n- --scope: global, workspace, or all\n- Exclude deprecated bullets by default\n\nJSON OUTPUT:\n```json\n{\n  \"threshold\": 90,\n  \"count\": 12,\n  \"bullets\": [\n    {\n      \"id\": \"abc-123\",\n      \"daysSinceLastFeedback\": 123,\n      \"content\": \"Use jQuery for DOM manipulation\",\n      \"category\": \"Frontend\",\n      \"scope\": \"global\",\n      \"score\": 2.1,\n      \"lastFeedback\": {\n        \"action\": \"helpful\",\n        \"timestamp\": \"2024-10-05T14:22:00Z\"\n      }\n    },\n    ...\n  ]\n}\n```\n\nUSE CASES:\n- Quarterly cleanup sessions\n- Finding outdated practices\n- Identifying unused rules\n- Playbook health maintenance\n\nEDGE CASES:\n- Bullet never had feedback → use creation date\n- All bullets are stale → show warning\n- No stale bullets → congratulate user\n- Very young playbook → adjust recommendations\n\nDEPENDENCIES:\n- Playbook loader\n- Date calculation utilities\n- Terminal formatting (chalk)\n- Recommendation engine\n\nSUCCESS CRITERIA:\n- Accurate staleness calculation\n- Clear identification of cleanup candidates\n- Helpful recommendations\n- Performance <500ms for 1000+ bullets\n- Actionable output for maintenance","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-07T21:57:16.703248Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-gadx","title":"Harden cassSearch parsing for noisy outputs","status":"tombstone","priority":2,"issue_type":"bug","created_at":"2025-12-08T07:16:09.051633Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"bug","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-gcnq","title":"[CLI:reflect] processSession - Full pipeline for one session","description":"Process a single session through the full reflection pipeline.\n\nFunction signature:\n```typescript\nasync function processSession(\n  sessionPath: string,\n  playbook: Playbook,\n  config: Config\n): Promise<{\n  diary: DiaryEntry;\n  deltas: PlaybookDelta[];\n  validated: PlaybookDelta[];\n}>\n```\n\nImplementation pipeline:\n1. Generate or load diary entry:\n   - Check if diary already exists for session\n   - If not: call diary generator (via diary command)\n   - If exists: load from diary directory\n   \n2. Run reflector:\n   - Pass diary entry and current playbook\n   - Get back array of PlaybookDelta objects\n   - Deltas include: adds, removes, modifies\n   \n3. Run validator on 'add' deltas:\n   - Filter deltas where operation = 'add'\n   - For each add delta:\n     - Call validator to check scientific support\n     - Only keep deltas with confidence >= threshold\n   - Skip validation for remove/modify (curator handles)\n   \n4. Return results:\n   - Original diary entry\n   - All deltas (unvalidated)\n   - Validated deltas (subset)\n\nError handling:\n- If diary generation fails: skip session, log error\n- If reflector fails: skip session, log error\n- If validator fails: include delta anyway (fail open)\n\nThe validated deltas are aggregated across all sessions and passed to batchCurate for final application.","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:49:54.433367Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-gmyw","title":"Test redirect-based version resolution across platforms","description":"# Task: Platform Testing for Redirect-Based Resolution\n\n## Context\n\nThe redirect-based version resolution must work correctly on all supported platforms. This task defines the testing matrix and procedures.\n\n## Supported Platforms\n\n| Platform | Architecture | Priority | CI Coverage |\n|----------|--------------|----------|-------------|\n| macOS | darwin-arm64 (Apple Silicon) | High | No (need self-hosted) |\n| macOS | darwin-x64 (Intel) | Medium | No |\n| Linux | x64 (Ubuntu/Debian) | High | Yes (GitHub Actions) |\n\n## Testing Matrix\n\n### Functional Tests\n\n| Test Case | Command | Expected Result |\n|-----------|---------|-----------------|\n| Basic resolution | `./install.sh --verify` | Resolves to latest version |\n| Explicit version | `./install.sh --version v0.2.0` | Uses specified version |\n| Network failure | (disconnect network) | Falls back gracefully |\n| Invalid repo | (modify REPO var) | Falls back gracefully |\n\n### Platform-Specific Tests\n\n#### macOS (darwin-arm64)\n\n```bash\n# Test 1: Basic curl behavior\ncurl --version  # Should be 7.x or 8.x\n\n# Test 2: Redirect tracking\ncurl -fsSL -o /dev/null -w '%{url_effective}\\n' \\\n  \"https://github.com/Dicklesworthstone/cass_memory_system/releases/latest\"\n\n# Test 3: Full install script (dry run conceptually)\nVERSION=\"\" ./install.sh --verify\n```\n\n#### macOS (darwin-x64)\n\nSame tests as arm64. May have older curl version on older macOS.\n\n#### Linux (x64)\n\n```bash\n# Test in Docker to simulate clean environment\ndocker run --rm -it ubuntu:22.04 bash -c '\n  apt-get update && apt-get install -y curl\n  curl -fsSL -o /dev/null -w \"%{url_effective}\\n\" \\\n    \"https://github.com/Dicklesworthstone/cass_memory_system/releases/latest\"\n'\n```\n\n### Shell Compatibility Tests\n\nThe script uses `#!/usr/bin/env bash`. Test with:\n\n| Shell | Version | Status |\n|-------|---------|--------|\n| bash 3.2 | macOS default | Must work |\n| bash 5.x | Linux default | Must work |\n| zsh | macOS default shell | N/A (script uses bash) |\n\n#### Bash 3.2 Specific Test\n\n```bash\n# macOS ships with bash 3.2 due to licensing\n/bin/bash --version  # Should show 3.2.x on macOS\n\n# Test parameter expansion\nfinal_url=\"https://github.com/Dicklesworthstone/cass_memory_system/releases/tag/v0.2.1\"\ntag=\"${final_url##*/}\"\necho \"$tag\"  # Should output: v0.2.1\n\n# Test [[ glob matching\nif [[ \"$final_url\" == *\"/releases/tag/\"* ]]; then\n  echo \"Match!\"\nfi\n```\n\n### curl Version Compatibility\n\n| curl Version | Platform | Notes |\n|--------------|----------|-------|\n| 7.64+ | macOS 10.15+ | Bundled |\n| 7.68+ | Ubuntu 20.04+ | Bundled |\n| 8.x | Recent systems | Works |\n\nKey flags used:\n- `-f` (fail on HTTP errors) - Available since curl 4.x\n- `-s` (silent) - Available since curl 4.x\n- `-S` (show errors with -s) - Available since curl 6.x\n- `-L` (follow redirects) - Available since curl 5.x\n- `-o /dev/null` - Standard\n- `-w '%{url_effective}'` - Available since curl 7.x\n\nAll flags are widely available and compatible.\n\n## CI Integration\n\n### GitHub Actions Test\n\nAdd to `.github/workflows/ci.yml`:\n\n```yaml\ntest-install-script:\n  runs-on: ubuntu-latest\n  steps:\n    - uses: actions/checkout@v4\n    \n    - name: Test version resolution\n      run: |\n        # Test redirect approach directly\n        final_url=\"$(curl -fsSL -o /dev/null -w '%{url_effective}' \\\n          \"https://github.com/Dicklesworthstone/cass_memory_system/releases/latest\" || true)\"\n        tag=\"${final_url##*/}\"\n        echo \"Resolved tag: $tag\"\n        \n        # Validate\n        if [[ \"$final_url\" != *\"/releases/tag/\"* ]]; then\n          echo \"ERROR: Redirect validation failed\"\n          exit 1\n        fi\n        \n        if [ -z \"$tag\" ]; then\n          echo \"ERROR: Tag extraction failed\"\n          exit 1\n        fi\n        \n        echo \"SUCCESS: Resolved version $tag\"\n```\n\n### Local Testing Script\n\nCreate `test/install-test.sh`:\n\n```bash\n#!/usr/bin/env bash\nset -euo pipefail\n\necho \"=== Install Script Tests ===\"\n\n# Test 1: Redirect resolution\necho -n \"Test 1 (redirect): \"\nfinal_url=\"$(curl -fsSL -o /dev/null -w '%{url_effective}' \\\n  \"https://github.com/Dicklesworthstone/cass_memory_system/releases/latest\" 2>/dev/null || true)\"\ntag=\"${final_url##*/}\"\nif [[ \"$final_url\" == *\"/releases/tag/\"* ]] && [ -n \"$tag\" ]; then\n  echo \"PASS ($tag)\"\nelse\n  echo \"FAIL\"\n  exit 1\nfi\n\n# Test 2: Fallback on invalid repo\necho -n \"Test 2 (fallback): \"\nfinal_url=\"$(curl -fsSL -o /dev/null -w '%{url_effective}' \\\n  \"https://github.com/nonexistent/repo/releases/latest\" 2>/dev/null || true)\"\nif [[ \"$final_url\" != *\"/releases/tag/\"* ]]; then\n  echo \"PASS (correctly triggers fallback)\"\nelse\n  echo \"FAIL (should not have found a tag)\"\n  exit 1\nfi\n\n# Test 3: Parameter expansion\necho -n \"Test 3 (extraction): \"\ntest_url=\"https://github.com/owner/repo/releases/tag/v1.2.3-beta\"\nextracted=\"${test_url##*/}\"\nif [ \"$extracted\" = \"v1.2.3-beta\" ]; then\n  echo \"PASS\"\nelse\n  echo \"FAIL (got '$extracted')\"\n  exit 1\nfi\n\necho \"=== All tests passed ===\"\n```\n\n## Manual Testing Checklist\n\nBefore merging:\n\n- [ ] macOS arm64: Run `./install.sh --easy-mode --verify`\n- [ ] macOS x64: Run `./install.sh --easy-mode --verify` (if available)\n- [ ] Linux: Run in Docker `ubuntu:22.04`\n- [ ] Network failure: Disconnect network, verify fallback\n- [ ] Rate limit: Run 100 times rapidly, verify no rate limiting\n- [ ] Old bash: Run on macOS default bash (`/bin/bash`)\n\n## Performance Testing\n\nCompare old vs new approach:\n\n```bash\n# Timing test\necho \"API approach:\"\ntime for i in {1..10}; do\n  curl -fsSL \"https://api.github.com/repos/Dicklesworthstone/cass_memory_system/releases/latest\" \\\n    | grep '\"tag_name\":' > /dev/null\ndone\n\necho \"Redirect approach:\"\ntime for i in {1..10}; do\n  curl -fsSL -o /dev/null -w '%{url_effective}' \\\n    \"https://github.com/Dicklesworthstone/cass_memory_system/releases/latest\" > /dev/null\ndone\n```\n\nExpected: Redirect approach should be faster (no JSON body to transfer).\n\n## Acceptance Criteria\n\n- [ ] All functional tests pass\n- [ ] Works on macOS arm64 (primary dev platform)\n- [ ] Works on Linux x64 (CI platform)\n- [ ] No regressions from current behavior\n- [ ] Performance is equal or better than API approach\n- [ ] CI integration added","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T18:39:43.993421Z","created_by":"jemanuel","updated_at":"2026-01-05T19:12:57.427218Z","closed_at":"2026-01-05T19:12:57.427218Z","close_reason":"Consolidating into single implementation task","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-gmyw","depends_on_id":"cass_memory_system-3o4m","type":"blocks","created_at":"2026-01-21T09:28:50Z","created_by":"import"},{"issue_id":"cass_memory_system-gmyw","depends_on_id":"cass_memory_system-8zpe","type":"blocks","created_at":"2026-01-21T09:28:50Z","created_by":"import"}]}
{"id":"cass_memory_system-gp8","title":"[Reflector] shouldExitEarly - Determine if more iterations needed","description":"function shouldExitEarly(\n  iteration: number,\n  deltasThisIteration: number,\n  totalDeltas: number,\n  config: Config\n): boolean\n\nExit early if:\n- No new deltas this iteration\n- Already have max deltas (20)\n- Iteration >= maxReflectorIterations\n\nSaves LLM calls when early iterations capture everything\n\nLOGIC:\n```typescript\nif (deltasThisIteration === 0) return true\nif (totalDeltas >= 20) return true\nif (iteration >= config.maxReflectorIterations - 1) return true\nreturn false\n```\n\nWHY EARLY EXIT:\n1. No new deltas: LLM has exhausted insights\n2. Max deltas (20): diminishing returns, avoid overwhelming playbook\n3. Max iterations: hard limit to prevent infinite loops\n\nEXAMPLE SCENARIOS:\n- Iteration 0: 15 deltas → continue\n- Iteration 1: 0 deltas → exit (total: 15)\n- Iteration 0: 12 deltas → continue\n- Iteration 1: 8 deltas → exit (total: 20, hit max)\n- Iteration 2: 3 deltas → continue\n- Iteration 3: 2 deltas → exit (hit maxReflectorIterations)\n\nCONFIG:\n- maxReflectorIterations: default 3\n- maxDeltas: hardcoded 20\n\nOPTIMIZATION:\nEarly exit saves unnecessary LLM calls and reduces latency\n\nUsed in reflectOnSession() main loop","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:45:03.662093Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-gpc7","title":"[MCP:Future] playbook resource definition","description":"Define playbook resource for MCP:\n\n```typescript\n{\n  uri: \"memory://playbook\",\n  name: \"Playbook\",\n  description: \"Current playbook with all bullets\",\n  mimeType: \"application/json\"\n}\n```\n\nReturns full playbook as a resource that agents can access directly.","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:49:34.042517Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-gr56","title":"[CLI] audit command - Check for rule violations","description":"Scan recent sessions for playbook rule violations.\n\nCommand signature:\n```bash\ncass-memory audit [options]\n\nOptions:\n  --days N           Scan sessions from last N days (default: 7)\n  --workspace PATH   Filter by workspace\n  --json             Output as JSON\n```\n\nPurpose:\nProactively check if recent coding sessions violated established playbook rules. Helps catch regressions and reinforces good practices.\n\nImplementation flow:\n1. Load current playbook (active bullets only)\n2. Get recent sessions:\n   - Call `cass timeline --days N --json`\n   - Filter by workspace if specified\n   \n3. Scan each session for violations:\n   - For each session:\n     - Export/summarize session content\n     - For each playbook bullet:\n       - LLM check: did this session violate this rule?\n       - If yes: record violation with evidence\n   \n4. Aggregate violations:\n   - Group by severity (derived from bullet maturity)\n   - Sort by session timestamp\n   \n5. Format and display:\n   - If --json: output AuditResult as JSON\n   - Else: format human-readable report\n   - Include actionable recommendations\n\nExample output:\n```\nAUDIT RESULTS (scanned 15 sessions)\n\nVIOLATIONS FOUND: 2\n\n1. [HIGH] Rule b-abc123: \"Always run tests before committing\"\n   Session: ~/.claude/.../session-001.jsonl\n   Evidence: Commit made without test run visible\n\n2. [MEDIUM] Rule b-def456: \"Use TypeScript strict mode\"\n   Session: ~/.cursor/.../session-xyz\n   Evidence: tsconfig.json has strict: false\n```\n\nThis helps maintain playbook adherence over time.","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:50:59.732580Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-gssx","title":"[Semantic] warmupEmbeddings - Pre-load model on init","description":"Pre-load embedding model during initialization for better UX.\n\nImplementation:\n```typescript\nasync function warmupEmbeddings(): Promise<boolean> {\n  try {\n    console.log(\"Warming up embedding model...\");\n    const embed = await getEmbedder();\n    \n    // Run test embedding to fully load model\n    await embed(\"test\", { pooling: \"mean\", normalize: true });\n    \n    console.log(\"Embedding model ready\");\n    return true;\n  } catch (error) {\n    console.warn(\"Could not warm up embeddings:\", error.message);\n    return false;\n  }\n}\n```\n\nWhy warm up:\n- First embedding is slow (~500ms model load)\n- Subsequent embeddings are fast (~3ms)\n- Better UX to load during init than during first query\n\nWhen to warm up:\n- During cass-memory init\n- Background async (non-blocking)\n- Before first context/stats command\n- After config change\n\nPerformance:\n- Warmup time: ~500ms (first time)\n- Warmup time: ~50ms (cached model)\n- Benefit: First query is instant\n\nUsage in CLI:\n```typescript\n// In main.ts\nasync function init() {\n  const config = await loadConfig();\n  \n  if (config.semanticSearchEnabled) {\n    // Do not await - let it warm up in background\n    warmupEmbeddings().catch(() => {\n      config.semanticSearchEnabled = false;\n    });\n  }\n}\n```\n\nAlternative: Lazy warmup\n- Do not warm up on init\n- Warm up on first semantic operation\n- Trade-off: Slower first command, faster startup\n\nConfig option:\n```yaml\nsemantic:\n  warmupOnInit: true  # Pre-load model\n  # vs\n  warmupOnInit: false  # Lazy load on first use\n```","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-07T21:49:49.949535Z","updated_at":"2025-12-14T00:19:49.232745Z","closed_at":"2025-12-14T00:19:49.232745Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-gssx","depends_on_id":"cass_memory_system-mnqm","type":"parent-child","created_at":"2026-01-21T09:28:50Z","created_by":"import"}]}
{"id":"cass_memory_system-gtqd","title":"Task: Audit all commands and migrate to printJson helpers","description":"# Task: Audit All Commands and Migrate to printJson Helpers\n\n## Context\n\nAfter creating `printJsonResult()` and fixing the critical outcome.ts violations, we need to systematically migrate ALL commands to use the standardized helpers.\n\n## Current State (Commands to Audit)\n\nCommands that currently use raw `console.log(JSON.stringify())`:\n\n| File | Line | Current Pattern |\n|------|------|-----------------|\n| mark.ts | 110 | `console.log(JSON.stringify({success:true,...}))` |\n| forget.ts | 83 | `console.log(JSON.stringify({success:true,...}))` |\n| outcome.ts | 131, 160, 173 | Multiple `console.log(JSON.stringify(...))` |\n| stale.ts | 146 | `console.log(JSON.stringify(...))` |\n| playbook.ts | 554, 665, 827 | Multiple patterns |\n\nCommands already using helpers (good examples):\n- context.ts:407 - uses `printJson(result)`\n- similar.ts:131 - uses `printJson(result)`\n- init.ts - uses `printJson()` throughout\n\n## Migration Rules\n\n1. **Replace raw JSON.stringify with printJsonResult():**\n   ```typescript\n   // Before\n   console.log(JSON.stringify({ bulletId, type }, null, 2));\n   \n   // After\n   printJsonResult({ bulletId, type });\n   ```\n\n2. **Ensure success field is present:**\n   ```typescript\n   // Before (bare array)\n   console.log(JSON.stringify(bullets, null, 2));\n   \n   // After (wrapped)\n   printJsonResult({ bullets });\n   ```\n\n3. **Use printJsonError() for error cases:**\n   ```typescript\n   // Before\n   console.log(JSON.stringify({ error: err.message }, null, 2));\n   \n   // After\n   printJsonError(err, { code: \"SPECIFIC_ERROR_CODE\" });\n   ```\n\n## Files to Modify\n\n- src/commands/mark.ts\n- src/commands/forget.ts\n- src/commands/outcome.ts (remaining after critical fix)\n- src/commands/stale.ts\n- src/commands/playbook.ts\n- src/commands/top.ts\n- src/commands/why.ts\n- src/commands/undo.ts\n- src/commands/audit.ts\n- Any others found during audit\n\n## Audit Checklist\n\nFor each command file:\n- [ ] Search for `console.log(JSON.stringify`\n- [ ] Search for `printJson(` (ensure using right helper)\n- [ ] Check ALL code paths that exit when `--json` is set\n- [ ] Verify success field present in all JSON responses\n- [ ] Verify error responses use printJsonError with code\n\n## Dependencies\n\n- Depends on: printJsonResult() helper\n- Depends on: outcome.ts critical fix (sets the pattern)\n\n## Acceptance Criteria\n\n- [ ] No raw `console.log(JSON.stringify())` in command files\n- [ ] All JSON responses have `success` boolean\n- [ ] All errors have `code` field\n- [ ] Grep for `JSON.stringify` in commands/ returns 0 results (except in helpers)\n\n## Estimated Scope\n\n- ~12-15 files to audit\n- ~30-40 individual changes\n- Medium effort, low risk (output changes only)\n\n## Notes\n\nThis is a systematic cleanup task. Can be done incrementally but should be completed before any new commands are added.","notes":"Scope clarification (Dec 15, 2025): This migration removed raw console.log(JSON.stringify(...)) patterns and standardized many *mutation* commands onto printJsonResult()/printJsonError(). It did not fully unify JSON envelopes across *read-only* commands (some still print raw payload without success) and did not fully standardize the top-level CLI error handler shape (src/cm.ts handleError). Remaining envelope/contract work is tracked under cass_memory_system-v8m5 and cass_memory_system-9iuc.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T18:24:53.475703Z","updated_at":"2025-12-15T21:39:03.577196Z","closed_at":"2025-12-15T20:11:30.352286Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-gtqd","depends_on_id":"cass_memory_system-1tjx","type":"blocks","created_at":"2026-01-21T09:28:50Z","created_by":"import"},{"issue_id":"cass_memory_system-gtqd","depends_on_id":"cass_memory_system-qwg9","type":"blocks","created_at":"2026-01-21T09:28:50Z","created_by":"import"},{"issue_id":"cass_memory_system-gtqd","depends_on_id":"cass_memory_system-xwlp","type":"blocks","created_at":"2026-01-21T09:28:50Z","created_by":"import"}]}
{"id":"cass_memory_system-gwr","title":"[Validator] EvidenceGateResult type definition","description":"Define the EvidenceGateResult type for pre-LLM filter results.\n\nTypeScript Interface:\n```typescript\ninterface EvidenceGateResult {\n  passed: boolean;           // Whether the rule passes the evidence gate\n  reason: string;            // Human-readable explanation\n  suggestedState: \"draft\" | \"active\";  // Recommended lifecycle state\n  sessionCount: number;      // Number of unique sessions containing evidence\n  successCount: number;      // Sessions that ended successfully\n  failureCount: number;      // Sessions that failed\n}\n```\n\nWHY THIS MATTERS:\n- Pre-LLM filter result - cheap check before expensive LLM call\n- Provides transparency into validation decision-making\n- Includes correlation data from diary entries\n- Guides lifecycle state assignment (draft vs active)\n\nUSAGE:\n- Returned by evidenceCountGate() function\n- Consumed by validateDelta() to determine next steps\n- Used in validation reports for audit trail\n\nDEPENDENCIES:\n- None (pure type definition)\n\nLOCATION:\n- src/types/validator.ts (or similar)","status":"tombstone","priority":3,"issue_type":"task","created_at":"2025-12-07T21:44:50.603554Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-gyur","title":"[Semantic] embedText - Generate embedding vector","description":"Generate 384-dimensional embedding vector from text.\n\nImplementation:\n```typescript\nasync function embedText(text: string): Promise<number[]> {\n  const embed = await getEmbedder();\n  const result = await embed(text, {\n    pooling: \"mean\",      // Average all token embeddings\n    normalize: true        // Unit vector for cosine similarity\n  });\n  return Array.from(result.data);  // Float32Array → number[]\n}\n```\n\nInput:\n- Any text string (bullet content, task description, etc.)\n- Automatically tokenized and truncated if too long\n- Max tokens: 512 (model limit)\n\nOutput:\n- 384-dimensional number array\n- Normalized to unit vector (L2 norm = 1)\n- Values typically in [-1, 1]\n\nPerformance:\n- ~3ms per embedding (after model load)\n- Can batch for efficiency\n\nUse cases:\n- Bullet content embedding\n- Task query embedding\n- Semantic search\n- Duplicate detection","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-07T21:49:28.793899Z","updated_at":"2025-12-13T09:31:43.553893Z","closed_at":"2025-12-13T09:31:43.553893Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-h2ol","title":"Fix Race Condition in Reflect Command & Context Awareness","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-08T03:02:35.998350Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-h4zk","title":"[Testing:Unit] curator.test.ts - Deterministic curation tests","description":"Test cases:\n- handleAddDelta: adds new, skips duplicates\n- handleHelpfulDelta: records event, checks promotion\n- handleHarmfulDelta: records event with reason\n- detectConflicts: finds contradictory rules\n- invertToAntiPattern: correct transformation\n- autoInvertHarmfulBullets: threshold-based inversion","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-07T21:49:35.798880Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-h6fy","title":"[P1] Add unit tests for output.ts module","description":"# Task: Unit tests for output.ts (232 lines)\n\n## Why Important\noutput.ts provides all terminal formatting utilities. Bugs here affect EVERY command's output quality.\n\n## What to Test\n\n### Formatting Functions\n- [ ] Table formatting with various widths\n- [ ] Text truncation preserves meaning\n- [ ] ANSI color codes applied correctly\n- [ ] Icons/emoji rendering\n\n### Terminal Width Handling\n- [ ] Narrow terminal (< 80 cols)\n- [ ] Wide terminal (> 120 cols)\n- [ ] No-TTY fallback\n\n### Output Modes\n- [ ] Color disabled mode\n- [ ] Emoji disabled mode\n- [ ] JSON-safe output (no ANSI)\n\n### Edge Cases\n- [ ] Empty input handling\n- [ ] Very long text handling\n- [ ] Unicode/emoji in content\n- [ ] Nested formatting\n\n## Files\n- Source: src/output.ts (232 lines)\n- Test: test/output.test.ts (new)\n\n## Acceptance\n- [ ] All formatting functions tested\n- [ ] Width handling verified\n- [ ] Mode toggles work\n- [ ] No mocks used","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-16T15:30:25.181210Z","updated_at":"2025-12-16T21:20:15.794975Z","closed_at":"2025-12-16T21:20:15.794975Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-hb4y","title":"Enhanced Agent-Native Onboarding v2","description":"# Epic: Enhanced Agent-Native Onboarding v2\n\n## Background & Context\n\nThe `cm onboard` command (added in bcac363) provides agent-native onboarding - a workflow where the coding agent itself extracts rules from cass sessions, eliminating the need for expensive LLM API calls. This is \"free\" when using Claude Max or GPT Pro since the agent is already paid for.\n\n**Current State (v1):**\n- `--status`: Check onboarding status\n- `--sample`: Sample diverse sessions for analysis  \n- `--read <path>`: Export session content for agent\n- `--prompt`: Show extraction instructions\n- `--guided`: Full guided flow\n\n**Key Problems:**\n1. No progress tracking - can't resume across sessions\n2. Must add rules one-by-one via repeated commands\n3. Blind sampling - doesn't consider playbook gaps\n4. No validation - easy to add duplicates\n5. Generic guidance regardless of playbook state\n\n## Goals\n\n1. Reduce friction: Batch add rules, track progress\n2. Smarter sampling: Fill gaps in playbook coverage\n3. Quality gates: Catch duplicates before adding\n4. Targeted focus: Let agents focus on specific areas\n5. Better guidance: Context-aware extraction templates\n\n## Non-Goals (Cut)\n\n- Impact preview (use existing cm stats)\n- Cross-session pattern detection (agent does this better)\n- LLM-based analysis (defeats \"no API cost\" purpose)","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-15T15:32:05.296587Z","updated_at":"2025-12-15T16:40:38.185038Z","closed_at":"2025-12-15T16:40:38.185038Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-hb4y.1","title":"Onboarding Progress Tracking","description":"Track which sessions have been analyzed to enable resumable onboarding across agent sessions.\n\n## Problem\nNo memory of which sessions have been analyzed. If agent context fills mid-onboarding, they must start over.\n\n## Solution\nState file at ~/.cass-memory/onboarding-state.json tracking:\n- Processed sessions (by path)\n- Rules extracted count\n- Timestamps\n\n## Acceptance Criteria\n- --status shows progress stats\n- --sample excludes processed sessions\n- --mark-done marks session without adding rules\n- --reset clears progress\n- --include-processed overrides exclusion","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-15T15:34:46.320157Z","updated_at":"2025-12-15T16:04:31.435427Z","closed_at":"2025-12-15T16:04:31.435427Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-hb4y.1","depends_on_id":"cass_memory_system-hb4y","type":"parent-child","created_at":"2026-01-21T09:28:50Z","created_by":"import"}]}
{"id":"cass_memory_system-hb4y.1.1","title":"Implement onboarding state persistence","description":"Create state management for tracking onboarding progress.\n\n## State Schema\n```json\n{\n  \"version\": 1,\n  \"startedAt\": \"ISO8601\",\n  \"lastUpdatedAt\": \"ISO8601\",\n  \"processedSessions\": [\n    {\"path\": \"string\", \"processedAt\": \"ISO8601\", \"rulesExtracted\": number}\n  ],\n  \"stats\": {\"totalSessionsProcessed\": number, \"totalRulesExtracted\": number}\n}\n```\n\n## Functions to Implement\n1. loadOnboardState() - Read file, return default if missing\n2. saveOnboardState() - Atomic write (temp file + rename)\n3. markSessionProcessed(path, rulesExtracted) - Add to list, update stats\n4. isSessionProcessed(path) - Check if in list\n5. resetOnboardState() - Delete file\n\n## File Location\n~/.cass-memory/onboarding-state.json\n\n## Considerations\n- Atomic write prevents corruption on crash\n- Version field enables future schema migrations\n- Stats derived from processedSessions for consistency\n- Handle corrupted JSON gracefully (warn + return empty)\n\n## Files to Create/Modify\n- src/onboard-state.ts (new) - State management\n- src/commands/onboard.ts - Import and use","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-15T15:35:31.437384Z","updated_at":"2025-12-15T15:47:40.057704Z","closed_at":"2025-12-15T15:47:40.057704Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-hb4y.1.1","depends_on_id":"cass_memory_system-hb4y.1","type":"parent-child","created_at":"2026-01-21T09:28:50Z","created_by":"import"}]}
{"id":"cass_memory_system-hb4y.1.2","title":"Integrate progress into sample and status","description":"Connect state management to --sample and --status commands.\n\n## --status Changes\nAdd progress section to output:\n```json\n{\n  \"status\": {...},\n  \"progress\": {\n    \"sessionsProcessed\": 5,\n    \"rulesExtracted\": 15,\n    \"startedAt\": \"...\",\n    \"lastActivity\": \"...\"\n  }\n}\n```\n\n## --sample Changes\n1. Load state on startup\n2. Filter out processed sessions from results\n3. Show \"X sessions remaining\" in output\n4. Add --include-processed flag to override\n\n## Human Output\n```\nONBOARDING STATUS\n  Progress: 5 sessions analyzed, 15 rules extracted\n  Started: 2 hours ago\n  Last activity: 10 minutes ago\n```\n\n## Depends On\n- State persistence task (for load/isProcessed functions)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-15T15:35:33.175735Z","updated_at":"2025-12-15T16:04:26.111321Z","closed_at":"2025-12-15T16:04:26.111321Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-hb4y.1.2","depends_on_id":"cass_memory_system-hb4y.1","type":"parent-child","created_at":"2026-01-21T09:28:50Z","created_by":"import"},{"issue_id":"cass_memory_system-hb4y.1.2","depends_on_id":"cass_memory_system-hb4y.1.1","type":"blocks","created_at":"2026-01-21T09:28:50Z","created_by":"import"}]}
{"id":"cass_memory_system-hb4y.1.3","title":"Add mark-done and reset commands","description":"Add commands to manually manage onboarding state.\n\n## --mark-done <path>\n- Validates path exists (warning if not in cass)\n- Marks as processed with rulesExtracted=0\n- Idempotent (marking twice is fine)\n- Use case: Session analyzed but no useful rules found\n\n## --reset\n- Deletes state file\n- Confirms in human mode: \"Reset onboarding progress? [y/N]\"\n- --yes skips confirmation\n- Use case: Start fresh after playbook overhaul\n\n## Implementation\n- Add options to onboard command in cm.ts\n- Add handlers in onboard.ts\n- Use existing state functions\n\n## Depends On\n- State persistence task","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T15:35:34.559083Z","updated_at":"2025-12-15T16:04:26.112132Z","closed_at":"2025-12-15T16:04:26.112132Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-hb4y.1.3","depends_on_id":"cass_memory_system-hb4y.1","type":"parent-child","created_at":"2026-01-21T09:28:50Z","created_by":"import"},{"issue_id":"cass_memory_system-hb4y.1.3","depends_on_id":"cass_memory_system-hb4y.1.1","type":"blocks","created_at":"2026-01-21T09:28:50Z","created_by":"import"}]}
{"id":"cass_memory_system-hb4y.2","title":"Batch Rule Addition","description":"Add multiple rules at once via --file option to reduce friction from N commands to 1.\n\n## Problem\nAfter extracting 10 rules, agent must run cm playbook add 10 times. Tedious and error-prone.\n\n## Solution\nAdd --file option to cm playbook add that accepts JSON array:\n[{\"content\": \"rule text\", \"category\": \"debugging\"}]\n\nSupport stdin via --file - for piping.\n\n## Design Decision\nEnhance existing playbook add command rather than new command (minimal API surface).\n\n## Acceptance Criteria\n- cm playbook add --file rules.json adds all rules\n- echo '[...]' | cm playbook add --file - reads stdin\n- Returns structured results (successes/failures)\n- Partial success allowed","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-15T15:34:49.058072Z","updated_at":"2025-12-15T16:04:31.436317Z","closed_at":"2025-12-15T16:04:31.436317Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-hb4y.2","depends_on_id":"cass_memory_system-hb4y","type":"parent-child","created_at":"2026-01-21T09:28:50Z","created_by":"import"}]}
{"id":"cass_memory_system-hb4y.2.1","title":"Add --file option to playbook add command","description":"Enable batch rule addition via JSON file input.\n\n## Command Changes\ncm playbook add --file <path>  # from file\ncm playbook add --file -       # from stdin\n\n## Input Format\n```json\n[\n  {\"content\": \"Rule text\", \"category\": \"debugging\"},\n  {\"content\": \"Another rule\", \"category\": \"testing\"}\n]\n```\n\n## Output Format\n```json\n{\n  \"success\": true,\n  \"added\": [\n    {\"id\": \"b-xxx\", \"content\": \"...\", \"category\": \"...\"}\n  ],\n  \"failed\": [\n    {\"content\": \"...\", \"error\": \"Content too short\"}\n  ],\n  \"summary\": {\"total\": 3, \"succeeded\": 2, \"failed\": 1}\n}\n```\n\n## Error Handling\n- Invalid JSON: Fail fast with clear error\n- Missing content: Skip entry, report in failed\n- Empty array: Warning, no-op\n\n## Files to Modify\n- src/cm.ts - Add --file option to playbook add\n- src/commands/playbook.ts - Implement batch handling\n\n## Implementation Notes\n- Read file/stdin synchronously before processing\n- Validate JSON structure upfront\n- Process rules sequentially (order matters for IDs)\n- Collect all results before returning","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-15T15:36:01.505412Z","updated_at":"2025-12-15T15:50:56.313332Z","closed_at":"2025-12-15T15:50:56.313332Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-hb4y.2.1","depends_on_id":"cass_memory_system-hb4y.2","type":"parent-child","created_at":"2026-01-21T09:28:50Z","created_by":"import"}]}
{"id":"cass_memory_system-hb4y.2.2","title":"Integrate batch add with onboarding state","description":"Connect batch add to progress tracking via optional --session flag.\n\n## New Option\ncm playbook add --file rules.json --session /path/to/session.jsonl\n\n## Behavior\nWhen --session provided:\n1. After successful batch add, mark session as processed\n2. Record number of rules actually added\n3. Update stats\n\n## Use Case\nTypical agent workflow:\n1. cm onboard --read /path/session.jsonl --json > analyze\n2. Agent extracts rules, writes to rules.json\n3. cm playbook add --file rules.json --session /path/session.jsonl\n4. Progress automatically tracked\n\n## Depends On\n- --file option implementation\n- State persistence","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T15:36:03.234637Z","updated_at":"2025-12-15T15:50:56.361051Z","closed_at":"2025-12-15T15:50:56.361051Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-hb4y.2.2","depends_on_id":"cass_memory_system-hb4y.1.1","type":"blocks","created_at":"2026-01-21T09:28:50Z","created_by":"import"},{"issue_id":"cass_memory_system-hb4y.2.2","depends_on_id":"cass_memory_system-hb4y.2","type":"parent-child","created_at":"2026-01-21T09:28:50Z","created_by":"import"},{"issue_id":"cass_memory_system-hb4y.2.2","depends_on_id":"cass_memory_system-hb4y.2.1","type":"blocks","created_at":"2026-01-21T09:28:50Z","created_by":"import"}]}
{"id":"cass_memory_system-hb4y.3","title":"Gap-Aware Sampling","description":"Sample sessions that fill gaps in playbook coverage.\n\n## Problem\nCurrent sampling uses hardcoded queries, ignoring what playbook already covers.\n\n## Solution\nAnalyze playbook category distribution and prioritize sessions likely to yield rules in underrepresented categories.\n\n## Gap Classification\n- Critical: 0 rules in category\n- Underrepresented: < 3 rules\n- Adequate: 3-10 rules\n- Well-covered: > 10 rules\n\n## Design Decision (v1)\nAnalyze playbook only (not cass content). If playbook has 0 testing rules, \"testing\" is a gap regardless of cass content. Simpler and sufficient.\n\n## Acceptance Criteria\n- --fill-gaps flag prioritizes gap-filling sessions\n- Gap analysis shown in --status output\n- Sessions tagged with likely categories","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-15T15:34:50.585766Z","updated_at":"2025-12-15T16:04:31.436832Z","closed_at":"2025-12-15T16:04:31.436832Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-hb4y.3","depends_on_id":"cass_memory_system-hb4y","type":"parent-child","created_at":"2026-01-21T09:28:50Z","created_by":"import"}]}
{"id":"cass_memory_system-hb4y.3.1","title":"Implement playbook gap analysis function","description":"Create function to analyze playbook category distribution and identify gaps.\n\n## Function Signature\nanalyzePlaybookGaps(playbook: Playbook): PlaybookGapAnalysis\n\n## Output Structure\n```typescript\ninterface PlaybookGapAnalysis {\n  totalRules: number;\n  byCategory: Record<string, {\n    count: number;\n    status: 'critical' | 'underrepresented' | 'adequate' | 'well-covered';\n  }>;\n  gaps: {\n    critical: string[];      // 0 rules\n    underrepresented: string[]; // < 3 rules\n  };\n  suggestions: string; // Human-readable summary\n}\n```\n\n## Thresholds\n- Critical: 0 rules\n- Underrepresented: 1-2 rules\n- Adequate: 3-10 rules\n- Well-covered: > 10 rules\n\n## Category Keyword Map\nAlso create CATEGORY_KEYWORDS for estimating session categories:\n```typescript\nconst CATEGORY_KEYWORDS = {\n  testing: [\"test\", \"spec\", \"mock\", \"assert\", \"expect\"],\n  debugging: [\"debug\", \"error\", \"fix\", \"bug\", \"trace\"],\n  security: [\"auth\", \"security\", \"token\", \"password\"],\n  // ...\n};\n```\n\n## Files to Create/Modify\n- src/gap-analysis.ts (new) - Gap analysis functions\n- src/commands/onboard.ts - Import and use","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T15:36:04.876214Z","updated_at":"2025-12-15T16:00:04.675121Z","closed_at":"2025-12-15T16:00:04.675121Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-hb4y.3.1","depends_on_id":"cass_memory_system-hb4y.3","type":"parent-child","created_at":"2026-01-21T09:28:51Z","created_by":"import"}]}
{"id":"cass_memory_system-hb4y.3.2","title":"Add --fill-gaps flag to sampling","description":"Modify --sample to prioritize gap-filling sessions when --fill-gaps is set.\n\n## Command\ncm onboard --sample --fill-gaps --json\n\n## Algorithm\n1. Run gap analysis on current playbook\n2. Identify gap categories (critical + underrepresented)\n3. Modify search queries to include gap category keywords\n4. Score each session by gap-filling potential\n5. Sort results by score (highest first)\n\n## Output Enhancement\n```json\n{\n  \"sessions\": [{\n    \"path\": \"/path/session.jsonl\",\n    \"reason\": \"Contains testing patterns; playbook has 1 testing rule\",\n    \"likelyCategories\": [\"testing\", \"debugging\"],\n    \"gapScore\": 0.85\n  }],\n  \"gapsTargeted\": [\"testing\", \"security\"],\n  \"playbookGaps\": { ... full gap analysis ... }\n}\n```\n\n## Session Category Detection\nUse CATEGORY_KEYWORDS on session snippet to estimate likely categories.\n\n## Depends On\n- Gap analysis function","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T15:36:07.055104Z","updated_at":"2025-12-15T16:00:04.677775Z","closed_at":"2025-12-15T16:00:04.677775Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-hb4y.3.2","depends_on_id":"cass_memory_system-hb4y.3","type":"parent-child","created_at":"2026-01-21T09:28:51Z","created_by":"import"},{"issue_id":"cass_memory_system-hb4y.3.2","depends_on_id":"cass_memory_system-hb4y.3.1","type":"blocks","created_at":"2026-01-21T09:28:51Z","created_by":"import"}]}
{"id":"cass_memory_system-hb4y.4","title":"Targeted Sampling Options","description":"Filter sampled sessions by workspace, agent, time, and depth.\n\n## New Options\nScope: --workspace, --agent, --category\nDepth: --quick (5 sessions), --deep (30 sessions)\nTime: --days, --since, --before\n\n## Use Cases\n- Focus on specific project: --workspace /path/to/project\n- Learn from specific agent: --agent claude\n- Quick bootstrap: --quick\n- Thorough analysis: --deep\n- Recent patterns: --days 30\n\n## Acceptance Criteria\n- All filters work independently and can be combined\n- Filters passed through to cass search where possible\n- JSON output includes applied filters","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-15T15:34:52.010278Z","updated_at":"2025-12-15T16:04:31.437392Z","closed_at":"2025-12-15T16:04:31.437392Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-hb4y.4","depends_on_id":"cass_memory_system-hb4y","type":"parent-child","created_at":"2026-01-21T09:28:51Z","created_by":"import"}]}
{"id":"cass_memory_system-hb4y.4.1","title":"Add scope filters to sampling","description":"Add --workspace, --agent, and --category filters to --sample.\n\n## New Options\n--workspace <path>  Filter to sessions from this workspace\n--agent <name>      Filter to sessions from this agent (claude, cursor, etc)\n--category <cat>    Filter to sessions likely about this category\n\n## Implementation\n1. --workspace: Pass through to cass search --workspace\n2. --agent: Pass through to cass search --agent\n3. --category: Add category keywords to search queries\n\n## Category Filter\nUses CATEGORY_KEYWORDS map to generate search terms:\n--category testing → search for \"test spec mock assert\"\n\n## Cass Integration\nCheck if cass supports these filters, pass through where possible.\nFor filters cass doesn't support, do post-filtering on results.\n\n## Output\n```json\n{\n  \"sessions\": [...],\n  \"filters\": {\n    \"workspace\": \"/path/to/project\",\n    \"agent\": \"claude\",\n    \"category\": null\n  }\n}\n```\n\n## Files to Modify\n- src/cm.ts - Add options\n- src/commands/onboard.ts - Implement filtering\n- src/cass.ts - Ensure CassSearchOptions supports filters","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T15:36:38.203235Z","updated_at":"2025-12-15T16:04:26.112560Z","closed_at":"2025-12-15T16:04:26.112560Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-hb4y.4.1","depends_on_id":"cass_memory_system-hb4y.4","type":"parent-child","created_at":"2026-01-21T09:28:51Z","created_by":"import"}]}
{"id":"cass_memory_system-hb4y.4.2","title":"Add depth modes and time filters","description":"Add --quick, --deep, --days, --since, --before options to --sample.\n\n## Depth Modes\n--quick   Sets limit=5, uses broader queries for fast bootstrap\n--deep    Sets limit=30, uses more diverse queries for thorough analysis\n\n## Time Filters\n--days <n>       Sessions from last N days (passes to cass)\n--since <date>   Sessions after this date (ISO8601)\n--before <date>  Sessions before this date (ISO8601)\n\n## Implementation\n- --quick/--deep: Presets that set limit and query diversity\n- --days: Pass to cass search --days\n- --since/--before: Convert to days or filter post-search\n\n## Interaction with --limit\nIf user provides explicit --limit, it overrides --quick/--deep.\n--quick --limit 10 → uses limit=10\n\n## Default Behavior\nWithout flags: limit=10, no time filter (current behavior)\n\n## Files to Modify\n- src/cm.ts - Add options\n- src/commands/onboard.ts - Implement modes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T15:36:40.441196Z","updated_at":"2025-12-15T16:04:26.113007Z","closed_at":"2025-12-15T16:04:26.113007Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-hb4y.4.2","depends_on_id":"cass_memory_system-hb4y.4","type":"parent-child","created_at":"2026-01-21T09:28:51Z","created_by":"import"}]}
{"id":"cass_memory_system-hb4y.5","title":"Pre-Add Validation","description":"Validate rules before adding to prevent duplicates and low-quality entries.\n\n## Problem\nWithout validation, agents can easily add near-duplicate or low-quality rules.\n\n## Validation Checks\n1. Similarity: Warn if >0.8 similar to existing rule\n2. Quality: Too short (<10 words), too long (>100 words), missing context\n3. Category: Suggest better category if mismatch detected\n\n## Design Decision\nNon-blocking by default. --check shows results, --strict fails on warnings.\n\n## Acceptance Criteria\n- --check flag shows validation results\n- --strict fails on warnings\n- Works with --file batch add\n- JSON output includes validation details","status":"closed","priority":3,"issue_type":"feature","created_at":"2025-12-15T15:35:06.084646Z","updated_at":"2025-12-15T16:40:31.788982Z","closed_at":"2025-12-15T16:40:31.788982Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-hb4y.5","depends_on_id":"cass_memory_system-hb4y","type":"parent-child","created_at":"2026-01-21T09:28:51Z","created_by":"import"}]}
{"id":"cass_memory_system-hb4y.5.1","title":"Implement similarity and quality checks","description":"Create validation function for rule quality and duplicate detection.\n\n## CONSTRAINT: Lightweight Similarity - ALREADY SATISFIED\nThe codebase already uses Xenova/transformers with all-MiniLM-L6-v2:\n- ~23MB local model (one-time download)\n- Runs on CPU (no GPU required)\n- No external API calls\n- Cached for offline use\n\nWe will REUSE this existing infrastructure via cm similar / findSimilarBulletsSemantic.\n\n## Function Signature\nvalidateRule(content: string, category: string, playbook: Playbook): ValidationResult\n\n## ValidationResult Structure\n```typescript\ninterface ValidationResult {\n  valid: boolean;\n  warnings: Array<{\n    type: 'similarity' | 'quality' | 'category';\n    message: string;\n    severity: 'error' | 'warning' | 'suggestion';\n    details?: any;\n  }>;\n  suggestions: {\n    category?: string;\n    reason?: string;\n  };\n}\n```\n\n## Checks to Implement\n\n### 1. Similarity Check\n- Use existing findSimilarBulletsSemantic from semantic.ts\n- Threshold: > 0.8 triggers warning\n- Return: matching rule ID and score\n\n### 2. Quality Heuristics (Simple string checks)\n- Too short: < 10 words → warning\n- Too long: > 100 words → suggestion to split\n- Missing context: No \"when\", \"if\", \"before\", \"after\", \"always\", \"never\" → suggestion\n- Too vague: Contains only generic words → warning\n\n### 3. Category Check (Keyword-based)\n- Match content keywords against CATEGORY_KEYWORDS\n- Pure keyword matching\n- If detected category differs from provided, suggest alternative\n\n## Files to Create/Modify\n- src/rule-validation.ts (new) - Validation functions\n- src/commands/playbook.ts - Import and use","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-15T15:36:41.576663Z","updated_at":"2025-12-15T16:36:08.600229Z","closed_at":"2025-12-15T16:36:08.600229Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-hb4y.5.1","depends_on_id":"cass_memory_system-hb4y.5","type":"parent-child","created_at":"2026-01-21T09:28:51Z","created_by":"import"}]}
{"id":"cass_memory_system-hb4y.5.2","title":"Add --check and --strict flags","description":"Add validation flags to playbook add command.\n\n## --check Flag\nShows validation results before adding:\n```\nValidation Results:\n  ✓ No similar rules found (highest: 0.45)\n  ⚠ Consider adding context: when does this apply?\n  \nAdding rule...\nAdded: b-xxx123\n```\n\nIn JSON mode:\n```json\n{\n  \"validation\": {...},\n  \"added\": {\"id\": \"b-xxx\", ...}\n}\n```\n\n## --strict Flag\nCombined with --check, fails if any warnings:\n- Exit code 1\n- Rule NOT added\n- Clear error message\n\n## Behavior Matrix\n| Flags | Warnings Present | Result |\n|-------|-----------------|--------|\n| (none) | - | Add silently |\n| --check | No | Add, show validation |\n| --check | Yes | Add, show warnings |\n| --check --strict | No | Add, show validation |\n| --check --strict | Yes | FAIL, don't add |\n\n## Batch Add Integration\nWith --file:\n- --check validates each rule, shows results\n- --strict skips rules with warnings, adds others\n- Summary shows validated/skipped counts\n\n## Files to Modify\n- src/cm.ts - Add flags\n- src/commands/playbook.ts - Integrate validation\n\n## Depends On\n- Validation functions implementation","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-15T15:36:42.898427Z","updated_at":"2025-12-15T16:40:30.720778Z","closed_at":"2025-12-15T16:40:30.720778Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-hb4y.5.2","depends_on_id":"cass_memory_system-hb4y.5","type":"parent-child","created_at":"2026-01-21T09:28:51Z","created_by":"import"},{"issue_id":"cass_memory_system-hb4y.5.2","depends_on_id":"cass_memory_system-hb4y.5.1","type":"blocks","created_at":"2026-01-21T09:28:51Z","created_by":"import"}]}
{"id":"cass_memory_system-hb4y.6","title":"Enhanced Read Output (Template)","description":"Provide contextual guidance when reading sessions with --template flag.\n\n## Problem\ncm onboard --read dumps raw content. Agent must figure out context alone.\n\n## Solution\n--template flag enriches output with:\n- Session metadata (agent, workspace, message count)\n- Topic hints (detected from content)\n- Related existing rules (similarity search)\n- Playbook gaps (from gap analysis)\n- Suggested extraction focus\n\n## Acceptance Criteria\n- --read --template returns enriched JSON\n- Related rules found via similarity search\n- Gaps included from gap analysis\n- Human-readable and JSON output modes","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-15T15:35:08.023500Z","updated_at":"2025-12-15T16:04:31.437848Z","closed_at":"2025-12-15T16:04:31.437848Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-hb4y.6","depends_on_id":"cass_memory_system-hb4y","type":"parent-child","created_at":"2026-01-21T09:28:51Z","created_by":"import"}]}
{"id":"cass_memory_system-hb4y.6.1","title":"Add --template flag to read command","description":"Enhance --read with --template flag for contextual extraction guidance.\n\n## CONSTRAINT: Lightweight Similarity - ALREADY SATISFIED\nUses existing local Xenova/transformers model (23MB, CPU, no external APIs).\n\n## Command\ncm onboard --read <path> --template --json\n\n## Output Structure\n```json\n{\n  \"metadata\": {\n    \"path\": \"/path/session.jsonl\",\n    \"agent\": \"claude\",\n    \"workspace\": \"/Users/x/project\",\n    \"messageCount\": 45,\n    \"topicHints\": [\"authentication\", \"API\", \"error handling\"]\n  },\n  \"context\": {\n    \"relatedRules\": [\n      {\"id\": \"b-abc\", \"content\": \"...\", \"similarity\": 0.6}\n    ],\n    \"playbookGaps\": {\n      \"critical\": [\"security\"],\n      \"underrepresented\": [\"testing\"]\n    },\n    \"suggestedFocus\": \"Look for error handling and API patterns\"\n  },\n  \"extractionFormat\": {\n    \"schema\": {\"content\": \"string\", \"category\": \"string\"},\n    \"categories\": [\"debugging\", \"testing\", ...]\n  },\n  \"sessionContent\": \"...\"\n}\n```\n\n## Topic Detection (Keyword-based)\n1. Extract words from first ~10 messages\n2. Match against CATEGORY_KEYWORDS\n3. Return top 3-5 matching categories\n\n## Related Rules\n1. Create snippet from session (first few messages)\n2. Use findSimilarBulletsSemantic from semantic.ts\n3. Return top 5 matches with score > 0.3\n\n## Note on Semantic Search\nIf semanticSearchEnabled is false in config, skip related rules section.\nThis is fine - related rules are \"nice to have\", not critical.\n\n## Depends On\n- Gap analysis function\n\n## Files to Modify\n- src/cm.ts - Add --template option\n- src/commands/onboard.ts - Implement template generation","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T15:37:03.230924Z","updated_at":"2025-12-15T16:04:09.477324Z","closed_at":"2025-12-15T16:04:09.477324Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-hb4y.6.1","depends_on_id":"cass_memory_system-hb4y.3.1","type":"blocks","created_at":"2026-01-21T09:28:51Z","created_by":"import"},{"issue_id":"cass_memory_system-hb4y.6.1","depends_on_id":"cass_memory_system-hb4y.6","type":"parent-child","created_at":"2026-01-21T09:28:51Z","created_by":"import"}]}
{"id":"cass_memory_system-hbjv","title":"[Testing:Property] deduplication.test.ts - Property-based tests","description":"Using fast-check:\nimport fc from \"fast-check\";\n\n// Properties:\n// - jaccardSimilarity is symmetric\n// - jaccardSimilarity returns [0, 1]\n// - identical strings have similarity 1.0\n// - hashContent is deterministic\n// - different content produces different hashes (usually)\n// - exact duplicates are always detected","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-07T21:49:47.303349Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-hfi","title":"[Cass] withCassErrorRecovery - Generic error recovery wrapper","description":"Implement withCassErrorRecovery() generic wrapper for consistent error handling.\n\n## Signature\n```typescript\nasync function withCassErrorRecovery<T>(\n  operation: () => Promise<T>,\n  fallback: T,\n  options?: { \n    maxRetries?: number; \n    rebuildIndexOnError?: boolean;\n  }\n): Promise<T>\n```\n\n## Implementation Flow\n1. Try operation\n2. On error, check exit code against CASS_EXIT_CODES\n3. If retryable and has recovery action, attempt recovery:\n   - Exit 3: Rebuild index, retry operation\n   - Exit 10: Modify operation params (caller responsibility), retry\n4. If max retries exhausted or non-retryable, return fallback\n5. Log all recovery attempts\n\n## Error Handling Strategy\n```typescript\nlet attempts = 0;\nconst maxRetries = options?.maxRetries || 1;\n\nwhile (attempts <= maxRetries) {\n  try {\n    return await operation();\n  } catch (error) {\n    const exitCode = extractExitCode(error);\n    const codeInfo = CASS_EXIT_CODES[exitCode];\n    \n    if (!codeInfo?.retryable || attempts >= maxRetries) {\n      log.debug(\"Non-retryable or max retries, returning fallback\");\n      return fallback;\n    }\n    \n    // Attempt recovery\n    if (codeInfo.action === \"rebuild_index\" && options?.rebuildIndexOnError) {\n      await cassIndex({ full: true });\n    }\n    \n    attempts++;\n  }\n}\n\nreturn fallback;\n```\n\n## Parameters\n- operation: Async function to wrap\n- fallback: Value to return on failure\n- options.maxRetries: Max retry attempts (default: 1)\n- options.rebuildIndexOnError: Auto-rebuild on exit 3 (default: false)\n\n## Usage\nDRY wrapper for consistent error handling:\n```typescript\n// Simple usage\nconst hits = await withCassErrorRecovery(\n  () => cassSearch(\"query\"),\n  [],\n  { rebuildIndexOnError: true }\n);\n\n// Complex usage\nconst result = await withCassErrorRecovery(\n  async () => {\n    const timeline = await cassTimeline(7);\n    return processTimeline(timeline);\n  },\n  { groups: [] },\n  { maxRetries: 2 }\n);\n```\n\n## Benefits\n- Centralized retry logic\n- Consistent error handling across all cass operations\n- Automatic recovery actions based on exit codes\n- Reduces boilerplate in wrapper functions","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:45:05.553389Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-hg12","title":"[Design] README Structure for Agent-First Framing","description":"# README Structure for Agent-First Framing\n\n## Purpose\nDesign the new structure for README.md that clearly separates concerns:\n- Agents are primary users (consumers of memory)\n- Humans are operators (setup, monitoring, oversight)\n\n## Proposed Structure\n\n### Section 1: What This Is (~10% of doc)\n- Tagline: \"Universal memory system FOR AI coding agents\"\n- The problem (agents forget everything)\n- The solution (three-layer architecture)\n- Key insight: Agents consume, humans operate\n\n### Section 2: Quick Start - For Humans (~15%)\n- Installation (one-liners)\n- Add blurb to AGENTS.md (point to blurb section)\n- Basic health check\n- That's it - you're done\n\n### Section 3: For Agents - How to Use Memory (~20%)\n- The protocol (START: context, WORK: reference rules, END: automatic)\n- Essential command reference (context, mark)\n- Output schemas\n- Error handling\n\n### Section 4: For Humans - Operation & Monitoring (~15%)\n- Configuration options\n- Running reflection (manual or cron)\n- Stats and health monitoring\n- Audit and review tools\n\n### Section 5: Architecture (~20%)\n- Three-layer memory model\n- ACE pipeline\n- Scoring and decay\n- Data models\n\n### Section 6: Advanced (~10%)\n- MCP server mode\n- Custom starters\n- Extending the system\n\n### Section 7: Reference (~10%)\n- All commands (comprehensive)\n- Configuration schema\n- Troubleshooting\n\n## Key Changes from Current\n\n1. Remove \"Typical Workflow\" section showing humans running commands\n2. Remove \"Individual developers\" and \"Power users\" as audiences\n3. Move human commands (init, reflect, playbook add) to operator section\n4. Simplify agent section to essential commands only\n5. Add explicit blurb section\n\n## Deliverables\n- [ ] Detailed outline with section headers\n- [ ] Content migration plan (what moves where)\n- [ ] List of sections to remove/merge","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-08T17:46:33.025719Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-hh3","title":"[Curator] handleHelpfulDelta - Record positive feedback","description":"Record positive feedback and check for maturity promotions.\n\nSignature:\nfunction handleHelpfulDelta(\n  playbook: Playbook,\n  delta: HelpfulDelta\n): { applied: boolean; promotion?: PromotionReport }\n\nProcess:\n1. Find bullet by ID\n   - If not found: return applied: false\n2. Create FeedbackEvent:\n   - timestamp: Date.now()\n   - sessionId: delta.sessionId\n   - context: delta.context (optional)\n3. Push to bullet.helpfulEvents array\n4. Increment bullet.helpfulCount\n5. Update bullet.lastValidatedAt to current timestamp\n6. Update bullet.updatedAt\n7. Check for promotion eligibility:\n   - candidate → validated: helpfulCount >= 3 && effectiveScore >= 2\n   - validated → trusted: helpfulCount >= 10 && effectiveScore >= 8\n   - trusted → core: helpfulCount >= 25 && effectiveScore >= 20\n8. If promoted:\n   - Update bullet.maturity\n   - Create PromotionReport\n   - Add to result.promotions\n9. Return result\n\nPromotion thresholds enforce evidence-based trust. Bullets must prove value over time.\n\nNote: effectiveScore = helpfulCount - harmfulCount","status":"tombstone","priority":3,"issue_type":"task","created_at":"2025-12-07T21:44:57.952849Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-hhrv","title":"[Critical] Undo/Rollback - Revert Bad Curation Decisions","description":"$(cat /tmp/fix_hhrv.txt)","status":"tombstone","priority":1,"issue_type":"feature","created_at":"2025-12-07T22:08:19.546516Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"feature","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-hir","title":"[Generator] generateSearchPlan - LLM query generation","description":"LLM-powered query generation for cass searches.\n\nSIGNATURE:\nasync function generateSearchPlan(task: string, config: Config): Promise<{ queries: string[]; keywords: string[] }>\n\nPURPOSE:\nUses LLM to analyze the task and generate targeted search queries for cass, plus keywords for playbook bullet matching. This ensures we find the most relevant historical context.\n\nOUTPUT:\n- queries: 3-5 targeted cass search strings\n- keywords: List of important terms for bullet scoring\n\nEXAMPLE:\nTask: 'Fix authentication timeout bug'\nOutput:\n  queries: ['authentication timeout', 'token expiry', 'session timeout fix']\n  keywords: ['authentication', 'timeout', 'token', 'session', 'jwt']\n\nIMPLEMENTATION NOTES:\n- Uses config.llmProvider and config.llmModel\n- Prompt should emphasize: specific technical terms, error patterns, component names\n- Fallback to extractKeywords (simple regex) if LLM unavailable\n- Cache queries if same task seen recently (optional optimization)\n\nPROMPT STRUCTURE:\nGiven task: {task}\nGenerate 3-5 search queries that would find relevant past work on:\n- Similar problems solved\n- Related error patterns\n- Component/domain mentions\nAlso extract key technical terms as keywords.\n\nLLM CONFIG:\n- Temperature: 0.3 (focused, deterministic)\n- Max tokens: 200 (short structured output)\n- Format: JSON { queries: [], keywords: [] }","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:44:53.078843Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-hpv6","title":"E2E test: 'cass stats' command","description":"E2E test for 'cass stats' CLI command:\n- Real subprocess execution via bun\n- Test stats output with various playbook states\n- Verify bullet counts by category, maturity, state\n- Verify feedback statistics accuracy\n- Test --json output format\n- Test error cases: empty playbook, missing playbook\n- Detailed logging: expected vs actual stats\nSetup: fixture directory with playbook containing known statistics","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-08T01:27:16.992897Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-hpzx","title":"[CLI:doctor] checkStorage - Verify storage health","description":"Implements the checkStorage function that verifies storage health and configuration.\n\nFUNCTION SIGNATURE:\n```typescript\nasync function checkStorage(config: Config): Promise<HealthCheck[]>\n```\n\nCHECKS PERFORMED:\n\n1. DATA DIRECTORY:\n   - Check if data directory exists\n   - Verify write permissions\n   - Test by creating temp file\n   - Status: FAIL if missing/unwritable, PASS otherwise\n   - Fixable: Create directory if missing\n\n2. DISK SPACE:\n   - Check available disk space at data directory\n   - Warn if <100MB available\n   - Fail if <10MB (critical)\n   - Status: WARN or FAIL based on threshold\n   - Not fixable (user must free space)\n\n3. PLAYBOOK FILE:\n   - Check if playbook.json exists\n   - Validate JSON structure\n   - Test loading and parsing\n   - Check for corruption (malformed JSON)\n   - Status: WARN if missing (will create), FAIL if corrupted\n   - Fixable: Create empty playbook if missing\n\n4. DIARY:\n   - Check if diary directory exists\n   - Count diary entries\n   - Calculate total size\n   - Report statistics\n   - Status: PASS or WARN (info only)\n\n5. EMBEDDING CACHE:\n   - Check if cache directory exists\n   - Check cache size and entry count\n   - Warn if cache very large (>1GB)\n   - Report hit/miss ratio if available\n   - Status: PASS or WARN (info only)\n\nIMPLEMENTATION APPROACH:\n- Check data directory exists and is writable\n- Measure available disk space with threshold checks\n- Validate playbook JSON structure and integrity\n- Count diary entries and calculate storage usage\n- Check embedding cache status and size\n\nERROR HANDLING:\n- Handle missing directories gracefully\n- Distinguish ENOENT vs EACCES vs corruption\n- Timeout on slow disk operations (10s max)\n- Provide specific error messages\n\nDEPENDENCIES:\n- fs/promises (file operations)\n- diskSpace or df (disk space check)\n- Config system\n- Path utilities\n\nSUCCESS CRITERIA:\n- Accurately detects all storage issues\n- Write test doesn't leave artifacts\n- Corruption detection reliable\n- Performance: all checks <1 second\n- Auto-fix safe (doesn't overwrite existing data)","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:55:27.661082Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-hrhu","title":"Fix diary command session path to absolute","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-07T05:06:46.805106782Z","created_by":"ubuntu","updated_at":"2026-01-07T05:07:06.766393719Z","closed_at":"2026-01-07T05:07:06.766393719Z","close_reason":"validateSessionPath now resolves to absolute path; matches doc and avoids relative ambiguity","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-hs01","title":"[Config] mergePlaybooks - Combine two playbooks","description":"Function signature:\n```typescript\nfunction mergePlaybooks(\n  base: Playbook,\n  overlay: Playbook | null,\n  options: {\n    conflictResolution: 'overlay-wins' | 'base-wins';\n    deduplication: 'by-id' | 'by-content-similarity';\n  }\n): Playbook\n```\n\nAlgorithm:\n1. If overlay is null, return base unchanged\n2. Merge bullets arrays:\n   - Create map by bullet ID\n   - Apply conflict resolution for duplicate IDs\n   - If deduplication by content-similarity, check semantic similarity (>0.9)\n3. Merge deprecated patterns arrays (union)\n4. Merge metadata:\n   - totalUsageCount: sum both counts\n   - lastUsed: max of both timestamps\n\nDeduplication strategies:\n- by-id: Only merge bullets with same ID\n- by-content-similarity: Also dedupe semantically similar bullets (embedding cosine >0.9)\n\nUsed by loadMergedPlaybook to combine global + repo playbooks.","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:50:13.803147Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-htps","title":"[E2E Tests] CLI playbook commands - list, add, remove","description":"## E2E Test: CLI playbook Commands - List, Add, Remove\n\n### Test Scenario\nTest playbook management CLI commands\n\n### Test Steps\n\n#### 1. List Bullets\n- Create playbook with 5 bullets\n- Run `cm playbook list`\n- Verify all bullets displayed\n- Verify confidence scores shown\n- Test `--format json` output\n\n#### 2. Add Bullet Manually\n- Run `cm playbook add \"Always use TypeScript strict mode\"`\n- Verify bullet added to playbook\n- Verify default confidence (0.5)\n- Run `cm playbook add --confidence 0.8 \"Use bun test\"`\n- Verify custom confidence applied\n\n#### 3. Remove Bullet\n- Run `cm playbook remove \"content to remove\"`\n- Verify bullet removed from playbook\n- Verify other bullets unchanged\n- Test fuzzy matching for removal\n\n#### 4. Playbook Export\n- Run `cm playbook export --format markdown`\n- Verify readable markdown output\n- Run `cm playbook export --format yaml`\n- Verify valid YAML output\n\n#### 5. Playbook Stats\n- Run `cm playbook stats`\n- Verify bullet count shown\n- Verify average confidence shown\n- Verify scope distribution shown\n\n### Verbose Logging\n- Log: 'Loading playbook from <path>'\n- Log: 'Playbook contains N bullets'\n- Log: 'Adding bullet: <content>'\n- Log: 'Removing bullet: <content>'\n- Log: 'Saving playbook to <path>'\n\n### Error Cases\n- Remove non-existent bullet\n- Add duplicate bullet (warn or skip)","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-08T01:24:41.006823Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-huos","title":"[Test] Fixtures: Sample playbook YAML files","description":"Create test/fixtures/playbooks/ with:\n\n1. empty-playbook.yaml - No bullets, just structure\n2. minimal-playbook.yaml - 1-2 simple bullets\n3. complex-playbook.yaml - 10+ bullets with all field types\n4. workspace-scoped.yaml - Bullets with workspace scope\n5. deprecated-patterns.yaml - Playbook with deprecated patterns\n6. feedback-heavy.yaml - Bullets with many feedback events\n\nEach fixture should:\n- Be valid against PlaybookSchema\n- Have realistic content (not lorem ipsum)\n- Cover edge cases for that scenario\n- Include inline comments explaining purpose\n\nExample:\n\\`\\`\\`yaml\n# test/fixtures/playbooks/minimal-playbook.yaml\n# Purpose: Test basic playbook loading with minimal data\nschema_version: 2\nname: minimal-test\nbullets:\n  - id: b-test-001\n    category: testing\n    content: Always run tests before committing changes\n    # ... rest of required fields\n\\`\\`\\`","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-08T01:22:16.110589Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-hw7","title":"[Curator] curatePlaybook - Main deterministic merge function","description":"Implement the main deterministic playbook curation function. This is the ACE core - NO LLM calls allowed.\n\nSignature:\nfunction curatePlaybook(\n  playbook: Playbook,\n  deltas: PlaybookDelta[],\n  config: { dedupThreshold: number; pruneThreshold: number; toxicLog?: ToxicEntry[] }\n): CurationResult\n\nHigh-level algorithm:\n1. Build hash cache from existing bullets (buildHashCache)\n2. Initialize result tracking (applied, skipped, conflicts, etc.)\n3. Process each delta by type:\n   - AddDelta → handleAddDelta\n   - HelpfulDelta → handleHelpfulDelta\n   - HarmfulDelta → handleHarmfulDelta\n   - ReplaceDelta → handleReplaceDelta\n   - DeprecateDelta → handleDeprecateDelta\n   - MergeDelta → handleMergeDelta\n4. Post-processing phase:\n   - Auto-invert harmful bullets (autoInvertHarmfulBullets)\n   - Check for maturity transitions (checkPromotions)\n   - Prune deprecated bullets (pruneDeprecated)\n5. Return comprehensive CurationResult\n\nCRITICAL: This function is DETERMINISTIC. Same inputs = same outputs. No AI inference, no randomness.\n\nThis prevents context collapse by ensuring playbook evolution is transparent and reproducible.","status":"tombstone","priority":3,"issue_type":"task","created_at":"2025-12-07T21:44:55.303034Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-hyho","title":"[CLI] context command - Pre-task hydration","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:51:34.968114Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-hzxr","title":"[Config] loadMergedConfig - Combine global + repo config","description":"Function signature:\n```typescript\nasync function loadMergedConfig(): Promise<Config>\n```\n\nSteps:\n1. Load global config (~/.cass-memory/config.json)\n2. Load repo config (./.cass/config.yaml) - may not exist\n3. Deep merge (repo overrides global for same keys)\n4. Validate with ConfigSchema\n5. Return merged config\n\nDeep merge strategy:\n- Primitive values: repo overrides global\n- Objects: recursively merge keys\n- Arrays: repo replaces entire array (no element merging)\n\nExample:\nGlobal: { llm: { provider: 'anthropic', model: 'opus' }, maxTokens: 4000 }\nRepo: { llm: { model: 'sonnet' } }\nResult: { llm: { provider: 'anthropic', model: 'sonnet' }, maxTokens: 4000 }\n\nValidation ensures merged config conforms to ConfigSchema before returning.","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:49:47.020793Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-i16d","title":"Add unit tests for progress.ts module","description":"# Add Unit Tests for progress.ts\n\n## Context\nThe `progress.ts` module provides progress reporting utilities but has NO dedicated test file.\n\n## Current State\n- File: `src/progress.ts`\n- Exports: `createProgress`, `ProgressReporter` type, progress utility functions\n- Used by: context.ts, serve.ts, and potentially other long-running operations\n- Tests: NONE\n\n## Scope\nCreate comprehensive unit tests WITHOUT mocks for:\n1. `createProgress()` factory function\n2. `ProgressReporter` methods (start, update, complete, fail)\n3. Progress event emission and formatting\n4. Edge cases (zero progress, negative, overflow)\n5. Integration with output.ts formatting\n\n## Test Strategy\n- Use real implementations where possible\n- Capture console/stderr output for assertions\n- Test with real timers (not fake timers)\n- Verify progress bar rendering\n\n## Acceptance Criteria\n- [ ] Test file: `test/progress.test.ts` exists\n- [ ] All exported functions have test coverage\n- [ ] No mock.module() or vi.mock() usage\n- [ ] Tests are deterministic and pass in CI\n\n## Dependencies\n- Depends on understanding progress.ts API","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T17:03:24.824928Z","updated_at":"2025-12-28T02:04:17.122670Z","closed_at":"2025-12-28T02:04:17.122670Z","close_reason":"Added comprehensive unit tests for progress.ts (33 tests covering all exported functions, edge cases, TTY/non-TTY, JSON/text formats, timer cleanup)","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-i45e","title":"[Epic] Agent-First Architecture Transformation","description":"# Agent-First Architecture Transformation\n\n## Background & Motivation\n\ncass-memory was designed as a persistent memory system for AI coding agents, but the current documentation and UX are framed as if **humans** are the primary users running `cm` commands. This is fundamentally backwards.\n\n**The reality:**\n- AI agents (Claude Code, Codex, Cursor, etc.) are the PRIMARY CONSUMERS of the memory system\n- Humans are OPERATORS who set up, configure, and monitor the system\n- Agents should make ALL determinations about what/how to add things to memory\n\n**Current problems:**\n1. README shows humans running `cm context \"task\"` → agents should get this automatically\n2. Workflow requires humans to run `cm mark` → agents should provide feedback inline\n3. Reflection is presented as a manual periodic task → should be automated via hooks\n4. Documentation is verbose and human-oriented → agents need minimal, LLM-native output\n\n## Vision: What Makes Agents Actually Use This\n\nFrom the perspective of an AI coding agent, the system must be:\n\n1. **Zero-friction**: ONE command to get value: `cm context \"my task\"`\n2. **Automatic learning**: Sessions are processed without explicit commands\n3. **Trivial feedback**: Inline comments like `[cass: helpful b-xyz]` not separate commands\n4. **LLM-native output**: Compact JSON, not walls of ASCII art\n\n## Target Workflow\n\n**Human does once:**\n1. Install cass-memory\n2. Add blurb to AGENTS.md  \n3. Configure hooks for automation\n\n**Agent does every session:**\n1. Runs `cm context \"<task>\" --json` (or gets injected context)\n2. Works normally, optionally drops inline feedback\n3. Session ends → hooks handle reflection automatically\n\n## Success Criteria\n\n- An agent reading only the AGENTS.md blurb knows exactly how to use cass-memory\n- The most common agent workflow requires exactly ONE command\n- Post-session learning happens without agent intervention\n- README clearly separates \"For Humans (Setup)\" from \"For Agents (Usage)\"","status":"tombstone","priority":1,"issue_type":"epic","created_at":"2025-12-08T17:45:39.741395Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"epic","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-i57c","title":"[Critical] Starter Playbooks - Pre-built Rules for Common Stacks","description":"$(cat /tmp/fix_i57c.txt)","status":"tombstone","priority":1,"issue_type":"feature","created_at":"2025-12-07T22:08:18.216525Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"feature","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-i73","title":"[Generator] contextWithoutCass - Graceful degradation","description":"Graceful degradation when cass is unavailable - provide playbook-only context.\n\nSIGNATURE:\nasync function contextWithoutCass(task: string, config: Config): Promise<ContextResult>\n\nPURPOSE:\nWhen cass binary is not found or cass searches fail, still provide useful context from the playbook alone. The system remains functional even without historical data.\n\nFLOW:\n1. Log warning: 'cass unavailable - providing playbook context only'\n2. Extract keywords from task using extractKeywords (simple regex, no LLM)\n3. Score bullets using keywords\n4. Separate anti-patterns\n5. Build ContextResult with:\n   - relevantBullets (from playbook)\n   - antiPatterns (from playbook)\n   - historySnippets: [] (empty)\n   - deprecatedWarnings: [] (can't check without history)\n   - suggestedCassQueries: [] (no point suggesting if cass unavailable)\n6. Add warning to result: 'Context generated without historical data'\n\nKEYWORD EXTRACTION (NO LLM):\nfunction extractKeywords(task: string): string[] {\n  // Simple heuristic:\n  // 1. Lowercase and split on whitespace\n  // 2. Remove stop words (the, a, is, etc)\n  // 3. Extract technical terms (camelCase, snake_case, etc)\n  // 4. Return unique terms\n}\n\nDEGRADATION LEVELS:\n1. Full: LLM queries + cass history + playbook\n2. No LLM: Simple keywords + cass history + playbook\n3. No cass: LLM queries + playbook only (NOT IMPLEMENTED)\n4. No cass, no LLM: Simple keywords + playbook only (THIS FUNCTION)\n\nSTILL USEFUL BECAUSE:\n- Playbook contains learned patterns from past work\n- Scoring by keyword relevance still surfaces useful rules\n- Anti-patterns still prevent common mistakes\n- Better than nothing!\n\nERROR HANDLING:\n- Don't throw errors - this IS the error handler\n- If playbook also unavailable, return minimal result:\n  { task, relevantBullets: [], antiPatterns: [], historySnippets: [], deprecatedWarnings: [], suggestedCassQueries: [] }\n\nLOGGING:\n- console.warn level (not error)\n- Message: 'cass unavailable - showing playbook only'\n- Include reason if known (binary not found vs search failed)\n\nUSE CASE:\n- Fresh install before cass is set up\n- CI environment without session history\n- Corrupted cass index\n- User working offline","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:45:02.102425Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-ia2","title":"[Cass] cassExport - Export session content","description":"Implement cassExport() to export session content in various formats.\n\n## Signature\n```typescript\nasync function cassExport(\n  sessionPath: string, \n  format: \"markdown\" | \"json\" | \"text\" = \"markdown\",\n  cassPath = \"cass\"\n): Promise<string | null>\n```\n\n## CLI Command\n`cass export \"{sessionPath}\" --format {format}`\n\n## Implementation\n- Use execFile() with maxBuffer: 50MB for large sessions\n- Return raw output string\n- Return null on error\n\n## Error Handling\n- Return null if session not found (exit 4)\n- Return null if export fails\n- Log error details at debug level\n- No retries (export is deterministic)\n\n## Format Options\n- markdown: Claude-style markdown with headers and formatting\n- json: Raw JSON session structure\n- text: Plain text concatenation of messages\n\n## Usage\nPrimary use case is diary generation:\n```typescript\nconst content = await cassExport(sessionPath, \"markdown\");\nif (content) {\n  const summary = await llm.summarize(content);\n  await writeDiaryEntry(summary);\n}\n```\n\n## Exit Codes\n- 0: Export successful\n- 4: Session not found\n- Other: Export error\n\n## Performance\n- Large sessions may take several seconds\n- maxBuffer prevents truncation of long sessions\n- Consider streaming API in future for very large sessions","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:44:58.772146Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-idy1","title":"[Decay] getDecayCurveData - Data for decay visualization","description":"Generate time-series data showing how a bullet's scores decay over time. Used for visualization, debugging decay parameters, and explaining score changes to users. Enables future charting/graphing features.\n\nCOMPLETE IMPLEMENTATION:\n```typescript\n/**\n * Generate decay curve data for visualization.\n * Shows how helpful/harmful/effective scores change over time.\n */\nfunction getDecayCurveData(\n  bullet: PlaybookBullet,\n  daysToPlot: number = 180,\n  stepSize: number = 7  // Weekly data points\n): Array<{\n  day: number;\n  helpful: number;\n  harmful: number;\n  effective: number;\n  date: string;\n}> {\n  const now = Date.now();\n  const dataPoints: Array<{\n    day: number;\n    helpful: number;\n    harmful: number;\n    effective: number;\n    date: string;\n  }> = [];\n\n  for (let day = 0; day <= daysToPlot; day += stepSize) {\n    const futureTime = now + (day * 24 * 60 * 60 * 1000);\n\n    // Calculate decayed scores at this future point\n    const helpful = getDecayedScore(\n      bullet.helpfulEvents,\n      bullet.confidenceDecayHalfLifeDays,\n      futureTime\n    );\n\n    const harmful = getDecayedScore(\n      bullet.harmfulEvents,\n      bullet.confidenceDecayHalfLifeDays,\n      futureTime\n    );\n\n    const baseScore = helpful - (4 * harmful);\n    const maturityMultiplier = {\n      candidate: 0.5,\n      established: 1.0,\n      proven: 1.5,\n      deprecated: 0\n    }[bullet.maturity];\n    const effective = baseScore * maturityMultiplier;\n\n    dataPoints.push({\n      day,\n      helpful: Math.round(helpful * 100) / 100,\n      harmful: Math.round(harmful * 100) / 100,\n      effective: Math.round(effective * 100) / 100,\n      date: new Date(futureTime).toISOString().split('T')[0]\n    });\n  }\n\n  return dataPoints;\n}\n```\n\nUSAGE EXAMPLES:\n\n1. ASCII CHART (for CLI):\n```typescript\nconst data = getDecayCurveData(bullet, 90, 7);\n\nconsole.log('Effective Score Decay (next 90 days):');\nconsole.log('');\ndata.forEach(point => {\n  const bar = '█'.repeat(Math.max(0, Math.floor(point.effective)));\n  const label = `Day ${point.day.toString().padStart(3)}`;\n  console.log(`${label}: ${bar} (${point.effective.toFixed(1)})`);\n});\n```\n\nOutput:\n```\nEffective Score Decay (next 90 days):\n\nDay   0: ████████████ (12.0)\nDay   7: ███████████ (11.2)\nDay  14: ██████████ (10.5)\nDay  21: █████████ (9.8)\nDay  28: █████████ (9.2)\nDay  35: ████████ (8.6)\n...\nDay  84: ████ (4.1)\nDay  91: ███ (3.8)\n```\n\n2. JSON FOR CHARTING:\n```typescript\n// Export for frontend charting library (Chart.js, D3, etc.)\nconst chartData = getDecayCurveData(bullet, 180, 1);\n\nconst chart = {\n  labels: chartData.map(d => d.date),\n  datasets: [\n    {\n      label: 'Effective Score',\n      data: chartData.map(d => d.effective),\n      borderColor: 'rgb(75, 192, 192)'\n    },\n    {\n      label: 'Helpful (decayed)',\n      data: chartData.map(d => d.helpful),\n      borderColor: 'rgb(75, 192, 75)'\n    },\n    {\n      label: 'Harmful (decayed)',\n      data: chartData.map(d => d.harmful),\n      borderColor: 'rgb(192, 75, 75)'\n    }\n  ]\n};\n```\n\n3. EXPLAIN SCORE CHANGE:\n```typescript\n// User asks: \"Why did this rule's score drop?\"\nconst data = getDecayCurveData(bullet, 90, 30);\n\nconsole.log(`Current score: ${data[0].effective}`);\nconsole.log(`30 days from now: ${data[1].effective}`);\nconsole.log(`60 days from now: ${data[2].effective}`);\nconsole.log(`90 days from now: ${data[3].effective}`);\nconsole.log(`\\nScore will drop ${(data[0].effective - data[3].effective).toFixed(1)} points over 90 days due to decay.`);\n```\n\n4. COMPARE HALF-LIFE SCENARIOS:\n```typescript\n// Compare 60-day vs 90-day vs 120-day half-life\nconst halfLives = [60, 90, 120];\n\nhalfLives.forEach(halfLife => {\n  const tempBullet = { ...bullet, confidenceDecayHalfLifeDays: halfLife };\n  const data = getDecayCurveData(tempBullet, 180, 30);\n  \n  console.log(`\\nHalf-life: ${halfLife} days`);\n  console.log(`Score at 90 days: ${data[3].effective}`);\n  console.log(`Score at 180 days: ${data[6].effective}`);\n});\n```\n\nPARAMETERS:\n\ndaysToPlot (default: 180):\n- How far into future to project\n- 90 = quarterly view\n- 180 = semi-annual view\n- 365 = annual view\n\nstepSize (default: 7):\n- Granularity of data points\n- 1 = daily (180 points for 180 days)\n- 7 = weekly (26 points for 180 days)\n- 30 = monthly (6 points for 180 days)\n\nTrade-off:\n- Smaller stepSize = more data points, smoother curve, slower computation\n- Larger stepSize = fewer data points, faster, good for CLI displays\n\nDATA POINT STRUCTURE:\n\nday: Number of days from now (0, 7, 14, ...)\nhelpful: Decayed helpful score at that point\nharmful: Decayed harmful score at that point\neffective: Final effective score (helpful - 4×harmful) × maturity\ndate: ISO date string (2025-03-15)\n\nWHY THIS IS USEFUL:\n\n1. TRANSPARENCY:\n   Users can see exactly why scores change over time\n\n2. DEBUGGING:\n   Verify decay algorithm is working correctly\n\n3. PLANNING:\n   \"If I don't update this rule, it will be deprecated in 60 days\"\n\n4. EDUCATION:\n   Help users understand exponential decay concept\n\n5. TUNING:\n   Compare different half-life values to find optimal settings\n\nFUTURE ENHANCEMENTS:\n\n1. Web Dashboard:\n   - Interactive charts with Chart.js\n   - Zoom, pan, hover tooltips\n   - Compare multiple bullets\n\n2. Alerts:\n   - \"Rule will drop below 0 in 30 days\"\n   - \"Rule will auto-deprecate in 45 days\"\n\n3. What-If Analysis:\n   - \"What if I mark this helpful 3 more times?\"\n   - \"What if I extend half-life to 120 days?\"\n\n4. Export:\n   - CSV for spreadsheet analysis\n   - PNG chart generation\n   - PDF reports\n\nDEPENDENCIES:\n- getDecayedScore()\n- PlaybookBullet with events and halfLife\n- maturity multipliers\n\nRETURNS:\nArray of data points with day, helpful, harmful, effective, date\n\nPERFORMANCE:\n- O(n × m) where n = number of steps, m = number of events\n- For 26 weekly points and 50 events: ~1300 calculations\n- Fast enough for real-time display","status":"tombstone","priority":3,"issue_type":"task","created_at":"2025-12-07T21:48:11.319323Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-iek3","title":"Implement cm context --no-history + honor history/top=0","description":"README documents --no-history but CLI doesn’t implement it; also context uses || so --history 0 / --top 0 are ignored. Add flag + treat 0 as valid to let users disable history/snippets explicitly.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-16T07:49:35.857414Z","updated_at":"2025-12-16T08:01:40.817792Z","closed_at":"2025-12-16T08:01:40.817792Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-ifgg","title":"Remove contribution language from README","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T04:20:47.168816809Z","created_by":"ubuntu","updated_at":"2026-01-07T05:01:16.817352528Z","closed_at":"2026-01-07T05:01:16.817352528Z","close_reason":"Contribution language already removed from README - verified no 'contribution' or related text remains","source_repo":".","deleted_at":"2026-01-07T05:01:16.817352528Z","deleted_by":"daemon","delete_reason":"delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-ikds","title":"[CLI] doctor command - System health check","description":"Implements the main entry point for the 'cass-memory doctor' command - a comprehensive system health check.\n\nCOMMAND SYNTAX:\n```bash\ncass-memory doctor [options]\n\nOptions:\n  --json    Output as JSON instead of pretty terminal UI\n  --fix     Auto-fix recoverable issues (interactive confirmation)\n```\n\nPURPOSE:\nSingle command to verify the entire cass-memory setup is healthy and properly configured. Diagnoses common issues and offers auto-fixes where safe.\n\nHEALTH CHECK CATEGORIES:\n\n1. CASS INTEGRATION:\n   - cass binary found in PATH\n   - Version compatibility\n   - Index health (stale? corrupted?)\n   - Session count and storage size\n   - Agent breakdown (which tools used)\n\n2. STORAGE:\n   - Data directory exists and writable\n   - Disk space available (warn if <100MB)\n   - Playbook file valid and loadable\n   - Diary count and total size\n   - Embedding cache status\n\n3. LLM PROVIDERS:\n   - OpenAI API key present and format valid\n   - Anthropic API key (optional)\n   - Other providers configured\n   - Rate limit status (if available)\n\n4. SELF-TEST:\n   - Playbook load performance\n   - Cass search latency\n   - Sanitization pattern breadth\n   - Config validation\n\nIMPLEMENTATION REQUIREMENTS:\n1. Parse command-line options\n2. Run all health checks in parallel (where safe)\n3. Collect results with pass/warn/fail status\n4. Identify fixable issues\n5. Render results (terminal UI or JSON)\n6. If --fix: prompt and apply fixes\n\nOUTPUT FORMAT (Terminal):\n```\nCASS-MEMORY SYSTEM HEALTH CHECK\n================================\n\n[✓] Cass Integration\n    ✓ cass found at /usr/local/bin/cass (v1.2.0)\n    ✓ Index healthy (156 sessions, last updated 2h ago)\n    ⚠ Large index size (2.3GB) - consider pruning old sessions\n\n[✓] Storage\n    ✓ Data directory: /Users/me/.cass-memory\n    ✓ Disk space: 45GB available\n    ✓ Playbook loaded (156 bullets)\n    ✗ Diary directory not found\n\n[⚠] LLM Providers\n    ✓ OpenAI API key configured\n    ⚠ Anthropic key missing (optional for some features)\n\n[✓] Self-Test\n    ✓ Playbook load: 45ms\n    ✓ Cass search: 120ms\n    ✓ Sanitization: 23 patterns loaded\n\nSUMMARY: 1 error, 2 warnings\n  • Run with --fix to auto-repair recoverable issues\n```\n\nERROR TYPES:\n- PASS (✓): All good\n- WARN (⚠): Non-critical issue\n- FAIL (✗): Critical problem\n\nFIXABLE ISSUES:\n- Missing directory → create\n- Missing playbook → create empty\n- Stale cass index → rebuild\n- Invalid config → reset to defaults\n\nNON-FIXABLE ISSUES:\n- Missing API keys → manual setup required\n- Insufficient disk space → manual cleanup\n- cass not found → installation required\n\nDEPENDENCIES:\n- Health check modules (checkCassIntegration, checkStorage, etc.)\n- Terminal UI renderer\n- Auto-fix utilities\n- Config system\n\nSUCCESS CRITERIA:\n- Detects all common issues reliably\n- Clear actionable guidance for failures\n- Auto-fix safe and effective\n- Performance <3 seconds for full check\n- JSON output suitable for CI/CD integration","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:54:29.606230Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-im5","title":"[Utils] generateBulletId - Unique bullet identifier generation","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:44:58.314468Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-inv","title":"[LLM] getModel - Provider-agnostic model instantiation","description":"Function signature:\nfunction getModel(config: Config): LanguageModel\n\nUsing Vercel AI SDK provider abstraction:\n- openai: createOpenAI({ apiKey })(config.model)\n- anthropic: createAnthropic({ apiKey })(config.model)\n- google: createGoogleGenerativeAI({ apiKey })(config.model)\n\nProvider abstraction is KEY benefit - same code works with any provider.\n\nImplementation:\n1. Get API key using getApiKey(config.provider)\n2. Create provider instance based on config.provider\n3. Return LanguageModel instance for config.model\n\nThis enables seamless switching between providers without changing generation code.","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:44:50.252148Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-iqat","title":"[Foundation] Bun build configuration for cross-platform binaries","description":"Configure Bun build system to compile CASS Memory System to standalone executables for Linux, macOS, and Windows.\n\n## Context\nCASS Memory System must be distributed as standalone executables that users can run without installing Node.js, Bun, or any dependencies. Bun's --compile flag creates single-file binaries that bundle the runtime, dependencies, and source code.\n\n## Technical Specification\n\n### Build Targets:\n1. Linux x64: bun build src/cass-memory.ts --compile --target=linux-x64 --outfile dist/cass-memory-linux\n2. macOS ARM64: bun build src/cass-memory.ts --compile --target=darwin-arm64 --outfile dist/cass-memory-macos\n3. Windows x64: bun build src/cass-memory.ts --compile --target=windows-x64 --outfile dist/cass-memory-windows.exe\n\n### Build Configuration:\n- Entry Point: src/cass-memory.ts\n- Output Directory: dist/\n- Compile Mode: --compile (creates executable, not JavaScript)\n- Minification: --minify (optional, reduces binary size)\n- Sourcemaps: --sourcemap (optional, for debugging)\n\n### Package.json Scripts:\njson\n{\n  \"scripts\": {\n    \"build\": \"bun build src/cass-memory.ts --compile --outfile dist/cass-memory\",\n    \"build:all\": \"npm run build:linux && npm run build:macos && npm run build:windows\",\n    \"build:linux\": \"bun build src/cass-memory.ts --compile --target=linux-x64 --outfile dist/cass-memory-linux\",\n    \"build:macos\": \"bun build src/cass-memory.ts --compile --target=darwin-arm64 --outfile dist/cass-memory-macos\",\n    \"build:windows\": \"bun build src/cass-memory.ts --compile --target=windows-x64 --outfile dist/cass-memory-windows.exe\",\n    \"build:current\": \"bun build src/cass-memory.ts --compile --outfile dist/cass-memory\"\n  }\n}\n\n\n### Binary Naming Convention:\n- cass-memory-linux (Linux x64)\n- cass-memory-macos (macOS ARM64 - Apple Silicon)\n- cass-memory-windows.exe (Windows x64)\n- cass-memory (current platform, for development)\n\n### Distribution Strategy:\n- GitHub Releases: Attach binaries to release tags\n- Homebrew: Formula for macOS installation\n- apt/yum: Future package repositories for Linux\n- Chocolatey: Future package for Windows\n- Direct Download: Users can download from GitHub releases\n\n### Build Process:\n1. Run typecheck: Ensure no TypeScript errors\n2. Run tests: Ensure all tests pass\n3. Build for all platforms: npm run build:all\n4. Test binaries: Run ./dist/cass-memory-* --version on each platform\n5. Create GitHub release: Upload binaries as release assets\n\n## Reasoning\n\n### Why Bun --compile:\n1. Single Binary: No dependencies to install\n2. Fast Startup: Compiled binaries start faster than Node.js scripts\n3. Cross-Platform: Bun can cross-compile from any platform\n4. Bundled Runtime: No 'command not found' errors\n5. Easy Distribution: Just download and run\n\n### Why Multiple Targets:\n1. Platform Compatibility: Users on Linux, macOS, and Windows\n2. Architecture Support: ARM64 for Apple Silicon, x64 for Intel/AMD\n3. Maximum Reach: Support as many users as possible\n\n### Why dist/ Directory:\n1. Standard Convention: Build artifacts go in dist/\n2. .gitignore: dist/ is ignored, binaries not committed\n3. Clean Separation: Source vs. build artifacts\n\n### Why Not npm Package:\n1. No Runtime Dependency: Users don't need Node.js/Bun installed\n2. Faster Install: Download binary vs. npm install\n3. Simpler: One file vs. node_modules/\n4. Offline: Works without internet after download\n\n### Why GitHub Releases:\n1. Hosting: Free hosting for binaries\n2. Versioning: Tied to git tags\n3. Changelog: Release notes for each version\n4. CDN: Fast downloads worldwide\n\n## Acceptance Criteria\n\n- bun run build creates executable for current platform\n- bun run build:all creates executables for Linux, macOS, Windows\n- All binaries are in dist/ directory\n- Binaries are executable (chmod +x on Unix)\n- ./dist/cass-memory-* --version shows correct version\n- ./dist/cass-memory-* --help shows usage information\n- Binary size is reasonable (< 50MB per platform)\n- Binaries work on clean systems without Bun/Node installed\n- README includes download instructions\n- GitHub Actions workflow builds and uploads binaries on release\n\n## How This Serves the Universal Agent Memory System\n\nCross-platform binaries make CASS Memory universally accessible:\n\n1. No Install Friction: Users download and run, no setup required\n2. Universal Compatibility: Works on any OS without runtime dependencies\n3. Enterprise-Friendly: IT departments can distribute binaries without npm registry\n4. Offline Support: Binaries work without internet connection\n5. Fast Startup: Compiled binaries start in milliseconds\n6. Consistent Behavior: Same binary works identically across machines\n7. CI/CD Integration: Binaries work in Docker, GitHub Actions, etc.\n\nWithout cross-platform binaries, users would need to install Bun, manage dependencies, and deal with version conflicts. Binaries make CASS Memory as easy to use as git - just download and run.","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:48:27.875231Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-iqe0","title":"[CLI:playbook] remove - Remove or deprecate bullet","description":"Remove or deprecate a playbook bullet.\n\nCommand signature:\n```bash\ncass-memory playbook remove <bullet-id> [options]\n\nOptions:\n  --hard             Permanently delete (default: soft deprecate)\n  --reason TEXT      Reason for removal\n```\n\nImplementation:\n1. Load playbook\n2. Find bullet by ID\n3. Perform removal based on mode:\n\nSoft delete (default):\n- Set bullet.deprecated = true\n- Set bullet.deprecatedAt = now\n- Set bullet.deprecationReason = reason\n- Keep in playbook file but exclude from active use\n- Preserves history\n\nHard delete:\n- Remove bullet entirely from playbook\n- No recovery possible\n- Should prompt for confirmation\n\n4. Save updated playbook\n5. Display confirmation\n\nOutput format (soft):\n```\nDeprecated bullet b-abc123\nContent: {content}\nReason: {reason}\n\nThe bullet is now hidden from active playbook but preserved in history.\nUse 'playbook list --all' to see deprecated bullets.\n```\n\nOutput format (hard):\n```\nPermanently deleted bullet b-abc123\nContent: {content}\n\nThis action cannot be undone.\n```\n\nConfirmation prompt for hard delete:\n```\nThis will permanently delete bullet b-abc123: \"{content}\"\nThis action cannot be undone. Continue? [y/N]\n```\n\nUse cases:\n- Soft: Rule is no longer relevant but keep for history\n- Hard: Duplicate bullet or mistake\n\nDefault to soft delete to preserve evidence trail.","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:52:25.037538Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-ix2t","title":"[Unit Tests] tracking.ts - Session tracking functions","description":"## Unit Tests: tracking.ts - Session Tracking Functions\n\n### Test Categories\n\n#### 1. TrackingLog Loading/Saving\n- loadTrackingLog() reads existing file\n- loadTrackingLog() creates default for missing\n- saveTrackingLog() writes atomically\n- Handles corrupt tracking files\n\n#### 2. markSessionProcessed()\n- Adds path to processedSessions set\n- Updates lastProcessedAt timestamp\n- Persists to tracking file\n- Idempotent for duplicate paths\n\n#### 3. isSessionProcessed()\n- Returns true for processed sessions\n- Returns false for unprocessed\n- Handles path normalization\n\n#### 4. getUnprocessedSessions()\n- Returns sessions not in tracking log\n- Respects maxSessions limit\n- Filters by agent if specified\n- Orders by timestamp (oldest first)\n\n#### 5. pruneOldEntries()\n- Removes entries older than threshold\n- Preserves recent entries\n- Updates file after pruning\n- Handles empty tracking log\n\n#### 6. Tracking Log Schema\n- Validates required fields\n- Handles schema migrations\n- Forward-compatible with new fields\n\n### Test Approach\n- Real temp file I/O\n- Concurrent access simulation\n- Verify file contents match expectations\n- Test with large tracking logs (10k+ entries)\n\n### Edge Cases\n- Unicode session paths\n- Very long paths\n- Paths with special characters\n- Case sensitivity on different OS","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-08T01:23:41.109984Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-ix3l","title":"E2E test: 'cass doctor' command","description":"E2E test for 'cass doctor' CLI command:\n- Real subprocess execution via bun\n- Test health check output\n- Verify detection of: missing playbook, invalid YAML, orphaned sessions\n- Test with healthy setup (all green)\n- Test with various problem scenarios\n- Test --json output format\n- Detailed logging: each check performed, pass/fail status\nSetup: fixture directories representing healthy and unhealthy states","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-08T01:27:18.463151Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-ix3l","depends_on_id":"cass_memory_system-8dxr","type":"blocks","created_at":"2026-01-21T09:28:51Z","created_by":"import"}]}
{"id":"cass_memory_system-ixln","title":"[CLI:init] createDirectoryStructure - Set up directories","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:51:32.132292Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-j2i","title":"[Curator] handleReplaceDelta - Update bullet content","description":"Update bullet content while preserving feedback history.\n\nSignature:\nfunction handleReplaceDelta(\n  playbook: Playbook,\n  delta: ReplaceDelta\n): { applied: boolean }\n\nProcess:\n1. Find bullet by ID\n   - If not found: return applied: false\n2. Update bullet.content to delta.newContent\n3. Update bullet.updatedAt to current timestamp\n4. DO NOT reset helpfulCount or harmfulCount\n5. DO NOT clear helpfulEvents or harmfulEvents\n6. DO NOT reset maturity state\n7. Return applied: true\n\nKEY PRINCIPLE: Feedback history is PRESERVED across content updates.\n\nWhy preserve history?\n- The rule's value/harm is tied to its semantic meaning, not exact wording\n- Allows refining phrasing without losing trust\n- Prevents gaming the system by rewording harmful rules\n\nExample use case:\n- Original: 'Use any type for flexibility'\n- Gets harmful feedback\n- Replace: 'Use any type when prototyping'\n- Still carries harmful history - must earn back trust\n\nThis maintains accountability while allowing improvement.","status":"tombstone","priority":3,"issue_type":"task","created_at":"2025-12-07T21:44:59.977690Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-j2j1","title":"Optimize sanitization performance and context quality","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-08T05:45:31.102929Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-j78u","title":"Coordinate with cass project (PR #29) for consistency","description":"# Task: Cross-Project Coordination with cass (coding_agent_session_search)\n\n## Context\n\nThe redirect-based version resolution pattern was proposed for both sibling projects:\n- **cass-memory** (this project): `Dicklesworthstone/cass_memory_system`\n- **cass** (sibling): `Dicklesworthstone/coding_agent_session_search`\n\nGitHub Issue #11 in cass-memory references PR #29 in the cass project. Both projects should ideally use the same pattern for consistency.\n\n## Current State\n\n### cass-memory (this project)\n- **Status**: Using API-based resolution (fragile)\n- **File**: `install.sh:26-43`\n- **Issue**: #11 (CasualDeveloper's suggestion)\n\n### cass (sibling project)\n- **Status**: Also using API-based resolution (same fragile pattern)\n- **File**: `install.sh:28-45`\n- **PR**: #29 (redirect-based approach - status unknown)\n\n## Coordination Goals\n\n1. **Consistency**: Both projects should use the same version resolution approach\n2. **Timing**: Ideally implement in both projects close together\n3. **Testing**: Can share test cases and validation approaches\n4. **Documentation**: Reference each other's issues/PRs for context\n\n## Action Items\n\n### 1. Check cass PR #29 Status\n\n```bash\n# Check if PR #29 is merged\ngh pr view 29 --repo Dicklesworthstone/coding_agent_session_search --json state,mergedAt\n\n# Or via web: https://github.com/Dicklesworthstone/coding_agent_session_search/pull/29\n```\n\nPossible states:\n- **Merged**: We can align our implementation with theirs\n- **Open**: We can coordinate and potentially co-develop\n- **Closed (not merged)**: Need to understand why, may need different approach\n\n### 2. Implementation Approach Based on PR Status\n\n#### If cass PR #29 is Merged:\n1. Review their final implementation\n2. Adopt the same approach for consistency\n3. Reference their PR in our commit message\n\n#### If cass PR #29 is Open:\n1. Coordinate with the PR author (if possible)\n2. Ensure our implementations are compatible\n3. Consider submitting our approach as a comment\n\n#### If cass PR #29 is Closed (not merged):\n1. Understand why it was closed\n2. Determine if the concerns apply to us\n3. Proceed independently if appropriate\n\n### 3. Cross-Reference in Commits\n\nWhen implementing, include cross-references:\n\n```\nfix(install): use redirect-based version resolution\n\nReplace GitHub API-based version resolution with redirect-based approach.\nThis avoids API rate limits (60/hr) and fragile JSON parsing.\n\nFixes #11\nRelated: Dicklesworthstone/coding_agent_session_search#29\n```\n\n### 4. Notify/Update GitHub Issue #11\n\nAfter implementation:\n1. Comment on Issue #11 with the fix commit\n2. Thank CasualDeveloper for the suggestion\n3. Note any differences from their proposed approach\n\n## Implementation Differences Between Projects\n\n### cass-memory (Bun/TypeScript)\n- Binary name: `cm`\n- Build: `bun run build`\n- Platforms: linux-x64, macos-arm64, macos-x64\n\n### cass (Rust)\n- Binary name: `cass`\n- Build: `cargo build --release`\n- Platforms: linux-x64, linux-arm64, macos-x64, macos-arm64\n\nDespite different build systems, the **install.sh version resolution logic is identical** and should remain consistent.\n\n## Version Fallback Considerations\n\nEach project should fall back to its own reasonable default:\n\n| Project | Current Fallback | Proposed Fallback |\n|---------|------------------|-------------------|\n| cass-memory | v0.1.0 | v0.2.1 (current) |\n| cass | v0.1.0 | (check their latest) |\n\nThe fallback should be updated whenever a new major version is released.\n\n## Timeline Considerations\n\n1. **Independent progress OK**: We don't need to block on cass PR #29\n2. **Coordination preferred**: If both PRs are open, coordinate timing\n3. **Documentation sync**: Update both READMEs/CHANGELOGs consistently\n\n## Communication Channels\n\n- GitHub Issues: Primary communication\n- PR comments: Technical discussion\n- Commit messages: Cross-references\n\n## Acceptance Criteria\n\n- [ ] cass PR #29 status checked and documented\n- [ ] Implementation aligned with cass approach (if merged)\n- [ ] Cross-references in commit messages\n- [ ] GitHub Issue #11 updated with resolution\n- [ ] Both projects use consistent pattern (eventually)\n\n## Notes\n\nThis task is lower priority (P3) because:\n1. cass-memory can proceed independently\n2. Coordination is nice-to-have, not blocking\n3. Eventual consistency is acceptable\n\nHowever, it's important for:\n1. Maintaining codebase consistency across projects\n2. Proper attribution to the community contributor\n3. Avoiding divergent implementations that cause confusion","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-05T18:40:49.462998Z","created_by":"jemanuel","updated_at":"2026-01-05T19:12:57.557476Z","closed_at":"2026-01-05T19:12:57.557476Z","close_reason":"Not actionable task - context moved to epic","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-j7gh","title":"[E2E Tests] CLI context command - pre-task briefing","description":"## E2E Test: CLI context Command - Pre-task Briefing\n\n### Test Scenario\nTest `cm context` generates useful pre-task context\n\n### Test Steps\n\n#### 1. Basic Context Generation\n- Initialize project with playbook\n- Add sample bullets to playbook\n- Run `cm context \"implement auth\"`\n- Verify relevant bullets returned\n- Verify context_brief generated\n\n#### 2. Context with Cass Integration\n- Ensure cass index exists\n- Run `cm context \"error handling\"`\n- Verify cass search results included\n- Verify deduplication with playbook\n\n#### 3. Context without Cass\n- Disable cass (rename binary or unset PATH)\n- Run `cm context \"testing\"`\n- Verify graceful fallback\n- Verify playbook-only context returned\n\n#### 4. Context Output Formats\n- Test `--format json` output\n- Test `--format markdown` output\n- Test `--format text` output\n- Verify each format is valid\n\n### Verbose Logging\n- Log: 'Generating context for task: <task>'\n- Log: 'Loading playbook from <path>'\n- Log: 'Found N relevant bullets'\n- Log: 'Searching cass for related sessions...'\n- Log: 'Cass returned M hits'\n- Log: 'Building context brief...'\n- Log: 'Context generation complete'\n\n### Performance\n- Should complete in < 5s for typical playbook\n- Log timing information","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-08T01:24:35.050166Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-j7gh","depends_on_id":"cass_memory_system-33w3","type":"blocks","created_at":"2026-01-21T09:28:51Z","created_by":"import"},{"issue_id":"cass_memory_system-j7gh","depends_on_id":"cass_memory_system-ep5y","type":"blocks","created_at":"2026-01-21T09:28:51Z","created_by":"import"},{"issue_id":"cass_memory_system-j7gh","depends_on_id":"cass_memory_system-p4mv","type":"blocks","created_at":"2026-01-21T09:28:51Z","created_by":"import"},{"issue_id":"cass_memory_system-j7gh","depends_on_id":"cass_memory_system-yj1z","type":"blocks","created_at":"2026-01-21T09:28:51Z","created_by":"import"}]}
{"id":"cass_memory_system-j7lc","title":"[Impl] Rewrite README.md with Agent-First Framing","description":"# Rewrite README.md with Agent-First Framing\n\n## Purpose\nTransform README from human-centric to agent-first documentation. This is the MAIN documentation task that consolidates all doc work.\n\n## This Task Includes (Consolidated)\n- Command categorization by audience (was ajkn)\n- README structure design (was hg12)  \n- Audience tags on all commands (was muvr)\n- Automation setup documentation (was skri)\n\n## Key Sections to Create\n\n### 1. What This Is\n- \"Memory system FOR AI coding agents\"\n- Agents are consumers, humans are operators\n- Three-layer architecture (keep, it's good)\n\n### 2. For Humans: Quick Start (~15%)\n- Install\n- Add blurb to AGENTS.md (link to blurb)\n- Done (that's it!)\n\n### 3. For Agents: Usage (~25%)\n- Protocol: START (cm context) → WORK → END (automatic)\n- cm context command with examples\n- cm mark command (and inline feedback option)\n- Output schemas\n\n### 4. For Humans: Operation & Monitoring (~20%)\n- Configuration options\n- Setting up automation (cron examples, hook examples)\n- cm stats, cm doctor, cm audit\n- cm playbook for manual rule management\n\n### 5. Architecture (~20%)\n- Keep existing content, it's good\n\n### 6. Command Reference (~15%)\n- ALL commands with audience tags:\n  - [Agent-Essential]: context, mark\n  - [Agent-Occasional]: doctor, stats\n  - [Operator]: init, playbook, project, serve\n  - [Automated]: reflect, audit\n\n## Quality Checklist\n- [ ] Agent section fits in ~500 tokens if extracted\n- [ ] Every command has audience tag\n- [ ] No implication that humans run agent commands\n- [ ] Blurb prominently featured\n- [ ] Automation setup clearly documented\n\n## Success Criteria\nSomeone reading just the \"For Agents\" section can use cass-memory effectively.","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-08T17:47:06.083160Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-je14","title":"[P0] Standardize error handling with recovery guidance","description":"# Task: Standardize Error Handling\n\n## Problem\nError messages don't tell users how to fix issues:\n- \"Semantic search unavailable\" - but why? How to enable?\n- \"Bullet not found\" - but where to look?\n- \"Config invalid\" - but what's wrong?\n\n## Solution\n\n### 1. Create Error Recovery System\n```typescript\ninterface RecoverableError {\n  message: string;\n  code: ErrorCode;\n  cause?: string;        // What triggered this\n  recovery: string[];    // Steps to fix\n  docs?: string;         // Link to documentation\n}\n```\n\n### 2. Update All Error Paths\nEvery error should include:\n- Clear message (what happened)\n- Cause (why it happened)\n- Recovery steps (how to fix)\n- Exit code (for scripting)\n\n### 3. JSON Error Format\n```json\n{\n  \"success\": false,\n  \"error\": \"Semantic search unavailable\",\n  \"cause\": \"OPENAI_API_KEY not set\",\n  \"recovery\": [\n    \"Set OPENAI_API_KEY environment variable\",\n    \"Or run: cm config set openaiApiKey <key>\",\n    \"Or use --no-semantic flag for keyword-only\"\n  ],\n  \"code\": \"MISSING_API_KEY\",\n  \"docs\": \"https://docs.example.com/semantic-search\"\n}\n```\n\n## Files to Update\n- src/utils.ts (printJsonError enhancement)\n- All src/commands/*.ts (add recovery to errors)\n- src/types.ts (ErrorCode expansion)\n\n## Acceptance\n- [ ] All error messages include recovery steps\n- [ ] JSON errors have consistent structure\n- [ ] Documentation links where applicable\n- [ ] Exit codes are meaningful and documented","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-16T15:33:06.829692Z","updated_at":"2025-12-16T18:16:23.508780Z","closed_at":"2025-12-16T18:16:23.508780Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-jfc5","title":"[UX] Safety & Footgun Reduction","description":"Why this matters\n- Some flags are irreversible (`--hard` deletes bullets; `--force` implies overwrites).\n- Premium UX means users can’t accidentally lose data; destructive actions require explicit intent and provide a preview.\n\nScope\n- Add confirmation patterns for destructive actions (type-to-confirm / --yes).\n- Make help text and docs clearly flag irreversible operations.\n- Ensure “safe defaults”: deprecate instead of delete; backup before overwrite.","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-13T10:13:13.687826Z","updated_at":"2025-12-13T22:35:42.030591Z","closed_at":"2025-12-13T22:35:42.030591Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-jfc5","depends_on_id":"cass_memory_system-q6uv","type":"parent-child","created_at":"2026-01-21T09:28:51Z","created_by":"import"}]}
{"id":"cass_memory_system-jhuj","title":"[CLI:audit] scanSessionsForViolations - Find rule violations","description":"Core logic to scan sessions and identify playbook rule violations.\n\nFunction signature:\n```typescript\nasync function scanSessionsForViolations(\n  sessions: string[],\n  playbook: Playbook,\n  config: Config\n): Promise<AuditViolation[]>\n```\n\nImplementation:\n1. For each session path:\n   - Load or export session content\n   - Extract key events: commits, file changes, commands\n   \n2. For each active playbook bullet:\n   - Prepare violation check prompt:\n     ```\n     Session summary: {sessionSummary}\n     Rule: {bullet.content}\n     Category: {bullet.category}\n     \n     Did this session violate this rule? If yes, provide evidence.\n     ```\n   \n   - Call LLM (fast model)\n   - Parse response for violation detection\n   \n3. Record violations:\n   ```typescript\n   interface AuditViolation {\n     bulletId: string;\n     bulletContent: string;\n     sessionPath: string;\n     timestamp: string;\n     severity: 'high' | 'medium' | 'low';\n     evidence: string;\n   }\n   ```\n   \n4. Severity mapping:\n   - proven → high\n   - accepted → medium\n   - candidate → low\n\nOptimizations:\n- Batch LLM calls where possible\n- Cache session summaries\n- Skip deprecated bullets\n- Early exit if no active rules\n\nEdge cases:\n- Handle session load failures gracefully\n- Skip sessions with no meaningful content\n- Handle LLM parsing errors (assume no violation)\n\nReturn array of all violations found across all sessions.","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:51:11.808386Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-jis4","title":"[UX][doctor] Align CLI flags with doctor capabilities","description":"Problem\n- `doctor.ts` supports fix UX concepts (interactive, dry-run, force) but `cm doctor` exposes only `--json` and `--fix`.\n- Doctor output suggests flags that do not exist (e.g., “Use --fix --force…”).\n\nWhat to do\n- Decide the supported doctor UX surface and implement it end-to-end:\n  - `--fix` (apply safe fixes)\n  - `--force` (allow cautious fixes)\n  - `--dry-run` (show what would change)\n  - `--interactive` / `--no-interactive` (avoid hanging in CI)\n  - `--self-test` / `--full` (run slow smoke tests)\n- Ensure help and messaging only mention real flags.\n\nNotes\n- In non-interactive mode, default to “no changes” unless explicit flags are provided.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-13T10:15:27.111825Z","updated_at":"2025-12-13T11:17:07.826897Z","closed_at":"2025-12-13T11:17:07.826897Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-jis4","depends_on_id":"cass_memory_system-dq7w","type":"parent-child","created_at":"2026-01-21T09:28:51Z","created_by":"import"}]}
{"id":"cass_memory_system-jkpj","title":"[EPIC] UX Polish: Stripe-Level CLI Quality","description":"# Epic: UX Polish for Premium CLI Experience\n\n## Goal\nTransform cass-memory CLI into a Stripe-level polished experience with consistent, intuitive, and delightful interactions.\n\n## Current Issues (from audit)\n\n### Critical Consistency Problems\n1. **Flag naming chaos**: --top vs --limit mean different things in different commands\n2. **Output format conflicts**: --json and --format can conflict\n3. **Error codes inconsistent**: Some use ErrorCode enum, some just exit(1)\n4. **Error messages lack recovery guidance**: User doesn't know how to fix\n\n### Missing Premium Features\n5. **No progress indicators** for long operations\n6. **No --examples flag** showing common workflows\n7. **Help text lacks practical examples**\n8. **No command aliases** for common operations\n\n### UX Anti-patterns\n9. **Silent defaults**: Invalid input silently falls back instead of erroring\n10. **Inconsistent dry-run messaging**\n11. **JSON output structures vary wildly**\n12. **Boolean flags use inconsistent patterns**\n\n## Success Criteria\n- [ ] All flag names follow consistent conventions\n- [ ] All errors include \"how to fix\" guidance\n- [ ] All long operations show progress\n- [ ] Help text includes examples for every command\n- [ ] JSON output follows consistent schema\n- [ ] Zero silent failures - all errors are explicit\n\n## Subtasks (Priority Order)\n1. [P0] Standardize error handling with recovery guidance\n2. [P0] Unify output format flags (--json, --format)\n3. [P1] Add progress indicators for long operations\n4. [P1] Standardize JSON output schema across commands\n5. [P1] Add examples to all command help text\n6. [P2] Add command aliases (cm ls, cm rm, etc.)\n7. [P2] Fix flag naming inconsistencies\n8. [P2] Eliminate silent defaults - fail fast on invalid input\n9. [P3] Add --examples global flag\n10. [P3] Add --info flag showing version + config locations","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-16T15:32:19.633430Z","updated_at":"2025-12-28T03:36:40.080459Z","closed_at":"2025-12-28T03:36:40.080459Z","close_reason":"All 12 dependency tasks completed: error handling, output formats, progress indicators, JSON schema, help examples, race fix, aliases, flag naming, fail-fast, truncation, --examples, --info","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-jkpj","depends_on_id":"cass_memory_system-082i","type":"blocks","created_at":"2026-01-21T09:28:51Z","created_by":"import"},{"issue_id":"cass_memory_system-jkpj","depends_on_id":"cass_memory_system-8zaj","type":"blocks","created_at":"2026-01-21T09:28:51Z","created_by":"import"},{"issue_id":"cass_memory_system-jkpj","depends_on_id":"cass_memory_system-bblo","type":"blocks","created_at":"2026-01-21T09:28:51Z","created_by":"import"},{"issue_id":"cass_memory_system-jkpj","depends_on_id":"cass_memory_system-fbye","type":"blocks","created_at":"2026-01-21T09:28:51Z","created_by":"import"},{"issue_id":"cass_memory_system-jkpj","depends_on_id":"cass_memory_system-je14","type":"blocks","created_at":"2026-01-21T09:28:51Z","created_by":"import"},{"issue_id":"cass_memory_system-jkpj","depends_on_id":"cass_memory_system-lk01","type":"blocks","created_at":"2026-01-21T09:28:51Z","created_by":"import"},{"issue_id":"cass_memory_system-jkpj","depends_on_id":"cass_memory_system-lm91","type":"blocks","created_at":"2026-01-21T09:28:51Z","created_by":"import"},{"issue_id":"cass_memory_system-jkpj","depends_on_id":"cass_memory_system-m3dp","type":"blocks","created_at":"2026-01-21T09:28:51Z","created_by":"import"},{"issue_id":"cass_memory_system-jkpj","depends_on_id":"cass_memory_system-oe0g","type":"blocks","created_at":"2026-01-21T09:28:51Z","created_by":"import"},{"issue_id":"cass_memory_system-jkpj","depends_on_id":"cass_memory_system-wuit","type":"blocks","created_at":"2026-01-21T09:28:51Z","created_by":"import"},{"issue_id":"cass_memory_system-jkpj","depends_on_id":"cass_memory_system-x2zm","type":"blocks","created_at":"2026-01-21T09:28:51Z","created_by":"import"},{"issue_id":"cass_memory_system-jkpj","depends_on_id":"cass_memory_system-yelb","type":"blocks","created_at":"2026-01-21T09:28:51Z","created_by":"import"}]}
{"id":"cass_memory_system-jkpj.1","title":"Audit recent CLI UX additions and fix issues","description":"Fresh-eyes review and harden the recently added/modified CLI UX surfaces (global --info/--examples, outcome --summary alias, serve stdio/http DI + in-process tests). Fix any bugs/confusing output, and keep docs/tests consistent.","notes":"Starting fresh-eyes audit of recent CLI UX changes (info/examples/outcome/serve) and will record progress here; Agent Mail inbox unavailable (BEADS_AGENT_MAIL_URL not set).\\n\\nFresh-eyes findings + fixes:\\n- Removed Commander defaults for cm serve --host/--port so MCP_HTTP_HOST/MCP_HTTP_PORT env overrides work again (defaults still apply when unset).\\n- Added /.gitignore entry for leftover root '/0' artifact from older coverage script argv slicing bug (no deletion performed).","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-18T03:48:23.340151929Z","updated_at":"2025-12-18T04:01:43.731820760Z","closed_at":"2025-12-18T04:01:43.731820760Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-jkpj.1","depends_on_id":"cass_memory_system-jkpj","type":"parent-child","created_at":"2026-01-21T09:28:51Z","created_by":"import"}]}
{"id":"cass_memory_system-jkpj.2","title":"Document global --info/--examples in README + docs tests","description":"Add README documentation for the new global flags (cm --info, cm --examples), and extend docs tests to prevent drift.","notes":"Starting: will document cm --info / cm --examples (global introspection) in README and add docs test assertions. Agent Mail not configured (BEADS_AGENT_MAIL_URL not set).\\n\\nProgress:\\n- README: added Global Introspection section with cm --info / cm --examples examples.\\n- test/docs.test.ts: added assertions to prevent drift.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T04:10:26.359110398Z","updated_at":"2025-12-18T04:11:28.389776983Z","closed_at":"2025-12-18T04:11:28.389776983Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-jkpj.2","depends_on_id":"cass_memory_system-jkpj","type":"parent-child","created_at":"2026-01-21T09:28:51Z","created_by":"import"}]}
{"id":"cass_memory_system-jkpj.3","title":"Make cm --info --examples --json output a single JSON envelope","description":"Currently, running both global introspection flags with --json prints two JSON objects to stdout, which breaks parsers. Change cm.ts to emit one JSON envelope when both are requested.","notes":"Starting: will combine cm --info/--examples JSON output into a single envelope when both flags are passed. Agent Mail not configured (BEADS_AGENT_MAIL_URL not set).\\n\\nDone:\\n- src/cm.ts now emits a single JSON envelope (command: introspect) for cm --info --examples --json.\\n- Added e2e regression: test/e2e-smoke.test.ts.\\n- Ran KEEP_TEMP=1 bun test test/e2e-smoke.test.ts (pass).","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T04:27:18.711256926Z","updated_at":"2025-12-18T04:28:34.812095108Z","closed_at":"2025-12-18T04:28:34.812095108Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-jkpj.3","depends_on_id":"cass_memory_system-jkpj","type":"parent-child","created_at":"2026-01-21T09:28:51Z","created_by":"import"}]}
{"id":"cass_memory_system-jkpj.4","title":"Fix LLM provider normalization + validate MCP tool required strings","description":"Bugfix/polish: normalize provider names in src/llm.ts getModel() (accept OpenAI/OPENAI/etc) and tighten src/commands/serve.ts MCP tools to reject empty required strings (task/query/bulletId/sessionId) to avoid accidental match-all searches or unclear behavior.","notes":"Done: src/llm.ts getModel() now normalizes provider case + improves unsupported-provider message; tests updated (test/llm.test.ts). MCP tools in src/commands/serve.ts now reject empty required strings (task/query/bulletId/sessionId) to prevent match-all searches; added unit expectations in test/serve-stdio.e2e.test.ts. Verified via bun run typecheck + KEEP_TEMP=1 bun test test/llm.test.ts + KEEP_TEMP=1 bun test test/serve-stdio.e2e.test.ts --test-name-pattern 'surfaces tool validation errors'.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T06:56:33.246995085Z","updated_at":"2025-12-18T06:56:48.355020188Z","closed_at":"2025-12-18T06:56:48.355020188Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-jkpj.4","depends_on_id":"cass_memory_system-jkpj","type":"parent-child","created_at":"2026-01-21T09:28:51Z","created_by":"import"}]}
{"id":"cass_memory_system-jl41","title":"[Integration] CLI Command Chains - Multi-Command Flows","description":"## Target: Integration tests for CLI command sequences\n\n### Test Scenarios:\n\n1. **Init → Context → Mark Flow**\n   ```bash\n   cm init --json\n   cm context \"test query\" --json\n   cm mark <bullet-id> helpful --json\n   cm context \"test query\" --json  # Score changed\n   ```\n\n2. **Init Repo → Playbook → Curate Flow**\n   ```bash\n   cd <temp-git-repo>\n   cm init --repo --json\n   cm playbook --add \"Test bullet\" --json\n   cm playbook --add \"Duplicate bullet\" --json\n   cm curate --dry-run --json\n   ```\n\n3. **Diary → Timeline → Reflect Flow**\n   ```bash\n   # Create diary entries\n   cm diary --list --json\n   cm timeline --since 7d --json\n   cm reflect --json\n   ```\n\n4. **Toxic Pattern Flow**\n   ```bash\n   cm toxic add \"bad-pattern\" --json\n   cm toxic list --json\n   cm toxic check \"content with bad-pattern\" --json\n   ```\n\n5. **Doctor → Validate → Fix Flow**\n   ```bash\n   cm doctor --json\n   cm validate --json\n   cm validate --fix --json\n   cm doctor --json  # Issues resolved\n   ```\n\n### Test Infrastructure:\n- Spawn actual CLI process\n- Capture stdout/stderr\n- Parse JSON output\n- Verify state changes\n\n### Logging:\n- Full command with args\n- Exit code\n- Stdout content\n- Stderr content\n- Duration","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T01:30:12.582767Z","updated_at":"2025-12-14T01:43:11.813763Z","closed_at":"2025-12-14T01:43:11.813763Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-job7","title":"Remove redundant path-utils and harden sanitize performance","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-08T06:05:01.162559Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-jsk7","title":"Implement split curation for Global vs Repo playbooks","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-08T05:23:49.064368Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-jvpl","title":"[Unit] diary.ts - Diary Loading, Formatting & Timeline","description":"## Target: src/diary.ts - Diary Module\n\n### Existing Tests to Expand:\n- test/format-raw-session.test.ts covers formatRawSession()\n\n### Functions to Test:\n\n1. **loadDiary(diaryDir)** - Load diary entries\n   - Loads all .md, .json, .jsonl files\n   - Sorts by date\n   - Returns DiaryEntry array\n   - Handles missing directory\n   - Handles permission errors\n\n2. **loadDiaryEntry(path)** - Load single entry\n   - Parses frontmatter\n   - Extracts content\n   - Returns DiaryEntry object\n   - Handles malformed files\n\n3. **formatRawSession(content, ext)** - Already tested\n   - EXPAND existing tests\n   - Add more edge cases\n   - Performance for large files\n\n4. **buildTimeline(entries, options)** - Timeline construction\n   - Chronological ordering\n   - Date grouping\n   - Filter by date range\n   - Filter by type\n\n5. **searchDiary(entries, query)** - Diary search\n   - Full-text search\n   - Date filtering\n   - Returns ranked results\n   - Handles empty query\n\n6. **checkToxicity(content, toxicLog)** - Toxicity check\n   - Matches against toxic patterns\n   - Returns match details\n   - Case insensitive matching\n   - Regex pattern support\n\n7. **validateDiaryEntry(entry)** - Entry validation\n   - Required fields present\n   - Date format valid\n   - Content not empty\n\n### Test Data:\n- Create sample diary entries\n- Various formats (.md, .json, .jsonl)\n- Include malformed examples\n- Unicode content","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-08T01:28:38.426582Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-jzo","title":"[LLM] extractDiary - Structured diary extraction","description":"Function signature:\nasync function extractDiary<T extends z.ZodSchema>(\n  schema: T,\n  sessionContent: string,\n  metadata: { sessionPath: string; agent: string; workspace?: string },\n  config: Config\n): Promise<z.infer<T>>\n\nImplementation:\n1. Build prompt from PROMPTS.diary template\n2. Substitute variables: sessionPath, agent, workspace, content\n3. Truncate sessionContent if >50000 chars (to avoid token limits)\n4. Call generateObject with:\n   - schema: provided Zod schema\n   - prompt: built prompt\n   - temperature: 0.3 (low for consistency)\n   - model: from config\n5. Return typed object (Zod validates structure)\n\nUsed by: digest command to extract structured insights from agent sessions.\n\nError handling: Should use llmWithRetry wrapper for resilience.","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:45:58.354780Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-jzqz","title":"Fix 31 failing tests blocking CI","notes":"Fixed 29+ test failures: duplicate reinforcement behavior, exit codes, path normalization, REDACTED placeholder, console.error capture. Remaining 2 flaky/environment-sensitive tests.","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-28T03:48:53.245451Z","updated_at":"2025-12-28T04:33:41.008937Z","closed_at":"2025-12-28T04:33:41.008937Z","close_reason":"Fixed 29+ test failures: duplicate reinforcement semantics, exit code expectations, path normalization, REDACTED placeholders. Tests now at 99.1% pass rate (1988+/1992).","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-jzr2","title":"Fix cassExpand/cassIndex flag drift","description":"src/cass.ts uses unsupported flags: cassExpand passes --robot (cass expand only supports --json) so it always fails; cassIndex supports options.incremental and passes --incremental which cass index does not accept. Update to correct flags and add regression coverage.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-16T09:24:37.072531Z","updated_at":"2025-12-16T09:27:57.342272Z","closed_at":"2025-12-16T09:27:57.342272Z","close_reason":"Completed: fix cassExpand/Index flags + regression tests","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-jztq","title":"[P1] Add unit tests for stale.ts command","description":"# Task: Unit tests for stale.ts command (245 lines)\n\n## Why Important\nstale.ts identifies outdated bullets - key for playbook hygiene. Incorrect staleness detection leads to:\n- Good rules being marked stale (false positives)\n- Bad rules staying active (false negatives)\n\n## What to Test\n\n### Staleness Detection\n- [ ] Bullets without recent feedback detected\n- [ ] Confidence decay calculation correct\n- [ ] Age-based staleness works\n- [ ] Activity-based staleness works\n\n### Filtering\n- [ ] Filter by scope (global/workspace)\n- [ ] Filter by maturity\n- [ ] Filter by category\n- [ ] Combine multiple filters\n\n### Recommendations\n- [ ] Stale bullets listed with reasons\n- [ ] Suggested actions are actionable\n- [ ] Priority ordering makes sense\n\n### Output\n- [ ] Text output readable\n- [ ] JSON output correct structure\n- [ ] Count summary accurate\n\n## Files\n- Source: src/commands/stale.ts (245 lines)\n- Test: test/stale.test.ts (new)\n\n## Acceptance\n- [ ] Staleness calculation tested\n- [ ] All filters tested\n- [ ] Output formats verified\n- [ ] No mocks used","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-16T15:30:22.517765Z","updated_at":"2025-12-17T02:44:19.671203Z","closed_at":"2025-12-17T02:44:19.671203Z","close_reason":"Added unit tests for stale command (JSON output, scope filter, recommendations, no-stale text). Typechecked; did not run bun test due to session no-delete constraint.","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-jzwe","title":"[P2] Add unit tests for audit.ts command","description":"# Task: Unit tests for audit.ts command (104 lines)\n\n## What to Test\n- [ ] Audit trail retrieved correctly\n- [ ] Time range filtering works\n- [ ] Event type filtering works\n- [ ] Output format correct\n- [ ] Privacy-sensitive data redacted\n\n## Files\n- Source: src/commands/audit.ts (104 lines)\n- Test: test/audit.test.ts (new)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T15:30:51.663033Z","updated_at":"2025-12-17T09:20:26.809136Z","closed_at":"2025-12-17T09:20:26.809136Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-k0qp","title":"[Semantic] saveEmbeddingCache - Persist cache to disk","description":"Persist embedding cache to disk atomically.\n\nImplementation:\n```typescript\nasync function saveEmbeddingCache(cache: EmbeddingCache): Promise<void>\n```\n\nProcess:\n1. Serialize cache to JSON\n2. Write to temp file (~/.cass-memory/embeddings/bullets.json.tmp)\n3. Atomic move to final location\n4. Handle errors gracefully\n\nAtomicity:\n- Write to temp file first\n- Move is atomic on most filesystems\n- Prevents corruption if crash during write\n\nError handling:\n- Directory not exist → create\n- Permission denied → log error\n- Disk full → log error, keep old cache\n- JSON serialization error → log and skip\n\nFile size:\n- 100 bullets: ~300KB\n- 1000 bullets: ~3MB\n- Gzip compression could reduce 50% (future)\n\nWhen called:\n- After loadOrComputeEmbeddings\n- After batch embedding updates\n- Before process exit (cleanup)\n\nExample:\n```typescript\nawait saveEmbeddingCache({\n  version: \"1.0\",\n  model: \"Xenova/all-MiniLM-L6-v2\",\n  bullets: {\n    \"b-123\": { contentHash: \"...\", embedding: [...], computedAt: \"...\" }\n  }\n});\n```","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-07T21:49:44.691385Z","updated_at":"2025-12-13T09:31:43.555295Z","closed_at":"2025-12-13T09:31:43.555295Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-k2k","title":"[Reflector] ReflectionStats - Track reflection effectiveness","description":"interface ReflectionStats {\n  sessionPath: string;\n  iterations: number;\n  deltasPerIteration: number[];\n  totalDeltas: number;\n  deltasByType: Record<string, number>;\n  duration: number;\n}\n\nTrack for analysis of reflection quality\n\nPURPOSE:\n- Monitor reflection effectiveness\n- Identify when early exit is working\n- Debug reflection issues\n- Optimize maxReflectorIterations\n\nEXAMPLE OUTPUT:\n```json\n{\n  \"sessionPath\": \"/path/to/session.jsonl\",\n  \"iterations\": 3,\n  \"deltasPerIteration\": [12, 5, 0],\n  \"totalDeltas\": 17,\n  \"deltasByType\": {\n    \"add\": 10,\n    \"helpful\": 4,\n    \"harmful\": 2,\n    \"replace\": 1,\n    \"deprecate\": 0\n  },\n  \"duration\": 4523\n}\n```\n\nANALYSIS INSIGHTS:\n- If iterations = 1 always: prompt may be too narrow\n- If deltasPerIteration decreases: good (finding less each time)\n- If duration > 10s: consider reducing maxReflectorIterations\n- If totalDeltas = 0: diary may be empty or LLM issue\n\nCOLLECTION POINTS:\n- Start: record sessionPath, start time\n- Each iteration: push deltas count\n- End: record total, duration, type breakdown\n\nSTORAGE:\n- Log to console in verbose mode\n- Optional: append to .cass/reflection-stats.jsonl\n\nUsed in reflectOnSession()","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:45:02.213483Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-k706","title":"[Unit Tests] utils.ts - Comprehensive utility function tests","description":"## Unit Tests: utils.ts - Comprehensive Utility Function Tests\n\n### Test Categories\n\n#### 1. Path Utilities\n- expandPath() handles ~/ expansion\n- expandPath() handles env vars\n- normalizePath() resolves relative paths\n- isAbsolutePath() cross-platform check\n- ensureDir() creates nested directories\n\n#### 2. File Utilities\n- readFileIfExists() returns content or null\n- writeFileAtomic() uses temp + rename\n- fileExists() sync existence check\n- getFileModTime() returns mtime\n\n#### 3. String Utilities\n- truncate() respects max length\n- truncate() adds ellipsis\n- sanitize() removes dangerous chars\n- slugify() creates URL-safe strings\n- capitalize() handles empty strings\n\n#### 4. Hash Utilities\n- hashContent() deterministic SHA256\n- shortHash() truncated for IDs\n- hashFile() streams large files\n\n#### 5. Keyword Extraction\n- extractKeywords() from text\n- Handles stopwords\n- Handles punctuation\n- Returns unique keywords\n- Case normalization\n\n#### 6. Scoring Utilities\n- normalizeScore() to [0,1] range\n- weightedAverage() calculation\n- percentile() calculation\n\n#### 7. Date/Time Utilities\n- formatDate() ISO format\n- parseDate() from various formats\n- daysAgo() calculation\n- isRecent() threshold check\n\n#### 8. Logging\n- log() respects verbose flag\n- error() always outputs\n- Proper stderr/stdout separation\n\n### Test Approach\n- Pure function testing (deterministic)\n- Edge cases: empty inputs, unicode, very long strings\n- Cross-platform path handling","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-08T01:24:03.916398Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-kakr","title":"Fix cassTimeline CLI args + robust session discovery fallback","description":"src/cass.ts cassTimeline currently calls cass timeline with --days, but cass timeline uses --since (e.g. 7d) per cass --help. The wrong flag can cause cass to treat the call as a search (returning search-shaped JSON), which then gets cast to CassTimelineResult and can crash callers (findUnprocessedSessions/audit/privacy). Update cassTimeline to use correct args, validate output shape, and fall back to wildcard cass search when timeline fails. Also update callers to use nullish coalescing so days=0 is respected.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-16T09:06:21.299057Z","updated_at":"2025-12-16T09:11:21.796584Z","closed_at":"2025-12-16T09:11:21.796584Z","close_reason":"Completed: fix cassTimeline args, validate output, fallback to wildcard search","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-kam","title":"[Curator] handleDeprecateDelta - Mark bullet as deprecated","description":"Explicitly mark a bullet as deprecated with optional replacement.\n\nSignature:\nfunction handleDeprecateDelta(\n  playbook: Playbook,\n  delta: DeprecateDelta\n): { applied: boolean }\n\nProcess:\n1. Find bullet by ID\n   - If not found: return applied: false\n2. Update bullet fields:\n   - state: 'retired'\n   - maturity: 'deprecated'\n   - deprecationReason: delta.reason (required)\n   - replacedBy: delta.replacedBy (optional bullet ID)\n   - updatedAt: current timestamp\n3. Return applied: true\n\nWhen is this used?\n- Manual deprecation by user (cm forget)\n- Merging bullets (old bullets point to merged result)\n- Replacing outdated rules with better versions\n\nImportant notes:\n- Deprecated bullets are NOT deleted\n- They're moved to playbook.deprecated array during pruning\n- History is preserved for audit trail\n- replacedBy provides migration path\n\nExample deprecation chain:\n1. Bullet A is deprecated with replacedBy: B\n2. Bullet B later deprecated with replacedBy: C\n3. System can trace evolution: A → B → C\n\nThis maintains continuity while allowing playbook evolution.","status":"tombstone","priority":3,"issue_type":"task","created_at":"2025-12-07T21:45:00.887743Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-ke2x","title":"Sub-Epic: E2E Test Suite with Detailed Logging","description":"# Sub-Epic: E2E Test Suite with Detailed Logging\n\n## Philosophy\nTest complete user workflows from CLI to result.\nRun actual `cm` commands against real (temp) file systems.\nDetailed logging at every step for debugging.\n\n## Logging Framework\n\n### Log Levels\n- DEBUG: Every function entry/exit, variable states\n- INFO: Major workflow steps, assertions\n- WARN: Unexpected but recoverable states\n- ERROR: Failures with full context\n\n### Log Format\n```\n[TIMESTAMP] [LEVEL] [TEST_NAME] [STEP] message\n  context: { key: value, ... }\n  duration: Xms\n```\n\n### Log Output\n- Console: INFO and above\n- File: ALL levels to test/logs/{test-name}-{timestamp}.log\n- Summary: test/logs/summary.json with pass/fail/duration\n\n## E2E Test Scenarios\n\n### Scenario 1: Fresh Installation\n1. Run `cm init` in empty temp dir\n2. Verify directory structure created\n3. Verify default config written\n4. Verify empty playbook created\n5. Log: All file paths and contents\n\n### Scenario 2: Session → Diary → Reflect Workflow\n1. Create fixture session file\n2. Run `cm diary <session>` (may skip LLM with fixture)\n3. Verify diary JSON created\n4. Run `cm reflect --dry-run` (with LLM fixture)\n5. Verify deltas proposed\n6. Log: Each step's input/output\n\n### Scenario 3: Playbook CRUD Operations\n1. `cm playbook add \"Test rule\"` → verify ID returned\n2. `cm playbook list --json` → verify rule appears\n3. `cm mark <id> --helpful` → verify count incremented\n4. `cm mark <id> --harmful` → verify feedback recorded\n5. `cm playbook remove <id>` → verify deprecation\n6. Log: Playbook state before/after each operation\n\n### Scenario 4: Context Retrieval\n1. Populate playbook with varied rules\n2. `cm context \"task description\" --json`\n3. Verify relevant rules returned\n4. Verify scoring makes sense\n5. Log: Scoring breakdown for each rule\n\n### Scenario 5: Feedback Loop & State Transitions\n1. Add new rule (maturity: candidate)\n2. Mark helpful 3x → verify maturity: established\n3. Mark helpful 7x more → verify maturity: proven\n4. Mark harmful 5x → verify state transition\n5. Log: State machine transitions\n\n### Scenario 6: Anti-Pattern Detection\n1. Add rule, mark harmful repeatedly\n2. Verify anti-pattern inversion triggered\n3. Attempt to add similar rule\n4. Verify conflict/warning raised\n5. Log: Inversion details, similarity scores\n\n### Scenario 7: Multi-Session Learning\n1. Process session A → extract deltas\n2. Process session B → extract deltas (should reference A's learnings)\n3. Process session C → verify deduplication\n4. Verify playbook growth curve\n5. Log: Delta counts, dedup stats\n\n### Scenario 8: Doctor & Stats\n1. Create scenario with issues (missing files, etc.)\n2. Run `cm doctor --json`\n3. Verify issues detected\n4. Run `cm stats --json`\n5. Verify statistics accurate\n6. Log: All diagnostic output\n\n### Scenario 9: Validation Pipeline\n1. Propose rule via reflect\n2. Run evidence-count gate\n3. If ambiguous, run LLM validation (fixture)\n4. Verify verdict matches expectations\n5. Log: Gate results, LLM prompt/response\n\n### Scenario 10: Error Recovery\n1. Simulate various error conditions:\n   - Missing cass binary\n   - Corrupted playbook YAML\n   - Invalid config JSON\n   - LLM API timeout (mocked)\n2. Verify graceful degradation\n3. Verify error messages helpful\n4. Log: Error chain, recovery actions\n\n## Test Execution\n- `bun test:e2e` - Run all E2E tests\n- `bun test:e2e:verbose` - Run with DEBUG logging\n- `bun test:e2e:scenario <name>` - Run specific scenario\n\n## CI/CD Integration\n- GitHub Actions workflow\n- Artifacts: Log files, coverage reports\n- Failure screenshots (terminal output)","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-08T01:22:59.495309Z","updated_at":"2025-12-14T00:25:29.830974Z","closed_at":"2025-12-14T00:25:29.830974Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-ke2x","depends_on_id":"cass_memory_system-u64s","type":"blocks","created_at":"2026-01-21T09:28:51Z","created_by":"import"}]}
{"id":"cass_memory_system-kfi","title":"[Security] SECRET_PATTERNS - Regex patterns for secret detection","description":"Implement the SECRET_PATTERNS array containing high-yield regex patterns for detecting common secrets.\n\nCOMPLETE list of patterns:\n\nTypeScript implementation:\n```typescript\nconst SECRET_PATTERNS: Array<{ pattern: RegExp; replacement: string }> = [\n  // AWS\n  { pattern: /AKIA[0-9A-Z]{16}/g, replacement: \"[AWS_ACCESS_KEY]\" },\n  { pattern: /[A-Za-z0-9/+=]{40}(?=\\s|$|\"|')/g, replacement: \"[AWS_SECRET_KEY]\" },\n\n  // Generic API keys/tokens\n  { pattern: /Bearer\\s+[A-Za-z0-9\\-\\._~\\+\\/]+=*/g, replacement: \"[BEARER_TOKEN]\" },\n  { pattern: /api[_-]?key[\"\\s:=]+[\"']?[A-Za-z0-9\\-_]{20,}[\"']?/gi, replacement: \"[API_KEY]\" },\n  { pattern: /token[\"\\s:=]+[\"']?[A-Za-z0-9\\-_]{20,}[\"']?/gi, replacement: \"[TOKEN]\" },\n\n  // Private keys\n  { pattern: /-----BEGIN (RSA |EC |DSA |OPENSSH )?PRIVATE KEY-----[\\s\\S]+?-----END (RSA |EC |DSA |OPENSSH )?PRIVATE KEY-----/g, replacement: \"[PRIVATE_KEY]\" },\n\n  // Passwords in common formats\n  { pattern: /password[\"\\s:=]+[\"'][^\"']{8,}[\"']/gi, replacement: 'password=\"[REDACTED]\"' },\n\n  // GitHub tokens\n  { pattern: /ghp_[A-Za-z0-9]{36}/g, replacement: \"[GITHUB_PAT]\" },\n  { pattern: /github_pat_[A-Za-z0-9_]{22,}/g, replacement: \"[GITHUB_PAT]\" },\n\n  // Slack tokens\n  { pattern: /xox[baprs]-[A-Za-z0-9-]+/g, replacement: \"[SLACK_TOKEN]\" },\n\n  // Database URLs with credentials\n  { pattern: /(postgres|mysql|mongodb):\\/\\/[^:]+:[^@]+@/gi, replacement: \"$1://[USER]:[PASS]@\" }\n];\n```\n\nEach pattern is chosen for HIGH YIELD - catches most secrets without excessive false positives.\nThese are proven patterns that work across codebases.\n\nPriority: 0 (Security Critical - P12)","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:44:47.352672Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-kfj","title":"[Types] ContextResult - Pre-Task Hydration Output","description":"## Overview\nDefine ContextResult type - the structured output from pre-task hydration that provides agents with relevant playbook rules, history, and warnings.\n\n## Purpose\nContextResult is the PRIMARY INTERFACE between cass-memory and AI agents:\n1. Delivered before each task to provide relevant context\n2. Includes playbook rules ranked by relevance\n3. Provides historical session snippets\n4. Warns about deprecated patterns\n5. Suggests useful cass queries for deeper investigation\n\n## ContextResult Structure\n\nCore fields that make up the hydrated context.\n\ntask: string\n- The task description that triggered context retrieval\n- Example: 'Implement JWT authentication for API endpoints'\n- Used for: Relevance ranking, scope filtering\n\nrelevantBullets: RelevantBullet[]\n- Array of playbook rules relevant to task\n- Ranked by: effectiveScore (with decay), semantic similarity, scope match\n- Limited by: config.maxBulletsInContext (default 50)\n- Sorted: Highest relevance first\n\nantiPatterns: AntiPattern[]\n- Array of anti-pattern warnings (type: 'anti-pattern')\n- Displayed separately as PITFALLS section\n- Purpose: Warn about common mistakes\n- Example: { id: 'b-xyz', content: 'Don't mock Router hooks directly', type: 'anti-pattern', effectiveScore: 8.2 }\n\nhistorySnippets: HistorySnippet[]\n- Array of relevant session excerpts from cass\n- Limited by: config.maxHistoryInContext (default 10)\n- Provides: Real examples from past work\n- Sorted: By relevance score\n\ndeprecatedWarnings: string[]\n- Array of warnings about deprecated patterns\n- Triggered if: Task description matches deprecatedPatterns\n- Example: ['Warning: \"Use class components\" is deprecated as of 2025-11-15. See b-new-hooks-rule instead.']\n\nsuggestedCassQueries: string[]\n- Array of recommended cass search queries\n- Generated from: Task analysis, bullet searchPointers\n- Purpose: Help agent find more context if needed\n- Example: ['JWT authentication patterns', 'token validation examples', 'auth middleware setup']\n\n## RelevantBullet Structure\n\nIndividual playbook rule in context.\n\nFields:\n- id: string (bullet ID)\n- content: string (rule text)\n- category: string (e.g., 'authentication')\n- type: 'rule' | 'anti-pattern'\n- maturity: 'candidate' | 'established' | 'proven'\n- effectiveScore: number (decayed confidence score)\n- lastHelpful: string | undefined (ISO 8601, most recent helpful mark)\n- reasoning: string | undefined (why rule was created)\n- searchPointer: string | undefined (for deeper investigation)\n\nExample:\n{ id: 'b-abc123', content: 'Use TokenValidator from @/lib/auth for JWT validation', category: 'authentication', type: 'rule', maturity: 'proven', effectiveScore: 12.5, lastHelpful: '2025-12-07T14:30:00Z', reasoning: 'Prevents auth bypass vulnerabilities' }\n\n## AntiPattern Structure\n\nAnti-pattern warning in context.\n\nFields:\n- id: string (bullet ID)\n- content: string (warning text)\n- type: 'anti-pattern' (always)\n- effectiveScore: number (how important this warning is)\n- category: string | undefined\n\nExample:\n{ id: 'b-xyz789', content: 'Don't mock useRouter - use mockRouter from test/utils', type: 'anti-pattern', effectiveScore: 8.2, category: 'testing' }\n\n## HistorySnippet Structure\n\nRelevant excerpt from past session.\n\nFields:\n- sessionPath: string (path to session file)\n- agent: string (which agent)\n- snippet: string (relevant excerpt, ~200 chars)\n- relevance: number (0-1, similarity to task)\n- timestamp: string | undefined (when session occurred)\n\nExample:\n{ sessionPath: '/cass/2025-12-05-auth-impl.jsonl', agent: 'claude', snippet: 'Implemented JWT validation using TokenValidator service with exp claim checks', relevance: 0.89, timestamp: '2025-12-05T10:15:00Z' }\n\n## Context Retrieval Flow\n\n1. Parse task description\n2. Determine scope (workspace, language, framework from task context)\n3. Filter bullets by scope\n4. Rank bullets by:\n   - Effective confidence score (with decay)\n   - Semantic similarity to task\n   - Maturity level\n5. Separate anti-patterns\n6. Search cass for relevant history\n7. Check for deprecated pattern matches\n8. Generate suggested queries\n9. Return ContextResult\n\n## JSON Output Mode\n\nCritical for agent integration (P2 feature).\n\nWhen config.jsonOutput = true, format as:\n{ task: '...', relevantBullets: [...], antiPatterns: [...], historySnippets: [...], deprecatedWarnings: [...], suggestedCassQueries: [...] }\n\nEnables: Programmatic consumption by AI agents, MCP integration, tool use\n\n## Display Format (Human-Readable)\n\nWhen config.jsonOutput = false:\n\nRELEVANT PLAYBOOK RULES:\n[PROVEN] Use TokenValidator from @/lib/auth for JWT validation (score: 12.5)\n  Reasoning: Prevents auth bypass vulnerabilities\n  Last helpful: 2 days ago\n\n[ESTABLISHED] Validate JWT exp and iat claims (score: 8.2)\n  Last helpful: 5 days ago\n\nPITFALLS TO AVOID:\n- Don't mock Router hooks directly - use mockRouter utility\n\nRELEVANT HISTORY:\n[2 days ago, claude] Implemented JWT validation using TokenValidator...\n[5 days ago, cursor] Added exp claim validation to prevent token replay...\n\nSUGGESTED CASS QUERIES:\n- cass search \"JWT authentication patterns\"\n- cass search \"token validation examples\"\n\n## Acceptance Criteria\n- ContextResult interface with all fields\n- RelevantBullet interface\n- AntiPattern interface\n- HistorySnippet interface\n- Zod schema validation\n- JSON output mode\n- Human-readable display format\n- Scope filtering logic\n- Relevance ranking algorithm\n- Examples showing complete context\n- JSDoc documentation\n- Integration with context command","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:45:07.368147Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-kmym","title":"Implement Dynamic Trauma Guard (Runtime Enforcer)","description":"Implement a single, robust 'trauma_guard.py' that dynamically reads from the 'traumas.jsonl' database at runtime.\n\nAdvantages over static generation:\n- **Instant Updates:** Adding a trauma immediately protects all projects without re-installing hooks.\n- **Single Source of Truth:** The JSONL file is the only definition of safety.\n\nLogic:\n1. Hook starts (PreToolUse).\n2. Reads '~/.cass-memory/traumas.jsonl' AND '.cass/traumas.jsonl' (if present).\n3. Checks command against active, relevant patterns.\n4. If match: Returns JSON Deny with the 'visceral' message from the trauma entry.","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-12-18T03:59:22.018222Z","updated_at":"2025-12-20T22:44:29.415308Z","closed_at":"2025-12-20T22:44:29.415308Z","close_reason":"Dynamic trauma guard script reads traumas.jsonl (global+repo) and denies matching Bash commands","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-kmym","depends_on_id":"cass_memory_system-653r","type":"discovered-from","created_at":"2026-01-21T09:28:51Z","created_by":"import"}]}
{"id":"cass_memory_system-koji","title":"[Testing:Fixtures] Test fixture files","description":"tests/fixtures/session.jsonl:\n{\"role\":\"user\",\"content\":\"Help me write a React hook\"}\n{\"role\":\"assistant\",\"content\":\"I'll create a useAuth hook...\"}\n\ntests/fixtures/playbook.yaml:\nschema_version: 2\nbullets:\n  - id: \"b-test-001\"\n    category: testing\n    content: \"Use React Testing Library\"\n    ...","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-07T21:49:48.141817Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-kozd","title":"onboard-state: normalize stored session paths (cwd/~ safe)","description":"Bug: src/onboard-state.ts stores raw sessionPath and compares via path.resolve(), which breaks if sessionPath is relative or uses ~ and later commands run from a different cwd. Normalize/expand to absolute (normalizePlatformPath) when storing and comparing, and add regression tests.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-16T09:48:31.011779Z","updated_at":"2025-12-16T09:55:53.368489Z","closed_at":"2025-12-16T09:55:53.368489Z","close_reason":"Normalize/expand onboarding session paths (absolute, ~ safe) so processed detection works across cwd; added regression tests.","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-kpn4","title":"Task: Replace hardcoded emoji with icon() calls","description":"# Task: Replace Hardcoded Emoji with icon() Calls\n\n## Context\n\nAfter adding the missing icons to the ICONS table, we need to replace all hardcoded emoji characters in command output with icon() calls.\n\n## Violations to Fix\n\n| File | Line | Current | Replacement |\n|------|------|---------|-------------|\n| mark.ts | 118 | `✓ Marked bullet` | `${icon(\"success\")} Marked bullet` |\n| forget.ts | 91 | `✓ Forgot bullet` | `${icon(\"success\")} Forgot bullet` |\n| forget.ts | 93 | (check for more) | |\n| outcome.ts | 138 | `✓ Recorded implicit` | `${icon(\"success\")} Recorded implicit` |\n| playbook.ts | 588 | `⊘ Skipped` | `${icon(\"skipped\")} Skipped` |\n| playbook.ts | 595 | `✗ Failed` | `${icon(\"failure\")} Failed` |\n| why.ts | 253 | `✓` | `${icon(\"success\")}` |\n\n## Search Commands for Audit\n\n```bash\n# Find hardcoded checkmarks\ngrep -rn '✓' src/commands/\n\n# Find hardcoded X marks\ngrep -rn '✗' src/commands/\n\n# Find hardcoded skipped symbols\ngrep -rn '⊘' src/commands/\n\n# Find any other Unicode symbols that might be emoji\ngrep -rn '[✓✗⊘❌⚠️✅]' src/commands/\n```\n\n## Replacement Pattern\n\n```typescript\n// Before\nimport chalk from \"chalk\";\nconsole.log(chalk.green(`✓ Operation completed`));\n\n// After\nimport chalk from \"chalk\";\nimport { icon } from \"../output.js\";\nconsole.log(chalk.green(`${icon(\"success\")} Operation completed`));\n```\n\n## Files to Modify\n\n- src/commands/mark.ts\n- src/commands/forget.ts\n- src/commands/outcome.ts\n- src/commands/playbook.ts\n- src/commands/why.ts\n- Any others found during audit\n\n## Acceptance Criteria\n\n- [ ] `grep -rn '✓' src/commands/` returns 0 results\n- [ ] `grep -rn '✗' src/commands/` returns 0 results\n- [ ] `grep -rn '⊘' src/commands/` returns 0 results\n- [ ] `CASS_MEMORY_NO_EMOJI=1 cm mark b-xxx --helpful` shows \"[OK]\" not \"✓\"\n- [ ] Visual output unchanged when emoji enabled\n\n## Dependencies\n\n- Depends on: \"Add missing icons to ICONS table\" task\n\n## Testing\n\n```bash\n# Test emoji mode (default)\ncm playbook list  # Should show emoji\n\n# Test no-emoji mode\nCASS_MEMORY_NO_EMOJI=1 cm playbook list  # Should show [OK]/[FAIL]/[SKIP]\n```\n\n## Notes\n\nThis is a systematic find-and-replace task. Each file needs the icon import added if not present.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T18:26:05.585490Z","updated_at":"2025-12-15T20:05:44.527546Z","closed_at":"2025-12-15T20:05:44.527546Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-kpn4","depends_on_id":"cass_memory_system-uazo","type":"blocks","created_at":"2026-01-21T09:28:51Z","created_by":"import"}]}
{"id":"cass_memory_system-krys","title":"[CLI] diary command - Generate session diary","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:51:37.942813Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-kv5k","title":"Add unit tests for commands/forget.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T05:17:25.882236Z","updated_at":"2025-12-16T05:24:33.475522Z","closed_at":"2025-12-16T05:24:33.475522Z","close_reason":"Added 5 unit tests for forget command: requires reason, forgets bullet with blocked log, invert creates anti-pattern, error on non-existent, JSON output format","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-kxi7","title":"Unit tests for utils.ts - Utility functions","description":"Complete unit test coverage for utils.ts:\n- getBulletsByCategory() filtering and sorting\n- findUnprocessedSessions() directory scanning\n- Date/time utilities\n- Path normalization\n- String utilities (truncation, sanitization)\n- Array utilities (deduplication, grouping)\nNO MOCKS - use real filesystem fixtures where needed","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-08T01:25:41.093958Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-kyzs","title":"[Config] Cascading configuration architecture","description":"Memory as Code - Configuration and playbooks merge from multiple levels:\n\n1. Global level: ~/.cass-memory/\n   - User preferences\n   - Personal rules\n   - API keys\n\n2. Repo level: .cass/\n   - Project-specific rules\n   - Team conventions\n   - Committed to git (shared!)\n\nMerge order: global → repo (repo wins on conflict)\nThis means cloning a repo gives you the team's memory instantly!\n\nImplementation requires:\n- Two-level configuration hierarchy\n- Conflict resolution strategy (repo wins)\n- Seamless merging of playbooks and config files\n- Git-friendly repo-level storage (.cass/ directory)","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:49:21.740485Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-l12","title":"[Reflector] formatCassHistory - Structure history for prompt","description":"function formatCassHistory(hits: CassHit[]): string\n\nFormat:\n```\nRELATED HISTORY FROM OTHER AGENTS:\n\nSession: ~/.cursor/projects/myapp/session-001.jsonl\nAgent: cursor\nSnippet: \"Fixed similar authentication issue by...\"\n---\nSession: ~/.codex/sessions/xyz.jsonl\nAgent: codex\nSnippet: \"Used waitFor to handle async...\"\n```\n\nSTRUCTURE:\n1. Header line\n2. For each hit:\n   - Session path (relative if possible)\n   - Agent name\n   - Relevant snippet (truncate to 200 chars)\n   - Separator (---)\n3. Limit to top 5 hits\n\nWHY THIS FORMAT:\n- Clear source attribution\n- Concise for prompt inclusion\n- Easy to scan for relevance\n\nTRUNCATION:\nIf snippet > 200 chars, truncate with \"...\"\n\nUsed in fetchCrossAgentHistory()","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:44:58.038308Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-l1ft","title":"Infra: Offline LLM Stub","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-08T01:23:02.916783Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-l1x5","title":"[UX][trust] Normalize config shape (llm.* vs top-level provider/model)","description":"Problem\n- Config currently supports both `provider`/`model` at top-level and an optional nested `llm.{provider,model}` (see `src/types.ts` and `src/llm.ts`).\n- This dual shape increases confusion and makes docs/examples brittle.\n\nWhat to do\n- Decide on the canonical config shape:\n  Option A: Keep top-level only (recommended for simplicity)\n  - Treat `llm.*` as deprecated alias; migrate at load time and warn once\n  Option B: Move to `llm.*` only\n  - Support top-level as deprecated alias\n- Update docs and defaults to match the chosen shape.\n\nNotes\n- Avoid “compat file clones”; do migration inside existing config handling.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-13T10:32:33.460669Z","updated_at":"2025-12-13T21:41:35.446992Z","closed_at":"2025-12-13T21:41:35.446992Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-l1x5","depends_on_id":"cass_memory_system-c10q","type":"parent-child","created_at":"2026-01-21T09:28:51Z","created_by":"import"}]}
{"id":"cass_memory_system-l2gd","title":"[Testing] Add pure unit tests: cass integration wrappers (cass.ts)","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-08T01:29:48.466892Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-l2ok","title":"[CLI:playbook] get - Get single bullet details","description":"Display detailed information for a single playbook bullet.\n\nCommand signature:\n```bash\ncass-memory playbook get <bullet-id> [--json]\n```\n\nImplementation:\n1. Load playbook\n2. Find bullet by ID\n3. Calculate effective score (with time decay)\n4. Format detailed output\n\nOutput format:\n```\nBULLET: b-abc123\n\nContent: Always run tests before committing\nCategory: best-practice\nMaturity: proven\nScope: global\n\nScores:\n  Raw score: 0.95\n  Effective score: 0.92 (with decay)\n  Positive feedback: 12\n  Negative feedback: 1\n\nHistory:\n  Created: 2024-11-15T10:30:00Z\n  Last updated: 2025-01-10T14:22:00Z\n  Age: 56 days\n\nSource sessions:\n  - ~/.claude/sessions/session-001.jsonl\n  - ~/.cursor/sessions/session-xyz.jsonl\n  - ~/.aider/sessions/2024-11-15-abc.jsonl\n\nTags: [testing, ci-cd, quality]\n\n{if deprecated:}\nStatus: DEPRECATED\nReason: {deprecationReason}\nDeprecated at: {deprecatedAt}\n```\n\nJSON output:\n- Include all fields from Bullet type\n- Add computed fields: effectiveScore, age\n- Full source session paths\n\nError handling:\n- If bullet ID not found: error message with suggestion\n- Suggest similar IDs (fuzzy match)\n\nThis command helps understand individual bullet provenance and health.","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:51:59.525040Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-l2w","title":"[Reflector] summarizeExistingBullets - Compact bullet representation","description":"function summarizeExistingBullets(bullets: PlaybookBullet[]): string\n\nFormat:\n```\nEXISTING PLAYBOOK BULLETS (summarized by category):\n\n### testing\n- [b-abc123] Use React Testing Library for components\n- [b-def456] Run tests before committing\n\n### git\n- [b-ghi789] Make atomic commits\n```\n\nPURPOSE:\n- Keeps prompt concise while providing context for helpful/harmful marks\n- Shows LLM what's already in playbook to avoid redundancy\n- Groups by category for better organization\n\nIMPLEMENTATION:\n1. Group bullets by category\n2. Sort categories alphabetically\n3. Format with markdown headers\n4. Include bulletId for reference\n5. Truncate content if needed (max 100 chars per bullet)\n\nUsed in buildReflectorPrompt()","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:44:53.704474Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-l5e","title":"[Decay] getLastFeedbackTimestamp - Most recent feedback date","description":"Get the timestamp of the most recent feedback event (helpful or harmful) for a bullet. Used in stats command, stale detection, and UI displays.\n\nCOMPLETE IMPLEMENTATION:\n```typescript\n/**\n * Get timestamp of most recent feedback event.\n * Returns null if bullet has no feedback history.\n */\nfunction getLastFeedbackTimestamp(bullet: PlaybookBullet): Date | null {\n  const allEvents = [...bullet.helpfulEvents, ...bullet.harmfulEvents];\n  \n  if (allEvents.length === 0) return null;\n\n  const timestamps = allEvents.map(e => new Date(e.timestamp).getTime());\n  return new Date(Math.max(...timestamps));\n}\n```\n\nUSAGE EXAMPLES:\n\n1. STATS COMMAND:\n```typescript\nbullets.forEach(bullet => {\n  const lastFeedback = getLastFeedbackTimestamp(bullet);\n  const daysSince = lastFeedback \n    ? Math.floor((Date.now() - lastFeedback.getTime()) / (1000*60*60*24))\n    : Infinity;\n  \n  console.log(`${bullet.title}: ${lastFeedback ? `${daysSince} days ago` : 'never'}`);\n});\n```\n\n2. STALE DETECTION:\n```typescript\nfunction isStale(bullet: PlaybookBullet, staleDays: number = 90): boolean {\n  const lastFeedback = getLastFeedbackTimestamp(bullet);\n  \n  if (\\!lastFeedback) {\n    return daysSince(bullet.createdAt) > staleDays;\n  }\n  \n  return daysSince(lastFeedback) > staleDays;\n}\n```\n\n3. SORTING BY ACTIVITY:\n```typescript\n// Sort bullets by most recently used\nconst sortedByActivity = bullets.sort((a, b) => {\n  const aTime = getLastFeedbackTimestamp(a)?.getTime() ?? 0;\n  const bTime = getLastFeedbackTimestamp(b)?.getTime() ?? 0;\n  return bTime - aTime;  // Most recent first\n});\n```\n\n4. JSON OUTPUT:\n```typescript\n{\n  id: 'rule-123',\n  title: 'Use semantic imports',\n  lastFeedback: getLastFeedbackTimestamp(bullet)?.toISOString() ?? null,\n  daysSinceLastFeedback: lastFeedback ? daysSince(lastFeedback) : null\n}\n```\n\nRETURN VALUES:\n\nnull:\n- No helpful events AND no harmful events\n- Bullet has never received feedback\n- May indicate unused or never-matched rule\n\nDate object:\n- Most recent timestamp from either helpful or harmful\n- Can be compared, formatted, or converted to ISO string\n- Use .getTime() for numeric comparison\n- Use .toISOString() for JSON serialization\n\nEDGE CASES:\n\n1. Only helpful events:\n   - Returns max(helpfulEvents.timestamp)\n\n2. Only harmful events:\n   - Returns max(harmfulEvents.timestamp)\n\n3. Both helpful and harmful:\n   - Returns max of all events\n   - Could be helpful or harmful - whichever is most recent\n\n4. Empty arrays:\n   - Returns null\n   - Caller should handle null case\n\nDEPENDENCIES:\n- PlaybookBullet.helpfulEvents: FeedbackEvent[]\n- PlaybookBullet.harmfulEvents: FeedbackEvent[]\n- FeedbackEvent.timestamp: string (ISO format)\n\nUSED BY:\n- isStale()\n- stats command\n- review command (future)\n- UI/dashboard displays (future)\n- Activity-based sorting\n- Playbook health analytics","status":"tombstone","priority":3,"issue_type":"task","created_at":"2025-12-07T21:46:37.384920Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-l5nt","title":"[CLI] stats command - Playbook health dashboard","description":"Implements the main entry point for the 'cass-memory stats' command - a comprehensive health dashboard for the playbook.\n\nCOMMAND SYNTAX:\n```bash\ncass-memory stats [options]\n\nOptions:\n  --json    Output in JSON format instead of pretty terminal UI\n```\n\nPURPOSE:\nProvides a single command to understand the overall health and composition of the playbook. Surfaces actionable insights like stale bullets, merge candidates, and at-risk rules.\n\nDISPLAYED METRICS:\n1. Total counts (global vs workspace)\n2. Maturity distribution (candidate/established/proven/deprecated)\n3. Type breakdown (rules vs anti-patterns)\n4. Score distribution buckets\n5. Top performers (highest effective scores)\n6. At-risk bullets (negative/declining scores)\n7. Stale bullets (no feedback in 90+ days)\n8. Merge candidates (high semantic similarity)\n\nIMPLEMENTATION REQUIREMENTS:\n1. Parse command-line options\n2. Load playbook from storage\n3. Compute full statistics (computeFullStats)\n4. Route to JSON output or terminal UI renderer\n5. Highlight actionable items\n\nOUTPUT MODES:\n1. Terminal UI (default):\n   - Pretty box drawing with colors\n   - Visual charts (bar graphs, sparklines)\n   - Highlighted warnings/issues\n   - Actionable recommendations\n\n2. JSON (--json):\n   - Complete stats object\n   - Machine-readable for scripting\n   - Include all metrics and lists\n\nACTIONABLE INSIGHTS:\n- \"5 bullets at risk - run 'cass-memory show <id>' to review\"\n- \"3 potential duplicates - consider 'cass-memory merge'\"\n- \"12 stale bullets - last feedback >90 days ago\"\n\nDEPENDENCIES:\n- Playbook loader\n- Stats computation (computeFullStats)\n- Terminal UI renderer (renderStatsUI)\n- JSON serialization\n\nSUCCESS CRITERIA:\n- Stats computed correctly across all dimensions\n- Terminal UI readable and informative\n- JSON output valid and complete\n- Actionable items clearly highlighted\n- Performance acceptable even for large playbooks (1000+ bullets)","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:53:16.549568Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-l6kv","title":"Unit tests for lock.ts - File locking mechanisms","description":"Complete unit test coverage for lock.ts:\n- Lock acquisition and release\n- Lock timeout handling\n- Stale lock detection\n- Lock file cleanup\n- Concurrent lock attempts\n- Edge cases: process crash recovery, orphaned locks\nNO MOCKS - use real temp directory with actual file locks","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-08T01:25:44.374398Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-laj4","title":"[ErrorHandling] handleMalformedLLMResponse - Parse failures","description":"Handle malformed or invalid LLM responses with retry and recovery.\n\nFunction signature:\nasync function handleMalformedLLMResponse(\n  response: unknown,\n  schema: z.ZodSchema,\n  prompt: string\n): Promise<unknown>\n\nImplementation:\n- Log the malformed response for debugging\n- Retry with modified prompt emphasizing JSON format requirements\n- Include example of expected output structure\n- Slightly increase temperature (may help with parsing)\n- Try to extract partial valid data if possible\n- Throw detailed error after max attempts with example of what was expected\n\nRecovery strategies:\n1. First retry: Add explicit JSON format instructions\n2. Second retry: Include example output\n3. Final retry: Simplify request\n4. Extract partial data or fail gracefully","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:51:24.594734Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-laui","title":"[Decay] Per-bullet half-life configuration","description":"$(cat /tmp/fix_laui.txt)","status":"tombstone","priority":3,"issue_type":"task","created_at":"2025-12-07T21:48:55.589990Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-ldbj","title":"Add ReDoS protection to sanitize.ts extra patterns","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-16T05:17:24.940233Z","updated_at":"2025-12-16T05:20:44.427431Z","closed_at":"2025-12-16T05:20:44.427431Z","close_reason":"Added isRegexPatternSafe helper and extended ReDoS protection to pre-compiled RegExp objects","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-lh88","title":"Harden outcome/context log loaders against partial JSONL writes","description":"recordOutcome() and appendContextLog() append under withLock, but loadOutcomes() / loadContextLog() read unlocked; mid-append reads can see a truncated trailing line and drop the newest record. Detect malformed trailing line (no final newline) and re-read once under the same lock.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-16T06:45:51.078955Z","updated_at":"2025-12-16T06:49:13.817817Z","closed_at":"2025-12-16T06:49:13.817817Z","close_reason":"loadOutcomes and loadContextLog detect malformed trailing JSONL line (no newline) and re-read once under withLock to avoid transiently dropping newest entries; added regression tests","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-lhd0","title":"[TRACKING] Test Coverage Gap Analysis - Dec 2025","description":"# Test Coverage Gap Analysis - December 2025\n\n## Summary\nThis tracking issue documents the comprehensive test gap analysis performed on 2025-12-21.\n\n## Current State\n- **109 test files** covering ~90% of core modules\n- **34,564 lines** of test code\n- **~3,461 test cases** across unit, integration, E2E\n- **Mockless architecture** (sdt1.2) mostly COMPLETE\n\n## Identified Gaps\n\n### 1. Core Modules WITHOUT Tests (3 files)\n| Module | Priority | Bead |\n|--------|----------|------|\n| progress.ts | P2 | cass_memory_system-i16d |\n| trauma.ts | P1 | cass_memory_system-6xl2 |\n| trauma_guard_script.ts | P2 | cass_memory_system-bnpt |\n\n### 2. Commands WITHOUT E2E Tests (4 commands)\n| Command | Priority | Bead |\n|---------|----------|------|\n| guard | P2 | cass_memory_system-rsgy |\n| trauma | P2 | cass_memory_system-6s8f |\n| quickstart | P2 | cass_memory_system-0pzz (existing) |\n| audit | P2 | cass_memory_system-jzwe (existing) |\n\n### 3. Commands WITH Unit Tests Only (need E2E)\n- forget.ts - Has unit test, no E2E\n- undo.ts - Has unit test, no E2E\n- usage.ts - Has tracking test, no CLI E2E\n\n## Existing Beads Already Tracking Gaps\n- sdt1.4: Coverage burn-down to 100%\n- sdt1.4.2: CLI commands coverage\n- sdt1.4.3: Core modules coverage (in_progress)\n- sdt1.4.4: Pipelines coverage\n- sdt1.4.5: starters/serve/reflect/validate (in_progress)\n- cax8: E2E Integration Test Suite\n- uj99: Complete Unit Test Coverage Without Mocks\n\n## Dependency Structure\n```\nsdt1 (P0 Epic: Comprehensive Test Coverage)\n├── sdt1.2 (P1 Mockless arch - MOSTLY CLOSED)\n├── sdt1.4 (P2 Coverage burn-down)\n│   ├── i16d (P2 progress.ts tests) NEW\n│   ├── 6xl2 (P1 trauma.ts tests) NEW\n│   ├── bnpt (P2 trauma_guard_script.ts tests) NEW\n│   ├── sdt1.4.2 (P1 CLI commands)\n│   ├── sdt1.4.3 (P2 core modules - in_progress)\n│   ├── sdt1.4.4 (P2 pipelines)\n│   └── sdt1.4.5 (P1 starters - in_progress)\n└── cax8 (P1 E2E Integration Suite)\n    ├── rsgy (P2 guard E2E tests) NEW\n    ├── 6s8f (P2 trauma E2E tests) NEW\n    └── (existing E2E beads...)\n```\n\n## Next Actions\n1. Complete P1 items: trauma.ts tests (6xl2)\n2. Complete in-progress: sdt1.4.3, sdt1.4.5\n3. Work through P2 items in dependency order\n\n## E2E Logging Quality\nThe existing E2E logging infrastructure (e2e-logger.ts) is EXCELLENT:\n- Step-by-step logging\n- State snapshots\n- Timer tracking\n- Repro command capture\n- JSONL artifact on failure\n\nNo new logging infrastructure needed.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-21T17:05:56.486526Z","updated_at":"2026-01-07T03:42:42.546981031Z","closed_at":"2026-01-07T03:42:42.546981031Z","close_reason":"Gap analysis complete - all identified gaps have been addressed: trauma.ts, progress.ts, trauma_guard_script.ts tests added, all CLI commands have E2E tests","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-lijb","title":"[UX][doctor] Upgrade doctor --json contract (overallStatus + remediation)","description":"Problem\n- `cm doctor --json` currently outputs only `{ checks: [...] }` with no overall status, no fix plan, and no stable remediation hints.\n- Automation (agents/CI) needs a reliable machine-readable summary.\n\nWhat to do\n- Define and implement a stable JSON schema, e.g.:\n  - `overallStatus`: healthy|degraded|unhealthy\n  - `checks`: [{category,item,status,message,details?}]\n  - `fixableIssues`: [{id,category,severity,safety,description,howToFix?}]\n  - `recommendedActions`: [{label,command,reason,urgency}]\n  - `selfTest` (optional, gated by flag)\n  - `version` + `generatedAt`\n\nNotes\n- Keep stdout JSON clean.\n- Errors should be structured (or stderr-only) and never intermix with JSON.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-13T10:15:58.243178Z","updated_at":"2025-12-13T22:33:31.256579Z","closed_at":"2025-12-13T22:33:31.256579Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-lijb","depends_on_id":"cass_memory_system-dq7w","type":"parent-child","created_at":"2026-01-21T09:28:51Z","created_by":"import"},{"issue_id":"cass_memory_system-lijb","depends_on_id":"cass_memory_system-jis4","type":"blocks","created_at":"2026-01-21T09:28:51Z","created_by":"import"},{"issue_id":"cass_memory_system-lijb","depends_on_id":"cass_memory_system-sj4a","type":"blocks","created_at":"2026-01-21T09:28:51Z","created_by":"import"}]}
{"id":"cass_memory_system-lk01","title":"[P1] Add progress indicators for long operations","description":"# Task: Add Progress Indicators\n\n## Problem\nLong operations show blank screen:\n- Semantic embedding computation (10-30s)\n- Large playbook operations\n- Batch reflect processing\n- Doctor with --self-test\n\nUsers think the CLI is frozen.\n\n## Solution\n\n### 1. Create Progress Utility\n```typescript\n// src/progress.ts\ninterface ProgressOptions {\n  total?: number;       // If known\n  message: string;      // \"Processing sessions...\"\n  showSpinner?: boolean;\n  showEta?: boolean;\n}\n\nconst progress = createProgress(options);\nprogress.update(current, message?);\nprogress.complete(\"Done!\");\nprogress.fail(\"Error occurred\");\n```\n\n### 2. JSON-Compatible Events\nFor --json mode, emit progress as events:\n```json\n{\"event\": \"progress\", \"current\": 5, \"total\": 10, \"message\": \"Processing...\"}\n{\"event\": \"progress\", \"current\": 10, \"total\": 10, \"message\": \"Complete\"}\n{\"event\": \"result\", \"success\": true, ...}\n```\n\n### 3. Commands to Update\n- context.ts: semantic search progress\n- reflect.ts: (already has some, enhance)\n- doctor.ts: self-test progress\n- onboard.ts: session processing progress\n- playbook.ts: import/export progress\n\n### 4. Spinner for Indeterminate\nWhen total unknown, show spinner:\n```\n⠋ Searching semantic index...\n⠙ Searching semantic index...\n✓ Found 12 relevant rules\n```\n\n## Files\n- src/progress.ts (new)\n- Update commands listed above\n\n## Acceptance\n- [ ] All operations >2s show progress\n- [ ] JSON mode gets progress events\n- [ ] Spinners for indeterminate operations\n- [ ] ETA where applicable","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-16T15:33:10.682913Z","updated_at":"2025-12-17T04:44:12.685266Z","closed_at":"2025-12-17T04:44:12.685266Z","close_reason":"Implemented delayed (>2s) progress indicators (spinner + ETA) via src/progress.ts; wired semantic embedding compute, cass search, reflect, doctor --self-test, onboard sampling/read, and playbook import/export to emit JSON progress events to stderr while keeping stdout as final printJsonResult envelope.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-lk01","depends_on_id":"cass_memory_system-oe0g","type":"blocks","created_at":"2026-01-21T09:28:51Z","created_by":"import"}]}
{"id":"cass_memory_system-lm91","title":"[P2] Fix flag naming inconsistencies","description":"# Task: Fix Flag Naming Inconsistencies\n\n## Problem\nSame semantic concept uses different names:\n- --top <n> in context = \"limit results\"\n- --top <n> in project = \"limit per category\"\n- --limit <n> = also \"limit results\"\n- Users confused about which to use\n\n## Solution\n\n### 1. Audit All Flags\nCreate mapping of current flags across commands.\n\n### 2. Establish Naming Convention\n```\n--limit <n>     = Max items to return (global concept)\n--per-category <n> = Limit per category (project-specific)\n--top <n>       = DEPRECATED alias for --limit\n\n--scope <s>     = Filter by scope (global/workspace/all)\n--category <c>  = Filter by category\n--maturity <m>  = Filter by maturity\n\n--format <f>    = Output format\n--json          = Shorthand for --format json\n```\n\n### 3. Deprecation Strategy\n- Keep old flags working with deprecation warning\n- Log: \"Warning: --top is deprecated, use --limit\"\n- Remove in next major version\n\n### 4. Update Documentation\n- Consistent flag names in all help text\n- Migration guide for deprecated flags\n\n## Files\n- src/cm.ts (flag definitions)\n- All src/commands/*.ts (update usages)\n- docs/ (update documentation)\n\n## Acceptance\n- [ ] All similar concepts use same flag name\n- [ ] Deprecated flags emit warnings\n- [ ] Help text is consistent\n- [ ] Migration path documented","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T15:33:55.966815Z","updated_at":"2025-12-20T23:15:48.529380Z","closed_at":"2025-12-20T23:15:48.529380Z","close_reason":"Standardized context/project flags: --limit and --per-category; deprecated --top with warnings; updated tests/docs","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-lmna","title":"[CLI] init command - Initialize cass-memory","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:51:30.383633Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-lmwr","title":"E2E test: 'cass reflect' command","description":"E2E test for 'cass reflect' CLI command:\n- Real subprocess execution via bun\n- Test reflection on session exports\n- Verify deltas are generated correctly\n- Verify playbook is updated with new patterns\n- Test --dry-run mode\n- Test --max-iterations option\n- Test error cases: no sessions, invalid session format\n- Detailed logging: sessions processed, deltas generated, playbook changes\nSetup: fixture directory with session exports and initial playbook\nNOTE: Requires test API key for real LLM calls","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-08T01:27:20.854775Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-lnl7","title":"Auto-Install Guards for Claude/Shell Environments","description":"Create a wrapper or 'cm init' step to automatically install generated guards.\n\nLogic:\n- Check for .claude/ directory. If present, install .claude/hooks/trauma_guard.py and update settings.json.\n- Check for .git/. If present, offer to install pre-commit hook or suggest shell alias.\n\nGoal: Make safety default and effortless.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T03:59:38.568221Z","updated_at":"2025-12-28T03:21:42.353863Z","closed_at":"2025-12-28T03:21:42.353863Z","close_reason":"Implemented auto-install guards for Claude hooks and git pre-commit. cm init now auto-installs guards when .claude or .git directories are present.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-lnl7","depends_on_id":"cass_memory_system-653r","type":"discovered-from","created_at":"2026-01-21T09:28:51Z","created_by":"import"}]}
{"id":"cass_memory_system-lul8","title":"Fix validateDelta tests to use real delta types","description":"validate.test.ts used non-existent delta types (remove/update) and a non-exported Bullet type. Switch to valid PlaybookDelta variants (helpful/replace) and NewBulletData for add tests.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-07T05:53:55.655668028Z","created_by":"ubuntu","updated_at":"2026-01-07T05:54:12.546891447Z","closed_at":"2026-01-07T05:54:12.546891447Z","close_reason":"Updated validateDelta tests to use valid PlaybookDelta variants and NewBulletData; bun test validate.test.ts passes.","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-lus7","title":"Tests: Add E2E tests for validate command","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-07T01:32:07.843768357Z","created_by":"ubuntu","updated_at":"2026-01-07T01:41:22.105256669Z","closed_at":"2026-01-07T01:41:22.105256669Z","close_reason":"Added 14 E2E tests for validate command - all tests passing","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-lyu","title":"[LLM] runValidator - Scientific validation","description":"Function signature:\nasync function runValidator<T extends z.ZodSchema>(\n  schema: T,\n  proposedRule: string,\n  evidence: string,\n  config: Config\n): Promise<z.infer<T>>\n\nImplementation:\n1. Build prompt from PROMPTS.validator template\n2. Substitute variables:\n   - proposedRule: the bullet text to validate\n   - evidence: historical session data from cass (last 90 days)\n3. Call generateObject with:\n   - schema: validation result schema\n   - temperature: 0.2 (low for consistency)\n4. Return validation result with:\n   - isValid: boolean\n   - reasoning: string (cite session paths)\n   - suggestedRefinement?: string (if wording could improve)\n\nUsed by: validate command (GPT Pro innovation).\n\nThis is the scientific method - test hypotheses against empirical data.","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:45:59.994922Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-m0sx","title":"Add E2E tests for undo command","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T00:32:41.457870273Z","created_by":"ubuntu","updated_at":"2026-01-07T00:36:48.006544974Z","closed_at":"2026-01-07T00:36:48.006544974Z","close_reason":"Added 15 E2E tests for undo command covering un-deprecate, undo-feedback, hard-delete, dry-run mode, and error cases. All tests pass.","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-m193","title":"Implement 'cm audit --trauma' for Forensics","description":"Implement 'cm audit --trauma' to scan 'cass' history for past catastrophes.\n\nOptimization: **High-Precision Filtering**\n- Naive apology scanning ('I am sorry') is too noisy.\n- **Requirement:** Must match (Apology Keyword) AND (Destructive Context/Verb).\n- Example: 'Sorry' + ('deleted', 'wiped', 'lost', 'overwrote', 'broken').\n\nLogic:\n1. Search cass for candidate sessions.\n2. Extract tool inputs around the apology.\n3. Compare against 'Simultaneous Launch Button' doom patterns.\n4. Present 'Candidate Traumas' for human confirmation.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-18T03:59:16.082097Z","updated_at":"2025-12-20T22:54:59.669131Z","closed_at":"2025-12-20T22:54:59.669131Z","close_reason":"Exposed audit --trauma flag; audit trauma mode now reachable + updated follow-up guidance","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-m193","depends_on_id":"cass_memory_system-653r","type":"discovered-from","created_at":"2026-01-21T09:28:51Z","created_by":"import"}]}
{"id":"cass_memory_system-m2jt","title":"[Semantic] loadOrComputeEmbeddings - Cache-aware embedding","description":"Load embeddings from cache or compute fresh if needed.\n\nImplementation:\n```typescript\nasync function loadOrComputeEmbeddings(\n  playbook: Playbook,\n  cache: EmbeddingCache\n): Promise<void>\n```\n\nProcess for each bullet:\n1. Compute content hash\n2. Check cache for bullet.id\n3. If cached AND hash matches:\n   - Use cached embedding\n   - Skip computation\n4. Otherwise:\n   - Compute fresh embedding\n   - Update cache entry\n5. Mutate bullet.embedding in place\n6. Save cache at end\n\nCache hit rate:\n- First run: 0% (cold cache)\n- Subsequent runs: ~95% (only changed bullets recomputed)\n- After content change: ~90% (only affected bullets)\n\nPerformance:\n- Cache hit: <1ms (array lookup)\n- Cache miss: ~3ms (embedding computation)\n- 100 bullets, 95% hit rate: ~65ms total\n\nError handling:\n- Missing cache file → create new\n- Corrupt cache → rebuild\n- Hash mismatch → recompute\n- Model mismatch → recompute all\n\nAtomic updates:\n- Write to temp file\n- Move to final location\n- Prevents corruption from crashes","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-07T21:49:33.888832Z","updated_at":"2025-12-13T09:31:43.554874Z","closed_at":"2025-12-13T09:31:43.554874Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-m3dp","title":"[P2] Add truncation indicator to context output","description":"# Bug: Missing Truncation Indicator\n\n## Problem\nIn context.ts, history snippets are truncated without indication:\n```typescript\nsnippet: truncate(h.snippet.trim().replace(/\\n/g, \" \"), 300)\n```\n\nUser sees truncated text but doesn't know content was cut off.\n\n## Fix\nAdd \"...\" or \"[truncated]\" indicator when truncation occurs:\n```typescript\nsnippet: truncateWithIndicator(h.snippet, 300)\n// Returns: \"The quick brown fox...\" instead of \"The quick brown fox\"\n```\n\n## Files\n- src/commands/context.ts\n- src/utils.ts (add truncateWithIndicator helper)\n\n## Acceptance\n- [ ] Truncated text shows indicator\n- [ ] Indicator doesn't count toward length limit\n- [ ] Works in both text and JSON output","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-16T15:34:28.494064Z","updated_at":"2025-12-17T02:48:37.397771Z","closed_at":"2025-12-17T02:48:37.397771Z","close_reason":"Added truncateWithIndicator helper and switched context history snippets to use it so truncation is explicit without consuming the slice budget; added unit tests; typecheck passes.","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-m4al","title":"Respect --top 0 in playbook/project exports","description":"exportToMarkdown/exportToAgentsMd/exportToClaudeMd currently use truthy checks (options.topN ? slice : all), so --top 0 incorrectly means unlimited instead of zero. Make topN handling explicit (0 => no bullets) and add regression tests.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-16T09:14:06.396682Z","updated_at":"2025-12-16T09:15:54.077825Z","closed_at":"2025-12-16T09:15:54.077825Z","close_reason":"Completed: explicit topN handling (0 means zero) + regression tests","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-m55","title":"[Generator] scorePlaybookBullets - Relevance scoring","description":"Score and rank playbook bullets by relevance to task.\n\nSIGNATURE:\nfunction scorePlaybookBullets(bullets: PlaybookBullet[], keywords: string[], config: Config): ScoredBullet[]\n\nPURPOSE:\nCalculate relevance scores for playbook bullets to surface the most useful rules for the current task. Combines keyword matching with temporal decay from feedback events.\n\nSCORING ALGORITHM:\nFor each active bullet:\n1. Calculate keyword relevance: scoreBulletRelevance(bullet, keywords)\n   - Count keyword matches in content/category/tags\n   - Weight by keyword importance (exact match > partial > stem)\n   - Range: 0.0 to 1.0\n\n2. Calculate effective score: getEffectiveScore(bullet, config)\n   - Base score from helpful/unhelpful events\n   - Apply temporal decay (recent feedback weighted higher)\n   - Range: -5.0 to +5.0\n\n3. Combine scores: final = relevance * max(0.1, effectiveScore)\n   - relevance gates the effective score\n   - Minimum 0.1 multiplier prevents total zero-out\n   - This ensures keyword match is required for high ranking\n\n4. Sort by final score descending\n\n5. Return top config.maxBulletsInContext (default 10)\n\nFILTERING:\n- Only include bullets with status: 'active'\n- Exclude bullets marked as deprecated\n- Exclude anti-patterns (handled separately)\n\nOUTPUT:\nArray<{\n  ...bullet,\n  relevanceScore: number,\n  effectiveScore: number,\n  finalScore: number\n}>\n\nEDGE CASES:\n- No keywords: Use base effective score only\n- New bullets (no feedback): Default effective score 0.5\n- Negative effective score: Can happen if unhelpful > helpful","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:44:54.916840Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-m6cp","title":"Implement cm context --limit and --min-score flags (README parity)","description":"README documents \"cm context --limit\" and \"--min-score\", but CLI currently errors on these flags (only supports --top/--history). Implement --limit as alias for --top and add --min-score filtering (likely on effectiveScore/finalScore). Add/adjust tests to cover CLI + programmatic usage.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-16T08:07:29.230579Z","updated_at":"2025-12-16T08:13:42.100386Z","closed_at":"2025-12-16T08:13:42.100386Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-m7np","title":"EPIC: Comprehensive Test Coverage - Unit, Integration, E2E","description":"# EPIC: Comprehensive Test Coverage\n\n## Current State (As of Dec 2025)\n- **Coverage**: ~37% (10 test files, 1,147 LOC tests vs 7,199 LOC source)\n- **Unit Tests**: Partial coverage on 6/28 source files\n- **Integration Tests**: NONE\n- **E2E Tests**: NONE\n- **Mock Usage**: Minimal (only console.warn in retry tests)\n\n## Philosophy: Real Tests, No Fakes\nThis epic prioritizes REAL behavior testing:\n- Unit tests use actual function implementations\n- Integration tests use real file I/O with temp directories\n- E2E tests run actual CLI commands with fixture data\n- Mocks ONLY for external services (LLM APIs) with clear boundaries\n\n## Structure\n1. **Sub-Epic: Unit Tests** - Pure function testing without mocks\n2. **Sub-Epic: Integration Tests** - Multi-module testing with real files\n3. **Sub-Epic: E2E Test Suite** - Complete workflow testing with logging\n\n## Success Criteria\n- [ ] 95%+ line coverage on all source files\n- [ ] Every exported function has explicit test cases\n- [ ] Integration tests cover all file I/O paths\n- [ ] E2E tests cover all CLI commands\n- [ ] Detailed logging in E2E tests for debugging\n- [ ] CI/CD integration with coverage reporting","status":"tombstone","priority":1,"issue_type":"epic","created_at":"2025-12-08T01:22:32.238036Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"epic","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-m8y4","title":"Fix onboard sample E2E test (cass stub not returning sessions)","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-28T04:35:28.845595Z","updated_at":"2025-12-28T04:51:30.564009Z","closed_at":"2025-12-28T04:51:30.564009Z","close_reason":"All tests passing now (2029 pass, 0 fail)","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-maz6","title":"Fix pre-parse JSON detection + harden findUnprocessedSessions","description":"Fix a couple edge cases:\n- hasJsonFlag should not mis-detect option values (e.g. --width 80) as command tokens; context --format markdown should override --json.\n- findUnprocessedSessions should treat invalid/negative days/maxSessions as defaults and normalize agent filter (trim/lowercase) for robustness.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-17T17:19:47.578182Z","updated_at":"2025-12-17T17:24:09.603685Z","closed_at":"2025-12-17T17:24:09.603685Z","close_reason":"Fixed hasJsonFlag command detection when global option values are present; hardened findUnprocessedSessions against invalid negative maxSessions and normalized agent filter; added unit tests; typecheck passes.","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-mcs8","title":"[CLI:playbook] export/import - Playbook portability","description":"Export and import playbook for portability and sharing.\n\nCommand signatures:\n```bash\ncass-memory playbook export [--yaml|--json] > playbook.yaml\ncass-memory playbook import <file>\n```\n\nEXPORT implementation:\n1. Load current playbook\n2. Serialize to requested format:\n   - Default: YAML (more human-readable)\n   - --json: JSON format\n3. Output to stdout (user redirects to file)\n\nExport format considerations:\n- Include all bullets (even deprecated if using --all)\n- Strip source session paths (not portable)\n- Preserve IDs for reimport\n- Include metadata: version, exported_at\n\nIMPORT implementation:\n1. Parse input file (detect YAML vs JSON)\n2. Validate schema\n3. Merge strategy:\n   - If bullet ID exists: skip (don't overwrite)\n   - If new: add to playbook\n   - Optional --replace flag to overwrite existing\n4. Display import summary:\n   ```\n   Imported playbook from playbook.yaml\n   - 5 bullets added\n   - 2 bullets skipped (already exist)\n   - 0 bullets updated\n   ```\n\nUse cases:\n- Share playbook between team members\n- Backup playbook\n- Migrate between systems\n- Import external best practices\n\nExample workflow:\n```bash\n# Export on machine A\ncass-memory playbook export > my-playbook.yaml\n\n# Import on machine B\ncass-memory playbook import my-playbook.yaml\n\n# Import with overwrite\ncass-memory playbook import --replace my-playbook.yaml\n```\n\nValidation:\n- Check file exists\n- Validate YAML/JSON syntax\n- Validate bullet schema\n- Warn on version mismatches","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:52:38.414909Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-md5c","title":"[Unit] security.ts - Complete Sanitization Coverage","description":"## Target: src/security.ts - Complete Sanitization Coverage\n\n### Functions to Test:\n1. **sanitizePath(path)** - Path traversal prevention\n   - Clean path unchanged: '/home/user/file.txt'\n   - Traversal blocked: '../../../etc/passwd' → error or sanitized\n   - Double encoding: '%2e%2e%2f' handling\n   - Null bytes: 'file\\x00.txt' stripped\n   - Unicode normalization attacks\n   - Windows paths: 'C:\\..\\' on cross-platform\n   - Symlink considerations (document behavior)\n\n2. **sanitizeInput(input)** - General input sanitization\n   - XSS vectors: '<script>alert(1)</script>'\n   - SQL injection patterns (if applicable)\n   - Command injection: '; rm -rf /'\n   - Template injection: '{{constructor.constructor}}'\n   - Length limits\n   - Encoding preservation for valid Unicode\n\n3. **validateBulletId(id)** - ID format validation\n   - Valid format: 'project-xxxx' pattern\n   - Invalid characters rejected\n   - Length constraints\n   - Case sensitivity rules\n\n4. **escapeForShell(arg)** - Shell argument escaping\n   - Spaces: 'hello world' → quoted\n   - Special chars: '$HOME' → escaped\n   - Quotes within strings\n   - Empty string handling\n   - Newlines and control chars\n\n5. **escapeForRegex(str)** - Regex metachar escaping\n   - All metacharacters: . * + ? ^ $ { } [ ] \\ | ( )\n   - Safe strings unchanged\n   - Empty string handling\n\n### Security Test Patterns:\n- OWASP test vectors\n- Fuzzing-style boundary inputs\n- Known CVE patterns (where applicable)\n- Verify NO false negatives (security must not fail open)\n- Test error messages don't leak sensitive info","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-08T01:24:34.725358Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-mehs","title":"[Tracking] LLM cost tracking","description":"Purpose: Track LLM usage and estimated costs for budget awareness\n\nFile path: ~/.cass-memory/cost/usage-{YYYY-MM}.json\nExample: ~/.cass-memory/cost/usage-2025-12.json\n\nType definitions:\n```typescript\ninterface CostEntry {\n  timestamp: string;           // ISO 8601\n  operation: 'diary' | 'reflect' | 'validate' | 'context';\n  provider: string;            // 'anthropic', 'openai', etc.\n  model: string;               // 'claude-opus-4', 'gpt-4', etc.\n  inputTokens: number;\n  outputTokens: number;\n  estimatedCost: number;       // USD\n}\n\ninterface MonthlyCost {\n  entries: CostEntry[];\n  totals: {\n    inputTokens: number;\n    outputTokens: number;\n    estimatedCost: number;\n  };\n}\n```\n\nOperations:\n- diary: Diary entry generation\n- reflect: Reflection analysis\n- validate: Delta validation\n- context: Context building/filtering\n\nImplementation:\n- One file per month (rotate monthly)\n- Append entries as operations complete\n- Recalculate totals on save\n- Use current pricing from config","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:51:10.870267Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-mey","title":"[Diary] saveDiaryEntry - Persist to disk","description":"$(cat /tmp/fix_mey.txt)","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:45:56.156512Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-mikz","title":"Integration test: Curator pipeline (curate + validate)","description":"Integration test for Curator pipeline:\n- curatePlaybook() -> validatePlaybook() full flow\n- Real playbook fixtures with various bullet states\n- Verify anti-pattern inversion persists through validation\n- Verify maturity transitions are validated correctly\n- Verify pruning decisions are reflected in output\n- Detailed logging: input state, transform deltas, output state\nNO MOCKS - real curate.ts + validate.ts interaction","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-08T01:26:20.995694Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-mjhj","title":"[Testing] tests/ directory structure","description":"tests/\n├── setup.ts              # Global test setup\n├── unit/\n│   ├── utils.test.ts\n│   ├── playbook.test.ts\n│   ├── validators.test.ts\n│   ├── decay.test.ts\n│   └── curator.test.ts\n├── integration/\n│   ├── cass.test.ts\n│   ├── playbook-persistence.test.ts\n│   └── config.test.ts\n├── llm/\n│   ├── diary-extraction.test.ts\n│   ├── reflector.test.ts\n│   └── validator.test.ts\n├── e2e/\n│   └── commands.test.sh\n├── property/\n│   └── deduplication.test.ts\n└── fixtures/\n    ├── session.jsonl\n    ├── playbook.yaml\n    └── config.json","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-07T21:49:25.292418Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-mkvs","title":"[CLI:doctor] checkLLMProviders - Verify API keys","description":"Implements the checkLLMProviders function that verifies API key configuration for LLM providers.\n\nFUNCTION SIGNATURE:\n```typescript\nasync function checkLLMProviders(): Promise<HealthCheck[]>\n```\n\nCHECKS PERFORMED:\n\n1. OPENAI:\n   - Check if OPENAI_API_KEY env var is set\n   - Validate key format (starts with sk-)\n   - Optionally: test with simple API call\n   - Status: FAIL if missing/invalid, PASS if valid\n   - Required for core functionality\n\n2. ANTHROPIC:\n   - Check if ANTHROPIC_API_KEY env var is set\n   - Validate key format (starts with sk-ant-)\n   - Status: WARN if missing (optional feature)\n   - Used for advanced extraction/reasoning\n\n3. OTHER PROVIDERS:\n   - Check for other configured providers (Cohere, HuggingFace, etc.)\n   - Report presence\n   - Status: PASS (info only)\n\n4. RATE LIMIT STATUS:\n   - If API access available, check rate limit headers\n   - Warn if approaching limits\n   - Status: WARN if near limit\n\nIMPLEMENTATION DETAILS:\n\nOpenAI Check:\n- Check process.env.OPENAI_API_KEY\n- Validate format: /^sk-[A-Za-z0-9]{32,}$/\n- Optional: Test with lightweight API call (models list)\n- Report: \"OpenAI configured (key: sk-...wxyz)\"\n\nAnthropic Check:\n- Check process.env.ANTHROPIC_API_KEY\n- Validate format: /^sk-ant-[A-Za-z0-9_-]{32,}$/\n- Mark as optional if missing\n- Report: \"Anthropic not configured (optional)\"\n\nSECURITY:\n- Never log full API keys\n- Only show first 3 and last 4 characters (sk-...wxyz)\n- Sanitize error messages\n- Don't include keys in JSON output\n\nERROR HANDLING:\n- Missing key → WARN or FAIL depending on provider\n- Invalid format → WARN with guidance\n- API test failures → WARN (network issue vs auth issue)\n- Timeout on API tests (5s max)\n\nVALIDATION LEVELS:\n1. Basic: Check env var exists (fast)\n2. Format: Validate key structure (fast)\n3. Live: Test API call (slow, optional)\n\nUse basic+format by default, live only with --full flag\n\nDEPENDENCIES:\n- Environment variable access\n- Regex for format validation\n- Optional: OpenAI/Anthropic SDK for live tests\n- Secret sanitization utilities\n\nSUCCESS CRITERIA:\n- Detects missing/invalid keys reliably\n- Clear guidance on which keys are required vs optional\n- Security: never leaks full keys\n- Performance: <1 second without live tests\n- Actionable error messages","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:55:45.322015Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-mmxv","title":"Sub-Epic: Unit Test Coverage (No Mocks)","description":"# Sub-Epic: Unit Test Coverage (No Mocks)\n\n## Philosophy\nTest pure functions with real implementations. No mocking of internal modules.\nMocks are ONLY acceptable for:\n- console.log/warn/error (to verify logging behavior)\n- Date.now() (for deterministic timestamp testing)\n- External APIs (LLM providers) - but prefer fixture responses\n\n## Phases (Ordered by Dependency)\n\n### Phase 1: Foundation (Types & Utilities)\n- types.ts: isBulletInScope, filterBulletsByScope, schema validation\n- utils.ts: Pure functions (hashContent, jaccardSimilarity, extractKeywords, etc.)\n- security.ts: Complete sanitize() and compileExtraPatterns()\n\n### Phase 2: Scoring System\n- scoring.ts: getEffectiveScore, getDecayedCounts, checkForPromotion, checkForDemotion\n- Decay algorithm verification with various time spans\n\n### Phase 3: Playbook Operations\n- playbook.ts: CRUD operations (find, add, deprecate, pin, unpin)\n- Merge operations, duplicate detection\n- Export to markdown\n\n### Phase 4: Curation Pipeline\n- curate.ts: Full curatePlaybook testing\n- Delta application (add, helpful, harmful, replace, deprecate)\n- Anti-pattern inversion logic\n- Duplicate detection and merging\n\n### Phase 5: Validation System\n- validate.ts: evidenceCountGate, validateDelta\n- Verdict normalization\n- Evidence classification\n\n### Phase 6: Diary & Reflection\n- diary.ts: loadDiaryEntry, loadAllDiaries, migrateOldDiary\n- reflect.ts: formatBulletsForPrompt, shouldExitEarly, deduplication\n\n## Test File Naming Convention\n- test/{module}.test.ts - Unit tests for src/{module}.ts\n- test/{module}.{feature}.test.ts - Specific feature tests\n\n## Coverage Target: 95%+ per module","status":"tombstone","priority":1,"issue_type":"epic","created_at":"2025-12-08T01:22:55.719561Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"epic","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-mnqm","title":"[UX] Semantic Search UX","description":"Why this matters\n- Semantic search is a premium feature, but the first-time experience can feel “broken” if the model needs to download, the network is offline, or caches are missing.\n- The CLI should make semantic status obvious, show progress when downloading, and fall back gracefully with clear enablement instructions.\n\nScope\n- Progress and messaging around embedding model load/download.\n- Clear fallbacks (semantic → keyword) with actionable enablement steps.\n- Integrate semantic readiness checks into `cm doctor`.","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-12-13T10:13:46.972086Z","updated_at":"2025-12-14T00:23:35.987162Z","closed_at":"2025-12-14T00:23:35.987162Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-mnqm","depends_on_id":"cass_memory_system-q6uv","type":"parent-child","created_at":"2026-01-21T09:28:51Z","created_by":"import"}]}
{"id":"cass_memory_system-mszn","title":"[ErrorHandling] LLM_RETRY_CONFIG - Retry policy constants","description":"Define retry policy configuration for LLM API calls.\n\nConfiguration object:\nconst LLM_RETRY_CONFIG = {\n  maxRetries: 3,\n  baseDelayMs: 1000,\n  maxDelayMs: 30000,\n  retryableErrors: [\n    'rate_limit_exceeded',\n    'server_error',\n    'timeout',\n    'overloaded',\n    'ETIMEDOUT',\n    'ECONNRESET'\n  ]\n};\n\nUsage:\n- Used by all LLM API calls for consistent retry behavior\n- Exponential backoff: baseDelay * 2^attempt\n- Cap delays at maxDelayMs to prevent excessive waits\n- Only retry on transient errors (not auth failures or invalid requests)\n\nThis ensures resilient LLM operations with predictable retry behavior.","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:50:48.573972Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-mtg8","title":"E2E tests: serve command","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T03:35:48.887507587Z","created_by":"ubuntu","updated_at":"2026-01-07T04:17:39.562949280Z","closed_at":"2026-01-07T04:17:39.562949280Z","close_reason":"E2E serve tests present; added env isolation to avoid token leakage and verified passing","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-mtg8","depends_on_id":"cass_memory_system-sdt1.4","type":"discovered-from","created_at":"2026-01-21T09:28:51Z","created_by":"import"}]}
{"id":"cass_memory_system-muvr","title":"[Docs] Update Command Reference with Audience Tags","description":"# Update Command Reference with Audience Tags\n\n## Purpose\nEvery command in the documentation should be tagged with its intended audience so readers know at a glance what applies to them.\n\n## Audience Tags\n- **[Agent-Essential]** - Agents should know and use these\n- **[Agent-Occasional]** - Agents might use, but not routine\n- **[Operator]** - For human setup and monitoring\n- **[Automated]** - Run by hooks, not directly\n\n## Commands to Tag\n\n| Command | Audience | Notes |\n|---------|----------|-------|\n| cm context | Agent-Essential | Primary command |\n| cm mark | Agent-Essential | Feedback |\n| cm doctor | Agent-Occasional | Health check |\n| cm stats | Agent-Occasional | Overview |\n| cm init | Operator | One-time setup |\n| cm playbook | Operator | Rule management |\n| cm reflect | Automated | Post-session |\n| cm audit | Automated | CI/CD |\n| cm project | Operator | Export |\n| cm serve | Operator | MCP server |\n\n## Implementation\n1. Add audience tag to each command section header\n2. Group commands by audience in quick reference\n3. Add note explaining the tagging system\n\n## Deliverables\n- [ ] All command sections tagged\n- [ ] Quick reference grouped by audience\n- [ ] Explanation of audience system","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-08T17:48:21.792654Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-mw0i","title":"[MCP:Future] memory_context tool definition","description":"Define memory_context tool for MCP:\n\n```typescript\n{\n  name: \"memory_context\",\n  description: \"Get relevant context for a task from playbook and cass\",\n  inputSchema: {\n    type: \"object\",\n    properties: {\n      task: { type: \"string\", description: \"Task description\" },\n      maxBullets: { type: \"number\", default: 50 },\n      workspace: { type: \"string\" }\n    },\n    required: [\"task\"]\n  }\n}\n```\n\nThis tool provides agents with relevant context from the memory system for a given task.","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:49:29.334688Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-mxgy","title":"[ErrorHandling] recoverCorruptPlaybook - Backup and recreate","description":"Implement recovery mechanism for corrupt or malformed playbook files.\n\nFunction signature:\nasync function recoverCorruptPlaybook(\n  playbookPath: string,\n  error: Error\n): Promise<Playbook>\n\nImplementation:\n- Backup corrupt file to {path}.backup.{timestamp} (never lose user data)\n- Log what happened (corruption type, backup location)\n- Create fresh empty playbook with correct structure\n- Return new playbook object\n- Provide clear instructions to user about recovery\n\nError scenarios:\n- Invalid JSON syntax\n- Missing required fields\n- Type mismatches\n- File truncation\n\nAlways prioritize data safety - backup before any destructive operation.","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:50:47.565366Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-myc","title":"[Security] sanitize - Apply all secret patterns to text","description":"Implement the core sanitize() function that applies all secret patterns to text.\n\nFunction signature:\n```typescript\nfunction sanitize(\n  text: string,\n  config: { enabled: boolean; extraPatterns?: RegExp[] }\n): string\n```\n\nImplementation requirements:\n1. If !config.enabled, return text unchanged\n2. Apply each SECRET_PATTERN in order (iterate through array)\n3. Then apply any extraPatterns (user-configured patterns)\n4. Return fully sanitized text\n\nCRITICAL: This function is the SINGLE POINT of sanitization for the entire system.\nAll secret redaction flows through this function.\n\nUsage example:\n```typescript\nconst raw = 'export AWS_ACCESS_KEY=AKIAIOSFODNN7EXAMPLE';\nconst clean = sanitize(raw, { enabled: true });\n// clean = 'export AWS_ACCESS_KEY=[AWS_ACCESS_KEY]'\n```\n\nPriority: 0 (Security Critical - P12)","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:44:48.303514Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-mz34","title":"[Test] Unit: config.ts - Configuration loading and merging","description":"# Unit Tests for config.ts\n\n## Functions to Test\n\n### loadConfig(options?)\nTest Cases:\n- No config file → returns defaults\n- Global config only → loads from ~/.cass-memory/config.yaml\n- Repo config only → loads from .cass/config.yaml\n- Both configs → merges (repo overrides global)\n- CLI options override both\n- Expands ~ in paths\n- Validates against ConfigSchema\n\n### mergeConfig(base, override)\nTest Cases:\n- Empty override → returns base\n- Nested override → deep merge\n- Array override → replaces (not appends)\n- null values don't override\n\n### validateConfig(config)\nTest Cases:\n- Valid config passes\n- Missing required fields → error\n- Invalid provider → error\n- Invalid paths → error\n\n### getDefaultConfig()\nTest Cases:\n- Returns complete config\n- All required fields present\n- Sensible defaults (90-day decay, etc.)\n\n### expandPath(path)\nTest Cases:\n- Expands ~ to home directory\n- Handles ~user format\n- Absolute paths unchanged\n- Relative paths resolved\n\n## Edge Cases\n- Config file with extra fields → ignored (forward compat)\n- Config file with invalid YAML → helpful error\n- Missing home directory → fallback behavior\n- Read-only file system → appropriate error\n\n## Test Setup\n\\`\\`\\`typescript\nimport { withTempDir } from \"./helpers/temp\";\n\ndescribe(\"config\", () => {\n  it(\"loads and merges global and repo configs\", async () => {\n    await withTempDir(\"config-merge\", async (dir) => {\n      // Create global config\n      const globalDir = path.join(dir, \".cass-memory\");\n      await fs.mkdir(globalDir, { recursive: true });\n      await fs.writeFile(\n        path.join(globalDir, \"config.yaml\"),\n        yaml.stringify({ provider: \"openai\" })\n      );\n      \n      // Create repo config\n      const repoDir = path.join(dir, \"project\", \".cass\");\n      await fs.mkdir(repoDir, { recursive: true });\n      await fs.writeFile(\n        path.join(repoDir, \"config.yaml\"),\n        yaml.stringify({ model: \"gpt-4\" })\n      );\n      \n      const config = await loadConfig({\n        home: dir,\n        cwd: path.join(dir, \"project\")\n      });\n      \n      expect(config.provider).toBe(\"openai\");\n      expect(config.model).toBe(\"gpt-4\");\n    });\n  });\n});\n\\`\\`\\`","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-08T01:23:40.917307Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-mz5q","title":"[Unit] Commands - diary.ts, toxic.ts, timeline.ts","description":"## Target: src/commands/*.ts - CLI Commands (Part 4)\n\n### diary.ts Tests:\n\n1. **diaryCommand(options)** - Diary CLI\n   - Lists diary entries\n   - Shows specific entry\n   - --since date filter\n   - --format option (md, json)\n   - --json output\n\n2. **Entry display**\n   - Frontmatter shown/hidden\n   - Content formatted\n   - Metadata included\n\n### toxic.ts Tests:\n\n1. **toxicCommand(action, pattern, options)** - Toxic patterns\n   - 'add' adds pattern to toxic.log\n   - 'remove' removes pattern\n   - 'list' shows all patterns\n   - 'check' tests content\n   - --json output\n\n2. **Pattern matching**\n   - Regex patterns work\n   - Literal patterns work\n   - Case sensitivity option\n\n### timeline.ts Tests:\n\n1. **timelineCommand(options)** - Timeline CLI\n   - Builds timeline from diary\n   - --since and --until filters\n   - --output file parameter\n   - --format (md, json, html)\n   - --json output\n\n2. **Timeline formatting**\n   - Chronological order\n   - Grouping by day/week\n   - Links to sources\n\n### Test Fixtures:\n- Sample diary entries\n- Sample toxic patterns\n- Date range test data","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-08T01:29:21.111136Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-n0mc","title":"[P0] Add unit tests for why.ts command","description":"# Task: Unit tests for why.ts command (328 lines)\n\n## Why Critical\nwhy.ts shows bullet provenance/evidence - key for user trust and debugging. Users need to understand WHY a rule exists. Untested means:\n- Evidence extraction bugs show wrong data\n- Display formatting issues confuse users\n- Missing evidence silently fails\n\n## What to Test\n\n### Bullet Lookup\n- [ ] Find bullet by exact ID\n- [ ] Find bullet by partial ID match\n- [ ] Handle non-existent bullet gracefully\n- [ ] Handle ambiguous partial match\n\n### Evidence Display\n- [ ] Shows source sessions correctly\n- [ ] Shows feedback history (helpful/harmful)\n- [ ] Shows creation/update timestamps\n- [ ] Shows maturity progression\n\n### Output Formats\n- [ ] Text output is readable\n- [ ] JSON output has correct structure\n- [ ] Markdown format works (if supported)\n\n### Edge Cases\n- [ ] Bullet with no evidence\n- [ ] Bullet with extensive evidence (truncation)\n- [ ] Deprecated bullet handling\n- [ ] Anti-pattern bullet display\n\n## Implementation Notes\n- Create test playbook with bullets having known evidence\n- Test both global and repo playbooks\n- Verify output contains expected content\n- ~15-20 test cases expected\n\n## Files\n- Source: src/commands/why.ts (328 lines)\n- Test: test/why.test.ts (new)\n\n## Acceptance\n- [ ] All display paths covered\n- [ ] Edge cases handled\n- [ ] Both output formats tested\n- [ ] No mocks used","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-16T15:30:17.200027Z","updated_at":"2025-12-16T16:31:45.889198Z","closed_at":"2025-12-16T16:31:45.889198Z","close_reason":"Added 19 unit tests covering: bullet lookup (exact/not found), WhyResult building (metadata, reasoning, evidence, feedback), source sessions (limits, verbose), edge cases (no evidence, deprecated, anti-pattern, special chars), text output formatting, and diary integration","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-n6s7","title":"[Design] Outcome Tracking in Agent-First Workflow","description":"# Outcome Tracking in Agent-First Workflow\n\n## Background\nThe system has \\`cm outcome\\` to record session outcomes (success/failure/partial). This valuable signal helps:\n- Correlate which rules lead to successful sessions\n- Identify rules that might be harmful (used in failed sessions)\n- Improve scoring over time\n\n## The Gap\nIn our agent-first model, how does outcome tracking happen?\n\nCurrent options (all have friction):\n1. Agent explicitly calls \\`cm outcome success\\` → agent must remember\n2. Human marks outcomes → defeats agent-first\n3. Parse session for success indicators → complex heuristics\n\n## Design Options\n\n### Option A: Implicit Outcome Signals\nInfer success from agent behavior:\n- Session ends with commit → likely success\n- Session ends with \"done\" or similar → likely success\n- Session ends with error/frustration → likely failure\n- Parse from session log during reflection\n\n### Option B: Trivial Agent Command\nMake it so easy agents do it naturally:\n\\`\\`\\`bash\ncm done        # alias for cm outcome success\ncm failed      # alias for cm outcome failure\ncm partial     # alias for cm outcome partial\n\\`\\`\\`\nAdd to quickstart/blurb so agents know to call it.\n\n### Option C: Hook-Based\nPost-session hook that:\n1. Checks for commit in session → success\n2. Checks for test pass → success\n3. Checks for error patterns → failure\n4. Defaults to partial if unclear\n\n### Option D: MCP Integration\n\\`cm_outcome\\` tool already exists. When running as MCP server, agents can call it naturally as part of their tool-calling flow.\n\n## Recommendation\nCombine approaches:\n1. Add simple aliases (cm done/failed) for explicit signaling\n2. Document in quickstart: \"END: cm done (or session auto-processed)\"\n3. Implement implicit inference in reflection as enhancement\n\n## Depends On\n- [Design] Low-Friction Feedback Mechanism (similar design considerations)\n\n## Deliverables\n- [ ] Design decision on primary approach\n- [ ] Implementation plan\n- [ ] Integration with reflection pipeline","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-08T18:08:11.664562Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-nd9","title":"[Playbook] createEmptyPlaybook - Initialize new playbook structure","description":"## Function Signature\n```typescript\nfunction createEmptyPlaybook(): Playbook\n```\n\n## Purpose\nInitialize a new empty playbook structure with default values. Called when no playbook exists or when recovering from corruption.\n\n## Returns\n```typescript\n{\n  schema_version: 2,\n  name: \"playbook\",\n  description: \"Auto-generated by cass-memory\",\n  metadata: {\n    createdAt: now(),\n    totalReflections: 0,\n    totalSessionsProcessed: 0\n  },\n  deprecatedPatterns: [],\n  bullets: []\n}\n```\n\n## Implementation Requirements\n- Set schema_version to 2 (current version)\n- Use ISO 8601 timestamp for createdAt\n- Initialize empty arrays for deprecatedPatterns and bullets\n- Set counters to 0\n\n## Usage Scenarios\n1. First-time setup when playbook.yaml doesn't exist\n2. Recovery from corrupted playbook file\n3. Manual reset of playbook data\n4. Testing and development initialization\n\n## Dependencies\n- None (pure function)\n\n## Related Functions\n- loadPlaybook() - calls this when file doesn't exist\n- savePlaybook() - saves the created structure","notes":"Existing playbook helper implementations already present; no code changes made. Released reservation; feel free to take over.","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:44:44.868015Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-nf0v","title":"[Critical] V1 Minimal Command Set - Only 5 Commands","description":"# V1 Minimal Command Set - Only 5 Commands\n\n## The Problem\nCurrent plan has 15+ commands. This is overwhelming for new users.\n\n## The Solution\nV1 ships with only 5 commands:\n\n### V1 Commands:\n1. **context** - Get relevant context for a task\n2. **mark** - Record helpful/harmful feedback\n3. **playbook** - List/add/remove rules\n4. **status** - Health check (doctor + stats combined)\n5. **reflect** - Extract rules from sessions (optional)\n\n### Command Details:\n```bash\n# 1. CONTEXT - The main command\ncm context \"fix the auth timeout bug\"\n\n# 2. MARK - Record feedback\ncm mark rule-123 helpful\ncm mark rule-456 harmful --reason \"caused test failure\"\n\n# 3. PLAYBOOK - Manage rules\ncm playbook             # List all rules\ncm playbook add \"Always check token expiry first\" --category auth\ncm playbook remove rule-123\n\n# 4. STATUS - Health check\ncm status               # Quick health + stats\ncm status --full        # Detailed diagnostics\n\n# 5. REFLECT - Extract rules (advanced)\ncm reflect              # Process recent sessions\ncm reflect --dry-run    # Preview without applying\n```\n\n### Help Text:\n```bash\n$ cm --help\n\ncm v1.0.0 - Cross-Agent Memory System (cass-memory)\n\nCOMMANDS:\n  context <task>    Get relevant rules and history for a task\n  mark <rule> <fb>  Record helpful/harmful feedback for a rule\n  playbook          List, add, or remove playbook rules\n  status            Check system health and statistics\n  reflect           Extract rules from recent sessions\n\nEXAMPLES:\n  cm context \"fix the auth bug\"\n  cm mark rule-123 helpful\n  cm playbook add \"Always validate JWT\" --category auth\n```\n\n## Why This Is Critical\n- Less is more for v1\n- Users can learn 5 commands\n- Users cannot learn 15 commands","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T22:16:46.288840Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-nfgu","title":"[Testing:Unit] decay.test.ts - Confidence decay algorithm tests","description":"Test cases:\n- getDecayedScore: empty events = 0, recent > old, halfLife math\n- getEffectiveScore: harmful multiplier, maturity bonus\n- checkForPromotion: candidate → established → proven thresholds\n- checkForDemotion: negative score triggers demotion\n- isStale: no feedback detection","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-07T21:49:28.489944Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-ngd","title":"[Security] Pattern breadth testing in doctor command","description":"Implement pattern breadth testing in the doctor command to detect over-aggressive patterns.\n\nTest purpose:\n- Detect patterns that are too broad (match benign text)\n- Warn about patterns with excessive false positives\n- Suggest more specific alternatives\n\nImplementation in doctor command:\n```typescript\nfunction testPatternBreadth(patterns: typeof SECRET_PATTERNS) {\n  const benignSamples = [\n    \"The tokenizer splits text into tokens\",\n    \"Bearer of bad news\",\n    \"This is a password-protected file\",\n    \"The API key concept is important\"\n  ];\n\n  for (const { pattern, replacement } of patterns) {\n    for (const sample of benignSamples) {\n      if (pattern.test(sample)) {\n        console.warn(`[doctor] Pattern too broad: ${pattern}`);\n        console.warn(`  Matches benign text: \"${sample}\"`);\n        console.warn(`  Consider more specific pattern`);\n      }\n    }\n  }\n}\n```\n\nExample warnings:\n```\nWarning: Pattern too broad: /token.*/gi\n  Matches benign text: \"The tokenizer splits text\"\n  Consider more specific pattern like /token[\"\\s:=]+/\n```\n\nTests to perform:\n1. Test each SECRET_PATTERN against benign samples\n2. Test user extraPatterns\n3. Suggest improvements for overly broad patterns\n4. Calculate false positive rate estimate\n\nAdd to doctor command output:\n- \"Sanitization Pattern Health\"\n- List any overly broad patterns\n- Suggest fixes\n\nPriority: 0 (Security Critical - P12)","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:44:54.287971Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-nmp8","title":"[Semantic] Local embedding architecture with @xenova/transformers","description":"Uses @xenova/transformers for LOCAL embeddings (no network required):\n- Model: Xenova/all-MiniLM-L6-v2 (~23MB)\n- Runs locally on CPU\n- ~3ms per embedding on modern laptop\n- Relevance improvement: 60% → 90%\n\nWhy local:\n- No network latency\n- No API costs\n- Works offline\n- Privacy (content never leaves machine)\n\nArchitecture components:\n1. Model loading: Lazy singleton pattern\n2. Embedding generation: Feature extraction pipeline\n3. Vector storage: 384-dimensional float arrays\n4. Similarity calculation: Cosine distance\n5. Caching: Hash-based invalidation\n6. Integration: Hybrid keyword + semantic scoring\n\nDependencies:\n- @xenova/transformers (primary)\n- Model cache: ~/.cache/huggingface/\n- Embedding cache: ~/.cass-memory/embeddings/bullets.json","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-07T21:49:27.179503Z","updated_at":"2025-12-13T09:31:43.552507Z","closed_at":"2025-12-13T09:31:43.552507Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-nn33","title":"Secure audit command and fix sanitization leak","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-08T03:10:38.763701Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-np4","title":"[Types] PlaybookBullet Schema Part 2 - Content, Type, and Kind","description":"## Overview\nDefine content, classification, and semantic categorization fields for PlaybookBullet. These fields determine WHAT the rule says and HOW it should be presented.\n\n## Content Fields\n\n### category: string\n- Purpose: High-level grouping for organization\n- Type: String (not strict enum - allows flexibility)\n- Common values: 'testing', 'git', 'debugging', 'api-design', 'security', 'performance', 'documentation'\n- Usage: Grouping in playbook display, filtering in search\n- Example: 'testing' for all test-related rules\n\n### content: string\n- Purpose: The actual rule text shown to agents\n- Length: 10-500 characters (enforced by validation)\n- Format: Clear, imperative statement\n- Examples: 'Use vitest for unit tests, not jest' / 'Validate JWT tokens before trusting claims' / 'Run pnpm test before committing'\n- Style: Action-oriented, specific, actionable\n\n### searchPointer: string | undefined\n- Purpose: Gemini-style pattern for retrieving detailed examples\n- Format: cass query pattern (e.g., 'auth* AND token validation')\n- Usage: When rule needs deep context, agent can run 'cass search <searchPointer>'\n- Example: 'JWT validation patterns' -> searches cass for relevant examples\n- Benefit: Keep bullets concise while providing depth on demand\n\n## Type Classification (Binary)\n\n### type: 'rule' | 'anti-pattern'\n- rule: Prescriptive guidance (do this)\n- anti-pattern: Proscriptive warning (don't do this)\n\n### isNegative: boolean\n- Purpose: Computed shorthand for type === 'anti-pattern'\n- Usage: Quick filtering and display logic\n- Derivation: Automatically set based on type field\n\nDisplay Impact:\n- Rules: Shown in main playbook sections\n- Anti-patterns: Shown in separate 'PITFALLS' section\n\n## Semantic Kind (4 Categories)\n\n### kind: 'project_convention' | 'stack_pattern' | 'workflow_rule' | 'anti_pattern'\n\n#### project_convention\n- Definition: Repository-specific conventions\n- Portability: LOW - unique to this codebase\n- Scope: Usually workspace-scoped\n- Examples: 'Use AuthService from @/lib/auth for authentication' / 'Store config in config/app.yaml, not .env' / 'Use JobQueue class for background tasks'\n- Characteristics: References specific files/modules/patterns in THIS project\n\n#### stack_pattern\n- Definition: Reusable patterns for languages/frameworks\n- Portability: HIGH - transferable across projects\n- Scope: Usually language or framework-scoped\n- Examples: 'For React hooks, test effects with renderHook from @testing-library/react-hooks' / 'In TypeScript, use const assertions for literal arrays' / 'For Next.js, prefer server components over client components'\n- Characteristics: Generic best practices for the tech stack\n\n#### workflow_rule\n- Definition: Process and methodology rules\n- Portability: MEDIUM - often org-specific\n- Scope: Usually global or workspace\n- Examples: 'Run pnpm test before committing' / 'Write commit messages in conventional commits format' / 'Update changelog in CHANGELOG.md for user-facing changes'\n- Characteristics: About HOW to work, not WHAT to code\n\n#### anti_pattern\n- Definition: Pitfalls and mistakes to avoid\n- Portability: VARIABLE\n- Scope: Any scope\n- Examples: 'Don't mock Router hooks directly - use mockRouter utility' / 'Avoid useState for derived values - use useMemo' / 'Don't commit .env files with secrets'\n- Characteristics: Negative guidance, often learned from past mistakes\n- Display: Shown in PITFALLS section, not main playbook\n\n## Kind vs Type vs Scope\n\nField | Purpose | Values | Controls\nscope | WHERE it applies | global/workspace/language/framework/task | Filtering by context\ntype | DO or DON'T | rule/anti-pattern | Display section\nkind | WHY it exists | project_convention/stack_pattern/workflow_rule/anti_pattern | Portability/semantics\n\n## Examples\n\nProject Convention Rule: { category: 'authentication', content: 'Use TokenValidator from @/lib/auth for all JWT validation', searchPointer: 'TokenValidator usage examples', type: 'rule', isNegative: false, kind: 'project_convention' }\n\nStack Pattern Rule: { category: 'testing', content: 'For React hooks, use renderHook from @testing-library/react', type: 'rule', isNegative: false, kind: 'stack_pattern' }\n\nWorkflow Rule: { category: 'git', content: 'Run full test suite before pushing to main', type: 'rule', isNegative: false, kind: 'workflow_rule' }\n\nAnti-Pattern: { category: 'testing', content: 'Don't mock useRouter - use mockRouter from test/utils', type: 'anti-pattern', isNegative: true, kind: 'anti_pattern' }\n\n## Acceptance Criteria\n- category field as flexible string\n- content field with 10-500 char validation\n- searchPointer optional field\n- type enum with 2 values\n- isNegative computed boolean\n- kind enum with 4 values\n- Examples for all kind types\n- JSDoc explaining kind semantics\n- Content length validation in schema","notes":"Completed: Added JSDoc for BulletTypeEnum and BulletKindEnum with portability guidance and examples. Added content length validation (10-500 chars). Added superRefine validation for type/isNegative consistency and kind/type consistency.","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:44:58.784179Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-nq6a","title":"Bug: Repo config must not enable crossAgent or remoteCass","description":"## Problem\nRepo-level config (`.cass/config.json|yaml`) is merged into runtime config (`loadConfig()`), but `crossAgent` (privacy) and `remoteCass` (SSH remote history) are **user-level consent/network settings**. Allowing a repo to set these can cause:\n- surprise network calls (SSH) when running `cm context`\n- privacy bypass (repo can set `crossAgent.enabled=true` and `consentGiven=true`)\n- confusing UX: `cm privacy status` reads **global** config only, so repo-driven behavior is invisible there\n\n## Goal\nTreat `crossAgent` and `remoteCass` as **sensitive user settings** that repo config cannot override.\n\n## Proposed fix\nIn `src/config.ts loadConfig()`, after loading repo config, delete `repoConfig.crossAgent` and `repoConfig.remoteCass` (similar to the existing path protections).\n\n## Docs\nUpdate README security note to explicitly list these keys as non-overridable by repo config.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-16T00:28:25.896796Z","updated_at":"2025-12-16T00:42:59.858062Z","closed_at":"2025-12-16T00:42:59.858062Z","close_reason":"Implemented in commit 4300912: loadConfig() now deletes crossAgent and remoteCass from repo config, README security note updated","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-nqfw","title":"[ErrorHandling] checkDiskSpace - Verify adequate storage","description":"Verify adequate disk space before large write operations.\n\nFunction signature:\nasync function checkDiskSpace(path: string): Promise<{\n  available: number;\n  warning: boolean;\n  critical: boolean;\n}>\n\nImplementation:\n- Use platform-specific commands (df on Unix, wmic on Windows)\n- Parse available space in bytes\n- Warning threshold: <100MB available\n- Critical threshold: <10MB available\n- Log warnings to user before proceeding\n- Throw error if critical\n\nCalled before:\n- Session ingestion\n- Playbook backups\n- Large log writes\n\nPrevents disk full errors during critical operations.","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:51:25.727592Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-nt85","title":"Fix flaky lock contention test","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-16T05:17:23.212728Z","updated_at":"2025-12-16T05:19:26.223556Z","closed_at":"2025-12-16T05:19:26.223556Z","close_reason":"Fixed by increasing retries, reducing delays, and adding interval-based serialization verification","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-nu1s","title":"[CLI:init] initRepoLevel - Create .cass/ in current repo","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:51:33.599046Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-nvuz","title":"[Testing:Unit] utils.test.ts - Utility function tests","description":"Test cases:\n- hashContent: consistent, normalized, 16 chars\n- jaccardSimilarity: symmetric, [0,1] range, identical=1\n- generateBulletId: unique, format match\n- expandPath: ~ expansion, absolute unchanged\n- extractKeywords: stop word removal, limit 10\n- scoreBulletRelevance: keyword and tag matching","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-07T21:49:26.466792Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-nwd","title":"[Curator] handleAddDelta - Process new bullet additions","description":"Process AddDelta to add new bullets to the playbook with comprehensive validation.\n\nSignature:\nfunction handleAddDelta(\n  playbook: Playbook,\n  delta: AddDelta,\n  existingHashes: Set<string>,\n  config: CuratorConfig\n): { applied: boolean; reason: string }\n\nValidation pipeline:\n1. Hash new content using SHA-256\n2. Check exact duplicate (hash in existingHashes)\n   - If found: skip, return 'duplicate'\n3. Check semantic duplicate (jaccardSimilarity >= dedupThreshold)\n   - If found: boost existing bullet's helpfulCount instead of adding\n   - Return 'similar-boosted'\n4. Check toxic log (isToxic)\n   - If toxic: reject permanently, return 'toxic'\n5. Detect semantic conflicts (detectConflicts)\n   - If conflicts: log warnings but still allow add\n   - Add conflict reports to result\n6. If all checks pass:\n   - Create bullet with state: 'active', maturity: 'candidate'\n   - Set createdAt, updatedAt\n   - Initialize helpfulCount: 0, harmfulCount: 0\n   - Add hash to existingHashes\n   - Return applied: true\n\nKEY PRINCIPLE: New bullets ALWAYS start as candidates. They must earn promotion through helpful feedback.\n\nThis prevents low-quality rules from polluting the playbook immediately.","status":"tombstone","priority":3,"issue_type":"task","created_at":"2025-12-07T21:44:56.828452Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-nx8k","title":"[MCP:Future] memory_reflect tool definition","description":"Define memory_reflect tool for MCP:\n\n```typescript\n{\n  name: \"memory_reflect\",\n  description: \"Trigger reflection on recent sessions\",\n  inputSchema: {\n    type: \"object\",\n    properties: {\n      days: { type: \"number\", default: 7 },\n      maxSessions: { type: \"number\", default: 20 },\n      dryRun: { type: \"boolean\", default: false }\n    }\n  }\n}\n```\n\nAllows agents to trigger the reflection process to extract insights from recent sessions.","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:49:32.439291Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-nxms","title":"Integration test: Full ACE pipeline (Generator -> Reflector -> Curator -> Validator)","description":"Full ACE (Adaptive Cognitive Evolution) pipeline integration test:\n- Session export -> Diary -> Reflection -> Curation -> Validation\n- Complete data flow through all four stages\n- Real fixtures representing realistic agent sessions\n- Verify end-to-end transformation correctness\n- Verify playbook evolution after processing\n- Detailed logging at each stage boundary with timing\n- Test with: minimal session, large session, multi-agent session\nNO MOCKS - full pipeline with real LLM calls (test API key)","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-08T01:26:27.471438Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-o037","title":"[Build] Bun binary compilation for distribution","description":"Set up Bun binary compilation for cross-platform distribution.\n\nAdd to package.json scripts:\n{\n  \"scripts\": {\n    \"build\": \"bun build src/cass-memory.ts --compile --outfile dist/cass-memory\",\n    \"build:linux\": \"bun build src/cass-memory.ts --compile --target=bun-linux-x64 --outfile dist/cass-memory-linux-x64\",\n    \"build:macos-arm\": \"bun build src/cass-memory.ts --compile --target=bun-darwin-arm64 --outfile dist/cass-memory-darwin-arm64\",\n    \"build:macos-x64\": \"bun build src/cass-memory.ts --compile --target=bun-darwin-x64 --outfile dist/cass-memory-darwin-x64\",\n    \"build:windows\": \"bun build src/cass-memory.ts --compile --target=bun-windows-x64 --outfile dist/cass-memory-windows-x64.exe\",\n    \"build:all\": \"npm run build:linux && npm run build:macos-arm && npm run build:macos-x64 && npm run build:windows\"\n  }\n}\n\nProduces standalone executables with Bun runtime bundled - no external dependencies required.\n\nTest each binary on target platform before release","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-07T21:49:42.447370Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-o1g2","title":"[Unit] types.ts - Schema Validation & Scope Utilities","description":"## Target: src/types.ts - Schema Validation & Scope Utilities\n\n### Zod Schemas to Test:\n1. **PlaybookBulletSchema** - Core bullet validation\n   - Valid complete bullet passes\n   - Missing required fields fail\n   - Invalid field types fail\n   - feedbackEvents array validation\n   - Optional fields (pinned, tags, scope)\n   - Default values applied correctly\n\n2. **FeedbackEventSchema** - Event validation\n   - type: 'helpful' | 'harmful' required\n   - timestamp validation (ISO string)\n   - Optional context field\n   - Invalid type rejected\n\n3. **PlaybookSchema** - Full playbook validation\n   - Valid playbook with bullets\n   - Empty bullets array valid\n   - Nested bullet validation\n   - Metadata fields\n\n4. **ConfigSchema** - Configuration validation\n   - All required paths present\n   - Optional fields with defaults\n   - Path expansion handling\n   - Invalid paths rejected\n\n5. **CassSearchOptionsSchema** - Search options\n   - All optional fields\n   - Type constraints (number ranges)\n   - Default values\n\n### Scope Utilities to Test:\n1. **scopeMatches(bulletScope, queryScope)** - Scope matching\n   - Exact match: 'project:foo' matches 'project:foo'\n   - Wildcard: 'project:*' matches 'project:foo'\n   - Global scope matches all\n   - Hierarchy: 'project:foo/bar' vs 'project:foo'\n   - Case sensitivity rules\n   - Invalid scope format handling\n\n2. **parseScope(scopeString)** - Parse scope strings\n   - Valid formats: 'global', 'project:name', 'file:path'\n   - Invalid format handling\n   - Empty string handling\n\n3. **normalizeScope(scope)** - Normalize scope representation\n   - Consistent formatting\n   - Path normalization within scope\n\n### Test Patterns:\n- Use Zod's safeParse for validation testing\n- Test both .parse() (throws) and .safeParse() (returns result)\n- Cover all discriminated union branches\n- Test refinements and transforms","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-08T01:24:31.008972Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-o3kq","title":"[P2] Migrate makeCassStub tests to CassRunner DI","description":"Goal\n- Reduce/avoid process-level fake executables (`makeCassStub`) in tests by using in-process dependency injection via `CassRunner` (added in `src/cass.ts`).\n\nCurrent usage\n- `test/helpers/temp.ts` `makeCassStub()` is used by:\n  - `test/validate.test.ts`\n  - `test/privacy.test.ts`\n  - `test/cli-context.e2e.test.ts`\n  - `test/cli-reflect.e2e.test.ts`\n  - `test/new-user-onboarding.e2e.test.ts`\n\nPlan\n- For non-CLI tests (validate/privacy): refactor to pass a deterministic `CassRunner` into the code under test instead of writing a shell script and pointing `config.cassPath`.\n- For CLI E2E tests: keep stubs only where we truly spawn the CLI process; otherwise prefer calling command handlers directly with injected dependencies.\n\nDone means\n- `test/validate.test.ts` and `test/privacy.test.ts` no longer require `makeCassStub()`.\n- Remaining `makeCassStub()` usage is limited to true process-level E2E tests (if any).","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T01:43:10.291197Z","updated_at":"2025-12-17T22:27:35.013384Z","closed_at":"2025-12-17T22:27:35.013384Z","close_reason":"Migrated validate/privacy/audit unit tests off makeCassStub by adding optional CassRunner injection (validate evidence gate + privacy/audit commands) and using in-process runner stubs; remaining makeCassStub usage is E2E-only; bun run typecheck passes.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-o3kq","depends_on_id":"cass_memory_system-sdt1.2.1","type":"discovered-from","created_at":"2026-01-21T09:28:51Z","created_by":"import"}]}
{"id":"cass_memory_system-o44i","title":"[Critical] Decision Logging - Why Rules Were Accepted/Rejected","description":"$(cat /tmp/fix_o44i.txt)","status":"tombstone","priority":1,"issue_type":"feature","created_at":"2025-12-07T22:08:20.522057Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"feature","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-o450","title":"[CLI:mark] markOutputResult - Confirm feedback recorded","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:51:45.671595Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-o9mu","title":"[Unit Tests] llm.ts - llmWithFallback and provider selection","description":"## Unit Tests: llm.ts - LLM Provider Integration Tests\n\n### Test Categories\n\n#### 1. getApiKey()\n- Returns key from environment variable\n- Throws for missing key\n- Throws for unknown provider\n- Checks correct env var per provider\n\n#### 2. getAvailableProviders()\n- Returns providers with valid API keys\n- Empty array when no keys set\n- Caches result within session\n\n#### 3. getModel()\n- Returns correct model instance per provider\n- Uses config model name\n- Falls back to provider default model\n\n#### 4. llmWithFallback() - Core Logic\n- Tries primary provider first\n- Falls back through FALLBACK_ORDER\n- Skips unavailable providers\n- Collects all errors on total failure\n\n#### 5. llmWithFallback() - Success Paths\n- Returns on first provider success\n- Stops trying after success\n- Parses response with provided schema\n- Returns typed object matching schema\n\n#### 6. llmWithFallback() - Failure Paths\n- Throws when all providers fail\n- Error message includes all failures\n- Logs each failure with provider name\n- Final log says 'No more providers'\n\n#### 7. Provider Configuration\n- FALLBACK_ORDER is [anthropic, openai, google]\n- FALLBACK_MODELS has correct model per provider\n- Primary provider from config.llm.provider\n- Primary model from config.llm.model\n\n#### 8. generateContext() - Structured Output\n- Returns ContextOutput schema\n- Includes bullets array\n- Includes context_brief\n- Includes search_queries (optional)\n\n### Test Approach\n- Test getApiKey with env manipulation\n- Test getAvailableProviders with mocked env\n- Test llmWithFallback logic without real LLM calls\n- Integration tests (separate) for real provider calls\n\n### Note\n- Unit tests focus on logic, not actual LLM calls\n- Integration tests in E2E suite test real providers","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-08T01:24:14.315107Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-obb","title":"[Reflector] fetchCrossAgentHistory - Get related sessions from other agents","description":"async function fetchCrossAgentHistory(\n  diary: DiaryEntry,\n  config: Config\n): Promise<string>\n\nSteps:\n1. Extract keywords from diary (accomplishments, challenges, keyLearnings)\n2. Query cass with keywords\n3. Exclude current session's agent to get cross-agent results\n4. Format top 5 hits as context\n5. Return formatted string\n\nTHIS IS THE CROSS-AGENT ENRICHMENT - learning from what other agents did\n\nEXAMPLE:\nCurrent agent: cursor\nQuery: \"authentication token refresh\"\nResults:\n- codex session: \"Fixed token expiry with refresh logic\"\n- windsurf session: \"Implemented JWT rotation pattern\"\n\nPURPOSE:\n- Share learnings across agents\n- Avoid reinventing solutions\n- Build collective memory\n\nQUERY CONSTRUCTION:\nCombine: accomplishments + challenges + keyLearnings\nLimit: 100 tokens\nFilter: agent != currentAgent\n\nDEPENDENCIES:\n- cass.query()\n- formatCassHistory()\n\nUsed in buildReflectorPrompt()","status":"tombstone","priority":3,"issue_type":"task","created_at":"2025-12-07T21:44:56.863357Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-oe0g","title":"[P0] Unify output format handling (--json vs --format)","description":"# Task: Unify Output Format Handling\n\n## Problem\nCommands use conflicting output format flags:\n- context: --json AND --format <markdown|json>\n- project: --format <agents.md|claude.md|raw> (no --json)\n- doctor: --json only\n- What takes precedence? Unclear!\n\n## Solution\n\n### 1. Establish Clear Precedence\n```\nPriority (highest first):\n1. --format <explicit_format>  // Most specific wins\n2. --json                      // Legacy shorthand for format=json\n3. Command default            // Usually \"text\" or \"markdown\"\n```\n\n### 2. Standardize Format Options\n```typescript\ntype OutputFormat = \n  | \"json\"        // Machine-readable\n  | \"text\"        // Human-readable plain text\n  | \"markdown\"    // Human-readable markdown\n  | \"table\"       // Tabular data\n  | \"raw\";        // Unformatted\n\n// Per-command can add custom formats:\n// project: \"agents.md\" | \"claude.md\" | ...\n```\n\n### 3. Centralize Format Resolution\n```typescript\n// In src/output.ts\nfunction resolveOutputFormat(flags: { json?: boolean; format?: string }, defaultFormat: OutputFormat): OutputFormat {\n  if (flags.format) return flags.format as OutputFormat;\n  if (flags.json) return \"json\";\n  return defaultFormat;\n}\n```\n\n### 4. Update All Commands\n- Remove duplicate format handling\n- Use centralized resolveOutputFormat\n- Document supported formats per command\n\n## Files to Update\n- src/output.ts (add resolveOutputFormat)\n- src/commands/context.ts\n- src/commands/project.ts\n- src/commands/doctor.ts\n- All other commands with format options\n\n## Acceptance\n- [ ] Single source of truth for format resolution\n- [ ] All commands use consistent pattern\n- [ ] --json and --format don't conflict\n- [ ] Help text documents format options","notes":"Implemented centralized `resolveOutputFormat()` in `src/output.ts` with precedence `--format` > `--json` > default.\n\nChanges:\n- Fixed global error-mode detection (`hasJsonFlag`) to respect `--format` overriding `--json` (and treat `--format json` as JSON mode).\n- Updated `context` output selection to use `resolveOutputFormat` directly.\n- Updated `project` to support `-j/--json` as alias for `--format json`, removed commander default for `--format`, and ensured JSON-mode errors/success responses are machine-parseable.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-16T15:33:08.717723Z","updated_at":"2025-12-16T15:47:50.230945Z","closed_at":"2025-12-16T15:47:50.230945Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-oea","title":"[Cass] cassStats - Get cass index statistics","description":"Implement cassStats() to get cass index statistics and metrics.\n\n## Signature\n```typescript\ninterface CassStats {\n  totalConversations: number;\n  totalMessages: number;\n  agentBreakdown: Record<string, number>;\n  oldestSession: string;\n  newestSession: string;\n}\n\nasync function cassStats(\n  cassPath = \"cass\"\n): Promise<CassStats | null>\n```\n\n## CLI Command\n`cass stats --json`\n\n## Implementation\n- Use execFile() to run stats command\n- Parse JSON output\n- Return structured stats object\n- Return null on error\n\n## Error Handling\n- Return null if index not available\n- Return null if parse error\n- Log errors at debug level\n\n## Output Structure\n```json\n{\n  \"totalConversations\": 150,\n  \"totalMessages\": 4500,\n  \"agentBreakdown\": {\n    \"claude-code\": 100,\n    \"claude-sonnet\": 30,\n    \"claude-opus\": 20\n  },\n  \"oldestSession\": \"2024-01-01T10:00:00Z\",\n  \"newestSession\": \"2024-01-15T16:30:00Z\"\n}\n```\n\n## Usage\nUsed in:\n- doctor command (system health checks)\n- stats display (user queries about usage)\n- Analytics and reporting\n\n```typescript\nconst stats = await cassStats();\nif (stats) {\n  console.log(`Total sessions: ${stats.totalConversations}`);\n  console.log(`Total messages: ${stats.totalMessages}`);\n  console.log(\"Agent breakdown:\");\n  for (const [agent, count] of Object.entries(stats.agentBreakdown)) {\n    console.log(`  ${agent}: ${count}`);\n  }\n}\n```","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:45:01.761600Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-of39","title":"E2E: Concurrency Stress Test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-08T01:23:11.937589Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-olu","title":"[Foundation] Create src/ directory structure with module organization","description":"Create the src/ directory structure with all core module files for the CASS Memory System.\n\n## Context\nThe src/ directory contains all TypeScript source code for the CASS Memory System. The structure must be organized by functional domain with clear separation of concerns for maintainability and testability.\n\n## Technical Specification\n\n### Directory Structure:\nsrc/\n├── cass-memory.ts          # Main CLI entry point, argument parsing, command routing\n├── types.ts                # Shared TypeScript types and Zod schemas\n├── utils.ts                # Shared utility functions (file I/O, path resolution, etc.)\n├── cass.ts                 # Core CASS orchestration logic\n├── llm.ts                  # LLM client factory and provider configuration\n├── playbook.ts             # Playbook loading, merging, and rule management\n├── diary.ts                # Diary entry creation and retrieval\n├── reflect.ts              # Reflection processing and memory extraction\n├── validate.ts             # Validation logic for configs and playbooks\n├── curate.ts               # Curation workflow (evidence gathering, LLM decisions)\n├── sanitize.ts             # Secret detection and sanitization\n└── commands/               # Command implementations\n    ├── init.ts             # Initialize CASS in repo/globally\n    ├── wrap.ts             # Wrap command execution with session tracking\n    ├── doctor.ts           # System health checks\n    ├── status.ts           # Show configuration status\n    ├── reflect.ts          # Manual reflection trigger\n    ├── diary.ts            # Diary entry commands\n    ├── playbook.ts         # Playbook management commands\n    ├── forget.ts           # Mark bullets as toxic\n    └── stats.ts            # Usage statistics\n\n### File Responsibilities:\n\n#### cass-memory.ts (Entry Point):\n- Parse CLI arguments using process.argv or a library like commander\n- Route to appropriate command handler in commands/\n- Handle --help, --version flags\n- Set up error handling and logging\n- Export main() function\n\n#### types.ts (Type Definitions):\n- TypeScript interfaces for Config, Playbook, DiaryEntry, Reflection, etc.\n- Zod schemas for runtime validation\n- Enums for bullet states, priority levels, etc.\n- Type guards and utility types\n\n#### utils.ts (Shared Utilities):\n- File system operations (ensureDir, readYAML, writeYAML, appendJSONL)\n- Path resolution (resolveGlobalDir, resolveRepoDir)\n- Date/time formatting\n- Error handling helpers\n- String manipulation utilities\n\n#### cass.ts (Core Orchestration):\n- High-level CASS workflow coordination\n- Session management\n- Playbook + Diary + Reflection integration\n- Decision-making orchestration\n\n#### llm.ts (LLM Integration):\n- Factory function to create LLM clients based on config\n- Provider detection (OpenAI, Anthropic, Google)\n- API key validation\n- Structured output helpers using Zod schemas\n- Rate limiting and error handling\n\n#### playbook.ts (Playbook Management):\n- Load playbook from ~/.cass-memory/ and .cass/\n- Merge global and repo-level playbooks\n- Rule filtering and prioritization\n- Toxic bullet checking\n- Usage tracking\n\n#### diary.ts (Diary Operations):\n- Create diary entries\n- Read diary history\n- Format diary content\n- Track diary metadata\n\n#### reflect.ts (Reflection Processing):\n- Parse session logs\n- Extract learned patterns\n- Generate playbook bullets via LLM\n- Update playbook YAML\n\n#### validate.ts (Validation):\n- Validate config.json structure\n- Validate playbook.yaml structure\n- Check for required fields\n- Provide helpful error messages\n\n#### curate.ts (Curation Workflow):\n- Evidence-based gate (check usage.jsonl)\n- LLM-based curation decision\n- Bullet promotion/demotion logic\n- Historical analysis\n\n#### sanitize.ts (Secret Sanitization):\n- Detect API keys, tokens, passwords\n- Pattern-based detection\n- Entropy-based detection\n- Replace secrets with placeholders\n\n## Reasoning\n\n### Why This Structure:\n1. Single Responsibility: Each file has one clear purpose\n2. Testability: Modules can be tested in isolation\n3. Discoverability: New contributors can find functionality quickly\n4. Import Clarity: Clear dependency graph (utils <- types <- everything else)\n5. Command Separation: Each CLI command is a separate module\n\n### Why commands/ Subdirectory:\n1. Scalability: Easy to add new commands\n2. Organization: Keeps main src/ clean\n3. Parallel Development: Multiple devs can work on different commands\n4. Lazy Loading: Only load command code when needed\n\n### Why Separate LLM Module:\n1. Provider Agnostic: Switch providers without touching business logic\n2. Testing: Mock LLM calls easily\n3. Configuration: Centralized API key and model management\n4. Rate Limiting: Global rate limit tracking\n\n## Acceptance Criteria\n\n- src/ directory exists\n- All core files created with proper exports\n- commands/ subdirectory exists\n- All command files created\n- Each file has a JSDoc comment explaining its purpose\n- All files use ES module syntax (import/export)\n- Types are imported from types.ts\n- Utils are imported from utils.ts\n- No circular dependencies\n- bun run typecheck passes\n\n## How This Serves the Universal Agent Memory System\n\nThe directory structure is the skeleton of the CASS Memory System:\n\n1. Modularity: Agents can extend specific modules without touching core logic\n2. Maintainability: Clear boundaries make bug fixes and enhancements easier\n3. Testability: Each module can be unit tested independently\n4. Onboarding: New contributors can navigate the codebase intuitively\n5. Extensibility: New commands and features can be added without refactoring\n\nA well-organized codebase ensures the CASS Memory System can evolve as new use cases emerge, from simple diary logging to complex multi-agent orchestration.","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:46:16.460684Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-oq5j","title":"Fix test isolation issues - tests pass individually but fail when run together","status":"tombstone","priority":2,"issue_type":"bug","created_at":"2025-12-08T05:44:44.815421Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"bug","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-oqgl","title":"[Semantic] batchEmbed - Efficient bulk embedding","description":"Efficient bulk embedding with batching and progress reporting.\n\nImplementation:\n```typescript\nasync function batchEmbed(\n  texts: string[],\n  batchSize: number = 32\n): Promise<number[][]>\n```\n\nWhy batching:\n- Transformer.js supports batch processing\n- More efficient than one-at-a-time\n- Better GPU utilization (if available)\n- Memory management for large sets\n\nProcess:\n1. Split texts into batches of 32\n2. For each batch:\n   - Embed all texts together\n   - Show progress (if large)\n3. Flatten results\n4. Return embeddings array\n\nPerformance:\n- Batch of 32: ~80ms vs 96ms (32×3ms)\n- Speedup: ~20%\n- Memory: ~15MB per batch\n\nProgress reporting:\n- For batches > 100 texts\n- Show progress bar\n- Estimate time remaining\n\nExample:\n```typescript\nconst bullets = playbook.bullets.map(b => b.content);\nconst embeddings = await batchEmbed(bullets, 32);\nbullets.forEach((b, i) => b.embedding = embeddings[i]);\n```\n\nUse cases:\n- Initial playbook embedding\n- Bulk cache rebuild\n- Embedding multiple diaries","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-07T21:49:45.641445Z","updated_at":"2025-12-13T19:55:58.587651Z","closed_at":"2025-12-13T19:55:58.587651Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-oug","title":"[LLM] PROMPTS.diary - Diary extraction prompt template","description":"Full prompt template for diary extraction:\n\nYou are analyzing a coding agent session to extract structured insights.\n\nSESSION METADATA:\n- Path: {sessionPath}\n- Agent: {agent}\n- Workspace: {workspace}\n\nSESSION CONTENT:\n{content}\n\nINSTRUCTIONS:\nExtract the following from this session. Be SPECIFIC and ACTIONABLE.\nAvoid generic statements like 'wrote code' or 'fixed bug'.\nInclude specific:\n- File names and paths\n- Function/class/component names\n- Error messages and stack traces\n- Commands run\n- Tools used\n\nIf the session lacks information for a field, provide an empty array.\n\n---\n\nThis prompt is tuned for structured extraction with Zod schema.\nTemperature: 0.3 (low for consistency)\nUsed in extractDiary function.\n\nImplementation: Truncate sessionContent if >50000 chars to avoid token limits.","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:44:51.952015Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-ov1","title":"[Utils] log - Conditional verbose logging to stderr","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:45:24.467590Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-p0dr","title":"[Docs] CLI --help text for all commands","description":"Implement comprehensive --help text for all commands.\n\nMain help:\ncass-memory <command> [options]\n\nCommands:\n  init       Initialize configuration and playbook\n  context    Get relevant context for a task\n  diary      Generate structured diary from session\n  reflect    Run reflection cycle on recent sessions\n  validate   Validate playbook integrity\n  mark       Mark bullet helpful/harmful\n  audit      Show bullet audit trail\n  playbook   Playbook operations\n  project    Project knowledge operations\n  forget     Remove toxic rules\n  stats      Playbook health metrics\n  doctor     System health check\n  top        Most impactful bullets\n  stale      Unused bullets\n  why        Show bullet provenance\n  similar    Find similar bullets\n\nGlobal Options:\n  --json     Output as JSON\n  --quiet    Suppress diagnostic output\n  --help     Show help\n  --version  Show version\n\nEach command should have detailed help accessible via: cass-memory <command> --help","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-07T21:49:31.460347Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-p1y9","title":"[Unit] cass.ts - CASS Integration (External Tool)","description":"## Target: src/cass.ts (291 LOC) - ZERO CURRENT COVERAGE\n\n### Functions to Test:\n\n1. **cassAvailable(cassPath)** - Check CASS availability\n   - Returns true if cass binary exists\n   - Returns false if missing\n   - Custom path parameter\n   - Permission checking\n\n2. **searchCass(query, options)** - Search CASS index\n   - Valid query returns results\n   - Empty query handling\n   - Limit parameter respected\n   - --robot flag always used\n   - Timeout handling\n\n3. **parseCassOutput(output)** - Parse CASS JSON output\n   - Valid JSON parsed correctly\n   - Invalid JSON → graceful error\n   - Empty output handling\n   - Partial results handling\n\n4. **viewCassSession(path, options)** - View session\n   - Returns session content\n   - Line number parameter\n   - Context parameter (-C)\n   - Missing file handling\n\n5. **expandCassContext(path, lineNumber, context)** - Expand context\n   - Returns surrounding context\n   - Handles file boundaries\n   - Missing file handling\n\n6. **getCassCapabilities()** - Get CASS features\n   - Returns capabilities object\n   - Handles version differences\n   - Caches results\n\n### External Process Testing:\nNote: These tests need real cass binary OR should be skipped if unavailable.\n\n- Test with CASS_AVAILABLE=false env var for skip\n- Use small test fixtures for real tests\n- Verify timeout handling with slow responses\n- Test stderr handling\n\n### Mock-Free Approach:\n- Detect if cass is installed\n- Skip tests gracefully if not\n- Use real cass for CI if available\n- Document test requirements","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-08T01:28:39.965544Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-p4mv","title":"[Test Infrastructure] Test data directory with sample fixtures","description":"## Test Infrastructure: Test Data Directory with Sample Fixtures\n\n### Directory Structure\n\n```\ntest/\n  fixtures/\n    configs/\n      valid-global.yaml        # Full valid global config\n      valid-repo.yaml          # Full valid repo config\n      minimal.yaml             # Only required fields\n      malformed.yaml           # Invalid YAML syntax\n      unknown-keys.yaml        # Future compatibility test\n    \n    playbooks/\n      empty.yaml               # Empty playbook\n      single-bullet.yaml       # One bullet for simple tests\n      multi-bullet.yaml        # 10 bullets, various confidences\n      scoped-bullets.yaml      # Bullets with different scopes\n      with-toxic.yaml          # Playbook with toxic list\n    \n    sessions/\n      simple-chat.jsonl        # 10 messages, basic Q&A\n      code-session.jsonl       # 30 messages, code discussion\n      error-session.jsonl      # Session with errors/debugging\n      long-session.jsonl       # 100+ messages for stress test\n    \n    diaries/\n      sample-diary.yaml        # Valid diary entry\n      multi-entry.yaml         # Multiple diary entries\n    \n    cass-output/\n      search-results.json      # Sample cass search response\n      timeline.json            # Sample cass timeline response\n      empty-results.json       # No hits response\n```\n\n### Fixture Principles\n- All fixtures are valid unless explicitly named otherwise\n- Fixtures are minimal but complete\n- Each fixture tests one specific scenario\n- Fixtures are deterministic (fixed timestamps)\n\n### Usage in Tests\n```typescript\nimport { loadFixture } from './helpers';\nconst config = loadFixture('configs/valid-global.yaml');\n```","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-08T01:23:05.861799Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-p5gv","title":"[Testing] Fix duplicate schema exports blocking tests","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-08T01:29:51.542460Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-p8dp","title":"Tests: cover diary --raw path","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T00:34:12.063685062Z","created_by":"ubuntu","updated_at":"2026-01-07T00:37:48.722435020Z","closed_at":"2026-01-07T00:37:48.722435020Z","close_reason":"Added tests for generateDiaryFromContent empty-content guard and diary --raw sanitization","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-p8dp","depends_on_id":"cass_memory_system-sdt1.4","type":"discovered-from","created_at":"2026-01-21T09:28:51Z","created_by":"import"}]}
{"id":"cass_memory_system-p8p","title":"[Utils] normalizeLineEndings - Cross-platform line ending handling","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:45:27.161664Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-p8pb","title":"[Testing:E2E] commands.test.sh - Full workflow tests","description":"#!/bin/bash\nset -e\n\nCASS_MEMORY=\"./dist/cass-memory\"\nTEST_DIR=$(mktemp -d)\nexport CASS_MEMORY_HOME=\"$TEST_DIR\"\n\n# Tests:\n# 1. init creates files\n# 2. config show returns JSON\n# 3. playbook list (empty)\n# 4. playbook add\n# 5. mark helpful\n# 6. context (if cass available)\n# 7. JSON output valid\n# 8. help shows commands\n\ncleanup() { rm -rf \"$TEST_DIR\"; }\ntrap cleanup EXIT","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-07T21:49:39.408230Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-pbwy","title":"[Semantic] findSimilarBulletsSemantic - Embedding-based search","description":"Find semantically similar bullets using embeddings.\n\nImplementation:\n```typescript\nasync function findSimilarBulletsSemantic(\n  query: string,\n  bullets: PlaybookBullet[],\n  topK: number = 5\n): Promise<{ bullet: PlaybookBullet; similarity: number }[]>\n```\n\nProcess:\n1. Embed query text\n2. For each bullet:\n   - Get or compute embedding\n   - Calculate cosine similarity\n3. Sort by similarity (descending)\n4. Return top K results\n\nUse cases:\n- \"similar\" command: Find bullets like a query\n- Duplicate detection: Find bullets too similar\n- Related content: Suggest related rules\n\nExample usage:\n```typescript\nconst similar = await findSimilarBulletsSemantic(\n  \"handling authentication errors\",\n  playbook.bullets,\n  5\n);\n// Returns:\n// [\n//   { bullet: {...}, similarity: 0.92 },  // \"wrap auth calls in try-catch\"\n//   { bullet: {...}, similarity: 0.87 },  // \"log failed login attempts\"\n//   { bullet: {...}, similarity: 0.81 },  // \"return 401 for auth failures\"\n//   ...\n// ]\n```\n\nPerformance:\n- 100 bullets: ~60ms\n- 1000 bullets: ~600ms\n- Could optimize with vector index (future)\n\nSimilarity thresholds:\n- 0.9+: Very similar (possible duplicates)\n- 0.7-0.9: Related content\n- 0.5-0.7: Loosely related\n- <0.5: Not related","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-07T21:49:46.578490Z","updated_at":"2025-12-13T09:43:49.828353Z","closed_at":"2025-12-13T09:43:49.828353Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-pcl","title":"[LLM] PROMPTS.context - Pre-task briefing prompt","description":"Full prompt template for pre-task briefing (hydration):\n\nVariables: {task}, {bullets}, {history}, {deprecatedPatterns}\n\nInstructions:\n1. Highlight 3-5 most relevant playbook rules with IDs\n2. Point to specific historical solutions (cite session paths)\n3. Warn about deprecated patterns if matched\n4. Suggest cass search queries for complex tasks\n\nFormat for agent consumption: structured, scannable, actionable\n\n---\n\nTemperature: 0.3\nMax tokens: 2000\nOutput: Free-form text (uses generateText, not generateObject)\n\nThis is the 'briefing' that agents receive before starting work - connect them to relevant organizational memory.\n\nUsed in generateContext function.","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:44:55.028306Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-pdkm","title":"[Build] Version management and display","description":"Implement version management and --version flag.\n\nImplementation:\n\n\nInclude version in:\n- --version flag output\n- --help text header\n- JSON output metadata: {\"version\": \"0.1.0\", ...}\n- Error messages for debugging\n- Doctor command output\n\nFormat: Semantic versioning (MAJOR.MINOR.PATCH)\n- MAJOR: Breaking changes\n- MINOR: New features (backward compatible)\n- PATCH: Bug fixes","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-07T21:49:44.420975Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-peoi","title":"[Impl] Add cm quickstart Command for Agent Self-Documentation","description":"# Add cm quickstart Command for Agent Self-Documentation\n\n## Purpose\nAn agent encountering cass-memory should be able to learn how to use it by running ONE command. The tool teaches agents how to use it.\n\n## Command\n\\`\\`\\`bash\ncm quickstart\n\\`\\`\\`\n\n## Output Content (~40 lines, ~400 tokens)\n\n\\`\\`\\`markdown\n# cass-memory Quick Start for AI Agents\n\n## What This Is\nPersistent memory across sessions. Check what's been learned before you work.\n\n## Protocol\nSTART: cm context \\\"<task>\\\" --json   ← Run before non-trivial work\nWORK:  Reference rule IDs: \\\"Per [b-xyz], checking expiry first...\\\"\nEND:   Session auto-processed (no action needed)\n\n## Essential Commands\n\n### Get Context (run first!)\ncm context \\\"fix authentication bug\\\" --json\n\n### Provide Feedback\ncm mark b-xyz123 helpful --reason \\\"prevented caching bug\\\"\ncm mark b-abc456 harmful --reason \\\"didn't apply here\\\"\n\nOr inline (auto-parsed during reflection):\n// [cass: helpful b-xyz123] this prevented a bug\n\n### Health Check\ncm doctor --json\n\n## Output Format\n{\\\"rules\\\": [{\\\"id\\\": \\\"b-xxx\\\", \\\"content\\\": \\\"...\\\", \\\"score\\\": N}], ...}\n\n## Rule IDs\nFormat: b-abc123. Reference when following rules or giving feedback.\n\n## Exit Codes\n0 = success (parse stdout), non-zero = error (check stderr)\n\\`\\`\\`\n\n## Implementation\n- Add new command: src/commands/quickstart.ts\n- Static markdown string (simple)\n- Support --json flag for structured output\n\n## NO BLOCKERS\nThis can be implemented immediately. Content is well-defined.","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-08T17:51:58.763314Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-pfsp","title":"Inject Trauma Warnings into 'cm context'","description":"Update 'cm context' to scan the user's task against the Trauma registry.\n\nLogic:\n1. Match task keywords/intent against Trauma patterns.\n2. If match: PREPEND a massive, high-visibility warning block to the output.\n3. Format:\n   🚨🚨🚨 CRITICAL WARNING 🚨🚨🚨\n   You previously caused a CATASTROPHE with this pattern.\n   DO NOT RUN [Command].\n   Reference: [Session] (User: '[Message]')\n\nGoal: Ensure the agent 'feels' the scar before starting the task.","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-12-18T03:59:28.212613Z","updated_at":"2025-12-20T23:02:01.871652Z","closed_at":"2025-12-20T23:02:01.871652Z","close_reason":"Already implemented: cm context loads traumas, matches task, prints visceral warning, and includes traumaWarning in JSON","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-pfsp","depends_on_id":"cass_memory_system-653r","type":"discovered-from","created_at":"2026-01-21T09:28:51Z","created_by":"import"}]}
{"id":"cass_memory_system-pljm","title":"[Docs] AGENTS.md template for agent integration","description":"Create AGENTS.md template showing how to integrate cass-memory with AI agents.\n\nTemplate content:\n## Memory System: cass-memory\n\nBefore starting complex tasks, retrieve relevant context:\n```bash\ncass-memory context \"<task description>\" --json\n```\n\nAs you work, track bullet usage:\n- When helpful: `cass-memory mark <id> --helpful`\n- When harmful: `cass-memory mark <id> --harmful`\n\n### Memory Protocol\n1. PRE-FLIGHT: Run context before non-trivial tasks\n2. REFERENCE: Cite bullet IDs when following rules\n3. FEEDBACK: Mark helpful/harmful during work\n4. REFLECT: Diary auto-generated after sessions\n\nInclude integration examples for Claude Code, custom agents, and CI/CD workflows","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-07T21:49:29.589824Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-pmh5","title":"Sort context bullets by relevance score","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-07T05:30:26.798362430Z","created_by":"ubuntu","updated_at":"2026-01-07T05:30:49.884001882Z","closed_at":"2026-01-07T05:30:49.884001882Z","close_reason":"Rank context bullets by relevance score","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-pn4m","title":"[Unit] Commands - reflect.ts, search.ts, validate.ts","description":"## Target: src/commands/*.ts - CLI Commands (Part 3)\n\n### reflect.ts Tests:\n\n1. **reflectCommand(options)** - Reflection CLI\n   - Runs reflection pipeline\n   - --since date filter\n   - --output file parameter\n   - --json structured output\n   - No sessions → appropriate message\n\n2. **Output handling**\n   - Markdown report generation\n   - Suggestions clearly formatted\n   - Statistics included\n\n### search.ts Tests:\n\n1. **searchCommand(query, options)** - Search CLI\n   - Searches playbook\n   - Searches CASS if available\n   - --scope filtering\n   - --limit parameter\n   - --json output\n   - No results message\n\n2. **Result formatting**\n   - Scores displayed\n   - Snippets included\n   - Source indicated\n\n### validate.ts Tests:\n\n1. **validateCommand(options)** - Validation CLI\n   - Validates playbook files\n   - Validates config files\n   - --fix attempts fixes\n   - --json output structured\n   - Exit code reflects validity\n\n2. **Error reporting**\n   - Clear error messages\n   - Line numbers when applicable\n   - Suggested fixes\n\n### CLI Testing:\n- Process.exit mocking for exit codes\n- Temp file fixtures\n- stderr capture for errors","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-08T01:29:19.209517Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-pn4m","depends_on_id":"cass_memory_system-fem1","type":"blocks","created_at":"2026-01-21T09:28:51Z","created_by":"import"},{"issue_id":"cass_memory_system-pn4m","depends_on_id":"cass_memory_system-mmxv","type":"blocks","created_at":"2026-01-21T09:28:51Z","created_by":"import"}]}
{"id":"cass_memory_system-pqbp","title":"[CLI] similar command - Semantic bullet search","description":"Implements the 'cass-memory similar' command for semantic bullet search using embeddings.\n\nCOMMAND SYNTAX:\n```bash\ncass-memory similar \"<query>\" [options]\n\nArguments:\n  query          Text query to find similar bullets\n\nOptions:\n  --limit N      Number of results (default: 5)\n  --threshold T  Minimum similarity score 0-1 (default: 0.7)\n  --scope SCOPE  Filter by scope (global, workspace, all)\n  --json         Output as JSON\n```\n\nPURPOSE:\nUses embeddings to find semantically similar bullets based on a natural language query. Useful for discovering related rules, finding duplicates, and exploring the playbook.\n\nOUTPUT FORMAT (Terminal):\n```\nSIMILAR BULLETS TO: \"handling authentication errors\"\n====================================================\n\nFound 5 semantically similar bullets:\n\n1. [Similarity: 0.92] Retry auth requests with exponential backoff\n   ID: abc-123 | Category: API | Score: 8.4\n   \"When authentication fails with 401, retry with exponential...\"\n\n2. [Similarity: 0.87] Handle token expiry gracefully\n   ID: def-456 | Category: Security | Score: 6.2\n   \"Check token expiry before API calls and refresh proactively...\"\n\n3. [Similarity: 0.81] Log auth failures for security monitoring\n   ID: ghi-789 | Category: Security | Score: 5.1\n   \"Always log authentication failures with context for audit...\"\n\n4. [Similarity: 0.76] Show user-friendly error on auth failure\n   ID: jkl-012 | Category: UX | Score: 4.3\n   \"Display clear message when auth fails, avoid technical jargon...\"\n\n5. [Similarity: 0.72] Use OAuth refresh tokens correctly\n   ID: mno-345 | Category: Security | Score: 7.8\n   \"Store refresh tokens securely and use to obtain new access...\"\n\nTIP: Use 'cass-memory show <id>' to see full details\n```\n\nIMPLEMENTATION REQUIREMENTS:\n\n1. Parse query and options\n2. Generate embedding for query text\n3. Load playbook with embeddings\n4. Compute cosine similarity between query and all bullets\n5. Filter by threshold and scope\n6. Sort by similarity descending\n7. Take top N results\n8. Display with formatting\n\nEMBEDDING SYSTEM:\n\nQuery Embedding:\n```typescript\nconst queryEmbedding = await generateEmbedding(query);\n```\n\nSimilarity Calculation:\n```typescript\nfunction cosineSimilarity(vec1: number[], vec2: number[]): number {\n  const dotProduct = vec1.reduce((sum, val, i) => sum + val * vec2[i], 0);\n  const mag1 = Math.sqrt(vec1.reduce((sum, val) => sum + val * val, 0));\n  const mag2 = Math.sqrt(vec2.reduce((sum, val) => sum + val * val, 0));\n  return dotProduct / (mag1 * mag2);\n}\n```\n\nBullet Matching:\n```typescript\nconst matches = bullets.map(bullet => ({\n  bullet,\n  similarity: cosineSimilarity(queryEmbedding, bullet.embedding)\n}))\n.filter(m => m.similarity >= threshold)\n.sort((a, b) => b.similarity - a.similarity)\n.slice(0, limit);\n```\n\nDISPLAYED INFORMATION:\n- Similarity score (0-1 scale)\n- Bullet ID\n- Category\n- Current effectiveness score\n- Content preview (truncated)\n\nFILTERS:\n- --threshold: minimum similarity (default 0.7)\n- --limit: max results (default 5)\n- --scope: global, workspace, or all\n\nJSON OUTPUT:\n```json\n{\n  \"query\": \"handling authentication errors\",\n  \"results\": [\n    {\n      \"id\": \"abc-123\",\n      \"similarity\": 0.92,\n      \"content\": \"Retry auth requests with exponential backoff\",\n      \"category\": \"API\",\n      \"score\": 8.4,\n      \"preview\": \"When authentication fails with 401...\"\n    },\n    ...\n  ]\n}\n```\n\nUSE CASES:\n- Find related rules before creating new one\n- Discover duplicate or overlapping bullets\n- Explore playbook by concept\n- Find rules by natural language description\n- Identify merge candidates\n\nEDGE CASES:\n- No embeddings available → error with setup instructions\n- No results above threshold → show message\n- Query too short → suggest more specific query\n- Very high similarity (>0.95) → flag as potential duplicate\n\nPERFORMANCE:\n- Cache embeddings in memory\n- Use FAISS or similar for large playbooks (1000+ bullets)\n- Lazy load embeddings on first use\n- Target <1 second for 500 bullets\n\nFALLBACK:\nIf embeddings not available:\n- Suggest enabling embeddings\n- Offer keyword-based search as alternative\n- Explain benefits of semantic search\n\nDEPENDENCIES:\n- Embedding generation (OpenAI/local)\n- Playbook with embeddings\n- Vector similarity utilities\n- Terminal formatting\n\nSUCCESS CRITERIA:\n- Semantically relevant results\n- Fast response time (<1s typical)\n- Similarity scores make sense\n- Helps discover related content\n- Clear when duplicates found","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-07T21:58:16.133670Z","updated_at":"2025-12-13T09:43:49.827412Z","closed_at":"2025-12-13T09:43:49.827412Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-ps2","title":"[Playbook] findMergeCandidates - Group similar bullets for merging","description":"## Function Signature\n```typescript\nfunction findMergeCandidates(\n  bullets: PlaybookBullet[],\n  minSimilarity: number = 0.7\n): PlaybookBullet[][]\n```\n\n## Purpose\nGroup similar bullets that could be merged. Used by stats command to suggest consolidation opportunities.\n\n## Algorithm\n1. Filter to active bullets only (exclude deprecated)\n2. Group bullets by category first\n3. Within each category:\n   - Calculate pairwise similarity for all bullets\n   - Cluster bullets with similarity >= minSimilarity\n   - Form groups of 2+ similar bullets\n4. Return array of groups\n\n## Output Format\n```typescript\n[\n  [bullet1, bullet2, bullet3],  // Group 1: 3 similar bullets\n  [bullet4, bullet5],           // Group 2: 2 similar bullets\n]\n```\n\n## Clustering Strategy\nOptions:\n1. **Simple pairwise**: If A~B and B~C, group {A,B,C}\n2. **Transitive closure**: Build similarity graph, find connected components\n3. **Hierarchical**: Use complete-linkage clustering\n\nRecommended: Transitive closure for best results\n\n## Category Grouping\nOnly compare bullets in same category:\n- Testing bullets with Testing bullets\n- Security bullets with Security bullets\n- Prevents false positives from shared terms\n\n## Usage in Stats Command\n```typescript\nconst groups = findMergeCandidates(playbook.bullets, 0.7);\nconsole.log(`Found ${groups.length} merge opportunities:`);\ngroups.forEach((group, i) => {\n  console.log(`\\nGroup ${i + 1}:`);\n  group.forEach(b => console.log(`  - ${b.content}`));\n});\n```\n\n## Similarity Threshold\n- **0.7**: Good default, catches related rules\n- **0.8**: Stricter, only very similar\n- **0.6**: Looser, may need manual review\n\n## Implementation Notes\n- Skip deprecated bullets entirely\n- Group by category first (performance)\n- Return only groups with 2+ bullets\n- Sort groups by size (largest first)\n\n## Dependencies\n- jaccardSimilarity() utility\n- Category field on bullets\n\n## Related Functions\n- findSimilarBullet() - finds single best match\n- isDuplicateBullet() - boolean duplicate check\n- deprecateBullet() - used when merging","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:45:08.411547Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-pub","title":"[Types] ConfigSchema - Application Configuration Zod Schema","description":"## Overview\nImplement comprehensive Zod schema for application-wide configuration with validation, defaults, and type safety.\n\n## Required Fields\n\n### Core Settings\n- schema_version: number (default: 1) - Config file version for migrations\n- provider: enum 'openai' | 'anthropic' | 'google' (default: 'anthropic') - LLM provider selection\n- model: string (default: 'claude-sonnet-4-20250514') - Model identifier\n- cassPath: string (default: 'cass') - Path to cass executable\n- playbookPath: string (default: '~/.cass-memory/playbook.yaml') - Main playbook location\n- diaryDir: string (default: '~/.cass-memory/diary') - Working memory directory\n\n### Reflector Configuration\n- maxReflectorIterations: number, range 1-10 (default: 3) - Max iterations for reflector loop\n- autoReflect: boolean (default: false) - Automatic reflection after sessions\n\n### Deduplication & Pruning\n- dedupSimilarityThreshold: number, range 0-1 (default: 0.85) - Cosine similarity threshold for merging bullets\n- pruneHarmfulThreshold: number, range 1-10 (default: 3) - Harmful marks before auto-retirement\n- defaultDecayHalfLife: number (default: 90) - Days for confidence decay half-life\n\n### Context Limits\n- maxBulletsInContext: number, range 5-200 (default: 50) - Max bullets in pre-task hydration\n- maxHistoryInContext: number, range 3-50 (default: 10) - Max history snippets per context\n\n### Lookback Windows\n- sessionLookbackDays: number, range 1-365 (default: 7) - Days for session search in context\n- validationLookbackDays: number, range 30-365 (default: 90) - Days for scientific validation\n\n### Feature Flags\n- validationEnabled: boolean (default: true) - Enable scientific validation before adding rules\n- enrichWithCrossAgent: boolean (default: true) - Include multi-agent history in context\n- verbose: boolean (default: false) - Detailed logging output\n- jsonOutput: boolean (default: false) - Machine-readable JSON output\n\n### Sanitization (Nested Object)\n- sanitization.enabled: boolean (default: true) - Enable secret sanitization\n- sanitization.extraPatterns: string[] (default: []) - Additional regex patterns for sanitization\n\n## Implementation Details\n- Use Zod's .default() for all optional fields\n- Implement .refine() for cross-field validation (e.g., maxBulletsInContext > maxHistoryInContext)\n- Add .transform() to expand ~ in paths\n- Include helpful error messages via .describe()\n- Export both schema and inferred TypeScript type\n\n## Acceptance Criteria\n- All 20+ config fields with correct types and ranges\n- Default values match specification\n- Range validation for numeric fields\n- Enum validation for provider/model\n- Path expansion for ~ in file paths\n- Type-safe TypeScript interface exported\n- Comprehensive JSDoc comments","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:44:54.881960Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-pwp","title":"[Generator] formatLastHelpful - Human-readable feedback time","description":"Format bullet feedback timestamps as human-readable relative time.\n\nSIGNATURE:\nfunction formatLastHelpful(bullet: PlaybookBullet): string\n\nPURPOSE:\nConvert the most recent helpful event timestamp into a user-friendly relative time string for display in context output. Helps users understand recency of validation.\n\nINPUT:\nPlaybookBullet with events: Array<{\n  type: 'helpful' | 'unhelpful',\n  timestamp: Date,\n  sessionPath?: string,\n  notes?: string\n}>\n\nLOGIC:\n1. Find most recent event where type === 'helpful'\n2. If no helpful events exist, return 'Never'\n3. Calculate time difference from now\n4. Format based on magnitude:\n   - < 1 hour: '{minutes} minutes ago'\n   - < 24 hours: '{hours} hours ago'\n   - < 7 days: '{days} days ago'\n   - < 30 days: '{weeks} weeks ago'\n   - < 365 days: '{months} months ago'\n   - >= 365 days: '{years} years ago'\n\nEXAMPLES:\n- Last helpful 45 minutes ago → '45 minutes ago'\n- Last helpful 3 hours ago → '3 hours ago'\n- Last helpful 2 days ago → '2 days ago'\n- Last helpful 3 weeks ago → '3 weeks ago'\n- Last helpful 5 months ago → '5 months ago'\n- Last helpful 2 years ago → '2 years ago'\n- No helpful events → 'Never'\n\nROUNDING:\n- Always round down (floor)\n- 1.9 days → '1 day ago' (not 2)\n- This is conventional for relative time\n\nSPECIAL CASES:\n- 'just now' for < 1 minute (optional)\n- 'today' for same calendar day (optional)\n- 'yesterday' for previous calendar day (optional)\n\nFORMATTING OPTIONS:\nBasic: '{n} {unit}s ago'\nFriendly: 'last week', 'yesterday', 'just now'\n\nIMPLEMENTATION:\nUse date-fns or similar library for robust relative time:\nimport { formatDistanceToNow } from 'date-fns';\nreturn formatDistanceToNow(lastHelpfulEvent.timestamp, { addSuffix: true });\n\nOUTPUT USAGE:\nAppears in context markdown:\n  - Score: 4.2 | Last helpful: 2 days ago\n\nHelps user assess:\n- Recency of validation (recent = high confidence)\n- Staleness (never helpful = low confidence)\n- Temporal patterns (helpful 2 years ago = may be outdated)","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:45:02.833061Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-pwt6","title":"[E2E Tests] CLI doctor command - health diagnostics","description":"## E2E Test: CLI doctor Command - Health Diagnostics\n\n### Test Scenario\nTest `cm doctor` diagnoses and optionally fixes issues\n\n### Test Steps\n\n#### 1. Healthy System Check\n- Initialize properly configured project\n- Run `cm doctor`\n- Verify all checks pass\n- Verify clear success message\n\n#### 2. Missing Config Detection\n- Remove config.yaml\n- Run `cm doctor`\n- Verify 'Missing config' reported\n- Test `cm doctor --fix` recreates config\n\n#### 3. Invalid Config Detection\n- Write malformed YAML to config.yaml\n- Run `cm doctor`\n- Verify parse error reported\n- Show line number of error\n\n#### 4. Cass Integration Check\n- Test with cass available\n- Test with cass unavailable\n- Verify appropriate status messages\n\n#### 5. Index Health Check\n- Test with healthy cass index\n- Test with missing/corrupt index\n- Verify `--fix` rebuilds index\n\n#### 6. Playbook Validation\n- Test with valid playbook\n- Test with invalid bullet schemas\n- Report specific validation errors\n\n### Verbose Logging\n- Log: 'Running cass-memory diagnostics...'\n- Log: 'Checking config file...'\n- Log: 'Checking playbook schema...'\n- Log: 'Checking cass availability...'\n- Log: 'Checking cass index health...'\n- Log: 'Diagnostics complete: N issues found'\n\n### Output Format\n- `--format json` for machine parsing\n- Human-readable table by default\n- Exit code reflects health status","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-08T01:24:43.178213Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-pwt6","depends_on_id":"cass_memory_system-ep5y","type":"blocks","created_at":"2026-01-21T09:28:51Z","created_by":"import"},{"issue_id":"cass_memory_system-pwt6","depends_on_id":"cass_memory_system-yj1z","type":"blocks","created_at":"2026-01-21T09:28:51Z","created_by":"import"}]}
{"id":"cass_memory_system-q23","title":"[LLM] generateObjectSafe - Schema validation with retry","description":"Function signature:\nasync function generateObjectSafe<T>(\n  schema: z.ZodSchema<T>,\n  prompt: string,\n  config: Config,\n  maxAttempts: number = 2\n): Promise<T>\n\nImplementation:\n1. Call generateObject with schema and prompt\n2. Validate result with Zod (double-check - SDK should already validate)\n3. If validation fails (malformed LLM response):\n   a. Modify prompt to emphasize JSON format requirements\n   b. Add schema example to prompt\n   c. Slightly increase temperature (e.g., 0.3 → 0.35) to avoid repeating same error\n   d. Retry (up to maxAttempts)\n4. Return validated result\n\nEnhanced prompt on retry:\n'[PREVIOUS ATTEMPT FAILED - OUTPUT MUST BE VALID JSON]\n\n{original prompt}\n\nCRITICAL: Your response MUST match this exact schema:\n{JSON.stringify(schema, null, 2)}\n\nExample valid output:\n{schemaExample}'\n\nHandles edge cases where LLM produces malformed JSON or misses required fields.\n\nUsed by: All generateObject calls in production code.","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:46:11.328654Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-q2zt","title":"Update lock.test.ts for atomic mkdir implementation","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-08T02:04:36.017152Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-q3h2","title":"[Testing] Epic: full coverage + e2e logging","status":"tombstone","priority":0,"issue_type":"epic","created_at":"2025-12-08T01:29:33.260572Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"epic","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-q4v","title":"[Reflector] buildReflectorPrompt - Dynamic prompt construction","description":"function buildReflectorPrompt(\n  diary: DiaryEntry,\n  sessionContent: string,\n  existingBullets: PlaybookBullet[],\n  iteration: number\n): string\n\nConstructs comprehensive prompt with:\n- Existing bullets summary (by category) - provides context for helpful/harmful marks\n- Diary fields (accomplishments, decisions, challenges, etc.) - structured insights\n- Session content (truncated if needed) - raw material for analysis\n- Cass history for cross-agent context - learn from other agents\n- Iteration note (\"This is iteration N. Focus on insights you may have missed.\")\n\nPROMPT STRUCTURE:\n1. System context (what reflection is for)\n2. Existing bullets (summarizeExistingBullets)\n3. Diary extraction fields\n4. Cross-agent history (fetchCrossAgentHistory)\n5. Session content snippet\n6. Iteration guidance (getIterationNote)\n7. Output schema instructions\n\nDEPENDENCIES:\n- summarizeExistingBullets()\n- fetchCrossAgentHistory()\n- getIterationNote()","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:44:52.839075Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-q6uv","title":"[UX] Premium CLI UX Pass (Stripe-level polish)","description":"Background\n- cass-memory is CLI-first; trust and clarity are the product.\n- Current UX has trust-killers: docs↔code drift, mismatched defaults, inconsistent command naming, noisy degraded-mode behavior, inconsistent output styling, and footguns for destructive flags.\n\nGoal\n- Make `cm` feel premium: crisp, consistent, predictable, safe, and automation-friendly.\n- Reduce time-to-first-successful `cm context` (install → init → doctor → first context).\n- Ensure `--json` outputs are stable contracts for agents (stdout = JSON only).\n\nNon-goals\n- Shipping new core memory features unless required for correctness.\n- Large refactors/codemods; prefer small, reviewable iterations.\n\nApproach\n- Fix trust pass issues first (defaults/docs/command naming/flags).\n- Introduce a small terminal output “design system” used by all commands.\n- Harden degraded-mode guidance and destructive-operation safety.","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-13T10:11:57.559066Z","updated_at":"2025-12-14T00:24:46.635732Z","closed_at":"2025-12-14T00:24:46.635732Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-q6uv","depends_on_id":"cass_memory_system-3l7","type":"parent-child","created_at":"2026-01-21T09:28:51Z","created_by":"import"}]}
{"id":"cass_memory_system-q858","title":"[Docs] Command reference documentation","description":"Create comprehensive command reference documentation for all cass-memory commands.\n\nFor each command document:\n- Command name and purpose: One-line description\n- Usage syntax: cass-memory <command> [options] [args]\n- Arguments: Positional args with descriptions\n- Options: All flags with type, default, description\n- Examples: 3-5 real-world examples\n- Exit codes: 0 success, 1 error, 2 validation failure, etc.\n- JSON output format: Schema for --json mode\n\nCommands to document:\n- init, context, diary, reflect, validate, mark, audit, playbook, project, forget, stats, doctor, top, stale, why, similar\n\nTarget: Complete reference with copy-paste examples","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-07T21:49:27.309716Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-qbdq","title":"[Critical] Zero-Config Quick Start Mode - Immediate Value Without Setup","description":"# Zero-Config Quick Start Mode\n\n## The Problem\nCurrent plan requires: init → config → reflect → wait for sessions → curate → then finally get value.\nThis is too many steps before users see ANY benefit. Most will abandon before step 3.\n\n## The Solution\nMake `cm context \"my task\"` work IMMEDIATELY, even with zero setup:\n\n### Day 1 (No Setup Required):\n```bash\n# User just runs this - no init, no config\ncm context \"fix the auth bug\"\n\n# Output (even with empty playbook):\n# Checking your recent agent sessions...\n# Found 3 relevant sessions from Claude Code and Cursor\n# \n# ## Relevant Past Work:\n# - Session from 2 hours ago: Fixed JWT validation (similar: auth)\n# - Session from yesterday: Updated user model schema\n# \n# No playbook rules yet. Run 'cm reflect' to start learning from your sessions.\n```\n\n### How It Works:\n1. Auto-detect ~/.cass directory (create if needed with sensible defaults)\n2. Auto-find cass sessions in standard locations\n3. Show value immediately from raw cass history\n4. Gradually introduce playbook as it gets populated\n\n### Config Auto-Detection:\n1. Check ~/.cass-memory/config.json → use if exists\n2. Check ./.cass/config.json → use if exists\n3. Otherwise → use sensible defaults, no file needed\n\n## Why This Is Critical\n- Users need to see value in < 30 seconds\n- If first experience is \"run init, then configure, then...\" they leave\n- cass history search alone is valuable - don't hide it behind setup\n- Playbook is a bonus, not a prerequisite\n\n## Success Metrics\n- Time to first useful output: < 5 seconds\n- Required setup steps: 0\n- Commands needed for basic usage: 1 (`cm context \"task\"`)","status":"tombstone","priority":0,"issue_type":"feature","created_at":"2025-12-07T22:08:05.870433Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"feature","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-qbmq","title":"[E2E] Error Recovery - Graceful Handling of Failures","description":"## Target: E2E test of error handling and recovery\n\n### Scenario: Various Failure Modes\n\n```\nCorrupted config file → graceful error, offer fix\nMissing permissions → clear message\nInvalid playbook YAML → validation error\nNetwork timeout (LLM) → retry then fallback\nDisk full → atomic write prevents corruption\nInterrupted operation → recoverable state\n```\n\n### Test Script:\n\n```typescript\ndescribe('E2E: Error Recovery', () => {\n  describe('corrupted config', () => {\n    it('detects and offers recovery', async () => {\n      const env = await createTestEnvironment();\n      \n      // Corrupt the config\n      await writeFile(join(env.home, '.cass-memory/config.json'), '{ invalid json');\n      log('Corrupted config file');\n      \n      // Try to use\n      const result = await runCLI(['context', 'test', '--json'], { env });\n      log('Result:', result.stdout, result.stderr);\n      \n      expect(result.exitCode).not.toBe(0);\n      expect(result.stderr).toContain('config');\n      \n      // Doctor should detect\n      const doctor = await runCLI(['doctor', '--json'], { env });\n      log('Doctor result:', doctor.stdout);\n      expect(JSON.parse(doctor.stdout).issues).toContainEqual(\n        expect.objectContaining({ type: 'config_invalid' })\n      );\n      \n      // Fix should work\n      const fix = await runCLI(['init', '--force', '--json'], { env });\n      log('Fix result:', fix.stdout);\n      expect(fix.exitCode).toBe(0);\n      \n      // Now works\n      const retry = await runCLI(['context', 'test', '--json'], { env });\n      log('Retry result:', retry.stdout);\n      expect(retry.exitCode).toBe(0);\n    });\n  });\n\n  describe('permission errors', () => {\n    it('handles unreadable playbook', async () => {\n      // ... test permission denied scenarios\n    });\n  });\n\n  describe('network failures', () => {\n    it('retries and falls back', async () => {\n      // Set invalid API endpoint\n      // Verify retry behavior\n      // Verify fallback to non-LLM mode\n    });\n  });\n});\n```\n\n### Logging:\n- Error messages captured\n- Recovery steps logged\n- Final state verification","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T01:31:15.840297Z","updated_at":"2025-12-14T00:40:16.695177Z","closed_at":"2025-12-14T00:40:16.695177Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-qbmq","depends_on_id":"cass_memory_system-ke2x","type":"blocks","created_at":"2026-01-21T09:28:51Z","created_by":"import"}]}
{"id":"cass_memory_system-qc5r","title":"Fix tests after security shim removal","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T00:49:28.898218773Z","created_by":"ubuntu","updated_at":"2026-01-07T00:50:15.069439334Z","closed_at":"2026-01-07T00:50:15.069439334Z","close_reason":"Updated security tests to import sanitize module after shim removal","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-qc5r","depends_on_id":"cass_memory_system-sdt1.4","type":"discovered-from","created_at":"2026-01-21T09:28:51Z","created_by":"import"}]}
{"id":"cass_memory_system-qd9r","title":"[E2E] Add coverage reports + log formatting (JSONL)","description":"Emit coverage summary (bun test --coverage) as artifact; enforce thresholds. Standardize e2e logging format (JSONL with step, command, exit_code, duration, stdout_truncated, stderr_truncated) and add per-run log directory under .cass-memory/usage/e2e.","notes":"Added scripts/coverage.sh to run bun test --coverage with artifacts + summary JSON","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-08T01:30:30.441139Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-qec","title":"[Generator] generateTaskContext - Main context generation","description":"Main context generation orchestrator function.\n\nSIGNATURE:\nasync function generateTaskContext(task: string, config: Config): Promise<ContextResult>\n\nFLOW:\n1. Plan searches (generate queries from task using LLM)\n2. Execute cass searches in parallel\n3. Score playbook bullets by relevance to task\n4. Separate rules from anti-patterns\n5. Check deprecated patterns for warnings\n6. Build JSON output structure\n7. Optionally generate formatted markdown\n\nRETURNS:\nContextResult with structured data for agent consumption including:\n- Relevant playbook rules (scored and filtered)\n- Anti-patterns to avoid\n- Historical context from cass\n- Deprecated pattern warnings\n- Suggested follow-up queries\n\nPURPOSE:\nCreates 'mission briefings' before tasks by hydrating context from both the playbook (learned patterns) and cass (historical sessions). This is the entry point for the Generator domain.\n\nDEPENDENCIES:\n- generateSearchPlan (query generation)\n- executeSearchPlan (cass searches)\n- scorePlaybookBullets (relevance scoring)\n- separateAntiPatterns (rule/pitfall split)\n- checkDeprecatedPatterns (warnings)\n- buildContextResult (assembly)\n- formatContextMarkdown (optional formatting)\n\nERROR HANDLING:\nFalls back to contextWithoutCass if cass is unavailable - still provides playbook context even without historical data.","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:44:52.093332Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-qef","title":"[Decay] isStale - Detect rules without recent feedback","description":"Detect rules that haven't received any feedback (helpful or harmful) in a configurable period. Stale rules need review - they may be obsolete or just unused.\n\nCOMPLETE IMPLEMENTATION:\n```typescript\n/**\n * Check if bullet is stale (no recent feedback).\n * Stale rules may be obsolete, irrelevant, or just not being invoked.\n */\nfunction isStale(bullet: PlaybookBullet, staleDays: number = 90): boolean {\n  const allEvents = [...bullet.helpfulEvents, ...bullet.harmfulEvents];\n  \n  if (allEvents.length === 0) {\n    // No feedback ever - check creation date\n    return daysSince(bullet.createdAt) > staleDays;\n  }\n\n  const lastFeedback = Math.max(\n    ...allEvents.map(e => new Date(e.timestamp).getTime())\n  );\n  \n  return daysSince(lastFeedback) > staleDays;\n}\n\nfunction daysSince(timestamp: string | number): number {\n  const time = typeof timestamp === 'string' \n    ? new Date(timestamp).getTime() \n    : timestamp;\n  return (Date.now() - time) / (1000 * 60 * 60 * 24);\n}\n```\n\nSTALENESS LOGIC:\n\nCase 1: No feedback ever\n- Check days since bullet.createdAt\n- If > staleDays, consider stale\n- May indicate rule never matches or is too narrow\n\nCase 2: Has feedback history\n- Find most recent event (helpful OR harmful)\n- If last event > staleDays ago, consider stale\n- May indicate codebase evolved past this rule\n\nDEFAULT: 90 days\n- Configurable per playbook or system-wide\n- Shorter for fast-moving projects\n- Longer for stable, mature codebases\n\nWHY STALENESS MATTERS:\n\nSTALE \\!= BAD:\n- Stale rule might be perfect but just not encountered\n- Could be edge case that rarely triggers\n- Or could be obsolete cruft from old codebase\n\nSTALE RULES NEED REVIEW:\n- Human review: Is this still relevant?\n- If yes: Keep or pin\n- If no: Deprecate or delete\n- If unsure: Leave as candidate, watch for another 90 days\n\nEXAMPLE SCENARIOS:\n\n1. SECURITY RULE (stale but critical):\n   - \"Never commit AWS credentials\"\n   - Created 1 year ago\n   - 0 feedback (good thing\\!)\n   - Stale = true but should be pinned\n   - Keep forever even without feedback\n\n2. OBSOLETE FRAMEWORK RULE:\n   - \"Use Angular 1.x controllers\"\n   - Last helpful 300 days ago\n   - Project migrated to React\n   - Stale = true, should deprecate\n\n3. EDGE CASE RULE:\n   - \"Handle leap year in date calculations\"\n   - Created 200 days ago\n   - 0 feedback (hasn't been encountered)\n   - Stale = true but may still be valid\n   - Review and decide\n\nINTEGRATION:\n\nUsed by stats command:\n```typescript\nconst staleCount = bullets.filter(b => isStale(b)).length;\nconsole.log(`Stale rules (>90 days): ${staleCount}`);\n```\n\nUsed by review command (future):\n```typescript\nconst staleRules = bullets.filter(b => isStale(b) && \\!b.pinned);\nconsole.log('Rules needing review:', staleRules);\n```\n\nCONFIGURATION:\n- Default staleDays: 90\n- Override per-playbook in playbook.json\n- Override per-invocation: isStale(bullet, 60)\n\nDEPENDENCIES:\n- daysSince() helper\n- PlaybookBullet.createdAt field\n- PlaybookBullet.helpfulEvents array\n- PlaybookBullet.harmfulEvents array\n\nRETURNS:\n- true: No feedback in staleDays period\n- false: Has recent feedback","status":"tombstone","priority":3,"issue_type":"task","created_at":"2025-12-07T21:46:10.631857Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-qhbq","title":"Correct validation result normalization and mapping","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-08T05:33:00.558498Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-qhu0","title":"Task: Document remoteCass + history origin metadata","description":"## Goal\nDocument the new opt-in remote history feature (`remoteCass`) and the `historySnippets[].origin` field so both humans and coding agents understand how to use/filter remote hits without guesswork.\n\n## Why\nWe added SSH-based remote cass querying so users can pull in context from other machines. Without docs, agents/users won't know:\n- how to enable it safely (opt-in)\n- how remote hits are tagged in JSON\n- how remote hits are rendered (dimmer + host label)\n\n## Scope\n- Update README configuration reference + options table.\n- Update quickstart (agent-facing) to mention remote history as an optional capability.\n- Keep guidance bounded and non-conflicting (avoid long troubleshooting or multiple competing next steps).","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T00:22:52.441933Z","updated_at":"2025-12-16T00:25:02.539360Z","closed_at":"2025-12-16T00:25:02.539360Z","close_reason":"Documented remoteCass config + historySnippets.origin semantics in README and cm quickstart","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-qino","title":"[E2E] Add failure-path e2e: cass unavailable, LLM unavailable","description":"Script e2e to simulate cass binary missing and LLM API unset. Expect graceful degradation messages, non-zero? exit codes defined, and structured logs showing fallback. Verify no network calls when LLM disabled.","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-08T01:30:22.943382Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-qlab","title":"Fix Critical RCE: Prevent repo config from overriding cassPath","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-08T02:00:25.821149Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-qm27","title":"[Decay] applyMaturityTransitions - Batch promotion/demotion","description":"Apply promotion/demotion rules across all bullets in a playbook. Called at the end of each curate cycle to automatically advance proven rules and demote toxic ones. Returns summary of all transitions.\n\nCOMPLETE IMPLEMENTATION:\n```typescript\n/**\n * Apply maturity transitions across entire playbook.\n * Checks each bullet for promotion/demotion and applies changes.\n * Called at end of curate cycle.\n */\nfunction applyMaturityTransitions(playbook: Playbook): {\n  promotions: { bulletId: string; from: string; to: string }[];\n  demotions: { bulletId: string; from: string; to: string }[];\n  autoDeprecated: { bulletId: string; score: number }[];\n  unchanged: number;\n} {\n  const promotions: { bulletId: string; from: string; to: string }[] = [];\n  const demotions: { bulletId: string; from: string; to: string }[] = [];\n  const autoDeprecated: { bulletId: string; score: number }[] = [];\n  let unchanged = 0;\n\n  playbook.bullets.forEach(bullet => {\n    if (bullet.maturity === 'deprecated') {\n      unchanged++;\n      return;  // Skip already deprecated\n    }\n\n    const currentMaturity = bullet.maturity;\n    \n    // Check for promotion first\n    const promotionTarget = checkForPromotion(bullet);\n    if (promotionTarget !== currentMaturity) {\n      bullet.maturity = promotionTarget;\n      promotions.push({\n        bulletId: bullet.id,\n        from: currentMaturity,\n        to: promotionTarget\n      });\n      return;\n    }\n\n    // Check for demotion\n    const demotionTarget = checkForDemotion(bullet);\n    if (demotionTarget === 'auto-deprecate') {\n      const score = getEffectiveScore(bullet);\n      bullet.maturity = 'deprecated';\n      bullet.deprecatedAt = new Date().toISOString();\n      bullet.deprecationReason = `Auto-deprecated due to negative score (${score.toFixed(2)})`;\n      autoDeprecated.push({ bulletId: bullet.id, score });\n      return;\n    }\n    \n    if (demotionTarget !== currentMaturity) {\n      bullet.maturity = demotionTarget;\n      demotions.push({\n        bulletId: bullet.id,\n        from: currentMaturity,\n        to: demotionTarget\n      });\n      return;\n    }\n\n    unchanged++;\n  });\n\n  return {\n    promotions,\n    demotions,\n    autoDeprecated,\n    unchanged\n  };\n}\n```\n\nTRANSITION RULES:\n\nProcessing Order:\n1. Skip deprecated bullets (already terminal state)\n2. Check promotion first (reward positive signals)\n3. Check demotion only if no promotion\n4. Apply auto-deprecation if score < -3\n\nWhy Promotion First?\n- Positive signals should override minor negatives\n- Prevents flip-flopping between maturity levels\n- Rewards consistent helpful marks\n\nEXAMPLE SCENARIOS:\n\nScenario 1: Mass Promotion\n```typescript\n// After successful sprint with good playbook usage\nconst result = applyMaturityTransitions(playbook);\n// Result:\n// promotions: 5 (candidate → established)\n// demotions: 0\n// autoDeprecated: 0\n// unchanged: 37\n```\n\nScenario 2: Codebase Evolution\n```typescript\n// After major refactor, old rules become toxic\nconst result = applyMaturityTransitions(playbook);\n// Result:\n// promotions: 2 (new patterns emerging)\n// demotions: 8 (old patterns harmful)\n// autoDeprecated: 3 (severely toxic old rules)\n// unchanged: 29\n```\n\nScenario 3: Stable Playbook\n```typescript\n// Mature playbook with infrequent changes\nconst result = applyMaturityTransitions(playbook);\n// Result:\n// promotions: 0\n// demotions: 0\n// autoDeprecated: 0\n// unchanged: 42\n```\n\nOUTPUT STRUCTURE:\n\nPromotions:\n```json\n{\n  \"bulletId\": \"rule-123\",\n  \"from\": \"candidate\",\n  \"to\": \"established\"\n}\n```\n\nDemotions:\n```json\n{\n  \"bulletId\": \"rule-456\",\n  \"from\": \"proven\",\n  \"to\": \"established\"\n}\n```\n\nAuto-Deprecated:\n```json\n{\n  \"bulletId\": \"rule-789\",\n  \"score\": -5.25\n}\n```\n\nINTEGRATION WITH CURATE CYCLE:\n```typescript\n// At end of curate command\nasync function finalizeCuration(playbook: Playbook) {\n  // 1. Save all feedback events\n  await savePlaybook(playbook);\n\n  // 2. Apply maturity transitions\n  const transitions = applyMaturityTransitions(playbook);\n\n  // 3. Save updated maturities\n  await savePlaybook(playbook);\n\n  // 4. Report to user\n  if (transitions.promotions.length > 0) {\n    console.log(`✓ Promoted ${transitions.promotions.length} rules`);\n    transitions.promotions.forEach(p => {\n      console.log(`  - ${p.bulletId}: ${p.from} → ${p.to}`);\n    });\n  }\n\n  if (transitions.demotions.length > 0) {\n    console.log(`⚠ Demoted ${transitions.demotions.length} rules`);\n    transitions.demotions.forEach(d => {\n      console.log(`  - ${d.bulletId}: ${d.from} → ${d.to}`);\n    });\n  }\n\n  if (transitions.autoDeprecated.length > 0) {\n    console.log(`⛔ Auto-deprecated ${transitions.autoDeprecated.length} rules`);\n    transitions.autoDeprecated.forEach(a => {\n      console.log(`  - ${a.bulletId} (score: ${a.score.toFixed(2)})`);\n    });\n  }\n}\n```\n\nSIDE EFFECTS:\n- Modifies playbook.bullets[].maturity in place\n- Sets deprecatedAt timestamp for auto-deprecated bullets\n- Sets deprecationReason for auto-deprecated bullets\n- Does NOT save to disk (caller's responsibility)\n\nIDEMPOTENCY:\nSafe to call multiple times - already-transitioned bullets won't re-transition unless scores change.\n\nDEPENDENCIES:\n- checkForPromotion()\n- checkForDemotion()\n- getEffectiveScore()\n- PlaybookBullet.maturity field\n- PlaybookBullet.deprecatedAt field (optional)\n- PlaybookBullet.deprecationReason field (optional)\n\nUSED BY:\n- curate command (end of cycle)\n- Batch processing scripts\n- Playbook maintenance tools","status":"tombstone","priority":3,"issue_type":"task","created_at":"2025-12-07T21:47:35.351776Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-qoto","title":"[Config] isSemanticallyToxic - Check against toxic log","description":"Function signature:\n```typescript\nasync function isSemanticallyToxic(\n  content: string,\n  toxicLog: ToxicEntry[]\n): Promise<boolean>\n```\n\nImplementation:\n1. Compute content hash (SHA256)\n2. Check if hash exists in toxicLog entries\n3. If not found by hash, compute content embedding\n4. Compare embedding against all toxic embeddings using cosine similarity\n5. Return true if similarity > 0.85 threshold\n\nToxicEntry structure:\n```typescript\ninterface ToxicEntry {\n  contentHash: string;\n  embedding: number[];\n  forgottenAt: string;\n  reason?: string;\n}\n```\n\nUsed during playbook loading to filter out bullets marked as toxic via `cm forget` command.\nPrevents resurrection of harmful rules across sessions.\n\nPerformance: Hash check is O(1), embedding comparison is O(n * embedding_dim) where n = toxic entries.","status":"tombstone","priority":3,"issue_type":"task","created_at":"2025-12-07T21:50:23.294264Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-qp8","title":"[Playbook] addBullet - Add new bullet to playbook","description":"## Function Signature\n```typescript\nfunction addBullet(\n  playbook: Playbook,\n  data: NewBulletData,\n  sourceSession: string\n): PlaybookBullet\n```\n\n## Purpose\nAdd a new bullet to the playbook with complete initialization of all required fields.\n\n## Created Bullet Structure\n```typescript\n{\n  id: generateBulletId(),\n  content: data.content,\n  category: data.category,\n  tags: data.tags || [],\n  type: \"rule\",\n  isNegative: false,\n  state: \"draft\",\n  maturity: \"candidate\",\n  helpfulCount: 0,\n  harmfulCount: 0,\n  helpfulEvents: [],\n  harmfulEvents: [],\n  confidenceDecayHalfLifeDays: config.defaultDecayHalfLife || 90,\n  pinned: false,\n  sourceSessions: [sourceSession],\n  sourceAgents: [extractAgentFromPath(sourceSession)],\n  createdAt: now(),\n  updatedAt: now()\n}\n```\n\n## Field Initialization\n- **id**: Generated via generateBulletId() (timestamp-based)\n- **type**: Always \"rule\" by default\n- **isNegative**: false (rules are positive by default)\n- **state**: \"draft\" (new bullets start in draft)\n- **maturity**: \"candidate\" (needs validation)\n- **confidenceDecayHalfLifeDays**: From config or 90 days\n- **helpfulEvents/harmfulEvents**: Empty arrays for feedback\n- **sourceSessions**: Array with creating session\n- **sourceAgents**: Extracted from session path\n\n## Implementation Notes\n- Push bullet to playbook.bullets array\n- Return the created bullet for immediate use\n- extractAgentFromPath() parses session filename\n- Timestamps use ISO 8601 format\n\n## Dependencies\n- generateBulletId()\n- extractAgentFromPath()\n- Config for decay half-life\n\n## Related Functions\n- findBullet() - locate created bullet\n- recordFeedbackEvent() - add feedback to bullet\n- savePlaybook() - persist the addition","notes":"Existing playbook helper implementations already present; no code changes made. Released reservation; feel free to take over.","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:44:47.858394Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-qqi8","title":"Unit Test: reflect.ts","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-08T01:53:20.188957Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-qrha","title":"[P1] Add unit tests for privacy.ts command","description":"# Task: Unit tests for privacy.ts command (277 lines)\n\n## Why Important\nprivacy.ts manages privacy settings - critical for user trust. Misconfigured privacy could leak sensitive data across agents/projects.\n\n## What to Test\n\n### Privacy Configuration\n- [ ] Show current privacy settings\n- [ ] Enable/disable cross-agent enrichment\n- [ ] Enable/disable remote history\n- [ ] Persist settings correctly\n\n### Privacy Enforcement\n- [ ] Verify settings affect context command\n- [ ] Verify settings affect reflect command\n- [ ] Settings isolated per workspace\n\n### Output\n- [ ] Current settings displayed clearly\n- [ ] Changes confirmed to user\n- [ ] JSON output format correct\n\n## Files\n- Source: src/commands/privacy.ts (277 lines)\n- Test: test/privacy.test.ts (new)\n\n## Acceptance\n- [ ] All privacy options tested\n- [ ] Settings persistence verified\n- [ ] No mocks used","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-16T15:30:19.941881Z","updated_at":"2025-12-16T21:34:52.846085Z","closed_at":"2025-12-16T21:34:52.846085Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-qrk5","title":"Integration test: Reflector pipeline (diary -> reflect -> delta)","description":"Integration test for Reflector pipeline:\n- extractDiary() -> reflectOnSession() -> Delta output\n- Real session export fixtures\n- Multi-iteration reflection with shouldExitEarly()\n- Verify delta accumulation across iterations\n- Verify stats tracking accuracy\n- Detailed logging: diary extraction, each iteration, final deltas\nNO MOCKS - real diary.ts + reflect.ts interaction","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-08T01:26:23.344061Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-qt2q","title":"[CLI:context] formatContextOutput - JSON vs Markdown","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:51:36.878209Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-qwdh","title":"Task: Centralize sentiment detection logic","description":"# Task: Centralize Sentiment Detection Logic\n\n## Context\n\noutcome.ts has duplicate sentiment detection patterns with a comment indicating this is known tech debt.\n\n## Current State (outcome.ts:17-45)\n\n```typescript\n// --- Helpers duplicate in outcome.ts now, removing local definitions ---\n\nconst POSITIVE_PATTERNS = [\n  /that worked/i,\n  /perfect/i,\n  /thanks/i,\n  /great/i,\n  /exactly what i needed/i,\n  /solved it/i,\n];\n\nconst NEGATIVE_PATTERNS = [\n  /that('s| is) wrong/i,\n  /doesn't work/i,\n  /broke/i,\n  /not what i wanted/i,\n  /try again/i,\n  /undo/i,\n];\n\nfunction detectSentiment(text?: string): Sentiment {\n  if (!text) return \"neutral\";\n  const positiveCount = POSITIVE_PATTERNS.filter((p) => p.test(text)).length;\n  const negativeCount = NEGATIVE_PATTERNS.filter((p) => p.test(text)).length;\n  if (positiveCount > negativeCount) return \"positive\";\n  if (negativeCount > positiveCount) return \"negative\";\n  return \"neutral\";\n}\n```\n\n## Investigation Needed\n\n1. Check if this logic exists elsewhere (outcome.js, types.ts, utils.ts)\n2. Determine canonical location for sentiment detection\n3. Either:\n   a. Export from canonical location and import here\n   b. Move to utils.ts if no canonical location exists\n\n## Files to Modify\n\n- src/commands/outcome.ts - Remove duplicate, import from canonical location\n- src/outcome.ts or src/utils.ts - Host canonical implementation\n\n## Acceptance Criteria\n\n- [ ] Sentiment detection logic exists in exactly ONE place\n- [ ] outcome.ts imports rather than defines\n- [ ] All tests pass\n\n## Priority\n\nP3 - Tech debt, not blocking agents.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-15T18:26:33.615926Z","updated_at":"2025-12-15T20:55:57.012502Z","closed_at":"2025-12-15T20:55:57.012502Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-qwg9","title":"Task: Create printJsonResult() helper for consistent success responses","description":"# Task: Create printJsonResult() helper\n\n## Context\n\nWe have `printJsonError()` in utils.ts for error responses, but no corresponding helper for success responses. This leads to inconsistent JSON output across commands.\n\n## Current State\n\n```typescript\n// utils.ts:1902 - bare JSON output\nexport function printJson(value: unknown): void {\n  console.log(JSON.stringify(value, null, 2));\n}\n\n// utils.ts:1906 - structured error output\nexport function printJsonError(err, options): void {\n  const payload = { success: false, error: message, code?, details? };\n  printJson(payload);\n}\n```\n\nCommands currently do:\n```typescript\n// Inconsistent - some add success, some don't\nconsole.log(JSON.stringify({ success: true, bulletId, ... }, null, 2));\nconsole.log(JSON.stringify(bullets, null, 2));  // No success field!\n```\n\n## Solution\n\nAdd `printJsonResult()` to utils.ts:\n\n```typescript\nexport interface JsonResultOptions {\n  /** Whether the operation had its intended effect (default: true) */\n  effect?: boolean;\n  /** Reason if effect is false */\n  reason?: string;\n}\n\nexport function printJsonResult<T extends Record<string, unknown>>(\n  data: T,\n  options: JsonResultOptions = {}\n): void {\n  const { effect = true, reason } = options;\n  const payload = {\n    success: true,\n    ...(effect === false ? { effect: false, reason } : {}),\n    ...data,\n  };\n  printJson(payload);\n}\n```\n\n## Usage Examples\n\n```typescript\n// Normal success\nprintJsonResult({ bulletId, type, newState });\n// → { \"success\": true, \"bulletId\": \"...\", \"type\": \"...\", \"newState\": \"...\" }\n\n// Soft success (no effect)\nprintJsonResult({ }, { effect: false, reason: \"No signal strong enough\" });\n// → { \"success\": true, \"effect\": false, \"reason\": \"No signal strong enough\" }\n\n// With data + soft success\nprintJsonResult({ rulesChecked: 5 }, { effect: false, reason: \"No matching rules\" });\n// → { \"success\": true, \"effect\": false, \"reason\": \"...\", \"rulesChecked\": 5 }\n```\n\n## Files to Modify\n\n- src/utils.ts - Add printJsonResult() function and types\n\n## Acceptance Criteria\n\n- [ ] printJsonResult() function added to utils.ts\n- [ ] TypeScript types properly defined\n- [ ] Function exported and available to commands\n- [ ] Unit test added for the helper\n\n## Notes\n\nThis task should be completed FIRST as other tasks depend on this helper.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-15T18:24:16.218069Z","updated_at":"2025-12-15T19:57:08.885279Z","closed_at":"2025-12-15T19:57:08.885279Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-qwm2","title":"Implement onboard subcommands in cm.ts and onboard.ts","description":"## Context\n\nThis task implements the subcommand structure designed in cass_memory_system-3i3u.\n\n## Implementation Checklist\n\n### 1. Update cm.ts\n\nReplace the current onboard command definition:\n\n```typescript\n// Current (flags)\nprogram.command(\"onboard\")\n  .description(\"Agent-native guided onboarding\")\n  .option(\"--status\", ...)\n  .option(\"--sample\", ...)\n  // etc.\n```\n\nWith subcommand pattern (like playbook):\n\n```typescript\n// New (subcommands)\nconst onboard = program.command(\"onboard\")\n  .description(\"Agent-native guided onboarding (no API costs)\");\n\nonboard.command(\"status\")\n  .description(\"Check onboarding status and progress\")\n  .option(\"--json\", \"Output JSON\")\n  .action(async (opts) => await onboardStatus(opts));\n\nonboard.command(\"gaps\")\n  .description(\"Show playbook category gap analysis\")\n  .option(\"--json\", \"Output JSON\")\n  .action(async (opts) => await onboardGaps(opts));\n\nonboard.command(\"sample\")\n  .description(\"Sample diverse sessions for analysis\")\n  .option(\"--limit <n>\", \"Number of sessions\", toInt)\n  .option(\"--fill-gaps\", \"Prioritize underrepresented categories\")\n  .option(\"--include-processed\", \"Include already-processed sessions\")\n  .option(\"--workspace <path>\", \"Filter by workspace\")\n  .option(\"--agent <name>\", \"Filter by agent\")\n  .option(\"--days <n>\", \"Filter to last N days\", toInt)\n  .option(\"--json\", \"Output JSON\")\n  .action(async (opts) => await onboardSample(opts));\n\nonboard.command(\"read\")\n  .description(\"Read/export a session for analysis\")\n  .argument(\"<path>\", \"Session path\")\n  .option(\"--template\", \"Rich contextual output for extraction\")\n  .option(\"--json\", \"Output JSON\")\n  .action(async (path, opts) => await onboardRead(path, opts));\n\n// ... etc for prompt, guided, mark-done, reset\n```\n\n### 2. Update onboard.ts\n\nRefactor from single mega-function to individual handlers:\n\n```typescript\n// Export individual handlers\nexport async function onboardStatus(options: { json?: boolean }): Promise<void>\nexport async function onboardGaps(options: { json?: boolean }): Promise<void>\nexport async function onboardSample(options: SampleOptions): Promise<void>\nexport async function onboardRead(sessionPath: string, options: ReadOptions): Promise<void>\nexport async function onboardPrompt(options: { json?: boolean }): Promise<void>\nexport async function onboardGuided(options: { json?: boolean }): Promise<void>\nexport async function onboardMarkDone(sessionPath: string, options: { json?: boolean }): Promise<void>\nexport async function onboardReset(options: { yes?: boolean; json?: boolean }): Promise<void>\n\n// Keep internal helper functions private\nasync function getOnboardStatus(config, playbook) { ... }\nasync function sampleDiverseSessions(options) { ... }\n// etc.\n```\n\n### 3. Add Deprecation Layer\n\nKeep old flags working but with warnings:\n\n```typescript\n// In cm.ts, add a catch-all handler for legacy flags\nprogram.command(\"onboard\")\n  .option(\"--status\", \"DEPRECATED: Use 'cm onboard status'\")\n  // ... other deprecated flags ...\n  .action(async (opts) => {\n    // Deprecation detection and forwarding\n    if (opts.status) {\n      console.error(chalk.yellow(\"⚠️  '--status' is deprecated. Use 'cm onboard status' instead.\"));\n      return onboardStatus({ json: opts.json });\n    }\n    // ... handle other deprecated flags ...\n    \n    // If no flags, show help\n    program.commands.find(c => c.name() === 'onboard')?.help();\n  });\n```\n\n## Files Modified\n\n- `src/cm.ts` - Subcommand definitions\n- `src/commands/onboard.ts` - Refactored handlers\n\n## Testing\n\n- Test each subcommand individually\n- Test deprecated flag syntax still works\n- Test JSON output is unchanged\n- Test error cases\n\n## Depends On\n\ncass_memory_system-3i3u (Design task)\n\n## Part of Feature\n\ncass_memory_system-e6o7 (Onboard subcommand refactor)","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-15T17:17:53.455560Z","updated_at":"2025-12-15T17:48:21.234228Z","closed_at":"2025-12-15T17:48:21.234228Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-qwm2","depends_on_id":"cass_memory_system-3i3u","type":"blocks","created_at":"2026-01-21T09:28:52Z","created_by":"import"}]}
{"id":"cass_memory_system-qxes","title":"[CLI:mark] recordMarkEvent - Create feedback event","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:51:44.573386Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-r0ap","title":"[Testing:Unit] playbook.test.ts - Playbook management tests","description":"Test cases:\n- createEmptyPlaybook: valid structure\n- addBullet: generates ID, initializes counters\n- updateBulletCounter: increments, handles missing\n- deprecateBullet: sets flags, optional replacement\n- isDuplicateBullet: exact and near duplicates, ignores deprecated\n- curatePlaybook: applies deltas, skips duplicates, auto-prunes","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-07T21:49:27.649666Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-r1hq","title":"[UX][output] Add shared terminal UI helpers (sections, tables, wrapping)","description":"Problem\n- Each command currently hand-rolls formatting (rulers, headings, emojis, spacing).\n- This causes inconsistent look-and-feel and makes it expensive to polish.\n\nWhat to do\n- Create a small shared output helper layer (no heavy UI framework) that provides:\n  - Terminal width detection and safe wrapping\n  - Standard section headers and separators\n  - Key/value tables and aligned lists\n  - Hint/warn/error callouts (with optional icons)\n  - “showing N of M” truncation helper\n\nScope\n- Used by `context`, `doctor`, `similar`, `stats`, `usage` first.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-13T10:16:31.464788Z","updated_at":"2025-12-13T23:09:31.972515Z","closed_at":"2025-12-13T23:09:31.972515Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-r1hq","depends_on_id":"cass_memory_system-3tds","type":"parent-child","created_at":"2026-01-21T09:28:52Z","created_by":"import"}]}
{"id":"cass_memory_system-r2w","title":"[Utils] fileExists - Async file existence check","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:44:47.194958Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-r6w7","title":"Fix Inefficient Outcome Locking","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-08T03:03:18.076714Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-r79a","title":"[CLI:diary] handleDiaryOutput - Save or print diary","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:51:40.071474Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-r9fb","title":"[E2E] Implement full-path scenario: reflect + validate + curate with logging","description":"Add scripted e2e covering diary extraction, reflect pipeline, validate, curate apply. Include fixtures for fake cass export, run in temp dir, assert playbook deltas applied. Capture verbose logs (timestamps, command + args, stderr) and redact secrets.","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-08T01:30:14.040228Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-r9h","title":"[Diary] enrichWithRelatedSessions - Cross-agent context","description":"Enrich diary with related sessions from other agents for cross-agent learning.\n\nFunction Signature:\nasync function enrichWithRelatedSessions(\n  diary: DiaryEntry,\n  config: Config\n): Promise<DiaryEntry>\n\nProcess:\n1. Extract keywords from diary content:\n   - All accomplishments, decisions, challenges, keyLearnings\n   - Suggested tags\n   - Combine into keyword set\n2. Query cass for related sessions using keywords\n3. Filter out sessions from same agent (diversity requirement)\n4. Score each result by relevance to current diary\n5. Take top 5 most relevant sessions\n6. Add to diary.relatedSessions array\n7. Return enriched diary\n\nRelevance Scoring Algorithm:\n- Keyword overlap count\n- Tag matching weight\n- Recency bonus (newer sessions scored higher)\n- Agent diversity bonus (different agent types)\n\nCross-Agent Learning Benefits:\n- Discover how other agents solved similar problems\n- Learn user preferences across different contexts\n- Build holistic view of user's work patterns\n- Enable knowledge transfer between tools\n\nExample Use Case:\nIf Claude diary shows 'React component refactoring', find related Cursor sessions about React, even if from different projects.\n\nConfiguration:\n- config.maxRelatedSessions: default 5\n- config.relatedSessionsDays: search within N days (default 30)\n- config.minRelevanceScore: threshold for inclusion\n\nOutput:\nReturns diary with relatedSessions array populated with {sessionPath, agent, score}.","status":"tombstone","priority":3,"issue_type":"task","created_at":"2025-12-07T21:45:39.692623Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-rd7d","title":"[Semantic] Model selection and fallback","description":"Configurable embedding model selection with fallback.\n\nConfig option:\n```typescript\ninterface Config {\n  embeddingModel: \"Xenova/all-MiniLM-L6-v2\" | \"Xenova/bge-small-en-v1.5\" | \"none\";\n  semanticSearchEnabled: boolean;\n}\n```\n\nModels:\n1. Xenova/all-MiniLM-L6-v2 (default)\n   - Size: 23MB\n   - Dims: 384\n   - Quality: Good\n   - Speed: ~3ms/embedding\n   - Best for: General purpose\n\n2. Xenova/bge-small-en-v1.5\n   - Size: 33MB\n   - Dims: 384\n   - Quality: Better\n   - Speed: ~4ms/embedding\n   - Best for: Higher quality matching\n\n3. \"none\"\n   - Disables semantic search\n   - Falls back to keyword-only\n   - Useful for: Low-resource environments\n\nFallback strategy:\n```typescript\nasync function getEmbedder(): Promise<any | null> {\n  try {\n    return await pipeline(\"feature-extraction\", config.embeddingModel);\n  } catch (error) {\n    console.warn(\"Embedding model failed to load:\", error.message);\n    console.warn(\"Falling back to keyword-only matching\");\n    config.semanticSearchEnabled = false;\n    return null;\n  }\n}\n```\n\nWhen to fall back:\n- Model download fails (network issue)\n- Model incompatible with platform\n- Insufficient memory\n- User preference (config.embeddingModel = \"none\")\n\nConfig example:\n```yaml\nsemantic:\n  enabled: true\n  model: \"Xenova/all-MiniLM-L6-v2\"\n  fallbackToKeyword: true\n```","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-07T21:49:48.161611Z","updated_at":"2025-12-13T11:55:02.160824Z","closed_at":"2025-12-13T11:55:02.160824Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-rf0t","title":"Fix reflect.test.ts schema expectation","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-08T03:04:43.847711Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-rg3","title":"[Utils] normalizeYamlKeys - snake_case to camelCase conversion","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:45:26.291490Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-ricm","title":"[BUG] MCP cm_context tool should accept --limit (not just --top)","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-20T23:25:11.865194Z","updated_at":"2025-12-20T23:28:04.600010Z","closed_at":"2025-12-20T23:28:04.600010Z","close_reason":"Updated MCP cm_context tool schema + handler to accept limit (top deprecated); updated README MCP tool params","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-ricm","depends_on_id":"cass_memory_system-lm91","type":"discovered-from","created_at":"2026-01-21T09:28:52Z","created_by":"import"}]}
{"id":"cass_memory_system-rj0p","title":"[CLI] validate command - Scientific rule validation","description":"Standalone command to validate a proposed playbook rule against historical evidence.\n\nCommand signature:\n```bash\ncass-memory validate \"<proposed rule>\" [options]\n\nOptions:\n  --json             Output as JSON\n  --verbose          Show evidence details\n  --days N           Look back N days for evidence (default: 90)\n```\n\nPurpose:\nBefore adding a rule to the playbook, validate it scientifically against past sessions. Prevents adding rules based on hunches rather than evidence.\n\nImplementation flow:\n1. Parse proposed rule from command line\n2. Query cass for relevant sessions:\n   - Look back N days\n   - Search for sessions related to rule topic\n   \n3. Run validator core logic:\n   - Extract evidence from sessions\n   - Classify as supporting/contradicting/neutral\n   - Calculate confidence score\n   - Generate verdict (accept/reject/unclear)\n   \n4. Format and display report:\n   - If --json: output ValidationReport as JSON\n   - Else: format human-readable report\n   - If --verbose: include full evidence excerpts\n\nExample usage:\n```bash\n$ cass-memory validate \"Always use httpx instead of requests\"\nPROPOSED RULE: \"Always use httpx instead of requests\"\nVERDICT: ✓ ACCEPT (confidence: 0.85)\nEVIDENCE:\n- [supports] ~/.claude/.../session-001.jsonl\n  \"Switched to httpx, fixed timeout issues\"\n- [supports] ~/.codex/.../session-xyz.jsonl\n  \"httpx handled async properly\"\nREASON: Found 4 sessions where requests caused issues, 0 issues with httpx\n```\n\nThis command can be used standalone or called internally by reflect command.","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:50:32.385303Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-rju0","title":"Fix runSelfTest() to recognize config.apiKey (PR #5 issue)","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-16T05:30:05.509589Z","updated_at":"2025-12-16T05:32:21.811812Z","closed_at":"2025-12-16T05:32:21.811812Z","close_reason":"Fixed runSelfTest() to recognize config.apiKey","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-rm96","title":"[Unit] curate.ts - Curation Pipeline Logic","description":"## Target: src/curate.ts - Curation Module\n\n### Functions to Test:\n\n1. **curatePlaybook(playbook, options)** - Main curation pipeline\n   - Applies all curation rules\n   - Respects options (dryRun, verbose)\n   - Returns curation report\n   - Handles empty playbook\n\n2. **detectDuplicates(bullets)** - Duplicate detection\n   - Exact duplicates found\n   - Near-duplicates (fuzzy matching)\n   - Returns duplicate groups\n   - Similarity threshold configurable\n\n3. **mergeDuplicates(bullets, duplicateGroups)** - Merge duplicates\n   - Combines feedbackEvents\n   - Keeps most informative content\n   - Preserves highest score\n   - Handles edge cases (all identical)\n\n4. **detectObsolete(bullets, options)** - Obsolete detection\n   - Age-based obsolescence\n   - Score-based obsolescence\n   - Combines multiple factors\n   - Respects pinned bullets\n\n5. **suggestTags(bullet)** - Auto-tagging suggestions\n   - Extract keywords from content\n   - Map to existing tag vocabulary\n   - Return confidence scores\n   - Handle technical terms\n\n6. **validateBulletContent(bullet)** - Content validation\n   - Check for placeholder text\n   - Check minimum content length\n   - Check for broken references\n   - Return validation issues\n\n### Curation Report Schema:\n- duplicatesFound: number\n- obsoleteFound: number\n- suggestedMerges: array\n- suggestedDeletions: array\n- suggestedTags: array\n\n### Test Data:\n- Create realistic bullet sets\n- Include edge cases (empty, massive)\n- Unicode content handling","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-08T01:28:35.084231Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-rmt","title":"[Generator] formatContextMarkdown - Human-readable output","description":"Format ContextResult as human-readable markdown for display.\n\nSIGNATURE:\nfunction formatContextMarkdown(result: ContextResult): string\n\nPURPOSE:\nConvert the structured JSON ContextResult into a nicely formatted markdown document for human consumption. Used when user runs 'cass-memory context' command.\n\nOUTPUT FORMAT:\n\nwtmp begins Sun Dec  7 16:47:25 EST 2025\n\nFORMATTING RULES:\n- Use proper markdown headers (##, ###)\n- Bullet IDs as bold inline code: **[b-abc123]**\n- Scores rounded to 1 decimal: 4.2\n- Snippets indented and quoted\n- Warnings with emoji ⚠️ prefix\n- Suggested queries as bullet list\n\nSECTION VISIBILITY:\n- 'PITFALLS TO AVOID': Only if antiPatterns.length > 0\n- 'Historical Context': Only if historySnippets.length > 0\n- 'Deprecated Warnings': Only if warnings.length > 0\n- 'Dig Deeper': Only if suggestedQueries.length > 0\n\nSNIPPET TRUNCATION:\n- Limit snippets to 150 chars with '...' if longer\n- Preserve code formatting if snippet contains newlines\n\nEXAMPLE OUTPUT:\n\nwtmp begins Sun Dec  7 16:47:26 EST 2025\n\nwtmp begins Sun Dec  7 16:47:26 EST 2025\n\nUSE CASE:\nDirect CLI output when user runs: cass-memory context 'Fix authentication timeout bug'","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:45:01.382979Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-rsgy","title":"Add E2E tests for guard command","description":"# Add E2E Tests for guard Command\n\n## Context\nThe `cm guard` command manages pre-commit guards that prevent traumatic patterns. It has NO dedicated E2E test.\n\n## Current State\n- File: `src/commands/guard.ts`\n- Functionality: Install/uninstall/list pre-commit guards\n- Tests: NONE\n\n## Scope\nCreate E2E tests for:\n1. `cm guard install` - Install pre-commit hook\n2. `cm guard uninstall` - Remove pre-commit hook\n3. `cm guard status` - Show guard status\n4. Integration with git hooks\n5. Error handling (not in git repo, permission issues)\n\n## Test Strategy\n- Use temp git repos for isolation\n- Test actual hook installation/execution\n- Verify hook blocks commits with trauma patterns\n- Test idempotent install/uninstall\n\n## Acceptance Criteria\n- [ ] Test file: `test/cli-guard.e2e.test.ts` exists\n- [ ] All guard subcommands tested\n- [ ] Hook actually executes and blocks bad commits\n- [ ] Uses E2ELogger for detailed output","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T17:05:08.688521Z","updated_at":"2025-12-28T02:22:11.476182Z","closed_at":"2025-12-28T02:22:11.476182Z","close_reason":"Added comprehensive E2E tests for guard command. 11 tests covering: install success, idempotent installs, missing .claude error, JSON output, malformed settings.json, preserving existing settings, silent mode. All tests pass.","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-rvmh","title":"[UX][doctor] Make --fix safe and CI-friendly (no surprise prompts)","description":"Problem\n- `cm doctor --fix` currently forces interactive prompts (`applyFixes(..., { interactive: true })`) and can hang in CI or agent workflows.\n- “Cautious” fixes have a `--force` concept, but it’s not wired through end-to-end.\n\nWhat to do\n- Define clear fix semantics:\n  - In interactive mode: prompt for safe fixes, then cautious fixes\n  - In non-interactive mode: apply *only safe* fixes when `--fix` is set; require `--force` to apply cautious; otherwise output a plan and exit non-zero (or degraded)\n- Add `--dry-run` to show intended changes without applying.\n\nSafety\n- Never modify user data without explicit intent.\n- Always create backups for config/playbook resets before writing.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-13T10:16:14.789284Z","updated_at":"2025-12-13T11:20:27.254217Z","closed_at":"2025-12-13T11:20:27.254217Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-rvmh","depends_on_id":"cass_memory_system-dq7w","type":"parent-child","created_at":"2026-01-21T09:28:52Z","created_by":"import"},{"issue_id":"cass_memory_system-rvmh","depends_on_id":"cass_memory_system-jis4","type":"blocks","created_at":"2026-01-21T09:28:52Z","created_by":"import"}]}
{"id":"cass_memory_system-rwv7","title":"[P2] Add unit tests for top.ts command","description":"# Task: Unit tests for top.ts command (144 lines)\n\n## What to Test\n- [ ] Top-ranked bullets returned correctly\n- [ ] Ranking algorithm verified\n- [ ] Limit parameter works\n- [ ] Filter by scope/category\n- [ ] JSON output format correct\n\n## Files\n- Source: src/commands/top.ts (144 lines)\n- Test: test/top.test.ts (new)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T15:30:44.505792Z","updated_at":"2025-12-17T08:33:17.814095Z","closed_at":"2025-12-17T08:33:17.814095Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-rxd","title":"[Curator] buildHashCache - Pre-compute content hashes","description":"Build a hash cache for O(1) duplicate detection during curation.\n\nSignature:\nfunction buildHashCache(playbook: Playbook): Set<string>\n\nProcess:\n1. Initialize empty Set<string>\n2. For each bullet in playbook.bullets:\n   - Hash bullet.content using SHA-256\n   - Add hash to set\n3. Return set\n\nWhy hash caching?\n- Enables O(1) exact duplicate lookup\n- Called once at start of curation\n- Prevents expensive re-hashing for each add delta\n- Clean separation of hashing logic\n\nHash algorithm:\n- SHA-256 of normalized content\n- Normalization:\n  * Trim whitespace\n  * Lowercase\n  * Remove extra spaces\n  * Consistent encoding\n\nExample usage in curatePlaybook:\nThe hash cache is built once and passed to all add delta handlers.\n\nPerformance impact:\n- Without cache: O(n * m) where n=deltas, m=bullets\n- With cache: O(n + m) - linear time\n- Critical for large playbooks (100+ bullets)\n\nHash cache is READ-ONLY during delta processing.\nUpdated after successful adds in handleAddDelta.","status":"tombstone","priority":3,"issue_type":"task","created_at":"2025-12-07T21:45:07.428337Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-ryxn","title":"Enhance dedup threshold and playbook command locking","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-08T02:53:38.587472Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-s1hm","title":"Unit Tests: Playbook Management","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-08T01:23:02.386658Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-s578","title":"[CLI:doctor] applyFixes - Auto-fix recoverable issues","description":"Implements the applyFixes function that automatically repairs recoverable issues found by doctor.\n\nFUNCTION SIGNATURE:\n```typescript\ninterface FixableIssue {\n  id: string;\n  description: string;\n  category: string;\n  severity: 'warn' | 'fail';\n  fix: () => Promise<void>;\n}\n\nasync function applyFixes(\n  issues: FixableIssue[],\n  options: { interactive?: boolean }\n): Promise<void>\n```\n\nPURPOSE:\nAutomatically repairs common issues that are safe to fix without user data loss. Requires explicit user confirmation unless --yes flag provided.\n\nFIXABLE ISSUES:\n\n1. Missing Data Directory:\n   - Create directory with proper permissions\n   - Safe: no data loss risk\n   - Auto-fix: Yes\n\n2. Missing Playbook:\n   - Create empty playbook.json\n   - Safe: creates new file, doesn't overwrite\n   - Auto-fix: Yes\n\n3. Stale Cass Index:\n   - Run: cass rebuild-index\n   - Potentially slow (warn user)\n   - Auto-fix: With confirmation\n\n4. Invalid Config:\n   - Reset to defaults\n   - Save backup of old config\n   - Auto-fix: With confirmation\n\n5. Missing Diary Directory:\n   - Create directory structure\n   - Safe: no data loss\n   - Auto-fix: Yes\n\nNON-FIXABLE ISSUES (guidance only):\n- Missing API keys → provide setup instructions\n- Insufficient disk space → suggest cleanup\n- cass not installed → provide install link\n- Corrupted playbook → manual recovery needed\n\nIMPLEMENTATION WORKFLOW:\n\n```typescript\nasync function applyFixes(issues, options) {\n  if (issues.length === 0) {\n    console.log('No fixable issues found.');\n    return;\n  }\n\n  console.log(`Found ${issues.length} fixable issues:\\n`);\n  issues.forEach((issue, i) => {\n    console.log(`${i + 1}. ${issue.description}`);\n  });\n\n  if (options.interactive) {\n    const answer = await prompt('Apply all fixes? (y/n): ');\n    if (answer !== 'y') {\n      console.log('Aborted.');\n      return;\n    }\n  }\n\n  for (const issue of issues) {\n    try {\n      console.log(`Fixing: ${issue.description}...`);\n      await issue.fix();\n      console.log('  ✓ Fixed');\n    } catch (err) {\n      console.error(`  ✗ Failed: ${err.message}`);\n    }\n  }\n\n  console.log('\\nRe-running health check...');\n  // Run doctor again to verify fixes\n}\n```\n\nSAFETY MEASURES:\n- Dry-run mode: show what would be fixed\n- Backup before destructive changes\n- Atomic operations (temp file + rename)\n- Rollback on failure\n- Detailed logging\n\nINTERACTIVE PROMPTS:\n- Show issue description\n- Show proposed fix\n- Ask for confirmation per-issue or batch\n- Provide skip option\n- Show progress during fixes\n\nERROR HANDLING:\n- If fix fails, continue with remaining fixes\n- Log failures but don't abort\n- Provide rollback option if available\n- Re-run doctor after fixes to verify\n\nFIX CATEGORIES:\n1. SAFE (auto-apply):\n   - Create missing directories\n   - Create missing empty files\n   \n2. CAUTIOUS (prompt):\n   - Rebuild indexes\n   - Reset configs\n   - Clear caches\n\n3. MANUAL (guidance only):\n   - Install dependencies\n   - Configure API keys\n   - Free disk space\n\nDEPENDENCIES:\n- File system operations\n- Prompt library (readline/inquirer)\n- Backup utilities\n- Config reset functions\n\nSUCCESS CRITERIA:\n- Only fixes safe issues without data loss\n- Clear communication of what's being fixed\n- Rollback on failure\n- Re-validates after fixes\n- Handles partial failures gracefully","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:56:30.127390Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-sc7","title":"[Validator] shouldSkipValidation - Determine if validation needed","description":"Implement the shouldSkipValidation function - Heuristics to determine if validation is needed.\n\nSIGNATURE:\n```typescript\nfunction shouldSkipValidation(delta: PlaybookDelta, config: Config): boolean\n```\n\nSKIP VALIDATION IF:\n1. Delta type is not \"add\" (remove/edit operations)\n2. config.validationEnabled === false (validation disabled globally)\n3. Rule content is too short to validate meaningfully (< 20 chars)\n4. Rule is workspace-specific (less generalizable)\n5. Rule is in \"PITFALLS\" section (anti-patterns, different validation)\n\nIMPLEMENTATION:\n```typescript\nfunction shouldSkipValidation(delta: PlaybookDelta, config: Config): boolean {\n  // Check 1: Validation disabled in config\n  if (!config.validationEnabled) {\n    return true;\n  }\n\n  // Check 2: Only validate \"add\" deltas\n  if (delta.type !== \"add\") {\n    return true;\n  }\n\n  // Check 3: Content too short\n  if (delta.content.length < 20) {\n    return true;\n  }\n\n  // Check 4: Workspace-specific rules (less generalizable)\n  const workspaceIndicators = [\n    /this project/i,\n    /our codebase/i,\n    /in this workspace/i,\n    /for this team/i\n  ];\n  if (workspaceIndicators.some(pattern => pattern.test(delta.content))) {\n    return true;\n  }\n\n  // Check 5: PITFALLS section (different validation logic)\n  if (delta.section === \"PITFALLS\") {\n    return true;  // Could have separate pitfall validation\n  }\n\n  // Check 6: Generic rule detection\n  if (isGenericRule(delta.content)) {\n    return true;  // Too obvious to validate\n  }\n\n  return false;  // Validation needed\n}\n```\n\nWORKSPACE-SPECIFIC DETECTION:\nRules that reference:\n- \"This project\"\n- \"Our codebase\"\n- \"In this workspace\"\n- \"For this team\"\n- Specific project names\n\nThese are valid but don't need historical validation.\n\nPERFORMANCE OPTIMIZATION:\n- Fast heuristics avoid expensive operations\n- No I/O, no LLM calls\n- Pure function for easy testing\n- Runs before evidenceCountGate()\n\nWHY THIS MATTERS:\n- Avoids wasting resources on rules that don't need validation\n- Allows workspace-specific rules without false rejections\n- Improves performance by early filtering\n- Provides escape hatch for validation edge cases\n\nDEPENDENCIES:\n- isGenericRule() - Detect overly obvious rules\n- PlaybookDelta type\n- Config type\n\nLOCATION:\n- src/validator/skip-validation.ts","status":"tombstone","priority":3,"issue_type":"task","created_at":"2025-12-07T21:44:58.794611Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-sdt1","title":"Epic: Comprehensive Test Coverage","description":"# Epic: Comprehensive Test Coverage\n\n## Goal\nAchieve comprehensive test coverage for cass-memory with:\n1. Unit tests - Pure function tests WITHOUT mocks/fakes\n2. Integration tests - Cross-module tests with real dependencies\n3. E2E tests - Full CLI tests with detailed logging\n\n## Philosophy: No Mocks Where Possible\n- Test REAL behavior, not mocked behavior\n- Use actual file I/O with temp directories\n- Use actual YAML parsing/serialization\n- Only mock external services (LLM APIs) when absolutely necessary\n- Prefer integration tests over unit tests with mocks\n\n## Structure\n1. Test Infrastructure (fixtures, helpers, logging)\n2. Unit Tests - Per-module (scoring, playbook, config, etc.)\n3. Integration Tests - Cross-module (curator pipeline, reflect pipeline)\n4. E2E Tests - Full CLI commands with logging\n\n## Success Criteria\n- All exported functions have tests\n- All CLI commands have e2e tests\n- Test output includes detailed logging for debugging\n- No flaky tests (deterministic)\n- Tests run in <30 seconds total","status":"in_progress","priority":0,"issue_type":"epic","created_at":"2025-12-08T01:21:38.071226Z","updated_at":"2026-01-21T09:30:38.187498642Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-sdt1.1","title":"Testing: Coverage & CI instrumentation","description":"Goal: Make coverage measurable, repeatable, and CI-visible (without committing generated artifacts).\n\nContext\n- We have scripts/coverage.sh, but CI does not run coverage and there is no enforced threshold or artifact upload.\n- bun:test supports coverage but we avoid creating persistent repo artifacts.\n\nScope\n- CI coverage job + artifact upload (coverage.txt + summary.json)\n- Coverage gating (phased) and per-module targets\n\nNotes\n- Prefer real implementations; no network calls in CI.\n- Any artifacts must be uploaded, not committed.","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-16T10:19:05.809193Z","updated_at":"2025-12-17T08:09:10.650008Z","closed_at":"2025-12-17T08:09:10.650008Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-sdt1.1","depends_on_id":"cass_memory_system-sdt1","type":"parent-child","created_at":"2026-01-21T09:28:52Z","created_by":"import"}]}
{"id":"cass_memory_system-sdt1.1.1","title":"Fix coverage script: remove python dependency + stabilize artifacts","description":"Problem\n- `scripts/coverage.sh` currently shells out to `python` for timestamps; python is not guaranteed on dev/CI machines.\n\nScope\n- Replace python timestamp helper with `node -e` or portable `date` usage.\n- Ensure summary JSON is valid and includes exit code + duration + key totals.\n- Keep artifacts in a user-specified `LOG_DIR` and avoid writing into the repo.","notes":"Implemented python-free `now_ms()` via `bun -e` and rewrote summary generation to use `bun -e` + `JSON.stringify` for valid escaping. Script no longer requires python.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-16T10:29:42.233873Z","updated_at":"2025-12-16T16:39:49.242039Z","closed_at":"2025-12-16T16:39:49.242039Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-sdt1.1.1","depends_on_id":"cass_memory_system-sdt1.1","type":"parent-child","created_at":"2026-01-21T09:28:52Z","created_by":"import"}]}
{"id":"cass_memory_system-sdt1.1.2","title":"CI: add coverage job + upload artifacts","description":"Scope\n- Add a GitHub Actions job that runs coverage (either `bun run test:coverage` or `./scripts/coverage.sh`) and uploads artifacts (`coverage.txt`, `summary.json`).\n- Ensure coverage job runs on PRs and main branch pushes.\n\nNon-goals\n- Do not commit generated coverage artifacts to git.","notes":"Added a `coverage` job to `.github/workflows/ci.yml` that runs `./scripts/coverage.sh` with `LOG_DIR=${{ runner.temp }}/cm-coverage` and uploads the resulting artifacts via `actions/upload-artifact` (always()).","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-16T10:29:42.368526Z","updated_at":"2025-12-16T15:37:57.535485Z","closed_at":"2025-12-16T15:37:57.535485Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-sdt1.1.2","depends_on_id":"cass_memory_system-sdt1.1","type":"parent-child","created_at":"2026-01-21T09:28:52Z","created_by":"import"},{"issue_id":"cass_memory_system-sdt1.1.2","depends_on_id":"cass_memory_system-sdt1.1.1","type":"blocks","created_at":"2026-01-21T09:28:52Z","created_by":"import"}]}
{"id":"cass_memory_system-sdt1.1.3","title":"Coverage gating: phased thresholds + module targets","description":"Scope\n- Add CI enforcement for coverage thresholds in phases (e.g., start at current baseline, then ratchet).\n- Optionally add per-module minimums for critical modules (`src/cm.ts`, `src/commands/*`, `src/playbook.ts`).\n\nRationale\n- Prevent backsliding while we burn down uncovered code.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T10:29:42.502334Z","updated_at":"2025-12-17T08:09:10.474930Z","closed_at":"2025-12-17T08:09:10.474930Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-sdt1.1.3","depends_on_id":"cass_memory_system-sdt1.1","type":"parent-child","created_at":"2026-01-21T09:28:52Z","created_by":"import"},{"issue_id":"cass_memory_system-sdt1.1.3","depends_on_id":"cass_memory_system-sdt1.1.2","type":"blocks","created_at":"2026-01-21T09:28:52Z","created_by":"import"}]}
{"id":"cass_memory_system-sdt1.2","title":"Testing: Mockless unit/integration architecture","description":"Goal: eliminate runtime/module mocking and reduce test doubles by moving boundaries to dependency injection and deterministic in-process implementations.\n\nContext\n- Current tests use bun:test mock() and mock.module(\"ai\").\n- We want unit/integration tests that exercise real code paths without monkeypatching.\n\nScope\n- Replace mock.module(\"ai\") with injectable LLM provider interface.\n- Replace mock() usage with closure-based spies or real test implementations.\n- Keep tests offline/deterministic; no network calls in CI.\n","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-16T10:29:41.822587Z","updated_at":"2025-12-28T03:16:26.693556Z","closed_at":"2025-12-28T03:16:26.693556Z","close_reason":"All children closed: mock.module removed, LLM boundary refactored, bun mock() removed, CI guardrail added, cass boundary tests updated","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-sdt1.2","depends_on_id":"cass_memory_system-sdt1","type":"parent-child","created_at":"2026-01-21T09:28:52Z","created_by":"import"}]}
{"id":"cass_memory_system-sdt1.2.1","title":"Inventory and classify all mocks/fakes in test suite","description":"Scope\n- Enumerate uses of `mock()`, `mock.module()`, fake executables, and filesystem shims in `test/**`.\n- Classify each as: removable (replace with closure spy), boundary-injection (refactor src), or unavoidable external dependency.\n\nInventory (as of 2025-12-17)\n\n1) bun:test mocking\n- `mock()` / `mock.module()` usage: none found in `test/**` (removed from `test/utils.diary.test.ts`, `test/reflect.integration.test.ts`, `test/pipeline.integration.test.ts`, `test/utils.shutdown.test.ts`).\n- `spyOn()` usage: allowed (closure-style spy); present in various tests (e.g. `test/llm-with-retry.test.ts`).\n\n2) Fake executables / CLI stubs\n- `test/helpers/temp.ts` exports `makeCassStub()` (writes a small shell script and chmods it executable).\n  Used by:\n  - `test/cli-context.e2e.test.ts`\n  - `test/cli-reflect.e2e.test.ts`\n  - `test/new-user-onboarding.e2e.test.ts`\n  - `test/privacy.test.ts`\n  - `test/validate.test.ts`\n  Classification: boundary-injection preferred; keep only where we truly need process-level CLI behavior.\n  Plan: migrate non-CLI tests to `CassRunner` DI: `cass_memory_system-o3kq`.\n\n3) LLM stubs (offline/deterministic)\n- `CM_REFLECTOR_STUBS` env var used as deterministic reflector output in:\n  - `test/reflect.integration.test.ts`, `test/pipeline.integration.test.ts`, `test/orchestrator.test.ts`, `test/reflect.test.ts`\n  - `test/reflect-command.integration.test.ts`\n  - `test/*pipeline*.test.ts`, `test/*learning*.test.ts`, `test/ace-pipeline.e2e.test.ts`\n  Classification: boundary-injection (global env). Prefer `LLMIO` injection (`test/helpers/llm-shim.ts`) for unit/integration where possible.\n  Plan: converge tests onto explicit `LLMIO` injection path where feasible: `cass_memory_system-vvou`.\n\n4) Filesystem / env isolation helpers\n- `test/helpers/temp.ts`: `withTempDir`, `withTempCassHome` (real FS under OS tmp, optional KEEP_TEMP).\n- `test/config-security.test.ts`: uses real temp dirs and calls `git init` (external dependency).\n  Classification: acceptable real-FS isolation; `git` is an unavoidable external dependency in that particular test.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-16T10:29:42.640989Z","updated_at":"2025-12-17T01:44:10.380827Z","closed_at":"2025-12-17T01:44:10.380827Z","close_reason":"Inventory complete; removed remaining bun:test mock imports; follow-up tasks created (cass_memory_system-o3kq, cass_memory_system-vvou)","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-sdt1.2.1","depends_on_id":"cass_memory_system-sdt1.2","type":"parent-child","created_at":"2026-01-21T09:28:52Z","created_by":"import"}]}
{"id":"cass_memory_system-sdt1.2.2","title":"Refactor LLM boundary for dependency injection (no mock.module)","description":"Problem\n- Tests currently monkeypatch the `ai` module via `mock.module(\"ai\")`, coupling tests to module loader behavior.\n\nScope\n- Introduce an explicit LLM provider interface for `src/llm.ts` (or a thin adapter) with a default production provider.\n- Update call sites to pass the provider (directly or via a central factory) so tests can pass a deterministic provider without monkeypatching.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-16T10:29:42.767877Z","updated_at":"2025-12-17T00:08:35.664029Z","closed_at":"2025-12-17T00:08:35.664029Z","close_reason":"Added injectable LLMIO boundary in src/llm.ts and rewrote LLM tests/helpers to stop using mock.module(\"ai\")","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-sdt1.2.2","depends_on_id":"cass_memory_system-sdt1.2","type":"parent-child","created_at":"2026-01-21T09:28:52Z","created_by":"import"}]}
{"id":"cass_memory_system-sdt1.2.3","title":"Rewrite tests to remove bun mock() usage","description":"Scope\n- Replace `mock()` spies with closure-based spies/counters in tests (e.g., `llm-with-retry.test.ts`, `config-security.test.ts`).\n- Replace module monkeypatch tests (`llm.mocked.test.ts`, `test/helpers/llm-shim.ts`) with injected providers/fixtures from the LLM refactor task.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-16T10:29:42.904177Z","updated_at":"2025-12-17T00:13:32.425235Z","closed_at":"2025-12-17T00:13:32.425235Z","close_reason":"Removed remaining bun:test mock() usage from tests (closure-based counters) and ensured rg mock/module checks are clean","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-sdt1.2.3","depends_on_id":"cass_memory_system-sdt1.2","type":"parent-child","created_at":"2026-01-21T09:28:52Z","created_by":"import"},{"issue_id":"cass_memory_system-sdt1.2.3","depends_on_id":"cass_memory_system-sdt1.2.2","type":"blocks","created_at":"2026-01-21T09:28:52Z","created_by":"import"}]}
{"id":"cass_memory_system-sdt1.2.4","title":"CI guardrail: fail if bun mock usage reappears","description":"Scope\n- Add a fast check (CI step or test) that fails if `test/**` contains `mock(` or `mock.module(`.\n- Ensure the rule is documented (why, what to do instead).\n\nRationale\n- Prevent regression back into module monkeypatching.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T10:29:43.044597Z","updated_at":"2025-12-17T00:16:49.703696Z","closed_at":"2025-12-17T00:16:49.703696Z","close_reason":"Added CI guardrail step that fails if test/** contains mock() or mock.module(), with guidance to use closure spies or injected providers","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-sdt1.2.4","depends_on_id":"cass_memory_system-sdt1.2","type":"parent-child","created_at":"2026-01-21T09:28:52Z","created_by":"import"},{"issue_id":"cass_memory_system-sdt1.2.4","depends_on_id":"cass_memory_system-sdt1.2.3","type":"blocks","created_at":"2026-01-21T09:28:52Z","created_by":"import"}]}
{"id":"cass_memory_system-sdt1.2.5","title":"Cass boundary tests: reduce reliance on fake executables","description":"Context\n- Some tests use a fake `cass` executable stub to simulate CLI outputs.\n\nScope\n- Introduce an injectable runner for `src/cass.ts` (if not already) so tests can use recorded fixtures (static JSON) without creating fake binaries.\n- Keep a small number of true integration tests that can run only when cass is installed (opt-in; not required for CI).","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-16T10:29:43.189577Z","updated_at":"2025-12-17T00:59:11.246136Z","closed_at":"2025-12-17T00:59:11.246136Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-sdt1.2.5","depends_on_id":"cass_memory_system-sdt1.2","type":"parent-child","created_at":"2026-01-21T09:28:52Z","created_by":"import"}]}
{"id":"cass_memory_system-sdt1.2.6","title":"Add guard to prevent bun:test mock usage","description":"Add a test/guard that fails when bun:test mocking APIs (mock(), mock.module(), etc.) are imported/used in test/**, to keep the suite mockless going forward.","notes":"Done: added guard test test/no-mocks.guard.test.ts to fail if bun:test mock is imported/required; ran KEEP_TEMP=1 bun test test/no-mocks.guard.test.ts (pass). Agent Mail not configured (BEADS_AGENT_MAIL_URL not set).","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-18T04:03:44.729871145Z","updated_at":"2025-12-18T04:05:38.914158748Z","closed_at":"2025-12-18T04:05:38.914158748Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-sdt1.2.6","depends_on_id":"cass_memory_system-sdt1.2","type":"parent-child","created_at":"2026-01-21T09:28:52Z","created_by":"import"}]}
{"id":"cass_memory_system-sdt1.2.7","title":"Fix CI mock guard false positive from validate tests","description":"CI guardrail greps for mock.module( in test/** and currently flags a string literal in test/validate.test.ts. Update test data (or guard) so CI doesn't fail while still forbidding actual bun:test mocking.","notes":"Fixing now: update test/validate.test.ts refinement string so CI grep guardrail does not trip. Agent Mail not configured (BEADS_AGENT_MAIL_URL not set).\\n\\nDone:\\n- Replaced mock.module() string literal with \"module-level mocking\" wording.\\n- Verified CI guard patterns find no matches: rg -n \"mock\\\\.module\\\\(\" test => none.\\n- Ran KEEP_TEMP=1 bun test test/validate.test.ts (pass).","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-18T04:13:25.821085262Z","updated_at":"2025-12-18T04:14:17.051649688Z","closed_at":"2025-12-18T04:14:17.051649688Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-sdt1.2.7","depends_on_id":"cass_memory_system-sdt1.2","type":"parent-child","created_at":"2026-01-21T09:28:52Z","created_by":"import"}]}
{"id":"cass_memory_system-sdt1.2.8","title":"Update CI mock guard to use no-mocks guard test","description":"Replace the CI ripgrep/grep mock guardrail (which can false-positive on string literals) with a deterministic bun test guard (test/no-mocks.guard.test.ts).","notes":"Starting: will replace CI grep-based mock guardrail with bun test/no-mocks.guard.test.ts to avoid string-literal false positives. Agent Mail not configured (BEADS_AGENT_MAIL_URL not set).\\n\\nDone:\\n- .github/workflows/ci.yml now runs: bun test test/no-mocks.guard.test.ts\\n- Verified locally: KEEP_TEMP=1 bun test test/no-mocks.guard.test.ts test/docs.test.ts (pass).","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-18T04:20:29.664318697Z","updated_at":"2025-12-18T04:21:03.651567663Z","closed_at":"2025-12-18T04:21:03.651567663Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-sdt1.2.8","depends_on_id":"cass_memory_system-sdt1.2","type":"parent-child","created_at":"2026-01-21T09:28:52Z","created_by":"import"}]}
{"id":"cass_memory_system-sdt1.2.9","title":"Harden no-mocks guard + deterministic test cleanup","notes":"Starting: fresh-eyes audit of mockless test refactor + new tests (no-mocks guard, KEEP_TEMP cleanup) and CI workflow changes; will fix any obvious runtime/test bugs. Agent Mail not configured here (BEADS_AGENT_MAIL_URL not set).\n\nDone:\n- Hardened no-mocks guard to also ban namespace imports from bun:test (prevents accessing mock APIs via `import * as`).\n- Fixed `withPatchedDateNow` in progress tests to restore Date.now correctly for sync + async callbacks.\n\nValidation:\n- bun run typecheck\n- bun test test/progress.test.ts\n- bun test test/no-mocks.guard.test.ts\n- KEEP_TEMP=1 bun test test/info-examples.test.ts\n- KEEP_TEMP=1 bun test test/onboard.test.ts\n- KEEP_TEMP=1 bun test test/serve-stdio.e2e.test.ts","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-18T07:07:13.043605973Z","updated_at":"2025-12-18T07:20:05.094467001Z","closed_at":"2025-12-18T07:20:05.094467001Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-sdt1.2.9","depends_on_id":"cass_memory_system-sdt1.2","type":"parent-child","created_at":"2026-01-21T09:28:52Z","created_by":"import"}]}
{"id":"cass_memory_system-sdt1.3","title":"Testing: E2E scripts + artifacted logging","description":"Goal: have repeatable, hermetic end-to-end scripts that exercise the compiled/ts CLI and produce rich, structured artifacts for debugging.\n\nContext\n- We have `scripts/e2e-smoke.sh`, but it depends on `python` (missing locally/CI) and includes cleanup deletes.\n- We want CI-runnable scripts with consistent JSONL step logs + captured stdout/stderr artifacts.\n\nScope\n- Make scripts self-contained (bun/node only).\n- Standardize artifact layout and redaction.\n- Add CI job to run scripts and upload artifacts.","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-16T10:29:41.963020Z","updated_at":"2025-12-17T00:39:30.344039Z","closed_at":"2025-12-17T00:39:30.344039Z","close_reason":"E2E scripts/logging track complete: python-free scripts/e2e-smoke.sh with structured step+artifact logging, expanded offline/degraded coverage incl serve contract, and CI job uploads artifacts","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-sdt1.3","depends_on_id":"cass_memory_system-sdt1","type":"parent-child","created_at":"2026-01-21T09:28:52Z","created_by":"import"}]}
{"id":"cass_memory_system-sdt1.3.1","title":"Fix e2e smoke script: remove python dependency + deletion cleanup","description":"Problem\n- `scripts/e2e-smoke.sh` uses `python` for timestamps/JSON escaping and `rm -f` for cleanup.\n\nScope\n- Replace python helpers with node/jq/portable shell equivalents.\n- Avoid deleting temp files; keep artifacts inside `LOG_DIR` for debugging.\n- Ensure it still emits JSONL per step and raw stdout/stderr artifacts.","notes":"Rewrote `scripts/e2e-smoke.sh` to be python-free and bun-only:\n- Replaced `python` timestamp/JSON escaping/argv encoding with `bun -e` helpers.\n- Removed per-step mktemp + `rm -f` cleanup by writing stdout/stderr directly to `LOG_DIR/artifacts/<step>.{out,err}`.\n- Replaced `node -e` bullet-id extraction with a `bun -e` parser (handles array or common envelope shapes).\n\nScript now preserves artifacts for debugging and does not require cleanup for correctness.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-16T10:29:43.328746Z","updated_at":"2025-12-16T15:51:37.051780Z","closed_at":"2025-12-16T15:51:37.051780Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-sdt1.3.1","depends_on_id":"cass_memory_system-sdt1.3","type":"parent-child","created_at":"2026-01-21T09:28:52Z","created_by":"import"}]}
{"id":"cass_memory_system-sdt1.3.2","title":"Expand e2e scripts to cover full CLI scenario matrix (offline-first)","description":"Scope\n- Extend the smoke script (or add companion script) to cover core commands and failure modes in offline/degraded operation:\n  - init, doctor, context, playbook add/list, mark, stats/top/similar, validate, outcome/audit, undo/forget/stale (as applicable).\n- Add assertions for JSON output shape where `--json` is supported.\n- Keep artifacts per-step for easy debugging.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T10:29:43.459705Z","updated_at":"2025-12-17T00:33:09.417465Z","closed_at":"2025-12-17T00:33:09.417465Z","close_reason":"Expanded scripts/e2e-smoke.sh to be offline-first with per-step JSONL + artifacts, added coverage for core top-level commands (incl. degrade/failure assertions)","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-sdt1.3.2","depends_on_id":"cass_memory_system-sdt1.3","type":"parent-child","created_at":"2026-01-21T09:28:52Z","created_by":"import"},{"issue_id":"cass_memory_system-sdt1.3.2","depends_on_id":"cass_memory_system-sdt1.3.1","type":"blocks","created_at":"2026-01-21T09:28:52Z","created_by":"import"}]}
{"id":"cass_memory_system-sdt1.3.3","title":"CI: run e2e scripts and upload artifacts","description":"Scope\n- Add a CI job that runs the e2e script(s) and uploads `LOG_DIR` artifacts on failure (and optionally on success).\n- Ensure failures are actionable by surfacing `steps.jsonl` in artifacts.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T10:29:43.595658Z","updated_at":"2025-12-17T00:34:58.548999Z","closed_at":"2025-12-17T00:34:58.548999Z","close_reason":"Added e2e-scripts CI job to run scripts/e2e-smoke.sh with fixed LOG_DIR, upload artifacts always, and print steps.jsonl on failure","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-sdt1.3.3","depends_on_id":"cass_memory_system-sdt1.3","type":"parent-child","created_at":"2026-01-21T09:28:52Z","created_by":"import"},{"issue_id":"cass_memory_system-sdt1.3.3","depends_on_id":"cass_memory_system-sdt1.3.1","type":"blocks","created_at":"2026-01-21T09:28:52Z","created_by":"import"},{"issue_id":"cass_memory_system-sdt1.3.3","depends_on_id":"cass_memory_system-sdt1.3.2","type":"blocks","created_at":"2026-01-21T09:28:52Z","created_by":"import"}]}
{"id":"cass_memory_system-sdt1.3.4","title":"E2E: serve command contract test (start, hit, shutdown)","description":"Scope\n- Add an e2e script step/test that starts `cm serve` on an ephemeral port, hits the health/info endpoint, then shuts down cleanly.\n- Capture request/response logs as artifacts.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-16T10:29:43.732498Z","updated_at":"2025-12-17T00:38:48.629255Z","closed_at":"2025-12-17T00:38:48.629255Z","close_reason":"Added cm serve contract step to scripts/e2e-smoke.sh: choose free port, POST tools/list JSON-RPC, record req/resp JSON, bounded shutdown with captured server stdout/stderr artifacts","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-sdt1.3.4","depends_on_id":"cass_memory_system-sdt1.3","type":"parent-child","created_at":"2026-01-21T09:28:52Z","created_by":"import"}]}
{"id":"cass_memory_system-sdt1.4","title":"Testing: Coverage burn-down to 100%","description":"Goal: move from current coverage targets (~80/80/70 per README) to effectively complete unit coverage for core modules, with integration/e2e filling workflow gaps.\n\nStrategy\n- Establish a baseline and make it visible in CI.\n- Identify top uncovered functions/modules and burn down systematically.\n- Raise thresholds in phases to avoid destabilizing CI.","status":"in_progress","priority":2,"issue_type":"epic","created_at":"2025-12-16T10:29:42.100999Z","updated_at":"2026-01-07T05:38:28.469208602Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-sdt1.4","depends_on_id":"cass_memory_system-6xl2","type":"blocks","created_at":"2026-01-21T09:28:52Z","created_by":"import"},{"issue_id":"cass_memory_system-sdt1.4","depends_on_id":"cass_memory_system-bnpt","type":"blocks","created_at":"2026-01-21T09:28:52Z","created_by":"import"},{"issue_id":"cass_memory_system-sdt1.4","depends_on_id":"cass_memory_system-i16d","type":"blocks","created_at":"2026-01-21T09:28:52Z","created_by":"import"},{"issue_id":"cass_memory_system-sdt1.4","depends_on_id":"cass_memory_system-sdt1","type":"parent-child","created_at":"2026-01-21T09:28:52Z","created_by":"import"}]}
{"id":"cass_memory_system-sdt1.4.1","title":"Capture baseline coverage + identify top uncovered modules","description":"Scope\n- Run coverage (locally/CI) and record the current totals and top uncovered files/functions.\n- Create follow-up child tasks for the biggest gaps (grouped by module).\n\nNote\n- This task is about measurement + planning, not fixing coverage itself.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T10:29:43.868636Z","updated_at":"2025-12-16T16:40:40.574112Z","closed_at":"2025-12-16T16:40:40.574112Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-sdt1.4.1","depends_on_id":"cass_memory_system-sdt1.1.2","type":"blocks","created_at":"2026-01-21T09:28:52Z","created_by":"import"},{"issue_id":"cass_memory_system-sdt1.4.1","depends_on_id":"cass_memory_system-sdt1.4","type":"parent-child","created_at":"2026-01-21T09:28:52Z","created_by":"import"}]}
{"id":"cass_memory_system-sdt1.4.10","title":"[Coverage] Make serve stdio/http transports testable in-process","description":"src/commands/serve.ts remains low coverage because serveStdio/serveHttp start long-lived transports that existing unit tests don't exercise. Refactor serveCommand to accept injected stdio streams and to expose/return an HTTP server handle so tests can send requests and close cleanly.","notes":"Completed: serveCommand now supports DI for stdio/http (inject streams; http exposes server+url and allows port 0). Added in-process tests covering stdio framing, HTTP POST handling (ping/notifications/bad JSON/payload limit), and routeRequest tools/call + resources/read without spawning. Targeted coverage run shows src/commands/serve.ts ~83% lines / ~89% funcs (KEEP_TEMP=1 bun test --coverage test/serve-stdio.e2e.test.ts).","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-18T03:05:57.070329608Z","updated_at":"2025-12-18T03:22:05.183546634Z","closed_at":"2025-12-18T03:22:05.183546634Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-sdt1.4.10","depends_on_id":"cass_memory_system-sdt1.4","type":"parent-child","created_at":"2026-01-21T09:28:52Z","created_by":"import"}]}
{"id":"cass_memory_system-sdt1.4.11","title":"Raise CI coverage thresholds to 80% (phase 1)","description":"Update CI coverage gate (COVERAGE_MIN_FUNCS/LINES) from 70/70 to 80/80 now that current totals are ~83.55 funcs / 80.18 lines.","notes":"Starting: raising CI coverage thresholds to 80/80 (current baseline from scripts/coverage.sh is funcs=83.55, lines=80.18). Agent Mail not configured (BEADS_AGENT_MAIL_URL not set).\\n\\nDone:\\n- .github/workflows/ci.yml: COVERAGE_MIN_FUNCS/LINES now 80/80.\\n- Verified against /tmp/cm-coverage-check/summary.json: Coverage gate passed: funcs=83.55 lines=80.18.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T04:34:13.946550834Z","updated_at":"2025-12-18T04:34:56.012676941Z","closed_at":"2025-12-18T04:34:56.012676941Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-sdt1.4.11","depends_on_id":"cass_memory_system-sdt1.4","type":"parent-child","created_at":"2026-01-21T09:28:52Z","created_by":"import"}]}
{"id":"cass_memory_system-sdt1.4.12","title":"Increase src/cm.ts coverage by exercising command actions in-process","description":"Bun coverage currently shows very low coverage for src/cm.ts because many E2E tests spawn child processes (not counted). Add in-process tests that run commander parseAsync for a representative set of commands to cover the CLI wiring and increase coverage headroom.","notes":"Starting: will add in-process parseAsync tests to execute cm.ts command actions and improve src/cm.ts coverage (E2E child-process runs do not count). Agent Mail not configured (BEADS_AGENT_MAIL_URL not set).","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T04:36:07.927759890Z","updated_at":"2025-12-18T05:11:30.752046774Z","closed_at":"2025-12-18T05:11:30.752046774Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-sdt1.4.12","depends_on_id":"cass_memory_system-sdt1.4","type":"parent-child","created_at":"2026-01-21T09:28:52Z","created_by":"import"}]}
{"id":"cass_memory_system-sdt1.4.13","title":"Increase src/commands/privacy.ts coverage (human output + errors)","description":"Add deterministic tests for src/commands/privacy.ts covering: human output (status/enable/disable/allow/deny) and missing-arg errors for allow/deny. Keep tests offline (cass stub/runner) and stable output (NO_COLOR + no-emoji).","notes":"Done: expanded test/privacy.test.ts to cover human-output branches (status/enable/disable/allow/deny), missing-arg JSON errors (allow/deny), invalid --days validation, and enable-discovered-agents path. Verified with bun run typecheck + KEEP_TEMP=1 bun test test/privacy.test.ts.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T06:22:52.620582656Z","updated_at":"2025-12-18T06:32:02.268729204Z","closed_at":"2025-12-18T06:32:02.268729204Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-sdt1.4.13","depends_on_id":"cass_memory_system-sdt1.4","type":"parent-child","created_at":"2026-01-21T09:28:52Z","created_by":"import"}]}
{"id":"cass_memory_system-sdt1.4.14","title":"Increase src/commands/stale.ts coverage (human output + errors)","description":"Add deterministic tests for src/commands/stale.ts covering: human output with stale bullets (including last-feedback branches + Next actions summary) and input-validation errors (invalid --days / invalid --scope). Keep tests offline/stable with NO_COLOR + no-emoji, and manage process.exitCode in error tests.","notes":"Done: expanded test/stale.test.ts to cover human output with stale bullets (including last-feedback branches + Next actions summary) and input validation errors (invalid --days / invalid --scope). Also updated test/helpers/git.ts cleanup to honor KEEP_TEMP so targeted tests can run without deleting temp repos. Verified with bun run typecheck + KEEP_TEMP=1 bun test test/stale.test.ts.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T06:35:57.701755957Z","updated_at":"2025-12-18T06:40:11.307682802Z","closed_at":"2025-12-18T06:40:11.307682802Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-sdt1.4.14","depends_on_id":"cass_memory_system-sdt1.4","type":"parent-child","created_at":"2026-01-21T09:28:52Z","created_by":"import"}]}
{"id":"cass_memory_system-sdt1.4.15","title":"[Coverage] Burn down low-coverage core modules (cass/semantic/diary)","description":"Raise overall line coverage by targeting the current lowest-coverage core modules (src/cass.ts, src/semantic.ts, src/diary.ts) with deterministic, mockless tests (using cass stubs and model=none branches).","notes":"Completed targeted coverage burn-down.\n\nCoverage runs:\n- Baseline: /tmp/cm-coverage-now/summary.json (All files: funcs 85.27%, lines 81.81%)\n- After: /tmp/cm-coverage-after-sdt1.4.15/summary.json (All files: funcs 85.77%, lines 82.30%)\n\nModule highlights:\n- src/diary.ts: 60.41% -> 76.36% lines (added tests for formatRawSession, generateDiaryFast/generateDiary fast path, processed-log index)\n- src/semantic.ts: 66.47% -> 68.65% lines (added cache + similarity + model=none embedding path tests)\n- src/cass.ts: added tests for wrapper hits + remoteCass degraded paths\n\nValidation:\n- bun run typecheck\n- LOG_DIR=/tmp/cm-coverage-after-sdt1.4.15 ./scripts/coverage.sh (full suite)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T08:38:46.807654577Z","updated_at":"2025-12-18T08:49:25.602179771Z","closed_at":"2025-12-18T08:49:25.602179771Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-sdt1.4.15","depends_on_id":"cass_memory_system-sdt1.4","type":"parent-child","created_at":"2026-01-21T09:28:52Z","created_by":"import"}]}
{"id":"cass_memory_system-sdt1.4.16","title":"Raise CI coverage thresholds to 85 funcs / 82 lines (phase 2)","description":"Bump CI coverage gate after recent burn-down: set COVERAGE_MIN_FUNCS=85 and COVERAGE_MIN_LINES=82 (phase 2), keeping headroom based on latest scripts/coverage.sh totals.","notes":"Updated CI coverage job thresholds to funcs>=85 and lines>=82 based on /tmp/cm-coverage-after-sdt1.4.15/summary.json totals (85.77 / 82.30). Verified gate script passes against that summary.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T08:50:19.276013469Z","updated_at":"2025-12-18T08:50:50.069692440Z","closed_at":"2025-12-18T08:50:50.069692440Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-sdt1.4.16","depends_on_id":"cass_memory_system-sdt1.4","type":"parent-child","created_at":"2026-01-21T09:28:52Z","created_by":"import"}]}
{"id":"cass_memory_system-sdt1.4.17","title":"Increase src/commands/similar.ts coverage (text output + validation errors)","description":"Add deterministic tests for similar command text output (no matches + matches) and input validation error paths, keeping keyword mode (no model downloads).","notes":"Completed similar.ts coverage expansion.\n\nCoverage runs:\n- Before: /tmp/cm-coverage-after-sdt1.4.15/summary.json (All files: funcs 85.77%, lines 82.30%)\n- After: /tmp/cm-coverage-after-sdt1.4.17/summary.json (All files: funcs 85.77%, lines 82.85%)\n\nModule highlight:\n- src/commands/similar.ts: lines 57.24% -> 92.41% (added tests for text output, no-matches tip, and JSON error payloads; plus input validation cases).\n\nValidation:\n- bun run typecheck\n- LOG_DIR=/tmp/cm-coverage-after-sdt1.4.17 ./scripts/coverage.sh","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T08:53:04.639377545Z","updated_at":"2025-12-18T08:56:38.045489863Z","closed_at":"2025-12-18T08:56:38.045489863Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-sdt1.4.17","depends_on_id":"cass_memory_system-sdt1.4","type":"parent-child","created_at":"2026-01-21T09:28:52Z","created_by":"import"}]}
{"id":"cass_memory_system-sdt1.4.18","title":"Cover helper assertions utilities (test/helpers/assertions.ts)","description":"Exercise test/helpers/assertions.ts helpers (expectValidPlaybook/Bullet/Config + file assertions) via existing test suite to lift overall funcs/lines and reduce the 0%-covered helper drag on CI coverage totals.","notes":"Completed helper assertion coverage.\n\nCoverage runs:\n- Before: /tmp/cm-coverage-after-sdt1.4.17/summary.json (All files: funcs 85.77%, lines 82.85%)\n- After: /tmp/cm-coverage-after-sdt1.4.18/summary.json (All files: funcs 87.34%, lines 84.05%)\n\nModule highlight:\n- test/helpers/assertions.ts: funcs 0% -> 100%, lines 11.94% -> 87.69% (now exercised via test/types.test.ts)\n\nValidation:\n- bun run typecheck\n- LOG_DIR=/tmp/cm-coverage-after-sdt1.4.18 ./scripts/coverage.sh","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T09:00:54.057258302Z","updated_at":"2025-12-18T09:04:00.819314190Z","closed_at":"2025-12-18T09:04:00.819314190Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-sdt1.4.18","depends_on_id":"cass_memory_system-sdt1.4","type":"parent-child","created_at":"2026-01-21T09:28:52Z","created_by":"import"}]}
{"id":"cass_memory_system-sdt1.4.19","title":"Raise CI coverage thresholds to 87 funcs / 83 lines (phase 3)","description":"With current coverage totals at 87.34% funcs / 84.05% lines (see /tmp/cm-coverage-after-sdt1.4.18/summary.json), raise CI gate to funcs>=87 and lines>=83 to lock in progress with reasonable buffer.","notes":"Updated CI coverage thresholds to funcs>=87 and lines>=83 (Phase 3) and verified gate passes against /tmp/cm-coverage-after-sdt1.4.18/summary.json totals (87.34 / 84.05).","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T09:04:10.383757505Z","updated_at":"2025-12-18T09:04:45.823079409Z","closed_at":"2025-12-18T09:04:45.823079409Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-sdt1.4.19","depends_on_id":"cass_memory_system-sdt1.4","type":"parent-child","created_at":"2026-01-21T09:28:52Z","created_by":"import"}]}
{"id":"cass_memory_system-sdt1.4.2","title":"Coverage burn-down: CLI commands (src/commands/*)","description":"Scope\n- Add/adjust unit/integration tests for command handlers to cover error paths and JSON output shape.\n- Focus on pure logic (argument parsing, output formatting, file IO boundaries) without bun mocks.","status":"in_progress","priority":1,"issue_type":"task","created_at":"2025-12-16T10:29:44.001803Z","updated_at":"2026-01-21T22:30:27.796599376Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-sdt1.4.2","depends_on_id":"cass_memory_system-sdt1.4","type":"parent-child","created_at":"2026-01-21T09:28:52Z","created_by":"import"},{"issue_id":"cass_memory_system-sdt1.4.2","depends_on_id":"cass_memory_system-sdt1.4.1","type":"blocks","created_at":"2026-01-21T09:28:52Z","created_by":"import"}],"comments":[{"id":1,"issue_id":"cass_memory_system-sdt1.4.2","author":"Dicklesworthstone","text":"Coverage improvements committed: stale.ts→100%, privacy.ts→96%, project.ts→96%, init.ts→72%. Tests: 2363 passing. Remaining low coverage: serve.ts 68%, onboard.ts 68%.","created_at":"2026-01-21T10:21:27Z"},{"id":2,"issue_id":"cass_memory_system-sdt1.4.2","author":"Dicklesworthstone","text":"Coverage improvements completed:\n\n**serve.ts**: 44% → 58% lines\n- Added tests for cm://playbook and cm://outcomes resources\n- Added validation tests for memory_search, cm_context, memory_reflect, cm_outcome\n- Added successful tool call tests (memory_search scopes, cm_feedback, cm_outcome)\n\n**onboard.ts**: 70.72% → 71.59% lines (maintained ~71%)\n- Added tests for template mode text error handling\n- Added sample text mode filtering tests\n- Added status with gaps in text mode test\n- Added guided flag JSON test\n\n58 serve tests passing, 45 onboard tests passing.","created_at":"2026-01-21T18:50:35Z"},{"id":3,"issue_id":"cass_memory_system-sdt1.4.2","author":"Dicklesworthstone","text":"Coverage improvements for audit.ts:\n\n**audit.ts**: 72.73% → 77.92% lines\n- Added test for trauma scan mode with found candidates (human-readable output)\n- Added test for playbook errors (triggers error catch block)\n- Error handling catch block (lines 175-182) now covered\n\n**Note on init.ts**: Existing tests already cover 72.44% lines. The uncovered paths are mainly interactive TTY prompts (promptYesNo, runTraumaScan) which are hard to test without mocking stdin/stdout TTY.\n\n12 audit tests passing.","created_at":"2026-01-21T21:06:07Z"},{"id":4,"issue_id":"cass_memory_system-sdt1.4.2","author":"Dicklesworthstone","text":"Coverage improvements for serve.ts (79.58% → 80.88%) and doctor.ts (81.94% → 83.32%). Added 20 new tests: serveCommand validation, memory_reflect params, cm_context/cm_feedback validation, repo structure, trauma/sanitization checks. 90 tests passing. Overall: 85.60% functions, 84.96% lines.","created_at":"2026-01-21T22:30:27Z"}]}
{"id":"cass_memory_system-sdt1.4.20","title":"Cover remaining test helpers (cass-shim + cli-runner)","description":"Reduce coverage drag from 0%-covered test helpers by exercising test/helpers/cass-shim.ts and fixing+covering test/helpers/cli-runner.ts (currently points at dist/index.js).","notes":"Implementing coverage + correctness improvements for test helpers:\n- Add unit tests for cass shim behaviors (limit/workspace/agent filtering, handlers, errors, index state).\n- Fix cli-runner helper to run src/cm.ts (not non-existent dist/index.js) and add a few smoke tests for runCLI/parseJSONOutput/assertCLISuccess.\n\nVerification:\n- Baseline (/tmp/cm-coverage-after-sdt1.4.18/summary.json): funcs 87.34%, lines 84.05%\n- After (/tmp/cm-coverage-after-sdt1.4.20/summary.json): funcs 89.73%, lines 86.46%\n- test/helpers/cli-runner.ts: 0%→77.78% funcs, 5.71%→86.67% lines\n- test/helpers/cass-shim.ts: 0%→75.76% funcs, 8.96%→82.61% lines\n- Validation: bun run typecheck + bun test","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T09:08:46.787224386Z","updated_at":"2025-12-18T09:23:02.387098148Z","closed_at":"2025-12-18T09:23:02.387098148Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-sdt1.4.20","depends_on_id":"cass_memory_system-sdt1.4","type":"parent-child","created_at":"2026-01-21T09:28:52Z","created_by":"import"}]}
{"id":"cass_memory_system-sdt1.4.21","title":"Increase coverage for context command","description":"src/commands/context.ts is a major coverage drag (~63% lines). Add focused tests for tricky branches (safeDeprecatedPatternMatcher, semantic fallback paths, markdown output, context-log append + sanitization, degraded cass handling) without mocks.","notes":"Implemented targeted in-process coverage for src/commands/context.ts (no mocks):\n- Added deterministic tests in test/cli-context.e2e.test.ts covering:\n  - Embedding-cache load path (no model download)\n  - Progress event emission (semantic_embeddings + cass_search)\n  - Markdown output path (format=markdown)\n  - Deprecated pattern ReDoS guard branches (literal match, long/unsafe/invalid regex)\n  - Context usage logging w/ sanitization (logContext + extraPatterns)\n  - Input validation JSON errors (and format override behavior)\n\nCoverage delta (scripts/coverage.sh):\n- Baseline (/tmp/cm-coverage-after-sdt1.4.20/summary.json): funcs 89.73%, lines 86.46%\n- After (/tmp/cm-coverage-after-sdt1.4.21/summary.json): funcs 89.88%, lines 86.80%\n- src/commands/context.ts: 77.27%→88.64% funcs, 63.41%→84.34% lines","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T09:23:24.555172105Z","updated_at":"2025-12-18T09:43:40.062644187Z","closed_at":"2025-12-18T09:43:40.062644187Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-sdt1.4.21","depends_on_id":"cass_memory_system-sdt1.4","type":"parent-child","created_at":"2026-01-21T09:28:52Z","created_by":"import"}]}
{"id":"cass_memory_system-sdt1.4.3","title":"Coverage burn-down: core modules (playbook/config/tracking/outcome)","description":"Scope\n- Add unit tests for uncovered branches in the core modules that drive most workflows: playbook/config/tracking/outcome/audit/output/sanitize.\n- Prefer real fixtures and deterministic filesystem operations.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T10:29:44.141016Z","updated_at":"2025-12-28T05:19:35.825347Z","closed_at":"2025-12-28T05:19:35.825347Z","close_reason":"Coverage improved: playbook 92.44%→97.62%, output 97.32%→98.66%, sanitize 96.24%→97.74%. Added tests for removeFromBlockedLog, agentIcon (aider/pi_agent), formatCheckStatusBadge (warn/fail), and verifySanitization heuristics.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-sdt1.4.3","depends_on_id":"cass_memory_system-sdt1.4","type":"parent-child","created_at":"2026-01-21T09:28:52Z","created_by":"import"},{"issue_id":"cass_memory_system-sdt1.4.3","depends_on_id":"cass_memory_system-sdt1.4.1","type":"blocks","created_at":"2026-01-21T09:28:52Z","created_by":"import"}]}
{"id":"cass_memory_system-sdt1.4.4","title":"Coverage burn-down: pipelines (curate/reflect/orchestrator)","description":"Scope\n- Add integration tests that exercise curator/reflector/orchestrator flows end-to-end in-process (no network).\n- Ensure failure modes are covered (missing cass, missing LLM, malformed sessions).","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T10:29:44.276677Z","updated_at":"2025-12-28T02:46:19.505668Z","closed_at":"2025-12-28T02:46:19.505668Z","close_reason":"Added 17 integration tests for pipeline failure modes covering malformed sessions, missing cass, LLM unavailable, curate/reflect errors","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-sdt1.4.4","depends_on_id":"cass_memory_system-sdt1.4","type":"parent-child","created_at":"2026-01-21T09:28:52Z","created_by":"import"},{"issue_id":"cass_memory_system-sdt1.4.4","depends_on_id":"cass_memory_system-sdt1.4.1","type":"blocks","created_at":"2026-01-21T09:28:52Z","created_by":"import"}]}
{"id":"cass_memory_system-sdt1.4.5","title":"Coverage burn-down: starters + serve/reflect + validate","description":"Scope\n- Raise coverage for the lowest-covered `src/*` files from the baseline report:\n  - `src/starters.ts` (0% stmts)\n  - `src/commands/serve.ts` (~25% stmts)\n  - `src/commands/reflect.ts` (~33% stmts)\n  - `src/reflect.ts` (~46% stmts)\n  - `src/validate.ts` (~54% stmts)\n\nApproach\n- Add unit/integration tests that hit real code paths (no Bun mocks).\n- Prefer in-process tests for command handlers; for `serve`, include an HTTP contract test that starts/stops cleanly and hits a health/info endpoint.\n- Keep everything offline/deterministic for CI.\n\nNotes\n- Baseline artifacts: `LOG_DIR=/var/folders/vt/n2xyn_s51b97_j3yh2qbqcnc0000gn/T//cm-coverage-baseline2-1765902991` (see `summary.json`).","notes":"Session fixes (Dec 27 2025):\n- Fixed LLMIO shim detection order bug in test/helpers/llm-shim.ts (reflector prompt contains 'session'/'diary' which was matching extractDiary detection first)\n- Fixed generateObjectSafe in src/llm.ts to skip model creation when using mock LLMIO (prevents API key requirement in tests)\n- Fixed shouldExitEarly test expectation bug in test/reflect.test.ts\n- Coverage improvements: reflect.ts improved from ~33-46% to ~60.54%\n- starters.ts already at 100% coverage\n- Remaining: serve.ts (~25%), validate.ts (~54%) still need test improvements","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-16T16:40:24.939233Z","updated_at":"2025-12-28T04:11:42.940953Z","closed_at":"2025-12-28T04:11:42.940953Z","close_reason":"Coverage improvements complete: starters 100%, serve 52.82%, reflect 61.59%/78.48%, validate 58.89%","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-sdt1.4.5","depends_on_id":"cass_memory_system-sdt1.4","type":"parent-child","created_at":"2026-01-21T09:28:52Z","created_by":"import"},{"issue_id":"cass_memory_system-sdt1.4.5","depends_on_id":"cass_memory_system-sdt1.4.1","type":"blocks","created_at":"2026-01-21T09:28:52Z","created_by":"import"}]}
{"id":"cass_memory_system-sdt1.4.6","title":"Coverage burn-down: onboard command (in-process tests)","description":"Scope\\n- Add in-process tests for src/commands/onboard.ts so Bun coverage includes the onboarding flows (status/gaps/sample/read/prompt/reset/mark-done/guided).\\n- Keep tests offline/deterministic (cass stub; no network; no LLM).\\n\\nNotes\\n- Coverage report shows src/commands/onboard.ts at ~0% funcs / ~2% lines (LOG_DIR=/tmp/cm-coverage-now).","notes":"Completed (2025-12-18): added in-process onboarding command tests.\n\nCoverage run:\n- Ran: LOG_DIR=/tmp/cm-coverage-onboard ./scripts/coverage.sh\n- Totals (Bun): funcs 80.87%, lines 77.03% (see /tmp/cm-coverage-onboard/summary.json)\n- src/commands/onboard.ts: 83.33% funcs / 80.97% lines (see /tmp/cm-coverage-onboard/artifacts/coverage.txt)\n\nTest coverage includes:\n- status/gaps/sample/read/prompt/reset/mark-done/guided (JSON + text output), including fill-gaps scoring and template mode.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T02:15:34.547159619Z","updated_at":"2025-12-18T02:25:59.144990820Z","closed_at":"2025-12-18T02:25:59.144990820Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-sdt1.4.6","depends_on_id":"cass_memory_system-sdt1.4","type":"parent-child","created_at":"2026-01-21T09:28:52Z","created_by":"import"}]}
{"id":"cass_memory_system-sdt1.4.7","title":"[Coverage] Add unit tests for progress reporter","description":"Add deterministic unit tests for src/progress.ts (createProgress). Coverage baseline: /tmp/cm-coverage-1766025255/summary.json shows ~30% funcs/lines for this module.","notes":"Implemented test/progress.test.ts covering createProgress (json/text, TTY/non-TTY, throttling, delay visibility, truncation, complete/fail). Full-suite coverage run: /tmp/cm-coverage-1766025662/summary.json (All files 81.73% funcs / 77.99% lines). src/progress.ts now 85.71% funcs / 93.05% lines; report: /tmp/cm-coverage-1766025662/artifacts/coverage.txt.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-18T02:37:48.514546245Z","updated_at":"2025-12-18T02:42:57.986714009Z","closed_at":"2025-12-18T02:42:57.986714009Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-sdt1.4.7","depends_on_id":"cass_memory_system-sdt1.4","type":"parent-child","created_at":"2026-01-21T09:28:52Z","created_by":"import"}]}
{"id":"cass_memory_system-sdt1.4.8","title":"[Coverage] Cover validate command ambiguous (LLM) path via LLMIO injection","description":"src/commands/validate.ts is low coverage because ambiguous evidence path calls runValidator (LLM). Add optional LLMIO injection to validateCommand so tests can cover REFINE->ACCEPT_WITH_CAUTION mapping, evidence formatting, and classifyOutcome without network/API keys.","notes":"Done: validateCommand now accepts deps { runner?: CassRunner; io?: LLMIO } and uses them for evidenceCountGate/safeCassSearch/runValidator so tests are deterministic and offline. Added ambiguous-evidence tests (REFINE -> ACCEPT_WITH_CAUTION) covering classifyOutcome, refinedRule, and evidence formatting; targeted coverage run shows src/commands/validate.ts at 100% funcs/lines.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-18T02:48:49.872263543Z","updated_at":"2025-12-18T02:53:16.387100224Z","closed_at":"2025-12-18T02:53:16.387100224Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-sdt1.4.8","depends_on_id":"cass_memory_system-sdt1.4","type":"parent-child","created_at":"2026-01-21T09:28:52Z","created_by":"import"}]}
{"id":"cass_memory_system-sdt1.4.9","title":"[Coverage] Add tests for outcome and outcome-apply commands","description":"src/commands/outcome.ts is very low coverage (~35% lines). Add deterministic tests for outcomeCommand/applyOutcomeLogCommand (validation errors, json/human outputs, session filtering) without writing into the repo (use temp HOME + chdir).","notes":"Done: extended test/outcome-apply.test.ts to cover src/commands/outcome.ts (outcomeCommand + applyOutcomeLogCommand): JSON validation errors, outcome success path (JSON + human missing-rule output), outcome-apply validation + session filtering + no-session apply. Full-suite coverage: /tmp/cm-coverage-1766026849/summary.json (All files 83.08% funcs / 79.64% lines). Module coverage: src/commands/outcome.ts is now 100% funcs / 84.30% lines (see /tmp/cm-coverage-1766026849/artifacts/coverage.txt).","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-18T02:56:41.429837132Z","updated_at":"2025-12-18T03:02:43.700940498Z","closed_at":"2025-12-18T03:02:43.700940498Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-sdt1.4.9","depends_on_id":"cass_memory_system-sdt1.4","type":"parent-child","created_at":"2026-01-21T09:28:52Z","created_by":"import"}]}
{"id":"cass_memory_system-sdt1.5","title":"Fix dedup within same reflection iteration (Scenario 7 E2E)","notes":"CI failure: test/multi-session-learning.e2e.test.ts \"deduplicates within same reflection iteration\" was failing (observed via KEEP_TEMP=1 bun run test:ci on 2025-12-18).\n\nRoot cause:\n- src/reflect.ts exited early when an iteration produced 0 *unique* deltas (all duplicates). That prevented later iterations from contributing new unique deltas (Scenario 7 expected iter3 to add rule B after iter2 duplicated rule A).\n\nFix:\n- src/reflect.ts now only early-exits when the reflector produces 0 deltas for an iteration (not merely duplicates), while still respecting max-iterations and total-delta safety limits.\n\nValidation:\n- KEEP_TEMP=1 bun test test/multi-session-learning.e2e.test.ts --test-name-pattern \"deduplicates within same reflection iteration\"\n- KEEP_TEMP=1 bun test test/multi-session-learning.e2e.test.ts\n- KEEP_TEMP=1 bun test test/ace-pipeline.e2e.test.ts --test-name-pattern \"Early Exit Conditions\"\n- bun run typecheck","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-18T07:23:41.614114839Z","updated_at":"2025-12-18T07:26:05.769425152Z","closed_at":"2025-12-18T07:26:05.769425152Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-sdt1.5","depends_on_id":"cass_memory_system-sdt1","type":"parent-child","created_at":"2026-01-21T09:28:52Z","created_by":"import"}]}
{"id":"cass_memory_system-shs3","title":"Task: Remove hardcoded warning emoji in onboard gaps output","description":"# Task: Remove hardcoded warning emoji in `onboard` gap output (and decide ASCII fallback)\n\n## Problem\n`src/commands/onboard.ts` has a hardcoded `⚠` in the gap-analysis output:\n\n```ts\nconsole.log(chalk.yellow(`  ⚠ ${cat} (${count} rules)`));\n```\n\nThis bypasses the icon system and ignores `CASS_MEMORY_NO_EMOJI`.\n\nImportant: the `warning` icon already exists in `src/output.ts` (`IconName: \"warning\"`), so the fix is **not** “add warning icon”, it’s “use the existing icon pipeline consistently”.\n\n## Solution\n\n### Step 1: Replace the hardcoded emoji in `src/commands/onboard.ts`\nUse the shared helpers:\n- Prefer: `iconPrefix(\"warning\")` (handles spacing)\n- Or: `icon(\"warning\")` (if you handle spacing yourself)\n\n### Step 2 (optional but recommended): Add an ASCII fallback for warnings\nToday, `ICONS.warning.plain` is empty, which means in no-emoji mode warnings become visually unmarked.\n\nConsider setting:\n- `ICONS.warning.plain = \"[!]\"` (or similar) so `CASS_MEMORY_NO_EMOJI=1` still preserves the warning affordance.\n\n## Agent integration notes\n- This is human-output only; JSON output (`--json`) is unaffected.\n- Keep output clean when the prefix is empty (no double spaces).\n\n## Files to modify\n- `src/commands/onboard.ts`\n- `src/output.ts` (only if adding the plain fallback)\n\n## Acceptance criteria\n- [ ] No hardcoded `⚠` remains in `src/commands/onboard.ts`.\n- [ ] `CASS_MEMORY_NO_EMOJI=1 cm onboard gaps` has no emoji.\n- [ ] If we add a plain fallback, warnings still show an ASCII marker (e.g. `[!]`).\n\n## Related\n- `cass_memory_system-ap27` was an earlier duplicate stub of this task.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-15T21:18:35.760629Z","updated_at":"2025-12-15T23:47:35.884285Z","closed_at":"2025-12-15T23:47:35.884285Z","close_reason":"Already fixed: line 523 uses iconPrefix('warning') - no hardcoded ⚠ in file","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-sj4a","title":"[UX][trust] Eliminate hard-coded CLI version + improve top-level error handling","description":"Problem\n- `src/cm.ts` hard-codes `.version(\"0.1.0\")`, which can drift from the real package/build version.\n- The CLI also uses `program.parse()` with async handlers; promise rejection/error handling is less explicit than it should be for a production CLI.\n\nWhat to do\n- Source the version from a single canonical place (package metadata or build-time injection).\n- Switch to `parseAsync` (or equivalent) and install a top-level error handler that:\n  - prints consistent errors\n  - sets an appropriate non-zero exit code\n  - does not pollute stdout JSON when `--json` is used\n\nWhy it helps\n- Version correctness is a trust signal and helps support/debugging.\n- Better error handling avoids confusing partial output and unhandled rejections.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-13T10:15:06.289404Z","updated_at":"2025-12-13T21:34:27.277294Z","closed_at":"2025-12-13T21:34:27.277294Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-sj4a","depends_on_id":"cass_memory_system-c10q","type":"parent-child","created_at":"2026-01-21T09:28:52Z","created_by":"import"}]}
{"id":"cass_memory_system-skri","title":"[Impl] Automated Post-Session Reflection Hook","description":"# Automated Post-Session Reflection Hook\n\n## Purpose\nAgents shouldn't have to remember to run `cm reflect`. Learning should happen automatically after sessions end. This task designs and documents the automation approach.\n\n## Current State\n- `cm reflect --days N` processes recent sessions\n- Must be run manually or via cron\n- Agents don't call this (nor should they)\n\n## Automation Options\n\n### Option 1: Shell Hook / Alias\nUsers configure their shell or agent tool to run reflection after sessions:\n```bash\n# In .bashrc or agent config\nalias ccend='cm reflect --days 1 --quiet'\n```\n\n### Option 2: Cron Job\nRegular background processing:\n```cron\n0 * * * * cm reflect --days 1 --quiet\n```\n\n### Option 3: cass Integration Hook\nWhen cass indexes a new session, trigger reflection:\n```bash\n# cass post-index hook\ncm reflect --session \"$INDEXED_SESSION\"\n```\n\n### Option 4: MCP Server Background Task\nThe MCP server periodically processes new sessions in the background.\n\n## Recommendation\nDocument all options in README with copy-paste examples. Primary recommendation:\n1. Cron for personal use (simple, reliable)\n2. CI/CD hook for team use (processes sessions on commit)\n3. MCP server for real-time use (when running as MCP)\n\n## Deliverables\n- [ ] Documentation for each automation option\n- [ ] Copy-paste configs for common setups\n- [ ] Add to \"For Humans - Operation\" section of README\n- [ ] Consider adding `cm setup-hooks` command","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-08T17:47:51.059278Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-sqsy","title":"[CLI:project] formatAgentsMd - Generate AGENTS.md section","description":"Implements the formatAgentsMd function that generates the AGENTS.md format for playbook export.\n\nFUNCTION SIGNATURE:\n```typescript\nfunction formatAgentsMd(\n  playbook: Playbook,\n  options: { topN?: number; showCounts?: boolean }\n): string\n```\n\nOUTPUT FORMAT:\n```markdown\n## Agent Playbook (auto-generated from cass-memory)\n\n### Testing (top 5 rules)\n1. [8× helpful] For React hooks, test effects separately\n2. [5× helpful] Run tests before committing\n3. [3× helpful] Use test fixtures for complex data\n\n### Git Workflow\n1. [6× helpful] Make atomic commits\n2. [4× helpful] Write descriptive commit messages\n\n### PITFALLS TO AVOID\n- AVOID: Caching auth tokens without expiry check\n- AVOID: Running migrations without backup\n```\n\nIMPLEMENTATION REQUIREMENTS:\n1. Group bullets by category (semantic clustering)\n2. Sort bullets within each category by effectiveness score\n3. Apply topN filter if specified\n4. Format counts as \"[Nx helpful]\" or \"[Nx helpful, 1× harmful]\"\n5. Separate anti-patterns into PITFALLS section\n6. Include metadata header (generation timestamp, total count)\n\nRANKING LOGIC:\n- Use effective score (with decay) for ranking\n- Prioritize established/proven over candidates\n- Show global rules before workspace-specific\n\nOUTPUT QUALITY:\n- Clean markdown formatting\n- Proper heading hierarchy\n- Concise bullet previews (truncate if needed)\n- Professional tone suitable for AI assistants\n\nDEPENDENCIES:\n- Playbook data structure\n- Score calculation utilities\n- Category inference system","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-07T21:52:09.248029Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-sr2t","title":"[ErrorHandling] EXIT_CODES - Standard exit codes","description":"Define standard exit codes for consistent scripting integration.\n\nConstants:\nconst EXIT_CODES = {\n  SUCCESS: 0,\n  USER_ERROR: 1,       // Invalid input\n  CONFIG_ERROR: 2,     // Configuration issues\n  CASS_ERROR: 3,       // cass unavailable/failed\n  LLM_ERROR: 4,        // LLM provider failed\n  IO_ERROR: 5,         // Filesystem issues\n  INTERNAL_ERROR: 9,   // Unexpected errors\n  INTERRUPTED: 130     // SIGINT (128 + 2)\n};\n\nUsage:\nprocess.exit(EXIT_CODES.SUCCESS);\n\nBenefits:\n- Enables shell scripting: if cass-memory ingest; then...\n- Distinguishes error types in CI/CD\n- Follows Unix conventions\n- Consistent with standard tools\n\nExamples:\n- Missing file: IO_ERROR (5)\n- Bad command args: USER_ERROR (1)\n- Rate limit exceeded: LLM_ERROR (4)\n- Ctrl+C: INTERRUPTED (130)\n\nDocument in README for users writing scripts.","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:51:59.786064Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-sr3","title":"[Decay] getDecayedScore - Time-weighted event aggregation","description":"Calculate decayed helpful count based on recency of events. A rule that was helpful 8 times in January but never since June will have dramatically lower effective score by December.\n\nCOMPLETE IMPLEMENTATION:\n```typescript\n/**\n * Calculate decayed helpful count based on recency of events.\n * A rule that was helpful 8 times in January but never since June\n * will have dramatically lower effective score by December.\n */\nfunction getDecayedScore(\n  events: FeedbackEvent[],\n  halfLifeDays: number = 90,\n  now: number = Date.now()\n): number {\n  if (events.length === 0) return 0;\n\n  return events.reduce((sum, event) => {\n    const eventTime = new Date(event.timestamp).getTime();\n    const daysSinceEvent = (now - eventTime) / (1000 * 60 * 60 * 24);\n    const decayFactor = Math.pow(0.5, daysSinceEvent / halfLifeDays);\n    return sum + decayFactor;\n  }, 0);\n}\n```\n\nMATHEMATICAL EXPLANATION:\n- halfLife = 90 days means after 90 days, an event is worth 0.5 of original\n- After 180 days, worth 0.25\n- After 270 days, worth 0.125\n- Exponential decay: decayFactor = 0.5^(daysAgo/halfLife)\n\nWHY THIS MATTERS:\nWithout decay, rules from 2 years ago have same weight as rules from yesterday. Codebases evolve - old rules may no longer apply. This is the SINGLE MOST IMPORTANT ENHANCEMENT - prevents playbook fossilization.\n\nPARAMETERS:\n- events: Array of FeedbackEvent with timestamp field\n- halfLifeDays: Number of days for event value to decay to 50% (default: 90)\n- now: Current timestamp in milliseconds (default: Date.now())\n\nRETURNS:\n- Decayed score as sum of all time-weighted events\n\nEXAMPLE:\nEvent from today: decayFactor = 1.0\nEvent from 90 days ago: decayFactor = 0.5\nEvent from 180 days ago: decayFactor = 0.25\nTotal score = 1.0 + 0.5 + 0.25 = 1.75","status":"tombstone","priority":3,"issue_type":"task","created_at":"2025-12-07T21:44:43.001078Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-ssb2","title":"[Config] savePlaybookToAppropriateLevel - Smart save location","description":"Function signature:\n```typescript\nasync function savePlaybookToAppropriateLevel(\n  bullet: PlaybookBullet,\n  config: Config\n): Promise<'global' | 'repo'>\n```\n\nDecision logic:\n1. If scope === 'workspace' → save to repo (.cass/playbook.yaml)\n2. If scope === 'global' AND in repo AND bullet is project-specific → save to repo\n3. Otherwise → save to global (~/.cass-memory/playbook.yaml)\n\nProject-specific heuristics:\n- Contains file paths\n- References project-specific APIs/frameworks\n- Created during workspace reflection\n\nImplementation:\n1. Detect repo context\n2. Apply decision logic\n3. Load appropriate playbook file\n4. Add/update bullet\n5. Save atomically\n6. Return save location\n\nEnsures team conventions go to .cass/ (shared) while personal rules stay global.","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:50:04.188624Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-su8w","title":"[E2E] Performance - Large Scale Operations","description":"## Target: E2E performance tests with detailed timing\n\n### Scenario: Large Data Volumes\n\n```\n1000 bullets in playbook\n100 diary entries\nComplex queries\nBulk operations\n```\n\n### Test Script:\n\n```typescript\ndescribe('E2E: Performance', () => {\n  describe('large playbook', () => {\n    it('handles 1000 bullets efficiently', async () => {\n      const env = await createTestEnvironment();\n      \n      // Generate 1000 bullets\n      log('Generating 1000 bullets...');\n      const startGen = performance.now();\n      \n      const playbook = createEmptyPlaybook();\n      for (let i = 0; i < 1000; i++) {\n        playbook.bullets.push(generateRandomBullet(i));\n      }\n      await savePlaybook(playbook, env.playbookPath);\n      \n      const genTime = performance.now() - startGen;\n      log(`Generated 1000 bullets in ${genTime.toFixed(2)}ms`);\n\n      // Test context query performance\n      log('Testing context query...');\n      const startQuery = performance.now();\n      \n      const result = await runCLI(['context', 'typescript error handling', '--json'], { env });\n      \n      const queryTime = performance.now() - startQuery;\n      log(`Context query completed in ${queryTime.toFixed(2)}ms`);\n      log('Result count:', JSON.parse(result.stdout).bullets.length);\n      \n      // Should complete in reasonable time\n      expect(queryTime).toBeLessThan(5000); // 5 seconds max\n      \n      // Test curate performance\n      log('Testing curation...');\n      const startCurate = performance.now();\n      \n      await runCLI(['curate', '--dry-run', '--json'], { env });\n      \n      const curateTime = performance.now() - startCurate;\n      log(`Curation completed in ${curateTime.toFixed(2)}ms`);\n      \n      expect(curateTime).toBeLessThan(10000); // 10 seconds max\n    });\n  });\n\n  describe('many diary entries', () => {\n    it('scans 100 entries quickly', async () => {\n      // Create 100 diary entries\n      // Test timeline generation\n      // Test reflect performance\n    });\n  });\n\n  describe('concurrent operations', () => {\n    it('handles 10 parallel context queries', async () => {\n      const startParallel = performance.now();\n      \n      const queries = Array(10).fill(null).map((_, i) =>\n        runCLI(['context', `query ${i}`, '--json'], { env })\n      );\n      \n      const results = await Promise.all(queries);\n      \n      const parallelTime = performance.now() - startParallel;\n      log(`10 parallel queries in ${parallelTime.toFixed(2)}ms`);\n      log(`Average per query: ${(parallelTime / 10).toFixed(2)}ms`);\n      \n      results.forEach((r, i) => {\n        expect(r.exitCode).toBe(0);\n        log(`Query ${i}: ${r.duration.toFixed(2)}ms`);\n      });\n    });\n  });\n});\n```\n\n### Metrics Logged:\n- Operation duration (ms)\n- Memory usage (if measurable)\n- File sizes\n- Bullet/entry counts\n- Throughput (ops/sec)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T01:31:17.188941Z","updated_at":"2025-12-14T02:04:07.710798Z","closed_at":"2025-12-14T02:04:07.710798Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-su8w","depends_on_id":"cass_memory_system-ke2x","type":"blocks","created_at":"2026-01-21T09:28:52Z","created_by":"import"}]}
{"id":"cass_memory_system-su9a","title":"Unit tests for validate.ts - Validator pipeline","description":"Complete unit test coverage for validate.ts:\n- validatePlaybook() main entry point\n- Bullet validation against schema\n- Category consistency checks\n- Scope validation (global vs project-specific)\n- Duplicate detection\n- Circular reference detection (if applicable)\n- Validation result structure\n- Error message formatting\nNO MOCKS - use real playbook fixtures with intentional errors","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-08T01:25:17.193708Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-sww","title":"[Validator] extractValidationKeywords - Rule to search terms","description":"Implement the extractValidationKeywords function - Extract search terms from proposed rules for cass search.\n\nSIGNATURE:\n```typescript\nfunction extractValidationKeywords(rule: string): string[]\n```\n\nALGORITHM:\n1. Tokenize the rule text\n2. Remove stop words (the, a, an, is, should, must, etc.)\n3. Extract technical terms (camelCase, PascalCase, kebab-case, snake_case)\n4. Identify technology names (React, TypeScript, PostgreSQL, etc.)\n5. Extract action verbs (validate, sanitize, implement, etc.)\n6. Prioritize domain-specific terms over generic ones\n7. Return 5-10 most relevant keywords\n\nEXAMPLE:\n```typescript\nconst rule = \"Always use TypeScript strict mode and enable noImplicitAny for type safety\";\nconst keywords = extractValidationKeywords(rule);\n// Returns: [\"TypeScript\", \"strict mode\", \"noImplicitAny\", \"type safety\"]\n```\n\nSTOP WORDS TO REMOVE:\n- Generic: the, a, an, is, are, should, must, always, never, etc.\n- Too common: use, when, if, then, for, with, etc.\n\nPRIORITIZE:\n- Technology names (React, Node.js, PostgreSQL)\n- Configuration options (strict mode, noImplicitAny)\n- Technical patterns (dependency injection, event sourcing)\n- Specific actions (sanitize, validate, normalize)\n\nWHY THIS MATTERS:\n- Focuses cass search on relevant historical sessions\n- Avoids noise from overly generic searches\n- Improves precision of evidence gathering\n- Key input to evidenceCountGate()\n\nDEPENDENCIES:\n- None (pure function)\n- Could use NLP library for better extraction (optional)\n\nLOCATION:\n- src/validator/keyword-extraction.ts","status":"tombstone","priority":3,"issue_type":"task","created_at":"2025-12-07T21:44:53.996904Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-sxf","title":"[Utils] error - Error logging to stderr","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:45:25.399714Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-syls","title":"[ErrorHandling] categorizeError - Error type classification","description":"Categorize errors for appropriate handling and user messaging.\n\nType definition:\ntype ErrorCategory = \n  | 'user_input'      // Invalid input from user\n  | 'configuration'   // Config file issues\n  | 'filesystem'      // File/directory issues\n  | 'network'         // API/network failures\n  | 'cass'            // cass-specific errors\n  | 'llm'             // LLM provider errors\n  | 'internal'        // Bugs in cass-memory\n\nFunction signature:\nfunction categorizeError(error: Error): ErrorCategory\n\nImplementation:\n- Check error message and code patterns\n- Match against known error types\n- Return appropriate category\n\nUsed for:\n- Selecting appropriate exit code\n- Formatting user-friendly error messages\n- Determining retry behavior\n- Logging and diagnostics\n\nExamples:\n- ENOENT -> 'filesystem'\n- 'Invalid bullet ID' -> 'user_input'\n- 'API rate limit' -> 'llm'\n- 'cass: command not found' -> 'cass'","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:51:58.715364Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-t2fr","title":"Fix mergePlaybooks to avoid shared mutable bullet references","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-16T05:49:06.814640Z","updated_at":"2025-12-16T05:52:08.068084Z","closed_at":"2025-12-16T05:52:08.068084Z","close_reason":"mergePlaybooks now clones bullets to prevent shared mutation; added unit regression test","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-t4es","title":"Fix 27 typecheck errors blocking build","status":"tombstone","priority":0,"issue_type":"bug","created_at":"2025-12-08T00:03:29.529896Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"bug","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-t5t","title":"[Types] Playbook Schema - YAML File Structure","description":"## Overview\nDefine top-level Playbook file schema - the YAML structure that stores the entire playbook with metadata, bullets, and deprecated patterns.\n\n## Purpose\nThe Playbook is the central artifact of the memory system:\n1. Single source of truth for all active rules\n2. Persisted as YAML for human readability and git-friendliness\n3. Includes metadata for tracking playbook health\n4. Implements Gemini tombstone pattern for deprecated rules\n\n## Schema Structure\n\nschema_version: number (required, current value: 2)\nname: string (required, playbook identifier)\ndescription: string | undefined (optional, free-form description)\nmetadata: object (playbook health tracking)\ndeprecatedPatterns: DeprecatedPattern[] (Gemini tombstones)\nbullets: PlaybookBullet[] (actual playbook rules)\n\n## Metadata Object Fields\n\ncreatedAt: string (ISO 8601, immutable)\nlastReflection: string | undefined (ISO 8601, most recent reflection)\ntotalReflections: number (count of reflection runs, default 0)\ntotalSessionsProcessed: number (sessions analyzed, default 0)\n\n## DeprecatedPattern Schema\n\npattern: string (text or regex of deprecated rule)\ndeprecatedAt: string (ISO 8601 timestamp)\nreason: string (why it was deprecated)\nreplacement: string | undefined (optional pointer to replacement rule ID)\n\nPurpose: Prevents re-adding deprecated rules in future reflections\n\n## File Location and Operations\n\nDefault: ~/.cass-memory/playbook.yaml\nConfigurable: config.playbookPath\nGit-friendly: YAML format enables meaningful diffs\nHuman-editable: Can be manually edited with care\n\nOperations:\n- Load: loadPlaybook(config.playbookPath)\n- Save: savePlaybook(playbook, config.playbookPath)\n- Validate: PlaybookSchema.safeParse(playbookData)\n\n## Migration Strategy\n\nDetect old schema_version, run migration function, update version, save\n\n## Playbook Health Metrics\n\nMaturity: totalReflections / totalSessionsProcessed ratio\nStaleness: Days since lastReflection\nCoverage: Active bullets / totalSessionsProcessed ratio\nQuality: Average effectiveScore across active bullets\nChurn: Deprecated bullets / total bullets ratio\n\n## Acceptance Criteria\n- schema_version field (number)\n- name field (string, required)\n- description field (optional)\n- metadata object with all 4 fields\n- deprecatedPatterns array with DeprecatedPattern schema\n- bullets array of PlaybookBullet objects\n- Zod schema validation\n- YAML serialization/deserialization\n- Complete example in docs\n- Migration utilities\n- Load/save functions\n- JSDoc documentation","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:45:04.038891Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-t87z","title":"[Unit] Commands - mark.ts, playbook.ts, curate.ts","description":"## Target: src/commands/*.ts - CLI Commands (Part 2)\n\n### mark.ts Tests:\n\n1. **markCommand(bulletId, action, options)** - Mark feedback\n   - 'helpful' action adds helpful event\n   - 'harmful' action adds harmful event\n   - Invalid bullet ID → error\n   - --context adds context\n   - --json output\n\n2. **Event array handling**\n   - feedbackEvents array updated\n   - Previous events preserved\n   - Timestamps correct\n\n### playbook.ts Tests:\n\n1. **playbookCommand(options)** - Playbook management\n   - Lists bullets with --list\n   - Shows specific bullet with --show\n   - Adds bullet with --add\n   - Removes bullet with --remove\n   - --json output for all operations\n\n2. **playbookExportCommand(options)** - Export\n   - Exports to markdown\n   - Exports to JSON\n   - Output file parameter\n\n### curate.ts Tests:\n\n1. **curateCommand(options)** - Curation CLI\n   - Runs curation pipeline\n   - --dry-run shows without changing\n   - --auto applies suggestions\n   - --json output structured\n   - Report includes all findings\n\n### Test Patterns:\n- Real temp playbook files\n- Pre-populated test data\n- Verify file changes after commands","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-08T01:29:17.874392Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-t8iv","title":"[CLI:audit] formatAuditViolations - Human-readable violations","description":"Format audit results for display.\n\nFunction signature:\n```typescript\nfunction formatAuditViolations(\n  result: AuditResult,\n  options: { json?: boolean }\n): string\n```\n\nAuditResult structure:\n```typescript\ninterface AuditResult {\n  violations: AuditViolation[];\n  stats: {\n    sessionsScanned: number;\n    rulesChecked: number;\n    violationsFound: number;\n    bySeverity: { high: number; medium: number; low: number; }\n  };\n  scannedAt: string;\n}\n```\n\nOutput format:\n```\nAUDIT RESULTS (scanned N sessions)\n\nVIOLATIONS FOUND: N\n\nFor each violation, grouped by severity:\n1. [SEVERITY] Rule bulletId: bulletContent\n   Session: sessionPath\n   Timestamp: timestamp\n   Evidence: evidence\n   \nIf no violations:\nNo violations found. All sessions comply with playbook rules.\n\nSUMMARY:\n- Sessions scanned: N\n- Rules checked: N\n- High severity: N\n- Medium severity: N\n- Low severity: N\n```\n\nFormatting rules:\n- Group violations by severity (high to medium to low)\n- Truncate session paths to last 2 components\n- Wrap evidence text at 80 chars\n- Use severity indicators in brackets\n- Color coding if terminal supports it\n\nJSON mode:\n- If --json flag: return JSON.stringify(result, null, 2)\n- Include all fields, no truncation\n\nThis output helps developers quickly identify and fix compliance issues.","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:51:32.423484Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-tdwt","title":"Respect cm privacy status --days 0","description":"privacy status currently treats --days 0 as invalid and silently defaults to 365. Align numeric flag handling with other commands (0 should mean 0-day lookback) to avoid surprising behavior.","status":"closed","priority":3,"issue_type":"bug","created_at":"2025-12-16T09:24:45.060251Z","updated_at":"2025-12-16T09:28:03.022899Z","closed_at":"2025-12-16T09:28:03.022899Z","close_reason":"Completed: privacy status now respects --days 0","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-tf26","title":"[MCP:Future] MCP server initialization","description":"Implement MCP server initialization code:\n\n```typescript\nimport { Server } from \"@modelcontextprotocol/sdk/server/index.js\";\n\nconst server = new Server({\n  name: \"cass-memory\",\n  version: \"1.0.0\"\n}, {\n  capabilities: {\n    tools: {}\n  }\n});\n```\n\nSets up the basic MCP server structure with capabilities for tool support.","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:49:28.381282Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-tf5","title":"[Types] Cass Integration Types - Search Options and Results","description":"## Overview\nDefine types for cass search integration - search options, results, and timeline data structures.\n\n## Purpose\nEnable seamless integration with cass session search engine for:\n1. Validation: Find evidence for/against proposed rules\n2. Context: Pull relevant session snippets for pre-task hydration\n3. Provenance: Link rules to originating sessions\n4. Analytics: Timeline views and usage patterns\n\n## CassSearchOptions\n\nConfigure cass search queries with filters and output options.\n\nFields:\n- limit: number | undefined (max results, default 10, range 1-1000)\n- days: number | undefined (lookback window, default 7, range 1-365)\n- agent: string | undefined (filter by agent, e.g., 'claude')\n- workspace: string | undefined (filter by workspace path)\n- fields: string[] | undefined (which fields to return, default all)\n- maxTokens: number | undefined (truncate snippets, range 10-2000)\n- highlight: boolean | undefined (wrap matches in markers, default false)\n- explain: boolean | undefined (include score details, default false)\n- timeout: number | undefined (query timeout ms, default 5000)\n\n## CassHit\n\nSingle search result from cass query.\n\nFields:\n- source_path: string (path to session file)\n- line_number: number (line in session, 1-indexed)\n- agent: string (which agent)\n- workspace: string | undefined (workspace path if available)\n- title: string | undefined (session title/summary)\n- snippet: string (matching text excerpt, ~200 chars)\n- score: number (BM25 relevance score, higher = more relevant)\n- created_at: string (ISO 8601 timestamp)\n\n## CassSearchResult\n\nComplete search response with results and metadata.\n\nStructure:\n- hits: CassHit[] (array of search results)\n- _meta: object | undefined (optional metadata)\n  - elapsed_ms: number (query execution time)\n  - total_hits: number (total matches before limit)\n  - wildcard_fallback: boolean (did query use wildcard)\n  - query_plan: string | undefined (if explain=true)\n\n## CassTimelineGroup\n\nAggregate session data by date for timeline visualization.\n\nStructure:\n- date: string (ISO date YYYY-MM-DD)\n- agents: Record<string, number> (sessions per agent)\n- total: number (total sessions for date)\n\nUsage: Timeline command, visualize activity, identify patterns\n\n## Integration Examples\n\nBasic Search:\n  cassSearch('JWT validation', { limit: 10, days: 30, workspace: '...' })\n\nEvidence Collection:\n  cassSearch(proposedRule, { limit: 20, days: 90, fields: ['snippet', 'score'] })\n\nTimeline Analysis:\n  cassTimeline({ days: 90 })\n\n## Acceptance Criteria\n- CassSearchOptions interface with all optional fields\n- CassHit interface with required/optional fields\n- CassSearchResult interface with hits and metadata\n- CassTimelineGroup interface for timeline data\n- Zod schemas for runtime validation\n- TypeScript type exports\n- Example usage for each type\n- JSDoc documentation\n- Integration with cass CLI wrapper functions","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:45:04.976704Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-ti9m","title":"E2E tests: outcome command","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T01:31:50.189268925Z","created_by":"ubuntu","updated_at":"2026-01-07T01:36:27.373807096Z","closed_at":"2026-01-07T01:36:27.373807096Z","close_reason":"Added E2E tests for outcome/outcome-apply commands","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-ti9m","depends_on_id":"cass_memory_system-sdt1.4","type":"discovered-from","created_at":"2026-01-21T09:28:52Z","created_by":"import"}]}
{"id":"cass_memory_system-tkb2","title":"[E2E Tests] Confidence decay over time - scoring accuracy","description":"## E2E Test: Confidence Decay Over Time - Scoring Accuracy\n\n### Test Scenario\nTest that bullet confidence decays over time as expected\n\n### Test Steps\n\n#### 1. No Decay at Creation\n- Create bullet with confidence 0.9\n- Immediately read effective confidence\n- Verify effective = base confidence\n\n#### 2. Decay After Half-Life\n- Create bullet dated 30 days ago\n- Default half-life = 30 days\n- Verify effective confidence ~ 0.45 (half)\n\n#### 3. Decay After Multiple Half-Lives\n- Bullet dated 60 days ago (2 half-lives)\n- Verify effective ~ 0.225 (quarter)\n- Bullet dated 90 days ago (3 half-lives)\n- Verify effective ~ 0.1125 (eighth)\n\n#### 4. Decay Floor\n- Very old bullet (1 year)\n- Verify doesn't decay below floor (e.g., 0.01)\n- Floor prevents total obsolescence\n\n#### 5. Custom Half-Life\n- Config: decay_half_life_days=7\n- Bullet dated 7 days ago\n- Verify effective = base * 0.5\n\n#### 6. Decay Disabled\n- Config: decay_enabled=false\n- Old bullet\n- Verify effective = base (no decay)\n\n#### 7. Context Generation Impact\n- Multiple bullets with different ages\n- Generate context\n- Verify newer bullets ranked higher\n- Verify old bullets still included if relevant\n\n### Verbose Logging\n- Log: 'Calculating effective confidence for bullet: <id>'\n- Log: 'Base confidence: X'\n- Log: 'Age: Y days'\n- Log: 'Half-life: Z days'\n- Log: 'Decay factor: W'\n- Log: 'Effective confidence: X * W = V'\n\n### Precision Testing\n- Use fixed timestamps (not Date.now())\n- Compare with epsilon for floating point\n- Test at exact half-life boundaries","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-08T01:24:58.208656Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-tklc","title":"Fix cass search options for days=0 and limit=0","description":"Cass wrappers currently use truthy checks (e.g. if (options.days)) so --days 0 is ignored and becomes an unbounded cass search; also limit 0 can silently fall back to default instead of returning empty. Make 0-handling explicit and prevent cass panic on --limit 0.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-16T08:50:54.488746Z","updated_at":"2025-12-16T08:58:54.755667Z","closed_at":"2025-12-16T08:58:54.755667Z","close_reason":"Completed: preserve days=0 semantics and guard limit=0","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-tl6a","title":"Harden ProcessedLog.load against partial writes","description":"ProcessedLog.append uses withLock but ProcessedLog.load reads unlocked; if it reads mid-append, the trailing JSON/TSV line can be truncated and skipped, causing reprocessing. Detect malformed trailing line (no final newline) and re-read once under the same lock.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-16T06:40:54.728657Z","updated_at":"2025-12-16T06:42:22.402915Z","closed_at":"2025-12-16T06:42:22.402915Z","close_reason":"ProcessedLog.load retries once under withLock when it sees a malformed trailing line (no final newline) to avoid transiently skipping mid-append entries; added regression test","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-tmcq","title":"Unit tests for diary.ts - Diary extraction and parsing","description":"Complete unit test coverage for diary.ts:\n- extractDiary() from session exports\n- DiaryEntry parsing and validation\n- Context extraction from agent conversations\n- Delta extraction from diary entries\n- Multi-agent session handling\n- Edge cases: empty sessions, malformed entries, very long entries\n- Timestamp handling and ordering\nNO MOCKS - use real session export fixtures","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-08T01:25:40.015302Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-tmg0","title":"[P0] Add unit tests for cm.ts CLI router","description":"# Task: Unit tests for cm.ts (544 lines)\n\n## Why Critical\ncm.ts is the CLI entry point - ALL user interactions flow through it. Zero test coverage means:\n- Command routing bugs go undetected\n- Global flag handling (--no-emoji, --no-color, --width) untested\n- Error handling for invalid commands untested\n- Version/help output formatting untested\n\n## What to Test\n\n### Command Routing\n- [ ] Each command name resolves to correct handler\n- [ ] Unknown commands produce helpful error\n- [ ] Command aliases work (if any)\n\n### Global Options\n- [ ] --no-emoji disables icons in output\n- [ ] --no-color disables ANSI escape codes\n- [ ] --width <n> affects table/output formatting\n- [ ] --json enables JSON output mode globally\n- [ ] --verbose enables debug logging\n\n### Argv Normalization\n- [ ] --no-history converts to --history 0\n- [ ] Other normalization rules work correctly\n\n### Error Handling\n- [ ] Missing required args produce clear error\n- [ ] Invalid flag values produce clear error\n- [ ] Exit codes are correct per error type\n\n### Help/Version\n- [ ] --help shows all commands\n- [ ] --version shows correct version\n- [ ] Per-command --help works\n\n## Implementation Notes\n- Use withTempCassHome for isolation\n- Capture stdout/stderr for output verification\n- Test via programmatic invocation, not shell exec\n- ~20-30 test cases expected\n\n## Files\n- Source: src/cm.ts (544 lines)\n- Test: test/cm.test.ts (new)\n\n## Acceptance\n- [ ] All routing paths covered\n- [ ] All global options tested\n- [ ] Error cases covered\n- [ ] No mocks used","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-16T15:29:37.381242Z","updated_at":"2025-12-16T17:18:18.984392Z","closed_at":"2025-12-16T17:18:18.984392Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-tp7","title":"[Diary] exportSessionSafe - Session export with validation","description":"Safely export session content with validation and fallback to raw file reading.\n\nFunction Signature:\nasync function exportSessionSafe(\n  sessionPath: string,\n  cassPath: string\n): Promise<{ content: string | null; error?: string }>\n\nProcess:\n1. Validate sessionPath exists on filesystem\n2. Check file size (reject if >50MB to prevent memory issues)\n3. Try primary method: cass export sessionPath\n4. If cass export fails, try fallback: raw file read\n5. For raw read, use formatRawSession based on extension\n6. Return { content } on success or { content: null, error } on failure\n\nValidation Steps:\n- File exists check (fs.existsSync)\n- File size check (fs.statSync - reject >50MB)\n- File readable check (fs.accessSync)\n\nPrimary Method (cass export):\n- Execute: cass export <sessionPath>\n- Captures formatted session content\n- Handles all cass-supported formats\n- Includes sanitization automatically\n\nFallback Method (raw read):\n- Read file directly with fs.readFileSync\n- Detect extension (.jsonl, .json, .md)\n- Pass to formatRawSession for parsing\n- Manual sanitization required\n\nError Cases:\n- File not found: { content: null, error: 'File not found' }\n- File too large: { content: null, error: 'File exceeds 50MB limit' }\n- Cass failed + raw failed: { content: null, error: 'Both export methods failed' }\n- Read permission denied: { content: null, error: 'Permission denied' }\n\nKey Features:\n- Graceful degradation (cass → raw)\n- Size limit prevents memory exhaustion\n- Detailed error messages\n- Never throws exceptions\n\nOutput:\nReturns object with content string or error message.","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:47:15.958626Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-tq21","title":"[MCP:Future] memory_search tool definition","description":"Define memory_search tool for MCP:\n\n```typescript\n{\n  name: \"memory_search\",\n  description: \"Search playbook and cass history\",\n  inputSchema: {\n    type: \"object\",\n    properties: {\n      query: { type: \"string\" },\n      scope: { enum: [\"playbook\", \"cass\", \"both\"] },\n      limit: { type: \"number\", default: 10 }\n    },\n    required: [\"query\"]\n  }\n}\n```\n\nEnables agents to search through the memory system for specific information.","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:49:31.352618Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-tr8y","title":"[CLI:doctor] runSelfTest - End-to-end smoke test","description":"Implements the runSelfTest function that performs end-to-end smoke tests of core functionality.\n\nFUNCTION SIGNATURE:\n```typescript\nasync function runSelfTest(config: Config): Promise<HealthCheck[]>\n```\n\nTESTS PERFORMED:\n\n1. PLAYBOOK LOAD PERFORMANCE:\n   - Load playbook from disk\n   - Measure load time\n   - Parse and validate structure\n   - Warn if >500ms (performance issue)\n   - Report: \"Playbook load: 45ms (156 bullets)\"\n\n2. CASS SEARCH LATENCY:\n   - Execute sample cass query\n   - Measure end-to-end latency\n   - Warn if >2 seconds\n   - Fail if >5 seconds or error\n   - Report: \"Cass search: 120ms\"\n\n3. SANITIZATION PATTERN BREADTH:\n   - Load sanitization patterns\n   - Count patterns by category\n   - Verify all required categories present\n   - Warn if <10 patterns total\n   - Report: \"Sanitization: 23 patterns loaded\"\n\n4. CONFIG VALIDATION:\n   - Validate all config values\n   - Check for deprecated options\n   - Verify paths are absolute\n   - Check for common misconfigurations\n   - Report: \"Config valid\"\n\n5. EMBEDDING SYSTEM:\n   - Check if embeddings enabled\n   - Test embedding generation for sample text\n   - Measure latency\n   - Report status\n   - Report: \"Embeddings: enabled (OpenAI ada-002)\"\n\nIMPLEMENTATION DETAILS:\n\nPlaybook Load Test:\n```typescript\nconst start = Date.now();\nconst playbook = await loadPlaybook(config.playbookPath);\nconst loadTime = Date.now() - start;\n\nif (loadTime > 500) {\n  return [{\n    category: 'Self-Test',\n    item: 'Playbook Load',\n    status: 'warn',\n    message: `Slow: ${loadTime}ms (consider optimization)`,\n  }];\n} else {\n  return [{\n    category: 'Self-Test',\n    item: 'Playbook Load',\n    status: 'pass',\n    message: `${loadTime}ms (${playbook.bullets.length} bullets)`,\n  }];\n}\n```\n\nCass Search Test:\n```typescript\nconst start = Date.now();\ntry {\n  const result = await exec('cass search \"test query\" --limit 5');\n  const searchTime = Date.now() - start;\n  \n  if (searchTime > 5000) {\n    return [{ status: 'fail', message: 'Very slow: ${searchTime}ms' }];\n  } else if (searchTime > 2000) {\n    return [{ status: 'warn', message: 'Slow: ${searchTime}ms' }];\n  } else {\n    return [{ status: 'pass', message: '${searchTime}ms' }];\n  }\n} catch (err) {\n  return [{ status: 'fail', message: 'Search failed: ${err.message}' }];\n}\n```\n\nSanitization Check:\n- Load patterns from config/patterns directory\n- Count by category (secrets, pii, sensitive_data)\n- Verify minimum coverage\n- Report total count\n\nConfig Validation:\n- Check all paths are absolute (not relative)\n- Verify no deprecated options\n- Check LLM model names are valid\n- Validate threshold values in range\n\nERROR HANDLING:\n- Graceful degradation if test fails\n- Report specific error details\n- Don't fail overall doctor run\n- Suggest fixes where applicable\n\nDEPENDENCIES:\n- Playbook loader\n- Cass CLI wrapper\n- Sanitization system\n- Config system\n- Performance measurement utilities\n\nSUCCESS CRITERIA:\n- Tests complete in <3 seconds total\n- Accurate performance measurements\n- Detects common issues (slow loads, bad configs)\n- Clear actionable feedback\n- No side effects from tests","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:56:06.592133Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-tv3j","title":"[MCP:Future] memory_mark tool definition","description":"Define memory_mark tool for MCP:\n\n```typescript\n{\n  name: \"memory_mark\",\n  description: \"Mark a playbook bullet as helpful or harmful\",\n  inputSchema: {\n    type: \"object\",\n    properties: {\n      bulletId: { type: \"string\" },\n      helpful: { type: \"boolean\" },\n      reason: { type: \"string\" }\n    },\n    required: [\"bulletId\", \"helpful\"]\n  }\n}\n```\n\nAllows agents to provide feedback on playbook bullets for reinforcement learning.","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:49:30.268429Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-two0","title":"[Unit] utils.ts - Pure Function Tests (Part 2: String & Hash Utilities)","description":"## Target: src/utils.ts - Part 2: String & Hash Utilities\n\n### Functions to Test:\n1. **slugify(text)** - Convert text to URL-safe slug\n   - Basic conversion: 'Hello World' → 'hello-world'\n   - Special chars: 'Test@#$%' → 'test'\n   - Unicode handling: 'Café Müller' → appropriate slug\n   - Empty string → empty or throws\n   - Whitespace normalization: '  multiple   spaces  ' → 'multiple-spaces'\n\n2. **hashContent(content)** - Generate deterministic hash\n   - Same input → same hash (deterministic)\n   - Different inputs → different hashes\n   - Empty string handling\n   - Large content (10KB+) performance\n   - Unicode content hashing\n\n3. **truncate(str, maxLen, suffix)** - Truncate with suffix\n   - String shorter than max → unchanged\n   - String at max → unchanged\n   - String longer → truncated with suffix\n   - Custom suffix: '...' vs '…' vs ''\n   - Edge: maxLen < suffix length\n   - Unicode safety (don't break mid-character)\n\n4. **formatBytes(bytes)** - Human-readable byte sizes\n   - 0 → '0 B'\n   - 1023 → '1023 B'\n   - 1024 → '1 KB'\n   - 1048576 → '1 MB'\n   - Decimal precision handling\n   - Negative numbers (error case)\n\n5. **formatDuration(ms)** - Human-readable durations\n   - 0 → '0ms' or '0s'\n   - 999 → '999ms'\n   - 1000 → '1s'\n   - 60000 → '1m'\n   - 3600000 → '1h'\n   - Combined: 3661000 → '1h 1m 1s'\n\n### Test Patterns:\n- Property-based: hash(x) always same length\n- Boundary testing: exactly at thresholds\n- Round-trip where applicable\n- No mocks - pure functions only","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-08T01:24:25.392783Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-u00q","title":"Add unit tests for examples.ts module","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T05:28:09.205293707Z","created_by":"ubuntu","updated_at":"2026-01-07T05:33:14.213702496Z","closed_at":"2026-01-07T05:33:14.213702496Z","close_reason":"Added 14 comprehensive tests covering JSON and human output formats","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-u3nh","title":"Integration test: Config + Scoring interaction","description":"Integration test for Config + Scoring:\n- Config loading from file\n- Scoring with config-driven parameters\n- Decay calculation with configurable half-life\n- Score thresholds from config\n- Verify config merging with defaults\n- Detailed logging: config source, merged values, scoring decisions\nNO MOCKS - real config.ts + scoring.ts interaction","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-08T01:26:31.093568Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-u64s","title":"[Test] Epic: Unit Tests - Pure Function Testing","description":"# Unit Test Epic\n\n## Philosophy\nTest individual functions in ISOLATION but with REAL implementations.\n- NO mocks for internal dependencies\n- NO mocks for file I/O (use temp dirs)\n- NO mocks for YAML parsing\n- ONLY mock external LLM APIs when absolutely necessary\n\n## Modules to Test (Priority Order)\n\n### P0 - Core Logic (Must Have)\n1. scoring.ts - Decay algorithms, maturity state machine\n2. playbook.ts - CRUD operations, bullet management\n3. config.ts - Config loading, merging, validation\n4. types.ts - Schema validation, edge cases\n\n### P1 - Pipeline Components\n5. curate.ts - Delta application, deduplication (partial exists)\n6. reflect.ts - Multi-iteration reflection helpers\n7. validate.ts - Evidence gate, validation normalization\n8. diary.ts - Diary generation, field extraction\n\n### P2 - Utilities\n9. utils.ts - All utility functions\n10. security.ts - Sanitization (exists, expand)\n11. tracking.ts - Session tracking\n12. lock.ts - File locking\n13. cass.ts - Cass binary integration (integration tests better)\n\n## Test Structure\nEach module test file should:\n- Import only the module under test\n- Use factory helpers for test data\n- Test happy path + edge cases + error cases\n- Achieve >90% line coverage for that module\n\n## Naming Convention\ntest/{module}.test.ts - Unit tests for src/{module}.ts\ntest/{module}.integration.test.ts - Integration tests\n\n## Acceptance Criteria\n- [ ] All exported functions have tests\n- [ ] Edge cases documented and tested\n- [ ] No external network calls\n- [ ] Tests are deterministic\n- [ ] Each test file runs in <5 seconds","status":"tombstone","priority":0,"issue_type":"epic","created_at":"2025-12-08T01:22:58.167624Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"epic","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-u9jw","title":"[ErrorHandling] handleCassUnavailable - Graceful degradation","description":"Implement graceful degradation when cass CLI is unavailable.\n\nFunction signature:\nasync function handleCassUnavailable(): Promise<{ \n  canContinue: boolean;\n  fallbackMode: 'playbook-only' | 'none';\n  message: string \n}>\n\nImplementation:\n- Try common installation paths (/usr/local/bin/cass, ~/.cargo/bin/cass, ~/.local/bin/cass)\n- If found, suggest setting CASS_PATH environment variable\n- If not found, enable playbook-only mode (no session ingestion, only playbook operations)\n- Log clear instructions for installation (cargo install cass or download from releases)\n- Return appropriate fallback mode and user-friendly message\n\nThis ensures the tool can still function for playbook management even without cass installed.","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:50:46.812240Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-uazo","title":"Task: Add missing icons to ICONS table (success, failure, skipped)","description":"# Task: Add Missing Icons to ICONS Table\n\n## Context\n\nCommands are hardcoding `✓`, `✗`, `⊘` characters because the ICONS table in output.ts doesn't have these simple status indicators.\n\n## Current ICONS Table (output.ts:42-65)\n\nHas: chart, star, check (✅), warning (⚠️), neutral, pin, tip, brain, note, fix, test, rocket, hospital, construction, diary, target, palette, folder, trophy, thumbsUp, clock, merge\n\nMissing: Simple success/failure/skipped indicators that match what commands are hardcoding.\n\n## Solution\n\nAdd new icons to the table:\n\n```typescript\n// output.ts - Add to IconName type\ntype IconName =\n  | \"chart\"\n  // ... existing ...\n  | \"success\"   // ✓ for simple success\n  | \"failure\"   // ✗ for failures\n  | \"skipped\";  // ⊘ for skipped items\n\n// Add to ICONS object\nconst ICONS: Record<IconName, { emoji: string; plain: string }> = {\n  // ... existing icons ...\n  success: { emoji: \"✓\", plain: \"[OK]\" },\n  failure: { emoji: \"✗\", plain: \"[FAIL]\" },\n  skipped: { emoji: \"⊘\", plain: \"[SKIP]\" },\n};\n```\n\n## Design Decision: Why Not Use Existing \"check\"?\n\nThe existing `check` icon is ✅ (green checkmark emoji). Commands are using `✓` (simple Unicode checkmark). These are visually different:\n- ✅ = Full emoji, colorful, big\n- ✓ = Simple Unicode, inline with text\n\nWe want to preserve the current visual appearance while routing through the icon system.\n\n## Files to Modify\n\n- src/output.ts\n\n## Acceptance Criteria\n\n- [ ] IconName type includes \"success\", \"failure\", \"skipped\"\n- [ ] ICONS object has entries for all three\n- [ ] Plain text alternatives are readable ([OK], [FAIL], [SKIP])\n- [ ] `icon(\"success\")` returns \"✓\" when emoji enabled, \"[OK]\" when disabled\n\n## Dependencies\n\nNone - this is a foundational task.\n\n## Notes\n\nKeep this task small and focused. The replacement of hardcoded emoji is a separate task.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T18:25:47.405835Z","updated_at":"2025-12-15T19:58:40.992853Z","closed_at":"2025-12-15T19:58:40.992853Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-uf2z","title":"[MCP:Future] stats resource definition","description":"Define stats resource for MCP:\n\n```typescript\n{\n  uri: \"memory://stats\",\n  name: \"Playbook Stats\",\n  description: \"Playbook health metrics\",\n  mimeType: \"application/json\"\n}\n```\n\nReturns PlaybookStats as a resource for monitoring playbook health.","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:49:35.063416Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-uhyz","title":"Harden diary --raw parsing for Codex JSONL","description":"FormatRawSession currently treats Codex CLI JSONL entries as unknown/empty because it only reads role/content fields. Add handling for response_item/payload.message and skip session_meta to produce usable diaries in --raw mode.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-07T05:32:53.931648790Z","created_by":"ubuntu","updated_at":"2026-01-07T05:34:37.535873541Z","closed_at":"2026-01-07T05:34:37.535873541Z","close_reason":"Implementation complete with tests: session_meta skipped, response_item/payload.message handled, array content blocks supported","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-uj8","title":"[Validator] evidenceCountGate - Pre-LLM evidence filter","description":"Implement the evidenceCountGate function - Pre-LLM evidence filter that uses simple counts from cass hits + diary status correlation.\n\nCOMPLETE IMPLEMENTATION:\n```typescript\n/**\n * Pre-LLM filter: check if there's enough evidence to even consider this rule.\n * Uses simple counts from cass hits + diary status correlation.\n */\nasync function evidenceCountGate(\n  content: string,\n  config: Config\n): Promise<EvidenceGateResult> {\n  const keywords = extractKeywords(content);\n  const hits = await cassSearch(keywords.join(\" \"), { limit: 20, days: 90 });\n\n  if (hits.length === 0) {\n    return {\n      passed: true,  // No evidence either way - allow as draft\n      reason: \"No historical evidence found, proposing as draft\",\n      suggestedState: \"draft\",\n      sessionCount: 0, successCount: 0, failureCount: 0\n    };\n  }\n\n  // Group by unique session\n  const sessions = new Set(hits.map(h => h.source_path));\n\n  // Correlate with diaries to get success/failure counts\n  let successCount = 0;\n  let failureCount = 0;\n\n  for (const sessionPath of sessions) {\n    const diary = await findDiaryBySession(sessionPath);\n    if (diary) {\n      if (diary.status === \"success\") successCount++;\n      else if (diary.status === \"failure\") failureCount++;\n    }\n  }\n\n  const sessionCount = sessions.size;\n\n  // Gate 1: Single session - too early to generalize\n  if (sessionCount === 1) {\n    return {\n      passed: true,\n      reason: \"Single session only - proposing as draft for further validation\",\n      suggestedState: \"draft\",\n      sessionCount, successCount, failureCount\n    };\n  }\n\n  // Gate 2: More failures than successes - REJECT\n  if (failureCount > successCount && failureCount >= 2) {\n    return {\n      passed: false,\n      reason: `Pattern appears in ${failureCount} failed sessions vs ${successCount} successful - rejecting`,\n      suggestedState: \"draft\",\n      sessionCount, successCount, failureCount\n    };\n  }\n\n  // Gate 3: Strong evidence - allow as active candidate\n  if (successCount >= 3 && failureCount === 0) {\n    return {\n      passed: true,\n      reason: `Strong evidence: ${successCount} successful sessions, 0 failures`,\n      suggestedState: \"active\",\n      sessionCount, successCount, failureCount\n    };\n  }\n\n  // Default: pass to LLM, suggest draft\n  return {\n    passed: true,\n    reason: `Mixed evidence: ${sessionCount} sessions (${successCount} success, ${failureCount} failure)`,\n    suggestedState: \"draft\",\n    sessionCount, successCount, failureCount\n  };\n}\n```\n\nWHY THIS MATTERS:\n- Saves LLM cost by filtering out obviously bad rules\n- Improves quality by rejecting patterns from failed sessions\n- Fast heuristic-based validation before expensive LLM call\n- Scientific validation: rules must be supported by historical evidence\n\nVALIDATION GATES:\n1. Single session → draft (too early to generalize)\n2. More failures than successes → REJECT\n3. 3+ successes, 0 failures → active candidate\n4. Mixed evidence → pass to LLM as draft\n\nDEPENDENCIES:\n- extractKeywords() - Extract search terms from rule\n- cassSearch() - Search historical sessions\n- findDiaryBySession() - Get success/failure status\n\nLOCATION:\n- src/validator/evidence-gate.ts","status":"tombstone","priority":3,"issue_type":"task","created_at":"2025-12-07T21:44:51.519581Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-uj99","title":"[EPIC] Complete Unit Test Coverage Without Mocks","description":"# Epic: Complete Unit Test Coverage\n\n## Goal\nAchieve comprehensive unit test coverage for ALL source modules without relying on mocks or fake implementations. Tests should exercise real code paths with isolated test environments (temp directories, test configs).\n\n## Current State (from analysis)\n- **67% command coverage** (16/24 commands tested)\n- **81% core module coverage** (21/26 modules tested)\n- **Critical gaps**: cm.ts (CLI router), orchestrator.ts (reflection loop), 8 commands with zero tests\n\n## Success Criteria\n- [ ] 100% of src/commands/*.ts have dedicated test files\n- [ ] 100% of src/*.ts core modules have dedicated test files\n- [ ] No test file uses module-level mocking (vi.mock, jest.mock)\n- [ ] All tests use withTempCassHome or similar isolation\n- [ ] Test-to-source ratio >= 1.5:1 for complex modules\n\n## Subtasks (in dependency order)\n1. P0: Test cm.ts CLI router\n2. P0: Test orchestrator.ts reflection loop\n3. P0: Test why.ts command\n4. P1: Test privacy.ts command\n5. P1: Test stale.ts command\n6. P1: Test output.ts formatting\n7. P1: Test starters.ts module\n8. P2: Test top.ts command\n9. P2: Test project.ts command\n10. P2: Test quickstart.ts command\n11. P2: Test audit.ts command\n12. P3: Expand outcome.ts test coverage\n13. P3: Expand diary.ts test coverage\n\n## Anti-patterns to avoid\n- NO vi.mock() or jest.mock() for module replacement\n- NO fake LLM responses (use real prompts with deterministic test data)\n- NO hardcoded paths (use temp directories)\n- NO process.exit() in tests (use process.exitCode)","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-16T15:29:22.983799Z","updated_at":"2025-12-28T03:37:21.772926Z","closed_at":"2025-12-28T03:37:21.772926Z","close_reason":"All 11 dependency tasks completed: cm.ts, orchestrator.ts, why.ts, privacy.ts, stale.ts, output.ts, starters.ts, top.ts, project.ts, quickstart.ts, audit.ts","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-uj99","depends_on_id":"cass_memory_system-0pzz","type":"blocks","created_at":"2026-01-21T09:28:52Z","created_by":"import"},{"issue_id":"cass_memory_system-uj99","depends_on_id":"cass_memory_system-2r9c","type":"blocks","created_at":"2026-01-21T09:28:52Z","created_by":"import"},{"issue_id":"cass_memory_system-uj99","depends_on_id":"cass_memory_system-7r6y","type":"blocks","created_at":"2026-01-21T09:28:52Z","created_by":"import"},{"issue_id":"cass_memory_system-uj99","depends_on_id":"cass_memory_system-h6fy","type":"blocks","created_at":"2026-01-21T09:28:52Z","created_by":"import"},{"issue_id":"cass_memory_system-uj99","depends_on_id":"cass_memory_system-jztq","type":"blocks","created_at":"2026-01-21T09:28:52Z","created_by":"import"},{"issue_id":"cass_memory_system-uj99","depends_on_id":"cass_memory_system-jzwe","type":"blocks","created_at":"2026-01-21T09:28:52Z","created_by":"import"},{"issue_id":"cass_memory_system-uj99","depends_on_id":"cass_memory_system-n0mc","type":"blocks","created_at":"2026-01-21T09:28:52Z","created_by":"import"},{"issue_id":"cass_memory_system-uj99","depends_on_id":"cass_memory_system-qrha","type":"blocks","created_at":"2026-01-21T09:28:52Z","created_by":"import"},{"issue_id":"cass_memory_system-uj99","depends_on_id":"cass_memory_system-rwv7","type":"blocks","created_at":"2026-01-21T09:28:52Z","created_by":"import"},{"issue_id":"cass_memory_system-uj99","depends_on_id":"cass_memory_system-tmg0","type":"blocks","created_at":"2026-01-21T09:28:52Z","created_by":"import"},{"issue_id":"cass_memory_system-uj99","depends_on_id":"cass_memory_system-w558","type":"blocks","created_at":"2026-01-21T09:28:52Z","created_by":"import"}]}
{"id":"cass_memory_system-ukif","title":"Unit tests for types.ts - Schema validation & type guards","description":"Complete unit test coverage for types.ts:\n- All Zod schema validations (PlaybookBulletSchema, DeltaSchema, DiaryEntrySchema, etc.)\n- Type guard functions (isBulletScope, isValidCategory)\n- Schema edge cases (missing fields, invalid values, type coercion)\n- PlaybookBulletBaseSchema vs PlaybookBulletSchema behavior\n- NewBulletDataSchema partial validation\n- ScoredBulletSchema extended fields\n- FeedbackEventSchema with various event types\n- Test that superRefine scope validation works correctly\nNO MOCKS - use real schema parsing","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-08T01:25:12.674939Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-ulot","title":"(deleted)","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-16T15:35:53.571120Z","updated_at":"2025-12-16T16:32:06.197073Z","closed_at":"2025-12-16T16:32:06.197073Z","source_repo":".","deleted_at":"2025-12-07T21:50:16.045482Z","deleted_by":"jemanuel","delete_reason":"batch delete","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-ulu7","title":"Epic: Agent UX Improvements for Discoverability and Consistency","description":"## Overview\n\nThis epic addresses several agent-friendliness issues identified during comprehensive code review. The goal is to make cass-memory more intuitive and discoverable for AI coding agents, who are the primary users.\n\n## Problem Statement\n\nAI agents learn patterns from existing commands. When command structures are inconsistent, agents experience friction and make mistakes. Currently:\n\n1. **Inconsistent command patterns**: `playbook` and `privacy` use subcommands (`playbook list`, `privacy status`) but `onboard` uses flags (`--status`, `--sample`). This inconsistency creates cognitive load.\n\n2. **Solo user gap**: The quickstart documentation tells agents \"don't run reflect manually\" but doesn't explain what solo users (who are both agent AND operator) should do instead.\n\n3. **Undocumented options**: The `mark --harmful --reason` flag accepts specific enum values (caused_bug, wasted_time, etc.) but these aren't documented in --help.\n\n4. **Command overload**: The `onboard` command has ~12 mutually exclusive flags representing different workflow steps, making it hard to discover and use.\n\n## Success Criteria\n\n- [ ] All commands follow consistent subcommand patterns where appropriate\n- [ ] Quickstart includes clear guidance for solo users\n- [ ] All enum/option values are documented in --help\n- [ ] Agent can discover `onboard` functionality via `cm onboard --help` seeing a list of subcommands\n- [ ] Backwards compatibility maintained with deprecation warnings\n\n## Design Principles\n\n1. **Consistency over convenience**: Match established patterns even if flags seem \"simpler\"\n2. **Discoverability**: Agents should be able to explore via --help\n3. **Backwards compatibility**: Old syntax works with deprecation warnings\n4. **Progressive disclosure**: Simple use cases are simple, complex use cases are possible\n\n## Implementation Phases\n\n**Phase 1 (Quick Wins)**: Documentation fixes - no code changes to command behavior\n**Phase 2 (Onboard Refactor)**: Convert onboard flags to subcommands with deprecation layer\n**Phase 3 (Polish)**: Optional improvements to outcome command UX\n\n## Dependencies\n\nNone - this epic is independent of other work.\n\n## Risks\n\n- Breaking change for users with scripts using old onboard flags\n  - Mitigation: 6-month deprecation period with clear warnings\n- Increased code complexity from deprecation layer\n  - Mitigation: Remove deprecated code in next major version","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-12-15T17:16:21.550850Z","updated_at":"2025-12-15T17:51:20.987684Z","closed_at":"2025-12-15T17:51:20.987684Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-ulu7","depends_on_id":"cass_memory_system-84gh","type":"blocks","created_at":"2026-01-21T09:28:52Z","created_by":"import"},{"issue_id":"cass_memory_system-ulu7","depends_on_id":"cass_memory_system-b9dr","type":"blocks","created_at":"2026-01-21T09:28:52Z","created_by":"import"},{"issue_id":"cass_memory_system-ulu7","depends_on_id":"cass_memory_system-e6o7","type":"blocks","created_at":"2026-01-21T09:28:52Z","created_by":"import"},{"issue_id":"cass_memory_system-ulu7","depends_on_id":"cass_memory_system-uom9","type":"blocks","created_at":"2026-01-21T09:28:52Z","created_by":"import"}]}
{"id":"cass_memory_system-umj0","title":"[Test] Helpers: Playbook and bullet factories","description":"Create test/helpers/factories.ts with:\n\n## Functions\n\n### createTestBullet(overrides?: Partial<PlaybookBullet>): PlaybookBullet\n- Returns valid bullet with sensible defaults\n- Generates unique ID if not provided\n- Sets timestamps to now()\n- Merges overrides\n\n### createTestPlaybook(options?: { bulletCount?: number; withDeprecated?: boolean }): Playbook\n- Returns valid playbook with configurable bullets\n- Uses createTestBullet internally\n- Generates metadata timestamps\n\n### createTestDiary(overrides?: Partial<DiaryEntry>): DiaryEntry\n- Returns valid diary with realistic content\n- Sets session path to temp path\n- Generates unique ID\n\n### createTestConfig(overrides?: Partial<Config>): Config\n- Returns valid config with defaults\n- No LLM API keys (tests shouldn't call LLM)\n- Uses temp paths for playbook/diary\n\n### createFeedbackEvent(type: \"helpful\" | \"harmful\", daysAgo?: number): FeedbackEvent\n- Creates feedback event with timestamp\n- daysAgo parameter for testing decay\n\n## Design Principles\n- All factories return VALID objects (pass schema validation)\n- No external dependencies\n- Deterministic (same input = same output, except timestamps)\n- Composable (use factories in other factories)","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-08T01:22:43.345267Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-un2k","title":"[UX][onboarding] Restructure cm --help for progressive disclosure","description":"Problem\n- The CLI has many commands, but the product story is “one command for agents” (`cm context`).\n- Default help output doesn’t strongly guide new users and can feel overwhelming.\n\nWhat to do\n- Improve help information architecture:\n  - Put agent workflow first (context + quickstart)\n  - Group operator/maintenance commands separately (init/doctor/reflect/playbook)\n  - Group advanced/rare commands last (serve/outcome/audit/validate)\n  - Add 3-5 high-quality examples that match README\n\nConstraints\n- Keep commander usage intact; use built-in help hooks (`addHelpText`, `showHelpAfterError`, etc.).\n- Use invoked binary name (depends on naming task).","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-13T10:20:47.859404Z","updated_at":"2025-12-13T22:43:09.318407Z","closed_at":"2025-12-13T22:43:09.318407Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-un2k","depends_on_id":"cass_memory_system-1ojv","type":"parent-child","created_at":"2026-01-21T09:28:52Z","created_by":"import"},{"issue_id":"cass_memory_system-un2k","depends_on_id":"cass_memory_system-2yzr","type":"blocks","created_at":"2026-01-21T09:28:52Z","created_by":"import"}]}
{"id":"cass_memory_system-un7x","title":"[P2] Audit: Fix init partial state + safer repo playbook errors","description":"Fixes found during deep code audit:\n\n- `cm init` should be idempotent and repair partial global/repo state (e.g., config exists but playbook missing) without requiring `--force`.\n- Commands that modify playbooks should not silently ignore repo playbook load errors; this can lead to surprising writes to the wrong playbook.\n- Align playbook remove target selection with repo precedence.\n- Make `cm project` counts flag actually toggleable (`--no-show-counts`).","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-17T02:07:56.092630Z","updated_at":"2025-12-17T02:10:26.935353Z","closed_at":"2025-12-17T02:10:26.935353Z","close_reason":"Implemented audit fixes: init partial-state detection; project --no-show-counts; fail fast on repo playbook load errors in mutating commands; prefer repo target for playbook remove","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-un7x","depends_on_id":"cass_memory_system-bblo","type":"discovered-from","created_at":"2026-01-21T09:28:52Z","created_by":"import"}]}
{"id":"cass_memory_system-une","title":"[Validator] validateDeltas - Batch validate multiple deltas","description":"Implement the validateDeltas function - Batch validation for multiple playbook deltas.\n\nSIGNATURE:\n```typescript\nasync function validateDeltas(\n  deltas: PlaybookDelta[],\n  config: Config\n): Promise<Array<{ delta: PlaybookDelta; result: ValidationResult }>>\n```\n\nBATCH VALIDATION FLOW:\n1. Filter deltas to only \"add\" type (others pass through)\n2. For each delta requiring validation:\n   - Run validateDelta(delta, config)\n   - Collect result\n3. Return array of delta + result pairs\n\nRETURN TYPE:\n```typescript\nArray<{\n  delta: PlaybookDelta;\n  result: {\n    valid: boolean;\n    reason: string;\n    evidence: string[];\n    suggestedState: \"draft\" | \"active\";\n  };\n}>\n```\n\nPARALLELIZATION OPTIONS:\nSequential (default):\n```typescript\nconst results = [];\nfor (const delta of deltas) {\n  if (delta.type === \"add\") {\n    const result = await validateDelta(delta, config);\n    results.push({ delta, result });\n  }\n}\n```\n\nParallel (optional optimization):\n```typescript\nconst validationPromises = deltas\n  .filter(d => d.type === \"add\")\n  .map(delta => validateDelta(delta, config).then(result => ({ delta, result })));\nconst results = await Promise.all(validationPromises);\n```\n\nFILTERING LOGIC:\n- Only validate deltas with type === \"add\"\n- \"remove\" deltas pass through (valid: true)\n- \"edit\" deltas could be validated (future enhancement)\n- Non-add deltas get default result: { valid: true, reason: \"No validation required\" }\n\nERROR HANDLING:\n- If one validation fails, continue with others\n- Collect errors in result.reason\n- Don't fail entire batch for single validation error\n\nWHY THIS MATTERS:\n- Enables bulk rule processing from `cm learn`\n- Supports batch imports from other sources\n- Can parallelize for performance (if LLM API supports it)\n- Provides consistent interface for single + batch operations\n\nUSE CASES:\n- `cm learn` generating multiple rules from one session\n- Importing rules from external playbooks\n- Re-validating existing rules against new evidence\n- Bulk operations on rule sets\n\nDEPENDENCIES:\n- validateDelta() - Single delta validation\n- PlaybookDelta type\n- Config type\n\nLOCATION:\n- src/validator/batch-validate.ts","status":"tombstone","priority":3,"issue_type":"task","created_at":"2025-12-07T21:44:57.802201Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-unhc","title":"[CLI] top command - Most effective bullets","description":"Implements the 'cass-memory top' command to show the most effective bullets.\n\nCOMMAND SYNTAX:\n```bash\ncass-memory top [N] [options]\n\nArguments:\n  N              Number of bullets to show (default: 10)\n\nOptions:\n  --scope SCOPE  Filter by scope (global, workspace, all)\n  --category CAT Filter by category\n  --json         Output as JSON\n```\n\nPURPOSE:\nQuick command to see which bullets are most effective based on current scores with decay applied. Useful for understanding what rules are working well.\n\nOUTPUT FORMAT (Terminal):\n```\nTOP 10 MOST EFFECTIVE BULLETS\n==============================\n\n1. [Score: 12.4] Use React.memo for expensive renders\n   Category: Performance | Scope: global | Maturity: proven\n   Feedback: 8× helpful, 0× harmful\n   Last used: 2 days ago\n\n2. [Score: 11.8] Run migrations in transaction\n   Category: Database | Scope: global | Maturity: proven\n   Feedback: 7× helpful, 0× harmful\n   Last used: 5 days ago\n\n3. [Score: 10.2] Validate input at API boundary\n   Category: Security | Scope: workspace | Maturity: established\n   Feedback: 5× helpful, 1× harmful\n   Last used: 1 day ago\n\n...\n```\n\nIMPLEMENTATION REQUIREMENTS:\n\n1. Load playbook from storage\n2. Calculate effective score for each bullet (with decay)\n3. Filter by scope/category if specified\n4. Sort by effective score descending\n5. Take top N bullets (default 10)\n6. Format and display\n\nSCORE CALCULATION:\n- Use effective score with time decay\n- Formula: base_score * decay_factor\n- Decay based on days since last feedback\n- See score calculation utilities\n\nDISPLAYED INFORMATION:\n- Rank and score\n- Bullet content (truncated to fit)\n- Category and scope\n- Maturity level\n- Feedback counts (helpful vs harmful)\n- Last used timestamp\n\nFILTERS:\n- --scope: global, workspace, or all\n- --category: filter to specific category\n- Can combine filters\n\nJSON OUTPUT:\n```json\n{\n  \"timestamp\": \"2025-01-15T10:30:00Z\",\n  \"count\": 10,\n  \"bullets\": [\n    {\n      \"rank\": 1,\n      \"id\": \"abc-123\",\n      \"score\": 12.4,\n      \"content\": \"Use React.memo for expensive renders\",\n      \"category\": \"Performance\",\n      \"scope\": \"global\",\n      \"maturity\": \"proven\",\n      \"feedback\": { \"helpful\": 8, \"harmful\": 0 },\n      \"lastUsed\": \"2025-01-13T08:00:00Z\"\n    },\n    ...\n  ]\n}\n```\n\nEDGE CASES:\n- Empty playbook → show message\n- N > bullet count → show all\n- All bullets negative scores → still show top N\n- Ties in score → sort by ID or last used\n\nDEPENDENCIES:\n- Playbook loader\n- Score calculation utilities\n- Date formatting\n- Terminal formatting (chalk, table)\n\nSUCCESS CRITERIA:\n- Shows most effective bullets accurately\n- Scores reflect current state with decay\n- Filters work correctly\n- Output is readable and informative\n- Performance <500ms for 1000+ bullets","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-07T21:56:52.057091Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-uom9","title":"Add solo-user workflow guidance to quickstart","description":"## Context\n\nThe quickstart command (`cm quickstart`) is designed to explain the system to AI agents. Currently it says:\n\n> \"Run `cm reflect` manually in a well-configured setup. An operator typically schedules it (cron/hook).\"\n\nThis assumes a separation between \"agent\" and \"operator\" - but many users are SOLO users who are both. The current guidance leaves them confused about what to do.\n\n## Problem\n\nA solo user (common case: individual developer using Claude Code) reads the quickstart and sees:\n1. \"Use `cm context` before tasks\" ✓ Clear\n2. \"Don't run reflect manually\" - But how do rules get learned then?\n3. \"An operator schedules it\" - But I AM the operator, what do I do?\n\n## Proposed Addition\n\nAdd a new section to `src/commands/quickstart.ts`:\n\n```markdown\n## Solo Users (You're Both Agent and Operator)\n\nIf you're working alone without scheduled reflection:\n\n**Option A: Manual Reflection (Recommended)**\n\\`\\`\\`bash\n# After completing significant work:\ncm reflect --days 1 --json\n\n# Weekly maintenance:\ncm reflect --days 7 --json\n\\`\\`\\`\n\n**Option B: Agent-Native Onboarding**\n\\`\\`\\`bash\n# Check what sessions need analysis:\ncm onboard --status --json\n\n# Sample sessions to review:\ncm onboard --sample --json\n\\`\\`\\`\n\nThe system works without scheduled reflection - it just means you trigger learning manually.\n```\n\n## Why This Matters\n\n- Most early adopters are solo users\n- The current docs create confusion and friction\n- Clear guidance reduces support burden\n- Aligns with \"agent-native\" design philosophy\n\n## Implementation\n\n1. Add new section to `getQuickstartText()` in src/commands/quickstart.ts\n2. Add corresponding fields to `getQuickstartJson()` for JSON output\n3. Position after \"What You Usually DON'T Need To Do\" section\n\n## Acceptance Criteria\n\n- [ ] `cm quickstart` shows solo user guidance\n- [ ] `cm quickstart --json` includes solo user info in JSON\n- [ ] Guidance is actionable (specific commands to run)\n\n## Effort Estimate\n\n~30 minutes\n\n## Part of Epic\n\ncass_memory_system-ulu7 (Agent UX Improvements)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T17:16:52.436713Z","updated_at":"2025-12-15T17:45:26.271089Z","closed_at":"2025-12-15T17:45:26.271089Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-usqd","title":"[E2E Tests] CLI mark command - feedback recording","description":"## E2E Test: CLI mark Command - Feedback Recording\n\n### Test Scenario\nTest `cm mark` records user feedback on bullets\n\n### Test Steps\n\n#### 1. Mark Positive Feedback\n- Initialize project with playbook containing bullets\n- Run `cm mark --helpful \"bullet content snippet\"`\n- Verify bullet confidence increased\n- Verify feedback event logged\n\n#### 2. Mark Negative Feedback\n- Run `cm mark --unhelpful \"bullet content\"`\n- Verify bullet confidence decreased\n- Verify feedback event logged\n\n#### 3. Mark with Session Context\n- Run `cm mark --helpful --session /path/to/session \"bullet\"`\n- Verify session path recorded in event\n- Verify helps future correlation\n\n#### 4. Mark Non-existent Bullet\n- Run `cm mark --helpful \"non existent bullet\"`\n- Verify graceful error message\n- Suggest similar bullets if available\n\n#### 5. Fuzzy Matching\n- Test partial content matching\n- Test case-insensitive matching\n- Verify correct bullet identified\n\n### Verbose Logging\n- Log: 'Recording feedback for bullet: <snippet>'\n- Log: 'Searching playbook for matching bullet...'\n- Log: 'Found matching bullet with confidence: X'\n- Log: 'Applying feedback: +/- Y confidence'\n- Log: 'New confidence: Z'\n- Log: 'Feedback recorded successfully'\n\n### Feedback Persistence\n- Verify feedback survives restart\n- Verify feedback affects future context","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-08T01:24:38.119372Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-uufj","title":"[Test Infrastructure] Helpers, Fixtures & Logging Framework","description":"## Target: Shared test infrastructure for all test suites\n\n### Helper Modules to Create:\n\n1. **test/helpers/temp-env.ts** - Temporary environment management\n   ```typescript\n   export async function createIsolatedEnvironment(): Promise<TestEnv>\n   export async function cleanupEnvironment(env: TestEnv): Promise<void>\n   export async function withTempCassHome<T>(fn: (home: string) => Promise<T>): Promise<T>\n   ```\n\n2. **test/helpers/cli-runner.ts** - CLI execution helpers\n   ```typescript\n   export interface CLIResult {\n     exitCode: number;\n     stdout: string;\n     stderr: string;\n     duration: number;\n   }\n   export async function runCLI(args: string[], options?: RunOptions): Promise<CLIResult>\n   ```\n\n3. **test/helpers/logging.ts** - Detailed test logging\n   ```typescript\n   export function log(message: string, ...data: unknown[]): void\n   export function logStep(step: string): void\n   export function logTiming(operation: string, durationMs: number): void\n   export function logFileState(path: string): void\n   export function summarize(): TestSummary\n   ```\n\n4. **test/helpers/fixtures.ts** - Test data generators\n   ```typescript\n   export function generateBullet(overrides?: Partial<PlaybookBullet>): PlaybookBullet\n   export function generatePlaybook(bulletCount: number): Playbook\n   export function generateDiaryEntry(date?: Date): DiaryEntry\n   export function generateFeedbackEvent(type: 'helpful' | 'harmful'): FeedbackEvent\n   ```\n\n5. **test/helpers/git.ts** - Git repository helpers\n   ```typescript\n   export async function createTempGitRepo(): Promise<string>\n   export async function cloneRepo(source: string): Promise<string>\n   export async function commitAll(repoPath: string, message: string): Promise<void>\n   ```\n\n6. **test/helpers/assertions.ts** - Custom assertions\n   ```typescript\n   export function expectValidPlaybook(playbook: unknown): asserts playbook is Playbook\n   export function expectValidBullet(bullet: unknown): asserts bullet is PlaybookBullet\n   export function expectFileContains(path: string, content: string): Promise<void>\n   ```\n\n### Logging Output Format:\n```\n[2024-01-15T10:30:45.123Z] [STEP] Starting: Initialize environment\n[2024-01-15T10:30:45.456Z] [INFO] Created temp dir: /tmp/cass-test-abc123\n[2024-01-15T10:30:45.789Z] [CLI] Running: cm init --json\n[2024-01-15T10:30:46.012Z] [CLI] Exit: 0 (223ms)\n[2024-01-15T10:30:46.012Z] [CLI] Stdout: {\"success\":true,...}\n[2024-01-15T10:30:46.012Z] [FILE] ~/.cass-memory/config.json: 234 bytes\n[2024-01-15T10:30:46.123Z] [PASS] Step completed successfully\n```\n\n### Configuration:\n- LOG_LEVEL env var (debug, info, warn, error)\n- LOG_FILE env var (optional file output)\n- KEEP_TEMP env var (don't cleanup for debugging)","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-08T01:31:37.249094Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-uugk","title":"Add unit tests for validateDelta function","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-07T05:44:17.625415963Z","created_by":"ubuntu","updated_at":"2026-01-07T05:47:47.447739079Z","closed_at":"2026-01-07T05:47:47.447739079Z","close_reason":"Added 6 unit tests for validateDelta covering skip paths and decision logging","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-v319","title":"[ErrorHandling] handlePermissionError - File access issues","description":"Provide helpful error messages for permission-related failures.\n\nFunction signature:\nfunction handlePermissionError(error: Error, path: string): never\n\nImplementation:\n- Detect EACCES and EPERM errors\n- Get file/directory permissions using fs.stat\n- Provide helpful message including:\n  * Which file/directory failed\n  * Current permissions (in readable format)\n  * Suggested fix command (chmod/chown)\n  * Example: 'chmod 644 /path/to/file' or 'sudo chown user /path'\n- Throw enhanced error with actionable guidance\n\nCommon scenarios:\n- Cannot read session files\n- Cannot write to playbook\n- Cannot create directories\n\nHelps users quickly resolve permission issues.","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:51:26.616724Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-v4j0","title":"[ErrorHandling] AbortController integration - Cancellable operations","description":"Implement operation cancellation via AbortController pattern.\n\nImplementation:\nlet shouldAbort = false;\n\nfunction checkAbort(): void {\n  if (shouldAbort) throw new AbortError('Operation cancelled');\n}\n\nUsage:\n- Set shouldAbort = true in SIGINT handler\n- Call checkAbort() periodically in long-running operations:\n  * Before each LLM API call\n  * Between session file reads\n  * During batch operations\n  * In loops processing multiple items\n\nBenefits:\n- Allows clean exit mid-operation\n- User can cancel long-running tasks\n- Prevents wasted API calls\n- Immediate response to Ctrl+C\n\nExample:\nfor (const session of sessions) {\n  checkAbort(); // Exit cleanly if user pressed Ctrl+C\n  await processSession(session);\n}","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:51:57.657974Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-v625","title":"[Tracking] Processed log file format","description":"File location: ~/.cass-memory/reflections/global.processed.log\n\nFormat: Tab-separated values (TSV) with header comment\n\nExample file:\n```\n# cass-memory processed sessions log\ndiary-abc123\t~/.claude/projects/app/session-001.jsonl\t2025-12-07T10:30:00Z\t5\t3\ndiary-def456\t~/.cursor/state.vscdb:session-xyz\t2025-12-07T11:00:00Z\t8\t6\ndiary-ghi789\t/workspace/.aider.input.history\t2025-12-07T12:15:00Z\t3\t3\n```\n\nColumns (tab-separated):\n1. diaryId: Unique ID for diary entry (or entry ID if no diary)\n2. sessionPath: Full path to original session\n3. processedAt: ISO 8601 timestamp\n4. deltasProposed: Count of proposed deltas\n5. deltasApplied: Count of applied deltas\n\nNotes:\n- TSV for easy grep/awk processing\n- One line per processed session\n- Sorted chronologically (append-only)\n- Use atomicWrite for safety","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:50:51.469599Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-v6bn","title":"[Semantic] getEmbedder - Lazy-load embedding pipeline","description":"Singleton pattern for embedding pipeline - model loaded once per process.\n\nImplementation:\n```typescript\nimport { pipeline } from \"@xenova/transformers\";\n\nlet embedder: any = null;\n\nasync function getEmbedder(): Promise<any> {\n  if (!embedder) {\n    // First call downloads model (~23MB) if not cached\n    embedder = await pipeline(\n      \"feature-extraction\",\n      \"Xenova/all-MiniLM-L6-v2\"\n    );\n  }\n  return embedder;\n}\n```\n\nPerformance:\n- First call: ~500ms (model loading)\n- Subsequent calls: <1ms (return cached instance)\n- Model cached to ~/.cache/huggingface/\n\nError handling:\n- Network errors during download\n- Model incompatibility\n- Fallback to keyword-only mode if fails\n\nModule scope:\n- Keep embedder at module level\n- Never re-instantiate\n- Thread-safe (single-threaded Node.js)","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-07T21:49:28.018624Z","updated_at":"2025-12-13T09:31:43.553356Z","closed_at":"2025-12-13T09:31:43.553356Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-v7ru","title":"[Unit Tests] types.ts - Schema validation tests","description":"## Unit Tests: types.ts - Schema Validation Tests\n\n### Test Categories\n\n#### 1. CassHitSchema Validation\n- Accepts valid hit objects\n- Rejects missing required fields\n- Coerces string scores to numbers\n- Handles optional fields correctly\n\n#### 2. DiaryEntrySchema Validation\n- Validates complete diary entries\n- Rejects invalid date formats\n- Validates nested bullet arrays\n- Handles optional reflection field\n\n#### 3. PlaybookSchema Validation\n- Validates full playbook structure\n- Validates bullets array\n- Validates toxic array\n- Validates metadata fields\n\n#### 4. BulletSchema Validation\n- Required: content, confidence\n- Optional: scope, maturity, created_at\n- Confidence range [0, 1]\n- Content minimum length\n\n#### 5. ConfigSchema Validation\n- Validates nested llm settings\n- Validates playbook_paths array\n- Default values applied\n- Type coercion where appropriate\n\n#### 6. Scope Utilities\n- matchesScope() exact matching\n- matchesScope() glob patterns\n- matchesScope() workspace filters\n- normalizeScope() standardization\n\n#### 7. Delta Schemas\n- FeedbackDeltaSchema validation\n- ReflectionDeltaSchema validation\n- MergeDeltaSchema validation\n\n### Test Approach\n- Test valid cases pass\n- Test invalid cases fail with clear errors\n- Verify error messages are helpful\n- Test edge cases (empty strings, null, undefined)\n\n### Error Message Quality\n- Schema errors should identify exact field\n- Should suggest valid values where possible","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-08T01:23:57.412093Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-v8m5","title":"Epic: CLI Agent-Friendliness Improvements","description":"# Epic: CLI Agent-Friendliness Improvements\n\n## Goal\nMake `cm` safe and intuitive for AI agents calling it programmatically:\n- `--json` behaves like a stable machine API (stdout = JSON only)\n- errors are structured + actionable (`code`/`hint`/`details`)\n- recommendations/advice are non-conflicting and bounded\n- human output stays polished and respects `CASS_MEMORY_NO_EMOJI`\n\n## Current State (Dec 15, 2025)\n✅ Major progress is in, but there are still a few agent-hostile edge cases:\n- Some commands still emit non-JSON failures in `--json` mode (e.g. `console.error` + `process.exit(1)`).\n- JSON response envelopes are inconsistent across commands:\n  - Many mutation commands use `printJsonResult()` (`success`, optional `effect: false` + `reason`).\n  - Several read-only commands still `printJson(payload)` without `success` (e.g. `context`, `doctor`, `similar`, `usage`).\n  - Top-level CLI error handler (`src/cm.ts` `handleError`) prints a *different* error shape (`error: { message, code }`).\n- A small amount of human output still hardcodes emoji (one `⚠` in `onboard gaps`).\n\n## Completed (Dec 15, 2025)\n- `printJsonResult()` + `printJsonError()` helpers exist in `src/utils.ts`, and many commands were migrated off raw `JSON.stringify`.\n- “Soft success” cases that previously returned empty stdout now return JSON (notably `cm outcome` / `cm outcome-apply` paths).\n- Standard error code vocabulary exists (`ErrorCode` in `src/types.ts`).\n- Icon system exists (`src/output.ts`), with most status glyphs routed through `icon()`/`iconPrefix()` and ASCII fallbacks for success/failure/skipped.\n\n## Remaining Work (tracked as beads)\n- `cass_memory_system-9iuc` — ensure *all* validation/catch error paths produce JSON when `--json` (no stdout breaks).\n- `cass_memory_system-54zp` — standardize the `--json` envelope + error schema across all commands (including `src/cm.ts handleError`).\n- `cass_memory_system-75kt` — keep `cm context` suggestion fields semantically pure (don’t mix remediation into `suggestedCassQueries`).\n- `cass_memory_system-shs3` — remove the last hardcoded warning emoji in `onboard gaps` (and decide warning ASCII fallback).\n- `cass_memory_system-zja7` — include `pi_agent` in known-agent defaults and detection (so PI history isn’t silently excluded).\n\n## Robot JSON Output Contract (V1 — proposed target)\n\n### Machine invariants\n- If `--json` (or `--format json`) is set: stdout must be *one* valid JSON value and nothing else.\n- In JSON mode, avoid writing to stderr for “expected” degraded states; surface those as structured fields in the JSON payload.\n- Prefer `process.exitCode = 1; return;` over `process.exit(1)` inside command modules so programmatic callers/tests aren’t forcibly terminated.\n\n### Response shape (reserved top-level keys)\n\nSuccess (effectful):\n```json\n{ \"success\": true, ...payload }\n```\n\nSoft success (ran but intentionally did nothing):\n```json\n{ \"success\": true, \"effect\": false, \"reason\": \"...\", ...payload }\n```\n\nError:\n```json\n{\n  \"success\": false,\n  \"code\": \"MISSING_REQUIRED\",\n  \"error\": \"Human-readable message\",\n  \"hint\": \"cm init\",\n  \"details\": { \"...\": \"...\" },\n  \"retryable\": false\n}\n```\n\nNotes:\n- `code` should come from `ErrorCode` in `src/types.ts`.\n- Keep the error payload flat (avoid multiple competing error shapes).\n- Avoid nesting the “real payload” under `data` unless absolutely necessary; top-level fields are easier for agents to consume.\n\n## Recommendations / advice integration (avoid confusing agents)\nWhen adding guidance fields (recommended actions, suggested queries, warnings, remediation steps):\n\n1. **Keep types pure**: do not mix different suggestion types in one array (e.g. don’t put `cargo install cass` inside `suggestedCassQueries`).\n2. **Bounded + ranked**: cap to ~5 items and sort deterministically (e.g. urgency high→low).\n3. **No contradictions**: if two actions conflict, emit only the best one OR express dependencies (`dependsOn`) instead of giving competing next steps.\n4. **One source of truth**: prefer `cm doctor` as the canonical “system remediation” recommender; other commands should not invent different install/index advice.\n5. **Progressive disclosure**: defaults should be concise; put long explanations in `cm quickstart --json` / `cm onboard prompt` rather than every command output.\n6. **Explain semantics once**: reserve field-meaning explanations for `cm quickstart --json`; other commands should rely on stable field names and minimal hints.","notes":"Meta (Dec 15 2025): Be meticulous about guidance integration. Keep suggestion fields type-pure (no remediation mixed into suggestedCassQueries; see cass_memory_system-75kt and the dtqi note). Prefer cm doctor as the single source of truth for remediation. PI is now tracked as pi_agent including a human-output icon requirement (cass_memory_system-zja7).","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-15T18:23:30.500990Z","updated_at":"2025-12-15T23:51:11.943563Z","closed_at":"2025-12-15T23:51:11.943563Z","close_reason":"All sub-tasks completed: 3wlb,yher,fqzc,9iuc,54zp,75kt,shs3,zja7 closed; ap27 tombstoned","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-v8m5","depends_on_id":"cass_memory_system-3wlb","type":"blocks","created_at":"2026-01-21T09:28:52Z","created_by":"import"},{"issue_id":"cass_memory_system-v8m5","depends_on_id":"cass_memory_system-54zp","type":"blocks","created_at":"2026-01-21T09:28:52Z","created_by":"import"},{"issue_id":"cass_memory_system-v8m5","depends_on_id":"cass_memory_system-75kt","type":"blocks","created_at":"2026-01-21T09:28:52Z","created_by":"import"},{"issue_id":"cass_memory_system-v8m5","depends_on_id":"cass_memory_system-9iuc","type":"blocks","created_at":"2026-01-21T09:28:52Z","created_by":"import"},{"issue_id":"cass_memory_system-v8m5","depends_on_id":"cass_memory_system-ap27","type":"blocks","created_at":"2026-01-21T09:28:52Z","created_by":"import"},{"issue_id":"cass_memory_system-v8m5","depends_on_id":"cass_memory_system-fqzc","type":"blocks","created_at":"2026-01-21T09:28:52Z","created_by":"import"},{"issue_id":"cass_memory_system-v8m5","depends_on_id":"cass_memory_system-shs3","type":"blocks","created_at":"2026-01-21T09:28:52Z","created_by":"import"},{"issue_id":"cass_memory_system-v8m5","depends_on_id":"cass_memory_system-yher","type":"blocks","created_at":"2026-01-21T09:28:52Z","created_by":"import"},{"issue_id":"cass_memory_system-v8m5","depends_on_id":"cass_memory_system-zja7","type":"blocks","created_at":"2026-01-21T09:28:52Z","created_by":"import"}]}
{"id":"cass_memory_system-vh56","title":"[Docs] CHANGELOG.md format and maintenance","description":"Create and maintain CHANGELOG.md following Keep a Changelog format.\n\nFormat:\n## [Unreleased]\n\n## [0.1.0] - 2025-12-07\n\n### Added\n- Initial release of cass-memory\n- Commands: init, context, diary, reflect, validate, mark, audit, playbook, project\n- Advanced commands: forget, stats, doctor, top, stale, why, similar\n- Confidence decay algorithm with configurable half-life\n- Scientific validation of playbook integrity\n- Three-layer memory model (Diary → Playbook → Project)\n- ACE pipeline (Generator → Reflector → Validator → Curator)\n- JSON output support for all commands\n- Cross-platform binary compilation (macOS, Linux, Windows)\n\n### Changed\n### Deprecated\n### Removed\n### Fixed\n### Security\n\nMaintain changelog with every release and keep Unreleased section for ongoing work","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-07T21:49:41.521876Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-vlyh","title":"[Unit] reflect.ts - Reflection System & Learning","description":"## Target: src/reflect.ts (428 LOC) - ZERO CURRENT COVERAGE\n\n### Functions to Test:\n\n1. **generateReflection(sessions, playbook)** - Main reflection\n   - Analyzes sessions for patterns\n   - Identifies learning opportunities\n   - Returns reflection report\n   - Handles empty sessions\n\n2. **extractPatterns(sessions)** - Pattern extraction\n   - Finds repeated code patterns\n   - Identifies common errors\n   - Groups by category\n   - Returns pattern objects\n\n3. **suggestBullets(patterns, existing)** - Bullet suggestions\n   - Generate new bullet suggestions\n   - Avoid duplicates with existing\n   - Include confidence scores\n   - Categorize by type\n\n4. **compareWithPlaybook(patterns, playbook)** - Comparison\n   - Find covered patterns\n   - Find gaps\n   - Suggest updates\n   - Return comparison report\n\n5. **rankSuggestions(suggestions, options)** - Rank suggestions\n   - Score by frequency\n   - Score by impact\n   - Score by recency\n   - Combined ranking\n\n6. **formatReflectionReport(reflection)** - Report formatting\n   - Markdown output\n   - Structured sections\n   - Actionable items highlighted\n   - Statistics included\n\n### Reflection Report Schema:\n- patternsFound: Pattern[]\n- suggestedBullets: BulletSuggestion[]\n- coverageGaps: string[]\n- statistics: ReflectionStats\n\n### Test Data:\n- Sample sessions with known patterns\n- Edge cases (no patterns, all patterns)\n- Performance with large session sets","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-08T01:29:15.355219Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-vol","title":"[Types] HarmfulReason - Structured reasons for harmful marks","description":"## Overview\nDefine enumeration of structured reasons for marking a bullet as 'harmful'. Enables analysis of WHY rules fail, not just THAT they fail.\n\n## Purpose\nWhen a playbook rule causes problems, capturing the specific failure mode enables:\n1. Pattern detection - Identify systemic issues (e.g., 'outdated rules are most common problem')\n2. Targeted improvements - Address root causes (e.g., add validation for outdated patterns)\n3. Better refinement - Reflector can learn from failure categories\n4. User insights - Help users understand what went wrong\n\n## Enumeration Values\n\n### caused_bug\n- Definition: Following the rule directly introduced a defect or error\n- Example: 'Use AuthService.login()' but AuthService was refactored to AuthManager\n- Severity: HIGH - broke functionality\n- Action: Often requires immediate deprecation or replacement\n\n### wasted_time\n- Definition: Advice led to unnecessary work or dead ends\n- Example: 'Run full test suite before commit' when project has no tests\n- Severity: MEDIUM - productivity loss\n- Action: Refine rule to check preconditions\n\n### contradicted_requirements\n- Definition: Rule conflicted with actual user needs or project goals\n- Example: 'Use REST API' when project mandate is GraphQL\n- Severity: MEDIUM - misalignment\n- Action: Update rule or mark as wrong scope\n\n### wrong_context\n- Definition: Rule is valid but was applied in inappropriate situation\n- Example: 'Use React hooks' suggested in Vue.js project\n- Severity: LOW - scope issue\n- Action: Improve scope filtering (workspace/framework)\n\n### outdated\n- Definition: Rule was correct historically but no longer applicable\n- Example: 'Use class components' after project migrated to hooks\n- Severity: MEDIUM - temporal drift\n- Action: Add verification check or automatic expiration\n\n### other\n- Definition: Catchall for unclassified failures\n- Example: Edge cases not fitting above categories\n- Severity: VARIABLE\n- Action: Review and potentially add new category\n\n## Type Definition\ntype HarmfulReason = 'caused_bug' | 'wasted_time' | 'contradicted_requirements' | 'wrong_context' | 'outdated' | 'other'\n\n## Usage in FeedbackEvent\nconst harmfulEvent: FeedbackEvent = { timestamp: '2025-12-07T14:30:00Z', sessionPath: '/path/to/session.jsonl', reason: 'caused_bug', context: 'AuthService was refactored to AuthManager' }\n\n## Analytics Use Cases\n- Stats command: Show distribution of failure reasons\n- Audit command: Group violations by reason\n- Reflector: Learn patterns (e.g., 'outdated' rules need verification)\n- Auto-prune: Higher weight for 'caused_bug' vs 'wrong_context'\n\n## Acceptance Criteria\n- TypeScript type with 6 enum values\n- JSDoc for each value explaining semantics\n- Examples of each failure mode in docs\n- Integration with FeedbackEvent type\n- Used in harmful event creation flows","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:44:57.133573Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-vuss","title":"[Testing] Add pure unit tests: config + utils (fs/time) without mocks","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-08T01:29:45.657311Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-vuxg","title":"[Config] detectRepoContext - Find .cass/ directory","description":"Function signature:\n```typescript\nasync function detectRepoContext(): Promise<{\n  inRepo: boolean;\n  repoRoot?: string;\n  cassDir?: string;\n}>\n```\n\nImplementation:\n1. Run `git rev-parse --show-toplevel` to find repo root\n   - If fails: not in a git repo, return { inRepo: false }\n2. Check if .cass/ directory exists in repo root\n3. Return context information\n\nReturn values:\n- inRepo: true if in a git repository\n- repoRoot: absolute path to git repo root (if inRepo)\n- cassDir: absolute path to .cass/ directory (if exists)\n\nUsed by config loader to determine if repo-level config should be loaded.\nCalled at startup of most commands to establish context.","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:49:54.839482Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-vvou","title":"[P2] Replace CM_REFLECTOR_STUBS env stubs with LLMIO injection","description":"Goal\n- Remove or minimize reliance on global `process.env.CM_REFLECTOR_STUBS` for deterministic tests by preferring explicit dependency injection (e.g. `LLMIO` / `test/helpers/llm-shim.ts`).\n\nCurrent usage\n- `CM_REFLECTOR_STUBS` is read in:\n  - `src/reflect.ts` (test stub fast-path)\n  - `src/llm.ts` (cached per-iteration stub outputs)\n\nAnd is set in a number of tests (unit/integration/e2e), e.g.:\n- `test/reflect.test.ts`, `test/orchestrator.test.ts`, `test/*pipeline*.test.ts`, `test/*learning*.test.ts`, `test/ace-pipeline.e2e.test.ts`\n\nPlan\n- Prefer passing stubbed `LLMIO` to functions that already accept it (`extractDiary`, `runReflector`, `runValidator`).\n- For pipeline/orchestrator tests that currently rely on env, introduce explicit injection points (without adding compat layers) so tests can supply deterministic reflector outputs without global env.\n\nDone means\n- Unit/integration tests no longer require `CM_REFLECTOR_STUBS`.\n- Any remaining env-based stubbing is limited to true process-level E2E tests (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T01:43:15.045818Z","updated_at":"2025-12-28T04:10:43.978500Z","closed_at":"2025-12-28T04:10:43.978500Z","close_reason":"Converted orchestrator.test.ts and pipeline.integration.test.ts to LLMIO injection. E2E tests retain env stubs for subprocess testing.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-vvou","depends_on_id":"cass_memory_system-sdt1.2.1","type":"discovered-from","created_at":"2026-01-21T09:28:52Z","created_by":"import"}]}
{"id":"cass_memory_system-w4g","title":"[Utils] extractKeywords - Stop word filtered keyword extraction","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:45:13.749170Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-w558","title":"[P0] Add unit tests for orchestrator.ts","description":"# Task: Unit tests for orchestrator.ts (362 lines)\n\n## Why Critical\norchestrator.ts orchestrates the core reflection/learning loop - the PRIMARY value prop of cass-memory. Untested means:\n- Session processing order bugs undetected\n- Concurrent reflection races undetected\n- Lock handling edge cases undetected\n- Pipeline failures silently corrupt state\n\n## What to Test\n\n### Reflection Orchestration\n- [ ] Single session reflection produces correct deltas\n- [ ] Multiple session batch reflection works\n- [ ] Session ordering is deterministic\n- [ ] Progress callbacks fire correctly\n\n### Concurrency & Locking\n- [ ] Concurrent reflections are serialized\n- [ ] Lock timeouts are handled gracefully\n- [ ] Partial failures don't corrupt state\n\n### Integration Points\n- [ ] Playbook updates are atomic\n- [ ] Diary entries are created correctly\n- [ ] Stats are updated accurately\n\n### Error Recovery\n- [ ] Failed session doesn't block others\n- [ ] Partial batch can be resumed\n- [ ] Errors are logged with context\n\n## Implementation Notes\n- Use withTempCassHome for isolated playbooks\n- Create test session files with known content\n- Verify playbook state before/after\n- Test concurrent access with Promise.all\n- ~25-35 test cases expected\n\n## Files\n- Source: src/orchestrator.ts (362 lines)\n- Test: test/orchestrator.test.ts (new)\n\n## Acceptance\n- [ ] All orchestration paths covered\n- [ ] Concurrency tested\n- [ ] Error recovery tested\n- [ ] No mocks used","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-16T15:30:14.409168Z","updated_at":"2025-12-16T17:31:51.443414Z","closed_at":"2025-12-16T17:31:51.443414Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-w5xt","title":"[Diary] formatRawSession - Parse raw session formats","description":"Format raw session files when cass export is unavailable.\n\nFunction Signature:\nfunction formatRawSession(content: string, ext: string): string\n\nSupported Extensions and Formats:\n\n1. Markdown (.md):\n   - Return content as-is\n   - Already human-readable\n   - Used by aider\n\n2. JSONL (.jsonl):\n   - Parse each line as separate JSON object\n   - Expected schema: { role: string, content: string }\n   - Format as: \"**{role}**: {content}\\n\\n\"\n   - Skip invalid lines with warning comment\n   - Used by Claude\n\n3. JSON (.json):\n   - Parse as single JSON object\n   - Expected schema: { messages: Array<{role, content}> }\n   - Format each message as: \"**{role}**: {content}\\n\\n\"\n   - Handle nested conversation structure\n   - Used by various agents\n\nFormat Examples:\n\nJSONL Input:\n{\"role\":\"user\",\"content\":\"Hello\"}\n{\"role\":\"assistant\",\"content\":\"Hi there!\"}\n\nFormatted Output:\n**user**: Hello\n\n**assistant**: Hi there!\n\nJSON Input:\n{\"messages\":[{\"role\":\"user\",\"content\":\"Hello\"},{\"role\":\"assistant\",\"content\":\"Hi!\"}]}\n\nFormatted Output:\n**user**: Hello\n\n**assistant**: Hi!\n\nError Handling:\n- Invalid JSON: Include raw line with [PARSE ERROR] prefix\n- Missing fields: Use [unknown] for role or [empty] for content\n- Unsupported extension: Return raw content with warning header\n\nKey Features:\n- Human-readable output\n- Preserves conversation structure\n- Graceful handling of malformed data\n- Consistent formatting across file types\n\nOutput:\nReturns formatted string ready for LLM extraction.","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:47:33.384464Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-w6c","title":"[Types] Delta Schema - Playbook Change Operations","description":"## Overview\nDefine Delta schema - a discriminated union of all possible playbook mutation operations. Enables type-safe, auditable changes with clear semantics.\n\n## Purpose\nDeltas provide:\n1. Type-safe playbook modifications\n2. Audit trail of changes\n3. Rollback/undo capability (future)\n4. Batch operations (apply multiple deltas)\n5. Clear separation of concerns (one type per operation)\n\n## Delta Types (Discriminated Union)\n\nUse Zod's discriminatedUnion on 'type' field for type safety.\n\n### 1. Add Delta\n```typescript\n{\n  type: 'add',\n  bullet: NewBulletData,\n  reason: string,\n  sourceSession: string\n}\n```\n\nPurpose: Create new playbook bullet\nFields:\n- bullet: Partial PlaybookBullet (id, createdAt, updatedAt auto-generated)\n- reason: Why this rule is being added (for audit trail)\n- sourceSession: Which session prompted this addition\nExample: { type: 'add', bullet: { content: 'Use TokenValidator for JWT checks', category: 'authentication', scope: 'workspace', workspace: '/path/to/project' }, reason: 'Authentication bypass incident', sourceSession: '/cass/2025-12-07-auth-fix.jsonl' }\n\n### 2. Helpful Delta\n```typescript\n{\n  type: 'helpful',\n  bulletId: string,\n  sourceSession?: string\n}\n```\n\nPurpose: Mark bullet as helpful (append to helpfulEvents)\nFields:\n- bulletId: ID of bullet to mark helpful\n- sourceSession: Optional session that benefited from rule\nEffect: Appends FeedbackEvent to bullet.helpfulEvents with current timestamp\nExample: { type: 'helpful', bulletId: 'b-l7k9m2p4-a3f8', sourceSession: '/cass/2025-12-07-api-design.jsonl' }\n\n### 3. Harmful Delta\n```typescript\n{\n  type: 'harmful',\n  bulletId: string,\n  sourceSession?: string,\n  reason?: HarmfulReason\n}\n```\n\nPurpose: Mark bullet as harmful (append to harmfulEvents)\nFields:\n- bulletId: ID of bullet to mark harmful\n- sourceSession: Optional session where rule caused problems\n- reason: Optional HarmfulReason enum (caused_bug, outdated, etc.)\nEffect: Appends FeedbackEvent to bullet.harmfulEvents with current timestamp\nAuto-Trigger: If harmfulEvents.length >= config.pruneHarmfulThreshold, transition to retired state\nExample: { type: 'harmful', bulletId: 'b-m8n3p5q7-b4g9', sourceSession: '/cass/2025-11-20-refactor.jsonl', reason: 'outdated' }\n\n### 4. Replace Delta\n```typescript\n{\n  type: 'replace',\n  bulletId: string,\n  newContent: string,\n  reason: string\n}\n```\n\nPurpose: Update bullet content (refinement)\nFields:\n- bulletId: ID of bullet to update\n- newContent: New rule text\n- reason: Why content is being changed\nEffect: Updates bullet.content and bullet.updatedAt\nAudit: Creates history entry (future enhancement)\nExample: { type: 'replace', bulletId: 'b-n9o4q6r8-c5h0', newContent: 'Use TokenValidator from @/lib/auth for all JWT validation', reason: 'Made rule more specific to this codebase' }\n\n### 5. Deprecate Delta\n```typescript\n{\n  type: 'deprecate',\n  bulletId: string,\n  reason: string,\n  replacedBy?: string\n}\n```\n\nPurpose: Retire bullet (mark as deprecated)\nFields:\n- bulletId: ID of bullet to deprecate\n- reason: Why rule is being retired\n- replacedBy: Optional ID of replacement bullet\nEffect: Sets bullet.state = 'retired', bullet.maturity = 'deprecated', bullet.retiredAt = now\nGemini Pattern: Adds to deprecatedPatterns list in playbook\nExample: { type: 'deprecate', bulletId: 'b-o0p5r7s9-d6i1', reason: 'Project migrated from class components to hooks', replacedBy: 'b-p1q6s8t0-e7j2' }\n\n### 6. Merge Delta\n```typescript\n{\n  type: 'merge',\n  bulletIds: string[],\n  mergedContent: string,\n  reason: string\n}\n```\n\nPurpose: Combine duplicate/similar bullets into one\nFields:\n- bulletIds: Array of bullet IDs to merge (2+)\n- mergedContent: Combined rule text\n- reason: Why bullets are being merged\nEffect:\n  - Creates new bullet with mergedContent\n  - Aggregates helpfulEvents and harmfulEvents from all merged bullets\n  - Deprecates all source bullets with replacedBy pointing to merged bullet\n  - Preserves provenance (sourceSessions, sourceAgents)\nExample: { type: 'merge', bulletIds: ['b-a1b2c3d4', 'b-e5f6g7h8'], mergedContent: 'Use vitest for unit tests and playwright for e2e tests', reason: 'Deduplicated similar testing rules' }\n\n## Discriminated Union Schema\n\n```typescript\nconst DeltaSchema = z.discriminatedUnion('type', [\n  z.object({ type: z.literal('add'), bullet: NewBulletDataSchema, reason: z.string(), sourceSession: z.string() }),\n  z.object({ type: z.literal('helpful'), bulletId: z.string(), sourceSession: z.string().optional() }),\n  z.object({ type: z.literal('harmful'), bulletId: z.string(), sourceSession: z.string().optional(), reason: HarmfulReasonSchema.optional() }),\n  z.object({ type: z.literal('replace'), bulletId: z.string(), newContent: z.string(), reason: z.string() }),\n  z.object({ type: z.literal('deprecate'), bulletId: z.string(), reason: z.string(), replacedBy: z.string().optional() }),\n  z.object({ type: z.literal('merge'), bulletIds: z.array(z.string()).min(2), mergedContent: z.string(), reason: z.string() })\n])\n\ntype Delta = z.infer<typeof DeltaSchema>\n```\n\n## Usage Patterns\n\n### Single Delta Application\n```typescript\nimport { applyDelta } from './playbook'\nconst delta: Delta = { type: 'helpful', bulletId: 'b-abc123', sourceSession: '/cass/session.jsonl' }\nconst updatedPlaybook = await applyDelta(playbook, delta)\n```\n\n### Batch Delta Application\n```typescript\nconst deltas: Delta[] = [\n  { type: 'add', bullet: {...}, reason: '...', sourceSession: '...' },\n  { type: 'helpful', bulletId: 'b-xyz789', sourceSession: '...' },\n  { type: 'deprecate', bulletId: 'b-old123', reason: '...' }\n]\nconst updatedPlaybook = await applyDeltas(playbook, deltas)\n```\n\n### Type-Safe Handling\n```typescript\nfunction handleDelta(delta: Delta) {\n  switch (delta.type) {\n    case 'add':\n      return createBullet(delta.bullet, delta.reason)\n    case 'helpful':\n      return markHelpful(delta.bulletId, delta.sourceSession)\n    case 'harmful':\n      return markHarmful(delta.bulletId, delta.sourceSession, delta.reason)\n    case 'replace':\n      return updateContent(delta.bulletId, delta.newContent, delta.reason)\n    case 'deprecate':\n      return deprecateBullet(delta.bulletId, delta.reason, delta.replacedBy)\n    case 'merge':\n      return mergeBullets(delta.bulletIds, delta.mergedContent, delta.reason)\n  }\n}\n```\n\n## Audit Trail Integration\n\nEach delta should be logged for audit purposes:\n```typescript\n{\n  timestamp: '2025-12-07T14:30:00Z',\n  actor: 'claude',\n  delta: { type: 'add', bullet: {...}, reason: '...', sourceSession: '...' },\n  result: 'success' | 'failure',\n  error?: string\n}\n```\n\n## Acceptance Criteria\n- Zod discriminated union schema with all 6 delta types\n- Type-safe TypeScript interfaces\n- applyDelta function for single operations\n- applyDeltas function for batch operations\n- Type guard utilities for each delta type\n- Examples for all delta types\n- JSDoc documentation\n- Audit trail integration hooks\n- Validation for required fields\n- Error handling for invalid deltas","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:45:03.277644Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-wco","title":"[Reflector] reflectOnSession - Main reflection function","description":"async function reflectOnSession(\n  diary: DiaryEntry,\n  sessionContent: string,\n  existingBullets: PlaybookBullet[],\n  config: Config\n): Promise<PlaybookDelta[]>\n\nMulti-iteration reflection (ACE pattern):\n1. Initialize empty deltas array and seen hash set\n2. For i = 0 to config.maxReflectorIterations:\n   - Build prompt with iteration context\n   - Call LLM for deltas\n   - Deduplicate against seen hashes\n   - Add unique deltas to array\n   - If no new deltas, break early\n3. Return all deltas\n\nWHY MULTI-ITERATION: First pass catches obvious insights. Subsequent passes catch nuances that might be missed.\n\nDEPENDENCIES:\n- buildReflectorPrompt()\n- deduplicateDeltas()\n- validateReflectorOutput()\n- shouldExitEarly()\n\nOUTPUT: Array of PlaybookDelta objects ready for application to playbook","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:44:51.615811Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-wexa","title":"Tests: Add E2E tests for diary command","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T00:57:15.132758595Z","created_by":"ubuntu","updated_at":"2026-01-07T00:59:36.976879305Z","closed_at":"2026-01-07T00:59:36.976879305Z","close_reason":"Added E2E tests for diary command (raw/json/save/missing)","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-wexa","depends_on_id":"cass_memory_system-sdt1.4","type":"discovered-from","created_at":"2026-01-21T09:28:52Z","created_by":"import"}]}
{"id":"cass_memory_system-wg3n","title":"Update install.sh documentation and comments","description":"# Task: Documentation Updates for Redirect-Based Resolution\n\n## Context\n\nAfter implementing the redirect-based version resolution, we need to update documentation and code comments to reflect the new approach.\n\n## Files to Update\n\n### 1. install.sh - Inline Comments\n\nThe new `resolve_version()` function should have clear comments explaining:\n- Why we use redirect-based resolution (rate limits, cross-platform)\n- How the redirect mechanism works\n- Edge case handling\n- Fallback behavior\n\n**Example comments** (to be included in implementation):\n\n```bash\nresolve_version() {\n  if [ -n \"$VERSION\" ]; then return 0; fi\n\n  info \"Resolving latest version...\"\n  \n  # =========================================================================\n  # Redirect-Based Version Resolution\n  # =========================================================================\n  # We use GitHub's redirect behavior instead of the API for several reasons:\n  #\n  # 1. NO RATE LIMITING: GitHub API limits unauthenticated requests to 60/hr.\n  #    The redirect approach uses the public web interface, not the API.\n  #\n  # 2. NO JSON PARSING: The API approach requires grep + sed to parse JSON,\n  #    which varies between GNU and BSD (macOS). The redirect approach uses\n  #    only shell parameter expansion, which is POSIX-compliant.\n  #\n  # 3. SIMPLER FAILURE MODES: The API can fail due to rate limits, JSON\n  #    format changes, or API outages. The redirect only fails if GitHub\n  #    is completely down.\n  #\n  # How it works:\n  #   1. GitHub redirects /releases/latest → /releases/tag/{version}\n  #   2. curl's -w '%{url_effective}' captures the final URL after redirects\n  #   3. Shell parameter expansion ${url##*/} extracts the tag name\n  #\n  # Reference: GitHub Issue #11, cass PR #29\n  # =========================================================================\n  \n  local releases_url=\"https://github.com/${OWNER}/${REPO}/releases/latest\"\n  ...\n}\n```\n\n### 2. README.md - Installation Section\n\nThe README already documents installation but doesn't explain the version resolution mechanism. Consider adding a note:\n\n**Current** (line ~676):\n```markdown\n### One-Liner (Recommended)\n\n**Linux/macOS:**\n```bash\ncurl -fsSL https://raw.githubusercontent.com/Dicklesworthstone/cass_memory_system/main/install.sh \\\n  | bash -s -- --easy-mode --verify\n```\n```\n\n**Updated** (optional, only if we want to document this):\n```markdown\n### One-Liner (Recommended)\n\n**Linux/macOS:**\n```bash\ncurl -fsSL https://raw.githubusercontent.com/Dicklesworthstone/cass_memory_system/main/install.sh \\\n  | bash -s -- --easy-mode --verify\n```\n\nThe installer automatically resolves the latest version from GitHub releases.\nYou can specify a version explicitly with `--version vX.Y.Z`.\n```\n\n**Decision**: This level of detail is probably unnecessary for end users. The inline comments in install.sh are sufficient.\n\n### 3. CHANGELOG / Release Notes\n\nWhen releasing this change, document it:\n\n```markdown\n### Changed\n\n- **install.sh**: Replaced GitHub API-based version resolution with redirect-based approach\n  - Eliminates API rate limiting (was 60 requests/hour for unauthenticated users)\n  - Removes dependency on GNU/BSD-specific sed regex parsing\n  - More reliable fallback behavior\n  - Reference: GitHub Issue #11\n```\n\n### 4. Code Comments Style\n\nFollow existing comment style in the codebase:\n- Use `# ===` for section headers\n- Keep explanations concise but complete\n- Reference issues/PRs when relevant\n- Explain \"why\" not just \"what\"\n\n## Documentation Checklist\n\n- [ ] Add comprehensive comments to `resolve_version()` function\n- [ ] Update fallback version comment to explain why that version was chosen\n- [ ] No README changes needed (implementation detail, not user-facing)\n- [ ] Prepare changelog entry for next release\n- [ ] Reference GitHub Issue #11 in comments\n\n## Comment Guidelines\n\n### DO:\n- Explain the rationale for the redirect approach\n- Document edge cases and their handling\n- Reference the GitHub issue for context\n- Explain non-obvious shell syntax (`${var##*/}`)\n\n### DON'T:\n- Over-document obvious code\n- Add comments that will become stale\n- Include implementation details that belong in commits\n- Add TODO comments (use beads instead)\n\n## Example of Good vs Bad Comments\n\n**Bad** (states the obvious):\n```bash\n# Get the final URL\nfinal_url=\"$(curl ... -w '%{url_effective}' ...)\"\n```\n\n**Good** (explains why):\n```bash\n# Capture final URL after redirects - GitHub redirects /releases/latest\n# to /releases/tag/{version}, so the final URL contains the version tag\nfinal_url=\"$(curl ... -w '%{url_effective}' ...)\"\n```\n\n**Bad** (implementation detail):\n```bash\n# Use ${var##*/} to get text after last slash\ntag=\"${final_url##*/}\"\n```\n\n**Good** (explains the pattern):\n```bash\n# Extract tag from URL: .../releases/tag/v0.2.1 → v0.2.1\n# ${var##*/} removes everything up to and including the last slash\ntag=\"${final_url##*/}\"\n```\n\n## Acceptance Criteria\n\n- [ ] `resolve_version()` has clear, comprehensive comments\n- [ ] Comments explain \"why\" not just \"what\"\n- [ ] Shell syntax tricks are briefly explained for maintainability\n- [ ] GitHub Issue #11 is referenced\n- [ ] No unnecessary documentation bloat in README","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-05T18:40:17.949776Z","created_by":"jemanuel","updated_at":"2026-01-05T19:12:57.143532Z","closed_at":"2026-01-05T19:12:57.143532Z","close_reason":"Consolidating into single implementation task","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-wg3n","depends_on_id":"cass_memory_system-8zpe","type":"blocks","created_at":"2026-01-21T09:28:52Z","created_by":"import"}]}
{"id":"cass_memory_system-wgf","title":"[Cass] cassTimeline - Get session activity over time","description":"Implement cassTimeline() to get session activity over time.\n\n## Signature\n```typescript\ninterface CassTimelineGroup {\n  date: string;\n  sessions: Array<{\n    path: string;\n    agent: string;\n    messageCount: number;\n    startTime: string;\n    endTime: string;\n  }>;\n}\n\ninterface CassTimelineResult {\n  groups: CassTimelineGroup[];\n}\n\nasync function cassTimeline(\n  days: number, \n  cassPath = \"cass\"\n): Promise<CassTimelineResult>\n```\n\n## CLI Command\n`cass timeline --days {days} --json`\n\n## Implementation\n- Use execFile() to run timeline command\n- Parse JSON output\n- Return structured timeline data\n- Return { groups: [] } on error\n\n## Error Handling\n- Return empty groups array on any error\n- Log parse errors at debug level\n- No retries needed (timeline is read-only)\n\n## Output Structure\nTimeline groups sessions by date:\n```json\n{\n  \"groups\": [\n    {\n      \"date\": \"2024-01-15\",\n      \"sessions\": [\n        {\n          \"path\": \"/path/to/session.txt\",\n          \"agent\": \"claude-code\",\n          \"messageCount\": 42,\n          \"startTime\": \"2024-01-15T10:30:00Z\",\n          \"endTime\": \"2024-01-15T11:45:00Z\"\n        }\n      ]\n    }\n  ]\n}\n```\n\n## Usage\nUsed for:\n- Finding unprocessed sessions (reflect command)\n- Activity visualization\n- Stats and analytics\n- Session discovery\n\n```typescript\nconst timeline = await cassTimeline(7);\nconst allSessions = timeline.groups.flatMap(g => g.sessions);\n```","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:45:00.092946Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-wmvt","title":"Harden blocked log loading against partial writes","description":"loadBlockedLog() can transiently skip the last entry if it reads while appendBlockedLog is mid-write; retry by re-reading under the same file lock when a malformed tail line is detected.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-16T06:29:16.663862Z","updated_at":"2025-12-16T06:31:08.060858Z","closed_at":"2025-12-16T06:31:08.060858Z","close_reason":"loadBlockedLog retries once under lock when trailing JSONL line looks truncated; added unit regression test","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-woh8","title":"E2E test: 'cass playbook' command","description":"E2E test for 'cass playbook' CLI command:\n- Real subprocess execution via bun\n- Test playbook display with various formats\n- Test filtering by category, scope, maturity\n- Test --robot and --json output formats\n- Verify output includes all expected fields\n- Test error cases: missing playbook, corrupted YAML\n- Detailed logging: command invoked, output structure\nSetup: fixture directory with various playbook states","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T01:27:14.992010Z","updated_at":"2025-12-14T01:42:44.178325Z","closed_at":"2025-12-14T01:42:44.178325Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-woh8","depends_on_id":"cass_memory_system-8dxr","type":"blocks","created_at":"2026-01-21T09:28:52Z","created_by":"import"}]}
{"id":"cass_memory_system-wrur","title":"[Semantic] Lazy model download with progress","description":"Lazy model download with progress feedback.\n\nFirst use triggers download:\n- Model: ~23MB\n- Cache location: ~/.cache/huggingface/\n- Network required: First use only\n- Subsequent runs: Instant (cached)\n\nProgress handling:\n```typescript\nasync function getEmbedder(): Promise<any> {\n  if (!embedder) {\n    console.log(\"Downloading embedding model (one-time, ~23MB)...\");\n    const startTime = Date.now();\n    \n    embedder = await pipeline(\n      \"feature-extraction\",\n      \"Xenova/all-MiniLM-L6-v2\",\n      {\n        progress_callback: (progress: any) => {\n          if (progress.status === \"downloading\") {\n            const percent = Math.round(progress.progress * 100);\n            process.stdout.write(`\\rDownloading: ${percent}%`);\n          }\n        }\n      }\n    );\n    \n    const elapsed = Date.now() - startTime;\n    console.log(`\\nModel loaded in ${elapsed}ms`);\n  }\n  return embedder;\n}\n```\n\nUser experience:\n- First run: \"Downloading model... 45%\"\n- Takes: 10-30 seconds (depends on network)\n- Cached: Instant startup\n\nOffline handling:\n```typescript\ntry {\n  embedder = await pipeline(...);\n} catch (error) {\n  if (error.message.includes(\"network\")) {\n    // Check if cached version exists\n    const cached = checkLocalCache();\n    if (cached) {\n      console.log(\"Using cached model (offline mode)\");\n      embedder = await pipeline(..., { local_files_only: true });\n    } else {\n      console.warn(\"Model not cached and offline - disabling semantic search\");\n      config.semanticSearchEnabled = false;\n    }\n  }\n}\n```\n\nCache location:\n- Linux/Mac: ~/.cache/huggingface/\n- Windows: %USERPROFILE%\\.cache\\huggingface\\\n\nModel can be pre-downloaded:\n```bash\n# Pre-download for offline use\nnpx transformers-cli download Xenova/all-MiniLM-L6-v2\n```","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-07T21:49:49.026465Z","updated_at":"2025-12-14T00:17:53.982693Z","closed_at":"2025-12-14T00:17:53.982693Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-wrur","depends_on_id":"cass_memory_system-mnqm","type":"parent-child","created_at":"2026-01-21T09:28:52Z","created_by":"import"}]}
{"id":"cass_memory_system-wuit","title":"[P2] Add command aliases for common operations","description":"# Task: Add Command Aliases\n\n## Problem\nCommon operations require long typing:\n- cm playbook list → could be cm ls\n- cm playbook add → could be cm add\n- cm playbook remove → could be cm rm\n\n## Solution\n\n### Add Aliases\n```\ncm ls            → cm playbook list\ncm add <content> → cm playbook add <content>\ncm rm <id>       → cm playbook remove <id>\ncm ctx <task>    → cm context <task>\ncm ref           → cm reflect\ncm dr            → cm doctor\n```\n\n### Implementation\nUse Commander's .alias() feature:\n```typescript\nprogram\n  .command(\"playbook list\")\n  .alias(\"ls\")\n  .description(\"List bullets in playbook\")\n```\n\n### Document Aliases\nShow aliases in help text:\n```\nCommands:\n  context, ctx     Get relevant rules for a task\n  playbook list, ls   List bullets\n  ...\n```\n\n## Files\n- src/cm.ts (add aliases)\n- Consider: alias config file for user customization\n\n## Acceptance\n- [ ] Common commands have short aliases\n- [ ] Aliases shown in help\n- [ ] Aliases work identically to full commands","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T15:33:54.224920Z","updated_at":"2025-12-17T05:39:06.959909Z","closed_at":"2025-12-17T05:39:06.959909Z","close_reason":"Added command aliases: context→ctx, doctor→dr, reflect→ref, playbook list→ls; plus top-level shortcuts cm ls/cm add/cm rm that forward to playbook subcommands and are shown in help.","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-wx1","title":"[Curator] CurationResult type definition","description":"Define TypeScript interfaces for curation results and reporting.\n\nCore Types:\n- CurationResult: Main return type with playbook, statistics, and reports\n- ConflictReport: Details about detected rule conflicts\n- PromotionReport: Tracks maturity state transitions\n- InversionReport: Records harmful-to-anti-pattern conversions\n\nInterface CurationResult:\n  playbook: Playbook\n  applied: number\n  skipped: number\n  conflicts: ConflictReport[]\n  promotions: PromotionReport[]\n  inversions: InversionReport[]\n  pruned: number\n\nInterface ConflictReport:\n  newBulletContent: string\n  conflictingBulletId: string\n  conflictingContent: string\n  reason: string\n\nInterface PromotionReport:\n  bulletId: string\n  from: string\n  to: string\n\nInterface InversionReport:\n  originalId: string\n  originalContent: string\n  antiPatternId: string\n  antiPatternContent: string\n\nThese types enable comprehensive tracking of all curation operations for debugging and user feedback.","status":"tombstone","priority":3,"issue_type":"task","created_at":"2025-12-07T21:44:53.953125Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-x133","title":"[P1] Add E2E tests for why command","description":"# Task: E2E tests for why command\n\n## Scenario Coverage\n- [ ] User asks \"why\" for a recently created bullet\n- [ ] User asks \"why\" for an old bullet with lots of evidence\n- [ ] User asks \"why\" for a bullet they just marked helpful\n- [ ] User asks \"why\" for non-existent bullet (error case)\n- [ ] User asks \"why\" with partial ID match\n- [ ] JSON output validates correctly\n\n## Test Structure\n```\ntest/cli-why.e2e.test.ts\n├── \"shows evidence for bullet with known history\"\n├── \"handles bullet with no feedback history\"\n├── \"partial ID match finds correct bullet\"\n├── \"returns error for unknown bullet\"\n└── \"JSON output has correct structure\"\n```\n\n## Logging Requirements\n- Log each step with timestamp\n- Log playbook state before/after\n- Log exact command executed\n- On failure, dump full state\n\n## Files\n- Test: test/cli-why.e2e.test.ts (new)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-16T15:31:47.809851Z","updated_at":"2025-12-17T06:20:14.188226Z","closed_at":"2025-12-17T06:20:14.188226Z","close_reason":"Implemented why E2E tests + partial id resolution","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-x133","depends_on_id":"cass_memory_system-n0mc","type":"blocks","created_at":"2026-01-21T09:28:52Z","created_by":"import"}]}
{"id":"cass_memory_system-x2k0","title":"[Build] Release process documentation","description":"Document the release process with step-by-step checklist.\n\nRelease checklist:\n1. Update version in package.json (semantic versioning)\n2. Update CHANGELOG.md with release date and notes\n3. Run full test suite: npm test (ensure all pass)\n4. Build all platform binaries: npm run build:all\n5. Test binaries on each platform (macOS, Linux, Windows)\n6. Create git tag: git tag v0.1.0\n7. Push tag: git push origin v0.1.0\n8. Create GitHub release from tag\n9. Upload binaries as release assets:\n   - cass-memory-darwin-arm64\n   - cass-memory-darwin-x64\n   - cass-memory-linux-x64\n   - cass-memory-windows-x64.exe\n10. Update release notes with installation instructions\n11. Announce release (optional)\n12. Future: Update homebrew formula for macOS users\n\nAutomate with GitHub Actions in future","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-07T21:49:43.243256Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-x2zm","title":"[P1] Fix potential race condition in mark command","description":"# Bug: Race Condition in mark.ts\n\n## Problem\nIn mark.ts, bullet existence is checked outside the lock, then lock is acquired:\n```typescript\n// Pre-check outside lock\nconst bullet = findBullet(playbook, bulletId);\nif (!bullet) { /* error */ }\n\n// Then lock and operate\nawait withLock(saveTarget, async () => {\n  const targetPlaybook = await loadPlaybook(saveTarget);\n  const targetBullet = findBullet(targetPlaybook, bulletId);\n  if (!targetBullet) {\n    throw new Error(...);  // Bullet could be deleted between checks\n  }\n});\n```\n\nIf the bullet is deleted between the pre-check and lock acquisition, the error message may be confusing.\n\n## Fix\nMove all validation inside the lock, or accept that pre-check is optimization only and handle gracefully.\n\n## Files\n- src/commands/mark.ts\n\n## Acceptance\n- [ ] Race condition handled gracefully\n- [ ] Error message is clear regardless of timing","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-16T15:34:26.425135Z","updated_at":"2025-12-17T01:04:28.397185Z","closed_at":"2025-12-17T01:04:28.397185Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-x5sb","title":"Fix Critical Issues: Exec Safety, Playbook Corruption, Serve Security, Filename collisions","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-08T02:09:25.589979Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-xex1","title":"[P2] Add workflow E2E tests: first-week, team-onboard, migration","description":"# Task: Workflow E2E Tests\n\n## New User First-Week Scenario\nTests the complete journey of a new user over simulated \"first week\":\n1. cm init (fresh setup)\n2. cm quickstart (get documentation)\n3. cm context \"write a function\" (first task)\n4. cm outcome success (first feedback)\n5. cm reflect (first learning)\n6. cm stats (check progress)\n7. cm context \"another task\" (verify learning applied)\n\n## Team Onboarding Scenario\nTests onboarding a team member to existing playbook:\n1. Clone repo with existing playbook\n2. cm doctor (verify setup)\n3. cm context (get relevant rules)\n4. cm why <bullet-id> (understand rules)\n5. cm mark --helpful (provide feedback)\n\n## Playbook Migration Scenario\nTests migrating playbook between versions:\n1. Create playbook with old schema\n2. cm doctor --fix (migrate)\n3. Verify all data preserved\n4. Verify new features available\n\n## Files\n- test/workflow-first-week.e2e.test.ts\n- test/workflow-team-onboard.e2e.test.ts\n- test/workflow-migration.e2e.test.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T15:31:54.530832Z","updated_at":"2025-12-17T07:54:34.733190Z","closed_at":"2025-12-17T07:54:34.733190Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-xex1","depends_on_id":"cass_memory_system-6xsg","type":"blocks","created_at":"2026-01-21T09:28:52Z","created_by":"import"}]}
{"id":"cass_memory_system-xgvn","title":"[Test] Unit: scoring.ts - Decay algorithms and maturity","description":"# Unit Tests for scoring.ts\n\n## Functions to Test\n\n### calculateDecayedValue(eventDate, halfLifeDays)\nTest Cases:\n- Event from today → value ≈ 1.0\n- Event from 90 days ago with 90-day half-life → value ≈ 0.5\n- Event from 180 days ago with 90-day half-life → value ≈ 0.25\n- Event from 1 year ago → value approaches 0\n- Half-life of 30 days decays faster than 90 days\n- Future event date → value > 1.0 (edge case)\n- Invalid date → throws or returns 0\n\n### getDecayedScore(events, halfLifeDays)\nTest Cases:\n- Empty array → 0\n- Single recent event → ≈ 1.0\n- Multiple recent events → sum of values\n- Mix of old and new events → weighted sum\n- All ancient events → near 0\n\n### getDecayedCounts(bullet)\nTest Cases:\n- No feedback events → { helpful: 0, harmful: 0 }\n- Only helpful events → { helpful: N, harmful: 0 }\n- Only harmful events → { helpful: 0, harmful: N }\n- Mix of helpful/harmful → correct split\n- Decay affects counts appropriately\n\n### getEffectiveScore(bullet, config)\nTest Cases:\n- New bullet with no feedback → 0\n- Bullet with only helpful → positive score\n- Bullet with only harmful → negative score (4x multiplier)\n- Balanced feedback → depends on recency\n- Maturity multiplier applied correctly:\n  - candidate: 0.5x\n  - established: 1.0x\n  - proven: 1.5x\n  - deprecated: 0x\n\n### calculateMaturityState(bullet, config)\nTest Cases:\n- New bullet → candidate\n- 3+ feedback events → established\n- 10+ helpful, <10% harmful → proven\n- >30% harmful → deprecated\n\n### checkForPromotion / checkForDemotion\nTest Cases:\n- Promotion from candidate → established\n- Promotion from established → proven\n- Demotion from proven → established\n- Auto-deprecation when harmful ratio high\n\n### isStale(bullet, staleDays)\nTest Cases:\n- Recent feedback → not stale\n- Old feedback → stale\n- No feedback → stale\n\n## Test File Structure\n\\`\\`\\`typescript\nimport { describe, it, expect } from \"bun:test\";\nimport { \n  calculateDecayedValue, \n  getDecayedScore,\n  getDecayedCounts,\n  getEffectiveScore,\n  calculateMaturityState\n} from \"../src/scoring\";\nimport { createTestBullet, createFeedbackEvent } from \"./helpers/factories\";\n\ndescribe(\"scoring\", () => {\n  describe(\"calculateDecayedValue\", () => {\n    it(\"returns ~1.0 for events from today\", () => {\n      const today = new Date().toISOString();\n      const value = calculateDecayedValue(today, 90);\n      expect(value).toBeCloseTo(1.0, 2);\n    });\n    // ... more tests\n  });\n});\n\\`\\`\\`","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-08T01:23:41.139604Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-xgvn","depends_on_id":"cass_memory_system-ai52","type":"blocks","created_at":"2026-01-21T09:28:52Z","created_by":"import"}]}
{"id":"cass_memory_system-xhh","title":"[Cass] cassNeedsIndex - Check if index needs rebuild","description":"Implement cassNeedsIndex() to check if cass index needs rebuilding.\n\n## Signature\n```typescript\nfunction cassNeedsIndex(cassPath = \"cass\"): boolean\n```\n\n## CLI Command\n`cass health`\n\n## Implementation\n- Use execSync() to run cass health\n- Check exit code to determine index health\n- Return boolean indicating rebuild needed\n- Suppress stdout/stderr with stdio: \"pipe\"\n\n## Error Handling\n- Return true if exit code 1 or 3 (needs rebuild)\n- Return false if exit code 0 (healthy)\n- Return false on any other error (assume healthy to avoid false positives)\n\n## Exit Codes\n- 0: Index is healthy, no rebuild needed\n- 1: Index needs incremental update\n- 3: Index missing or corrupted, needs full rebuild\n\n## Usage\nUsed for proactive index maintenance:\n```typescript\nif (cassNeedsIndex()) {\n  console.log(\"Rebuilding cass index...\");\n  await cassIndex({ full: true });\n}\n```","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:44:54.407263Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-xiw","title":"[Validator] isGenericRule - Detect overly obvious rules","description":"Implement the isGenericRule function - Detect overly obvious rules that add no value.\n\nSIGNATURE:\n```typescript\nfunction isGenericRule(content: string): boolean\n```\n\nGENERIC RULE EXAMPLES (REJECT THESE):\n- \"Write tests\"\n- \"Use good variable names\"\n- \"Handle errors\"\n- \"Document your code\"\n- \"Follow best practices\"\n- \"Keep code DRY\"\n- \"Use meaningful comments\"\n\nDETECTION HEURISTICS:\n\n1. LENGTH CHECK:\n   - Very short rules (< 20 chars) are likely generic\n   - Example: \"Write tests\" (11 chars)\n\n2. GENERIC TERM PATTERNS:\n```typescript\nconst genericPatterns = [\n  /^write tests?$/i,\n  /^use (good|better|descriptive) (names|variables)/i,\n  /^handle errors?$/i,\n  /^document (your|the) code/i,\n  /^follow best practices/i,\n  /^keep.*DRY/i,\n  /^avoid code duplication/i,\n  /^use meaningful (names|comments)/i,\n  /^always validate input/i,\n  /^make code (readable|maintainable)/i\n];\n```\n\n3. NO SPECIFIC TECHNOLOGY:\n   - Generic: \"Use dependency injection\"\n   - Specific: \"Use React Context for dependency injection\"\n   - If no technology/framework/pattern mentioned → likely generic\n\n4. NO ACTIONABLE DETAIL:\n   - Generic: \"Handle errors properly\"\n   - Specific: \"Wrap async operations in try-catch and log to Sentry\"\n\nIMPLEMENTATION:\n```typescript\nfunction isGenericRule(content: string): boolean {\n  // Check 1: Too short\n  if (content.length < 20) {\n    return true;\n  }\n\n  // Check 2: Generic patterns\n  const genericPatterns = [\n    /^write tests?$/i,\n    /^use (good|better|descriptive) (names|variables)/i,\n    /^handle errors?$/i,\n    /^document (your|the) code/i,\n    /^follow best practices/i,\n    /^keep.*DRY/i,\n    /^avoid code duplication/i,\n    /^use meaningful (names|comments)/i,\n    /^always validate input$/i,\n    /^make code (readable|maintainable)/i\n  ];\n\n  if (genericPatterns.some(pattern => pattern.test(content))) {\n    return true;\n  }\n\n  // Check 3: No specific technology mentioned\n  const hasTechnology = /\\b(React|TypeScript|Python|Node|PostgreSQL|Redis|Docker|AWS|API|REST|GraphQL|SQL)\\b/i.test(content);\n  const hasPattern = /\\b(dependency injection|event sourcing|CQRS|microservices|singleton|factory|strategy)\\b/i.test(content);\n\n  if (!hasTechnology && !hasPattern && content.length < 50) {\n    return true;  // Short, generic, no specifics\n  }\n\n  return false;\n}\n```\n\nEXAMPLES:\n\nGeneric (return true):\n- \"Write unit tests\"\n- \"Use descriptive variable names\"\n- \"Handle errors properly\"\n- \"Keep functions small\"\n- \"Avoid code duplication\"\n\nSpecific (return false):\n- \"Use TypeScript strict mode with noImplicitAny enabled\"\n- \"Wrap all Prisma queries in try-catch blocks and log errors to Sentry\"\n- \"Use React.memo for expensive component renders in data tables\"\n- \"Implement retry logic with exponential backoff for external API calls\"\n\nWHY THIS MATTERS:\n- Prevents playbook pollution with obvious advice\n- Focuses validation resources on meaningful rules\n- Improves playbook quality and signal-to-noise ratio\n- Saves LLM costs by rejecting generics early\n\nDEPENDENCIES:\n- None (pure function)\n\nLOCATION:\n- src/validator/generic-rules.ts","status":"tombstone","priority":3,"issue_type":"task","created_at":"2025-12-07T21:44:59.729673Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-xjk","title":"[Utils] scoreBulletRelevance - Keyword-based bullet scoring","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:45:23.661135Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-xjx","title":"[Reflector] deduplicateDeltas - Remove duplicate insights","description":"function deduplicateDeltas(\n  newDeltas: PlaybookDelta[],\n  seenHashes: Set<string>\n): PlaybookDelta[]\n\nFor each delta:\n- Hash the delta (content + type)\n- If hash in seenHashes, skip\n- Otherwise add hash and keep delta\n- Return unique deltas\n\nPURPOSE:\nPrevents same insight being proposed multiple times across iterations\n\nEXAMPLE SCENARIO:\n- Iteration 0: LLM proposes \"Use async/await for promises\"\n- Iteration 1: LLM proposes same insight with slightly different wording\n- Deduplication: Hash matches, second proposal is skipped\n\nALGORITHM:\n1. Create result array\n2. For each delta in newDeltas:\n   - hash = hashDelta(delta)\n   - if (seenHashes.has(hash)) continue\n   - seenHashes.add(hash)\n   - result.push(delta)\n3. Return result\n\nDEPENDENCIES:\n- hashDelta()\n\nUsed in reflectOnSession() main loop","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:44:54.645079Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-xmdx","title":"Research: Verify redirect-based version resolution approach","description":"# Task: Validate the Redirect-Based Approach\n\n## Context\n\nBefore implementing the redirect-based version resolution, we need to verify that it works reliably across all our supported platforms and handles edge cases appropriately.\n\n## Background\n\nThe redirect-based approach relies on GitHub's behavior of redirecting:\n```\nhttps://github.com/{owner}/{repo}/releases/latest\n  → https://github.com/{owner}/{repo}/releases/tag/{version}\n```\n\nWe need to confirm:\n1. This redirect behavior is consistent and reliable\n2. curl's `%{url_effective}` correctly captures the final URL\n3. The approach handles various edge cases gracefully\n\n## Verification Steps\n\n### 1. Test Basic Redirect Behavior\n\n```bash\n# Test with cass-memory repo\ncurl -fsSL -o /dev/null -w '%{url_effective}\\n' \\\n  \"https://github.com/Dicklesworthstone/cass_memory_system/releases/latest\"\n\n# Expected output: https://github.com/Dicklesworthstone/cass_memory_system/releases/tag/v0.2.1\n```\n\n### 2. Test Tag Extraction\n\n```bash\nfinal_url=\"$(curl -fsSL -o /dev/null -w '%{url_effective}' \\\n  \"https://github.com/Dicklesworthstone/cass_memory_system/releases/latest\" || true)\"\ntag=\"${final_url##*/}\"\necho \"Extracted tag: $tag\"\n\n# Expected: v0.2.1\n```\n\n### 3. Test Edge Cases\n\n#### No releases exist\n```bash\n# Test with a repo that has no releases (find one or create test)\n# Should fail gracefully\n```\n\n#### Network error\n```bash\n# Test with invalid URL\nfinal_url=\"$(curl -fsSL -o /dev/null -w '%{url_effective}' \\\n  \"https://github.com/nonexistent/repo/releases/latest\" 2>/dev/null || true)\"\n# Should return empty or error gracefully\n```\n\n#### Non-semver tags\n```bash\n# Some repos use non-standard tag formats (e.g., \"release-2024-01-05\")\n# Our extraction should still work: ${final_url##*/} extracts whatever the tag is\n```\n\n### 4. Platform Verification\n\nTest on:\n- [ ] macOS (darwin-arm64) - Apple Silicon\n- [ ] macOS (darwin-x64) - Intel\n- [ ] Linux (x64) - Ubuntu/Debian\n- [ ] Linux in Docker - CI environment simulation\n\n### 5. Compare with API Approach\n\nDocument any differences in behavior:\n- Response time (redirect should be faster - no JSON parsing)\n- Failure modes\n- Error messages\n\n## Acceptance Criteria\n\n1. [ ] Redirect approach returns correct version tag for cass-memory repo\n2. [ ] Redirect approach returns correct version tag for cass repo\n3. [ ] Shell parameter expansion works on bash 3.x (macOS default) and bash 5.x (Linux)\n4. [ ] Edge cases are documented with expected behavior\n5. [ ] No rate limiting observed (test multiple rapid requests)\n\n## Research Questions to Answer\n\n1. Does GitHub ever NOT redirect /releases/latest? (e.g., draft-only releases?)\n2. What happens if the latest release is a pre-release?\n3. Is there any caching behavior we need to account for?\n4. Does the redirect work for private repos (with auth)?\n\n## Deliverables\n\n- [ ] Test results documented in this bead\n- [ ] Edge cases and their handling documented\n- [ ] Recommendation for implementation (go/no-go)\n\n## Notes\n\nThis research task should be quick (< 30 minutes) but is critical to ensure we don't introduce regressions. The current API approach, while fragile, does work - we need to be confident the redirect approach is strictly better.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T18:37:51.064495Z","created_by":"jemanuel","updated_at":"2026-01-05T19:12:56.741453Z","closed_at":"2026-01-05T19:12:56.741453Z","close_reason":"Consolidating into single implementation task","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-xtj","title":"[Utils] expandPath - Home directory expansion","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:44:45.074017Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-xw0","title":"[Utils] generateDiaryId - Unique diary entry identifier","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:45:00.048552Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-xwlp","title":"Task: Define standard error codes enum","description":"# Task: Define Standard Error Codes Enum\n\n## Context\n\nError handling is currently inconsistent across commands. Some use error codes, some don't. Agents need standardized codes to programmatically handle errors.\n\n## Current State\n\n```typescript\n// audit.ts - has codes but not standardized\n{ error: message, code: \"missing_api_key\" }\n{ error: message, code: \"audit_error\" }\n\n// cm.ts error handler\n{ success: false, error: { message, code: \"CLI_ERROR\" } }\n\n// many commands - no code at all\n{ error: err.message }\n```\n\n## Solution\n\nCreate a standardized error codes enum in types.ts:\n\n```typescript\n// src/types.ts\n\nexport const ErrorCode = {\n  // Input validation errors (4xx-like)\n  INVALID_INPUT: \"INVALID_INPUT\",\n  MISSING_REQUIRED: \"MISSING_REQUIRED\",\n  BULLET_NOT_FOUND: \"BULLET_NOT_FOUND\",\n  SESSION_NOT_FOUND: \"SESSION_NOT_FOUND\",\n  PLAYBOOK_NOT_FOUND: \"PLAYBOOK_NOT_FOUND\",\n  CONFIG_INVALID: \"CONFIG_INVALID\",\n  \n  // External service errors (5xx-like)\n  CASS_UNAVAILABLE: \"CASS_UNAVAILABLE\",\n  CASS_SEARCH_FAILED: \"CASS_SEARCH_FAILED\",\n  LLM_API_ERROR: \"LLM_API_ERROR\",\n  LLM_RATE_LIMITED: \"LLM_RATE_LIMITED\",\n  LLM_BUDGET_EXCEEDED: \"LLM_BUDGET_EXCEEDED\",\n  \n  // File system errors\n  FILE_NOT_FOUND: \"FILE_NOT_FOUND\",\n  FILE_PERMISSION_DENIED: \"FILE_PERMISSION_DENIED\",\n  FILE_WRITE_FAILED: \"FILE_WRITE_FAILED\",\n  LOCK_ACQUISITION_FAILED: \"LOCK_ACQUISITION_FAILED\",\n  \n  // Operational errors\n  VALIDATION_FAILED: \"VALIDATION_FAILED\",\n  REFLECTION_FAILED: \"REFLECTION_FAILED\",\n  AUDIT_FAILED: \"AUDIT_FAILED\",\n  \n  // Generic fallbacks\n  INTERNAL_ERROR: \"INTERNAL_ERROR\",\n  UNKNOWN_ERROR: \"UNKNOWN_ERROR\",\n} as const;\n\nexport type ErrorCode = typeof ErrorCode[keyof typeof ErrorCode];\n```\n\n## Usage Pattern\n\n```typescript\nimport { ErrorCode } from \"../types.js\";\nimport { printJsonError } from \"../utils.js\";\n\n// In command handlers\ntry {\n  const bullet = findBullet(playbook, bulletId);\n  if (!bullet) {\n    printJsonError(\"Bullet not found\", { code: ErrorCode.BULLET_NOT_FOUND });\n    process.exit(1);\n  }\n} catch (err) {\n  printJsonError(err, { code: ErrorCode.INTERNAL_ERROR });\n  process.exit(1);\n}\n```\n\n## Files to Modify\n\n- src/types.ts - Add ErrorCode enum\n- src/utils.ts - Update printJsonError to use ErrorCode type (optional)\n\n## Acceptance Criteria\n\n- [ ] ErrorCode enum defined in types.ts\n- [ ] Type exported and usable by commands\n- [ ] At least 15-20 common error codes defined\n- [ ] Codes follow SCREAMING_SNAKE_CASE convention\n- [ ] Comments/grouping for discoverability\n\n## Dependencies\n\nNone - can be done in parallel with other tasks.\n\n## Notes\n\nThis defines the vocabulary. Actual migration of commands to use these codes happens in the audit task.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T18:25:11.471828Z","updated_at":"2025-12-15T20:06:48.690650Z","closed_at":"2025-12-15T20:06:48.690650Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-y10h","title":"Fix cost tracking race condition","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-08T03:26:57.253222Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-y1d4","title":"[Impl] Add Inline Feedback Parsing to Reflection","description":"# Implement Inline Feedback Parsing in Reflection\n\n## Purpose\nParse inline feedback comments from session logs during reflection, enabling zero-command feedback from agents.\n\n## Depends On\n- afjz (Feedback format design) - need to know exact format to parse\n\n## Implementation\n\n### Parser Module\nCreate parser that finds comments matching:\n\\`\\`\\`regex\n\\[cass:\\s*(helpful|harmful)\\s+(b-[a-z0-9]+)\\](?:\\s+(.+))?\n\\`\\`\\`\n\n### Integration Point\nIn reflection pipeline (src/reflect.ts):\n1. After loading session content\n2. Scan for inline feedback comments\n3. Apply each as if \\`cm mark\\` was called\n4. Log what was auto-extracted\n\n### Edge Cases\n- Multiple comments per session: process all\n- Duplicate feedback (inline + explicit): dedupe by session+rule\n- Invalid rule IDs: warn and skip\n- Comments in code strings: minimize false positives with context\n\n## Deliverables\n- [ ] Parser function for inline feedback\n- [ ] Integration with reflection pipeline\n- [ ] Tests for various comment formats\n- [ ] Warning log for invalid/skipped feedback","status":"tombstone","priority":3,"issue_type":"task","created_at":"2025-12-08T17:48:24.552377Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-y22j","title":"[Docs] Configuration reference documentation","description":"Document all configuration options with types, defaults, and examples.\n\nConfiguration sources (precedence order):\n1. Command-line flags (highest)\n2. Environment variables\n3. Repo config (.cass/config.yaml)\n4. Global config (~/.cass-memory/config.json)\n5. Defaults (lowest)\n\nGlobal config: llm_provider, default_model, confidence_threshold, decay_half_life_days, max_bullets_per_section\nRepo config: project_name, playbook_path, diary_path, session_path, validation_rules\nEnvironment variables: OPENAI_API_KEY, ANTHROPIC_API_KEY, CASS_MEMORY_CONFIG, CASS_MEMORY_DEBUG\n\nInclude JSON schema for validation and example configs","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-07T21:49:28.411185Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-y4rh","title":"Fix validate E2E mock Cass hits to satisfy schema","status":"closed","priority":3,"issue_type":"bug","created_at":"2026-01-07T04:24:31.031618428Z","created_by":"ubuntu","updated_at":"2026-01-07T04:25:19.690010085Z","closed_at":"2026-01-07T04:25:19.690010085Z","close_reason":"Bug fixed - validate E2E mocks now include required schema fields (line_number, agent). All 14 tests passing.","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-y5s","title":"[Curator] pruneDeprecated - Remove deprecated from active list","description":"Remove deprecated bullets from active list and move to deprecated section.\n\nSignature:\nfunction pruneDeprecated(playbook: Playbook): number\n\nProcess:\n1. Initialize pruned counter\n2. Filter playbook.bullets:\n   - Keep bullets where maturity !== 'deprecated'\n   - Collect deprecated bullets\n3. For each deprecated bullet:\n   - Add to playbook.deprecated array (if it exists)\n   - Increment pruned counter\n4. Update playbook.bullets to filtered array\n5. Return pruned count\n\nImportant notes:\n- Does NOT delete data\n- Deprecated bullets move to separate section for history\n- Maintains complete audit trail\n- Allows future analysis of what didn't work\n\nWhy separate active from deprecated?\n- Keeps active playbook focused and clean\n- Prevents deprecated rules from being used\n- Preserves history for learning\n- Enables deprecation analytics\n\nPlaybook structure after pruning:\n{\n  bullets: [...active bullets...],\n  deprecated: [...deprecated bullets...],\n  stats: {\n    totalActive: bullets.length,\n    totalDeprecated: deprecated.length\n  }\n}\n\nThis is called at the END of curatePlaybook, after auto-inversion.\n\nPrune order matters:\n1. Process all deltas\n2. Auto-invert harmful bullets (creates deprecations)\n3. Prune deprecated (moves them out)\n4. Return final playbook","status":"tombstone","priority":3,"issue_type":"task","created_at":"2025-12-07T21:45:06.480400Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-y6t","title":"[Types] CommandResult and Error Types","description":"## Overview\nDefine command result and error types for consistent CLI output and error handling across all cass-memory commands.\n\n## Purpose\nStandardize:\n1. Success/failure responses from all commands\n2. Error reporting with actionable messages\n3. Data payloads for JSON output mode\n4. Audit violation reporting\n5. Health check results\n\n## CommandResult\n\nStandard return type for all CLI commands.\n\nFields:\n\nsuccess: boolean\n- True if command completed successfully\n- False if command failed\n- Example: true\n\nmessage: string\n- Human-readable summary of result\n- Success: 'Added 3 new rules to playbook'\n- Failure: 'Failed to load playbook: file not found'\n- Required: Always present\n\ndata: unknown | undefined\n- Optional command-specific payload\n- Type varies by command\n- Examples:\n  - context command: ContextResult\n  - stats command: StatsReport\n  - validate command: ValidationReport\n- JSON mode: Serialized to output\n\nerror: string | undefined\n- Optional error details for failures\n- Stack trace (in verbose mode)\n- Technical details\n- Example: 'ENOENT: no such file or directory, open ~/.cass-memory/playbook.yaml'\n\n## AuditViolation\n\nIndividual violation found by audit command.\n\nFields:\n\nbulletId: string\n- ID of bullet that was violated or contradicted\n- Example: 'b-abc123'\n\nbulletContent: string\n- Text of the rule that was violated\n- Example: 'Use TokenValidator for JWT validation'\n\nsessionPath: string\n- Path to session where violation occurred\n- Example: '/cass/2025-12-07-api-impl.jsonl'\n\nevidence: string\n- Excerpt showing the violation\n- Example: 'Used direct JWT decode without TokenValidator'\n\nseverity: 'low' | 'medium' | 'high'\n- How serious the violation is\n- low: Stylistic deviation\n- medium: Best practice not followed\n- high: Security/correctness issue\n\n## AuditResult\n\nComplete audit report from audit command.\n\nFields:\n\nsessionsScanned: number\n- Count of sessions analyzed\n- Example: 25\n\nviolations: AuditViolation[]\n- Array of found violations\n- Grouped by: severity, then bulletId\n- Example: [{ bulletId: 'b-abc', bulletContent: 'Use TokenValidator', sessionPath: '/cass/...', evidence: '...', severity: 'high' }]\n\nsuggestions: string[]\n- Actionable recommendations\n- Examples:\n  - 'Consider deprecating rule b-xyz - violated in 80% of recent sessions'\n  - 'Rule b-abc is consistently followed - promote to proven'\n  - 'Add anti-pattern for direct JWT decode based on 5 violations'\n\n## ErrorTypes\n\nCommon error categories for better error handling.\n\nCategories:\n\nConfigError:\n- Config file not found\n- Invalid config format\n- Missing required config fields\n\nPlaybookError:\n- Playbook file not found\n- Invalid playbook YAML\n- Schema validation failure\n\nCassError:\n- cass executable not found\n- cass search failed\n- cass timeout\n\nValidationError:\n- Invalid bullet data\n- Rule validation failed\n- Evidence gate not passed\n\nLLMError:\n- API key missing\n- API call failed\n- Rate limit exceeded\n- Invalid response format\n\n## Success Response Examples\n\nContext command:\n{ success: true, message: 'Found 12 relevant rules for task', data: { task: '...', relevantBullets: [...], ... } }\n\nReflect command:\n{ success: true, message: 'Processed 5 sessions, added 3 rules, updated 2', data: { addedCount: 3, updatedCount: 2 } }\n\nStats command:\n{ success: true, message: 'Playbook statistics', data: { totalBullets: 42, activeCount: 35, ... } }\n\n## Error Response Examples\n\nConfig error:\n{ success: false, message: 'Config file not found', error: 'ENOENT: ~/.cass-memory/config.yaml' }\n\nPlaybook error:\n{ success: false, message: 'Invalid playbook format', error: 'YAML parsing failed at line 42: unexpected indent' }\n\nValidation error:\n{ success: false, message: 'Validation failed', error: 'Insufficient evidence: only 1 session found' }\n\n## JSON Output Mode\n\nWhen config.jsonOutput = true:\n- All commands return CommandResult as JSON\n- Suppress human-friendly formatting\n- Include full data payload\n- Errors as structured objects\n\nExample:\n{ \"success\": true, \"message\": \"Context retrieved\", \"data\": { \"task\": \"...\", \"relevantBullets\": [...] } }\n\n## Acceptance Criteria\n- CommandResult interface with all fields\n- AuditViolation interface\n- AuditResult interface\n- Error type definitions\n- Success/error response examples\n- JSON serialization support\n- Zod schemas for validation\n- TypeScript exports\n- JSDoc documentation\n- Consistent error messages across commands","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:45:08.437115Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-y7x","title":"[Generator] separateAntiPatterns - Split rules from pitfalls","description":"Separate anti-patterns from regular rules for distinct presentation.\n\nSIGNATURE:\nfunction separateAntiPatterns(scoredBullets: ScoredBullet[]): { rules: ScoredBullet[]; antiPatterns: ScoredBullet[] }\n\nPURPOSE:\nSplit scored bullets into two categories for different sections of the context output. Anti-patterns (pitfalls) are shown separately to highlight what NOT to do.\n\nCLASSIFICATION LOGIC:\nA bullet is an anti-pattern if:\n  bullet.type === 'anti-pattern' || bullet.kind === 'anti_pattern'\n\nBoth field names supported for backwards compatibility.\n\nOUTPUT STRUCTURE:\n{\n  rules: ScoredBullet[],        // Regular patterns/rules (what to do)\n  antiPatterns: ScoredBullet[]  // Anti-patterns (what NOT to do)\n}\n\nPRESENTATION:\nRules appear in: 'Relevant Playbook Rules' section\nAnti-patterns appear in: 'PITFALLS TO AVOID' section\n\nEXAMPLE:\nInput: [\n  { id: 'b1', content: 'Use async/await for DB calls', type: 'pattern' },\n  { id: 'b2', content: 'AVOID: Blocking DB calls in event loop', type: 'anti-pattern' },\n  { id: 'b3', content: 'Cache frequently-read data', type: 'optimization' }\n]\n\nOutput: {\n  rules: [b1, b3],\n  antiPatterns: [b2]\n}\n\nSCORE PRESERVATION:\nBoth arrays maintain the scoring metadata (relevanceScore, effectiveScore, finalScore) from scorePlaybookBullets for potential display.\n\nIMPLEMENTATION NOTES:\n- Simple filter operation (no mutation)\n- Preserves order within each category\n- Empty antiPatterns array is valid (no pitfalls relevant)","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:44:57.792421Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-y8o","title":"Phase 3: Advanced Features + Intelligence","description":"# EPIC: Advanced Features + Intelligence\n\n## Purpose\nAdd intelligent features that dramatically improve relevance and usability:\nlocal semantic search, multi-iteration reflection, scientific validation,\nand playbook health analytics.\n\n## Background & Reasoning\nSimple keyword matching for bullet relevance achieves ~60% accuracy. By adding\nlocal semantic embeddings via @xenova/transformers (all-MiniLM-L6-v2, 23MB model),\nwe can reach ~90% relevance without network calls.\n\nThe GPT Pro proposal introduced \"scientific validation\" - before accepting a new\nrule, query cass for historical evidence. Did this pattern succeed or fail in the\npast? This prevents accepting rules that contradict historical evidence.\n\nMulti-iteration reflection (from ACE paper) runs the reflector multiple times per\nsession, focusing on different aspects each iteration. This catches insights that\na single pass might miss.\n\n## Priority Features (from ROI analysis)\n- P7: Local semantic search @xenova/transformers (4× impact)\n- P9: Stats command playbook health dashboard (2× impact)\n\n## Key Deliverables\n1. `cass-memory validate \"<rule>\"` - Scientific validation against history\n2. `cass-memory stats` - Playbook health dashboard\n3. Local embedding-based relevance scoring\n4. Multi-iteration reflector (configurable 1-3 iterations)\n5. Cross-agent enrichment in diaries\n\n## Technical Specifications\n### Semantic Search\n- Model: Xenova/all-MiniLM-L6-v2 (runs locally, ~23MB)\n- Embedding dimension: 384\n- Scoring: 40% keyword + 60% semantic similarity\n- Cache: ~/.cass-memory/embeddings/bullets.embeddings\n\n### Stats Dashboard Metrics\n- Total bullets by scope (global/workspace)\n- Distribution by maturity (candidate/established/proven/retired)\n- Distribution by kind (project_convention/stack_pattern/workflow_rule/anti_pattern)\n- Top performers (highest effective scores)\n- At-risk bullets (negative effective scores)\n- Stale bullets (no feedback in 90+ days)\n- Merge candidates (high semantic similarity pairs)\n\n## Dependencies\n- Requires Phase 2 completion (diary, reflect, curate pipeline)","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-12-07T21:16:41.554097Z","updated_at":"2025-12-14T00:13:08.830615Z","closed_at":"2025-12-14T00:13:08.830615Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-y8o","depends_on_id":"cass_memory_system-0ew","type":"blocks","created_at":"2026-01-21T09:28:52Z","created_by":"import"}]}
{"id":"cass_memory_system-y8o.1","title":"Validate Command: Scientific Validation (GPT Pro Pattern)","description":"# Feature: Validate Command (Scientific Validation)\n\n## Purpose\nValidate a proposed rule against historical evidence from cass.\nThis implements the GPT Pro proposal's \"scientific validation\" - \ntreating rule proposals as hypotheses to be tested against data.\n\n## Usage\n```bash\ncass-memory validate \"Always use httpx instead of requests\" --json\ncass-memory validate \"Prefer composition over inheritance\" --verbose\n```\n\n## Process Flow\n```\n1. Extract validation keywords from proposed rule\n2. Check evidence-count gate (auto-accept/reject if clear signal)\n3. If ambiguous, run LLM validator with evidence\n4. Return verdict with reasoning\n```\n\n## Implementation\n```typescript\nasync function validateCommand(\n  proposedRule: string,\n  flags: ValidateFlags\n): Promise<void> {\n  const config = await loadConfig();\n  \n  // 1. Extract keywords\n  const keywords = extractKeywords(proposedRule);\n  \n  // 2. Check evidence gate\n  const gateResult = await evidenceCountGate(proposedRule, config);\n  \n  if (gateResult.action !== \"needs-llm\") {\n    output({\n      proposedRule,\n      verdict: gateResult.action === \"auto-accept\" ? \"ACCEPT\" : \"REJECT\",\n      confidence: gateResult.confidence,\n      reason: `${gateResult.action}: ${gateResult.successCount} successes, ${gateResult.failureCount} failures`,\n      evidence: gateResult.relevantSessions.map(h => ({\n        session: h.source_path,\n        snippet: h.snippet,\n        outcome: classifySessionOutcome(h)\n      }))\n    }, formatValidationResult, flags);\n    return;\n  }\n  \n  // 3. Run LLM validator\n  const validation = await runValidator(\n    ValidationResultSchema,\n    proposedRule,\n    formatEvidenceForPrompt(gateResult.relevantSessions),\n    config\n  );\n  \n  output({\n    proposedRule,\n    verdict: validation.valid ? \"ACCEPT\" : \"REJECT\",\n    confidence: validation.confidence || 0.7,\n    reason: validation.reason,\n    refinedRule: validation.refinedContent,\n    evidence: gateResult.relevantSessions.map(h => ({\n      session: h.source_path,\n      snippet: h.snippet\n    }))\n  }, formatValidationResult, flags);\n}\n```\n\n## Output Example\n```json\n{\n  \"proposedRule\": \"Always use httpx instead of requests\",\n  \"verdict\": \"ACCEPT_WITH_CAUTION\",\n  \"confidence\": 0.75,\n  \"reason\": \"Evidence shows httpx succeeded in 4 sessions for async use cases, but requests was fine for simple sync calls\",\n  \"refinedRule\": \"Prefer httpx for async HTTP calls; requests is acceptable for simple synchronous requests\",\n  \"evidence\": [\n    {\n      \"session\": \"~/.claude/sessions/abc.jsonl\",\n      \"snippet\": \"Switched to httpx for async support, much cleaner code\"\n    },\n    {\n      \"session\": \"~/.cursor/sessions/def.jsonl\", \n      \"snippet\": \"requests worked fine for this simple GET request\"\n    }\n  ]\n}\n```","status":"tombstone","priority":1,"issue_type":"feature","created_at":"2025-12-07T21:24:14.956313Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"feature","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-y8o.2","title":"Stats Command: Playbook Health Dashboard (P9)","description":"# Feature: Stats Command (P9 - Playbook Health Dashboard)\n\n## Purpose\nDisplay comprehensive playbook health metrics. Helps identify:\n- At-risk bullets that need attention\n- Stale bullets that may be outdated\n- Top performers worth promoting\n- Merge candidates (similar content)\n\n## Usage\n```bash\ncass-memory stats\ncass-memory stats --json\ncass-memory stats --category testing\n```\n\n## Metrics Displayed\n\n### 1. Overview\n- Total bullets (global vs workspace)\n- Distribution by state (draft/active/proven/retired)\n- Distribution by kind (project_convention/stack_pattern/workflow_rule/anti_pattern)\n\n### 2. Score Distribution\n- Excellent (effective score > 10)\n- Good (5-10)\n- Neutral (0-5)\n- At Risk (< 0)\n\n### 3. Top Performers\n- Top 5 bullets by effective score\n- Most frequently marked helpful\n\n### 4. Needs Attention\n- Bullets with negative effective scores\n- Stale bullets (no feedback in 90+ days)\n- Merge candidates (similarity > 0.8)\n\n## Implementation\n```typescript\nasync function statsCommand(flags: StatsFlags): Promise<void> {\n  const config = await loadConfig();\n  const playbook = await loadMergedPlaybook(config);\n  \n  // Calculate all metrics\n  const stats = {\n    total: playbook.bullets.length,\n    byScope: countByScope(playbook.bullets),\n    byState: countByState(playbook.bullets),\n    byKind: countByKind(playbook.bullets),\n    scoreDistribution: calculateScoreDistribution(playbook.bullets, config),\n    topPerformers: getTopPerformers(playbook.bullets, config, 5),\n    atRisk: getAtRiskBullets(playbook.bullets, config),\n    stale: getStaleBullets(playbook.bullets, 90),\n    mergeCandidates: findMergeCandidates(playbook.bullets, 0.8)\n  };\n  \n  output(stats, formatStatsHuman, flags);\n}\n```\n\n## Human Output\n```\n╭─────────────────────────────────────────────────────────────╮\n│              CASS-MEMORY PLAYBOOK HEALTH                    │\n├─────────────────────────────────────────────────────────────┤\n│ Total Bullets: 156 (Global: 89, Workspace: 67)              │\n│                                                             │\n│ BY STATE:                                                   │\n│   ● Draft:       23 (14.7%)  ░░░░░                          │\n│   ● Active:      87 (55.8%)  ████████████████               │\n│   ● Proven:      34 (21.8%)  ███████                        │\n│   ● Retired:     12 (7.7%)   ███                            │\n│                                                             │\n│ BY KIND:                                                    │\n│   project_convention: 42  stack_pattern: 58                 │\n│   workflow_rule: 48       anti_pattern: 8                   │\n│                                                             │\n│ SCORE DISTRIBUTION:                                         │\n│   Excellent (>10):  18  ████                                │\n│   Good (5-10):      45  ██████████                          │\n│   Neutral (0-5):    71  ████████████████                    │\n│   At Risk (<0):     10  ███  ⚠️                             │\n│                                                             │\n│ TOP PERFORMERS:                                             │\n│   1. b-abc123 (24.3) \"Use waitFor for async assertions...\"  │\n│   2. b-def456 (18.7) \"Prefer httpx for async HTTP...\"       │\n│   3. b-ghi789 (15.2) \"Mock external APIs in tests...\"       │\n│                                                             │\n│ NEEDS ATTENTION:                                            │\n│   ⚠️ 10 bullets at risk (negative scores)                   │\n│   🕐 8 bullets stale (no feedback 90+ days)                 │\n│   🔄 3 merge candidate pairs detected                       │\n╰─────────────────────────────────────────────────────────────╯\n```","status":"tombstone","priority":1,"issue_type":"feature","created_at":"2025-12-07T21:24:16.213660Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"feature","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-y8o.3","title":"Local Semantic Search: @xenova/transformers (P7)","description":"# Feature: Local Semantic Search (P7 - 4× Relevance Impact)\n\n## Purpose\nDramatically improve bullet relevance matching by using local semantic\nembeddings. Catches synonyms and conceptual matches that keyword search misses.\n\n## The Problem\nKeyword matching misses:\n- \"authentication\" vs \"auth\" vs \"login\" vs \"session\"\n- \"error handling\" vs \"exception management\" vs \"failure recovery\"\n- \"performance optimization\" vs \"speed improvement\" vs \"making it faster\"\n\n## Solution: Local Embeddings\nUse @xenova/transformers with all-MiniLM-L6-v2 model:\n- Runs 100% locally (no network calls)\n- ~23MB model download (one time)\n- ~3ms per embedding on modern laptop\n- 384-dimension dense vectors\n\n## Implementation\n```typescript\nimport { pipeline } from \"@xenova/transformers\";\n\nlet embedder: any = null;\n\nasync function getEmbedder() {\n  if (!embedder) {\n    embedder = await pipeline(\n      \"feature-extraction\",\n      \"Xenova/all-MiniLM-L6-v2\"\n    );\n  }\n  return embedder;\n}\n\nasync function embedText(text: string): Promise<number[]> {\n  const embed = await getEmbedder();\n  const result = await embed(text, { pooling: \"mean\", normalize: true });\n  return Array.from(result.data);\n}\n\nfunction cosineSimilarity(a: number[], b: number[]): number {\n  let dot = 0, normA = 0, normB = 0;\n  for (let i = 0; i < a.length; i++) {\n    dot += a[i] * b[i];\n    normA += a[i] * a[i];\n    normB += b[i] * b[i];\n  }\n  return dot / (Math.sqrt(normA) * Math.sqrt(normB));\n}\n```\n\n## Enhanced Bullet Scoring\n```typescript\nasync function scoreBulletsEnhanced(\n  bullets: PlaybookBullet[],\n  task: string,\n  config: Config\n): Promise<ScoredBullet[]> {\n  // 1. Keyword scoring (fast, always run)\n  const keywords = extractKeywords(task);\n  const keywordScored = bullets.map(b => ({\n    bullet: b,\n    keywordScore: scoreBulletRelevance(b.content, b.tags, keywords)\n  }));\n  \n  // 2. Semantic scoring (if enabled)\n  if (!config.semanticSearchEnabled) {\n    return keywordScored.map(({ bullet, keywordScore }) => ({\n      ...bullet,\n      combinedScore: keywordScore,\n      effectiveScore: getEffectiveScore(bullet, config)\n    }));\n  }\n  \n  const taskEmbedding = await embedText(task);\n  \n  const semanticScored = await Promise.all(\n    keywordScored.map(async ({ bullet, keywordScore }) => {\n      // Load cached or compute embedding\n      const bulletEmbedding = bullet.embedding || await embedText(bullet.content);\n      const semanticScore = cosineSimilarity(taskEmbedding, bulletEmbedding);\n      \n      return {\n        ...bullet,\n        keywordScore,\n        semanticScore,\n        // Combined: 40% keyword + 60% semantic\n        combinedScore: (keywordScore * 0.4) + (semanticScore * 10 * 0.6),\n        effectiveScore: getEffectiveScore(bullet, config)\n      };\n    })\n  );\n  \n  return semanticScored;\n}\n```\n\n## Embedding Cache\n```typescript\n// ~/.cass-memory/embeddings/bullets.json\ninterface EmbeddingCache {\n  version: string;\n  model: string;\n  bullets: Record<string, {\n    contentHash: string;\n    embedding: number[];\n    computedAt: string;\n  }>;\n}\n\nasync function loadOrComputeEmbeddings(\n  playbook: Playbook,\n  cache: EmbeddingCache\n): Promise<void> {\n  for (const bullet of playbook.bullets) {\n    const hash = hashContent(bullet.content);\n    const cached = cache.bullets[bullet.id];\n    \n    if (cached && cached.contentHash === hash) {\n      bullet.embedding = cached.embedding;\n    } else {\n      bullet.embedding = await embedText(bullet.content);\n      cache.bullets[bullet.id] = {\n        contentHash: hash,\n        embedding: bullet.embedding,\n        computedAt: now()\n      };\n    }\n  }\n  await saveEmbeddingCache(cache);\n}\n```\n\n## Performance Characteristics\n- Model download: ~23MB (first use only)\n- Model load: ~500ms (first embedding only)\n- Per-embedding: ~3ms\n- 100 bullets: ~300ms total\n- Cache hit: ~0ms (just array lookup)","status":"closed","priority":3,"issue_type":"feature","created_at":"2025-12-07T21:24:17.511923Z","updated_at":"2025-12-14T00:13:07.207826Z","closed_at":"2025-12-14T00:13:07.207826Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-y8o.3","depends_on_id":"cass_memory_system-y8o","type":"parent-child","created_at":"2026-01-21T09:28:53Z","created_by":"import"}]}
{"id":"cass_memory_system-y9k","title":"[Foundation] tsconfig.json with strict TypeScript settings","description":"Create tsconfig.json with strict TypeScript configuration for type safety and ESM module support.\n\n## Context\nTypeScript configuration is critical for ensuring type safety, proper module resolution, and IDE support throughout the CASS Memory System codebase. The configuration must support ESM, strict type checking, and clean import paths.\n\n## Technical Specification\n\n### Compiler Options:\n- target: ESNext - Use latest JavaScript features\n- module: ESNext - ES module output\n- moduleResolution: bundler - Modern resolution for Bun\n- strict: true - Enable all strict type checking options\n- esModuleInterop: true - Better compatibility with CommonJS modules\n- skipLibCheck: true - Skip type checking of declaration files for faster builds\n- resolveJsonModule: true - Allow importing JSON files\n- allowSyntheticDefaultImports: true - Allow default imports from modules with no default export\n- forceConsistentCasingInFileNames: true - Ensure consistent file name casing\n- noImplicitAny: true - Disallow implicit any types\n- strictNullChecks: true - Strict null checking\n- strictFunctionTypes: true - Strict function type checking\n- noUnusedLocals: true - Report errors on unused local variables\n- noUnusedParameters: true - Report errors on unused parameters\n- noImplicitReturns: true - Report error when not all code paths return a value\n- noFallthroughCasesInSwitch: true - Report errors for fallthrough cases in switch\n\n### Path Mapping:\n- paths: { @/*: [./src/*] } - Clean imports like import { Playbook } from '@/types'\n\n### Include/Exclude:\n- include: [src/**/*] - Include all source files\n- exclude: [node_modules, dist] - Exclude dependencies and build output\n\n### Output:\n- outDir: ./dist - Output directory for compiled files\n- declaration: true - Generate .d.ts files for library use\n- declarationMap: true - Generate sourcemaps for declarations\n- sourceMap: true - Generate sourcemaps for debugging\n\n## Reasoning\n\n### Why Strict Mode:\n1. Catch Bugs Early: Strict null checks prevent null/undefined errors at runtime\n2. Better Refactoring: Type errors guide you when making changes\n3. IDE Support: Better autocomplete and IntelliSense\n4. LLM Integration: Type safety is crucial when parsing LLM responses\n\n### Why ESNext Target:\n1. Bun Support: Bun natively supports modern JavaScript\n2. Smaller Polyfills: No need to transpile to ES5\n3. Modern Features: Use async/await, optional chaining, etc.\n\n### Why Bundler Module Resolution:\n1. Modern Standard: Aligns with modern bundlers and runtimes\n2. Better Imports: Supports package.json exports field\n3. Bun Compatibility: Matches Bun's module resolution algorithm\n\n### Why Path Mapping:\n1. Clean Imports: @/types instead of ../../../types\n2. Refactor-Friendly: Moving files doesn't break imports\n3. Readability: Clear namespace separation\n\n## Acceptance Criteria\n\n- tsconfig.json exists in project root\n- strict: true is enabled\n- target: ESNext is set\n- module: ESNext is set\n- moduleResolution: bundler is set\n- Path mapping configured for @/* -> ./src/*\n- include/exclude properly configured\n- outDir set to ./dist\n- bun run typecheck runs without errors on initial project\n- IDE shows proper IntelliSense for imports\n- No implicit any warnings in editor\n\n## How This Serves the Universal Agent Memory System\n\nTypeScript configuration is the quality gate for the entire codebase:\n\n1. Type Safety: Prevents runtime errors when parsing LLM responses, file operations, and config management\n2. Developer Experience: IntelliSense and autocomplete make development faster and more reliable\n3. Maintainability: Strong types serve as living documentation for the codebase\n4. Refactoring Confidence: Type errors guide safe refactoring as the system evolves\n5. LLM Output Validation: Zod schemas combined with TypeScript types ensure structured outputs match expectations\n\nWithout strict TypeScript, the system would be prone to runtime errors, especially when dealing with dynamic LLM responses and user configurations.","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:45:44.254164Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-yagh","title":"[Critical] User-Friendly Error Messages","description":"$(cat /tmp/fix_yagh.txt)","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T22:16:46.567040Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-ydz","title":"[LLM] generateSearchQueries - Task-based query generation","description":"Function signature:\nasync function generateSearchQueries(task: string, config: Config): Promise<string[]>\n\nSchema:\n{\n  queries: z.array(z.string()).max(5).describe('3-5 diverse search queries')\n}\n\nPrompt:\n'Given this task: {task}\n\nGenerate 3-5 diverse search queries to find relevant information in cass:\n- Similar problems encountered before\n- Related frameworks or tools\n- Relevant patterns or best practices\n- Error messages or debugging approaches\n\nMake queries specific enough to be useful but broad enough to match variations.'\n\nImplementation:\n1. Build prompt with task\n2. Call generateObject with:\n   - schema: queries array\n   - temperature: 0.5\n3. Return queries array\n\nUsed by: Generator phase to expand task into multiple cass search angles.\n\nExample: Task 'add authentication' → queries: ['JWT implementation', 'session management', 'password hashing', 'OAuth setup']","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:46:02.927470Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-yea2","title":"Verify v0.2.1 release assets are uploaded correctly","description":"# Task: Verify v0.2.1 Release Assets\n\n## Context\n\nGitHub Issue #11 mentions that the v0.2.1 release may have missing assets. The commenter suggests:\n\n> \"For now, the immediate fix is still to re-run the release workflow to upload the missing v0.2.1 assets.\"\n\n## Background\n\nThe release workflow (`.github/workflows/release.yml`) should upload:\n- `cass-memory-linux-x64` - Linux binary\n- `cass-memory-macos-arm64` - macOS Apple Silicon binary\n- `cass-memory-macos-x64` - macOS Intel binary\n- `*.sha256` - Checksum files for each binary\n\n## Verification Steps\n\n### 1. Check Current Release Assets\n\n```bash\n# List v0.2.1 release assets\ngh release view v0.2.1 --repo Dicklesworthstone/cass_memory_system --json assets\n\n# Or check via web:\n# https://github.com/Dicklesworthstone/cass_memory_system/releases/tag/v0.2.1\n```\n\n### 2. Expected Assets\n\n| Asset | Required | Purpose |\n|-------|----------|---------|\n| `cass-memory-linux-x64` | Yes | Linux binary |\n| `cass-memory-linux-x64.sha256` | Yes | Linux checksum |\n| `cass-memory-macos-arm64` | Yes | macOS ARM binary |\n| `cass-memory-macos-arm64.sha256` | Yes | macOS ARM checksum |\n| `cass-memory-macos-x64` | Yes | macOS Intel binary |\n| `cass-memory-macos-x64.sha256` | Yes | macOS Intel checksum |\n\n### 3. If Assets Are Missing\n\nRe-run the release workflow:\n\n```bash\n# Option 1: Re-run via GitHub Actions UI\n# Go to Actions → Release → Re-run failed jobs\n\n# Option 2: Delete and recreate release (if necessary)\ngh release delete v0.2.1 --repo Dicklesworthstone/cass_memory_system\ngit push --delete origin v0.2.1\ngit tag -d v0.2.1\ngit tag v0.2.1\ngit push origin v0.2.1\n```\n\n**Note**: Deleting and recreating a release should be a last resort. Try re-running the workflow first.\n\n### 4. Verify Install Script Works\n\nAfter confirming assets exist:\n\n```bash\n# Test install with explicit version\ncurl -fsSL https://raw.githubusercontent.com/Dicklesworthstone/cass_memory_system/main/install.sh \\\n  | bash -s -- --version v0.2.1 --verify\n```\n\n## Why This Matters\n\n1. **Blocking issue**: If assets are missing, the install script fails\n2. **User experience**: First-time users can't install\n3. **Fallback version**: Once we update fallback to v0.2.1, it MUST work\n\n## Priority\n\nThis is **P1 (high priority)** because:\n- Blocks new user installations if broken\n- Blocks the fallback version update task\n- May be the root cause of reported issues\n\n## Acceptance Criteria\n\n- [ ] All expected release assets are present for v0.2.1\n- [ ] Install script successfully downloads v0.2.1 binary\n- [ ] Checksum verification passes\n- [ ] Binary executes correctly (`cm --version`)\n\n## Dependencies\n\nThis task should be completed BEFORE:\n- Updating fallback version to v0.2.1\n- Final testing of redirect-based resolution\n\n## Notes\n\nIf the release workflow is fundamentally broken:\n1. Fix the workflow in a separate PR\n2. Create a new patch release (v0.2.2)\n3. Update fallback to the new version instead\n\nThe redirect-based version resolution work can proceed in parallel - it doesn't depend on the specific version being available, just that SOME version is available.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-05T18:42:00.773381Z","created_by":"jemanuel","updated_at":"2026-01-05T19:22:20.413351Z","closed_at":"2026-01-05T19:22:20.413351Z","close_reason":"Uploaded all 8 assets to v0.2.1 release: 4 binaries (linux-x64, macos-arm64, macos-x64, windows-x64) + 4 SHA256 checksums. Verified redirect resolution works.","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-yee2","title":"Update quickstart and docs for new onboard subcommands","description":"## Context\n\nAfter implementing the onboard subcommand refactor (cass_memory_system-qwm2), documentation needs to be updated to reflect the new command structure.\n\n## Files to Update\n\n### 1. src/commands/quickstart.ts\n\nUpdate any references to onboard commands:\n\nBefore:\n```\ncm onboard --sample --json\ncm onboard --read <path>\n```\n\nAfter:\n```\ncm onboard sample --json\ncm onboard read <path>\n```\n\n### 2. AGENTS.md (if applicable)\n\nCheck if there are any onboard command references that need updating.\n\n### 3. README.md (if applicable)\n\nCheck if there are any onboard command references.\n\n### 4. Inline help text\n\nEnsure the parent `cm onboard` command help text explains the subcommand structure:\n\n```\ncm onboard <command>\n\nAgent-native guided onboarding (no API costs)\n\nCommands:\n  status      Check onboarding status and progress\n  gaps        Show playbook category gap analysis\n  sample      Sample diverse sessions for analysis\n  read        Read/export a session for analysis\n  prompt      Show extraction instructions\n  guided      Full guided workflow\n  mark-done   Mark a session as processed\n  reset       Reset onboarding progress\n\nUse 'cm onboard <command> --help' for more information on a command.\n```\n\n## Acceptance Criteria\n\n- [ ] All documentation uses new subcommand syntax\n- [ ] No references to deprecated flag syntax (except in migration notes)\n- [ ] `cm onboard --help` shows clear subcommand list\n\n## Depends On\n\ncass_memory_system-qwm2 (Implementation task)\n\n## Part of Feature\n\ncass_memory_system-e6o7 (Onboard subcommand refactor)","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-15T17:18:05.186221Z","updated_at":"2025-12-15T17:50:05.272993Z","closed_at":"2025-12-15T17:50:05.272993Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-yee2","depends_on_id":"cass_memory_system-qwm2","type":"blocks","created_at":"2026-01-21T09:28:53Z","created_by":"import"}]}
{"id":"cass_memory_system-yelb","title":"[P3] Add --examples global flag","description":"# Task: Add --examples Global Flag\n\n## Problem\nUsers want to see common workflows without reading docs.\n\n## Solution\n```bash\ncm --examples\n# Shows:\n#\n# Quick Start:\n#   cm init                              # Set up cass-memory\n#   cm context \"my task\" --json          # Get relevant rules\n#   cm outcome success b-xxx,b-yyy       # Record what helped\n#   cm reflect                           # Learn from session\n#\n# Common Workflows:\n#   cm playbook list --scope workspace   # See workspace rules\n#   cm stats --category testing          # Check testing coverage\n#   cm doctor --fix                      # Fix any issues\n#\n# For command-specific examples:\n#   cm <command> --help\n```\n\n## Files\n- src/cm.ts (add --examples handler)\n- src/examples.ts (new - example content)\n\n## Acceptance\n- [ ] --examples shows curated workflows\n- [ ] Examples are copy-pasteable\n- [ ] Covers main use cases","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-16T15:33:58.298912Z","updated_at":"2025-12-28T02:34:52.886585Z","closed_at":"2025-12-28T02:34:52.886585Z","close_reason":"Implemented --examples global flag with 7 curated workflow categories, both human and JSON output","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-yelb","depends_on_id":"cass_memory_system-082i","type":"blocks","created_at":"2026-01-21T09:28:53Z","created_by":"import"}]}
{"id":"cass_memory_system-yf5m","title":"Replace GitHub API version resolution with redirect-based approach in install.sh","description":"# Task: Implement Redirect-Based Version Resolution\n\n**GitHub Issue**: #11 (CasualDeveloper)\n**Related**: cass PR #29, Epic cass_memory_system-fubh\n\n## Summary\n\nReplace the fragile GitHub API-based version resolution in `install.sh` with a robust redirect-based approach. This is a single function change (~15 lines) that eliminates API rate limits and cross-platform parsing issues.\n\n---\n\n## The Problem\n\nCurrent `resolve_version()` (install.sh:26-43):\n```bash\ntag=$(curl -fsSL -H \"Accept: application/vnd.github.v3+json\" \\\n  \"https://api.github.com/repos/${OWNER}/${REPO}/releases/latest\" \\\n  | grep '\"tag_name\":' | sed -E 's/.*\"([^\"]+)\".*/\\1/')\n```\n\n**Issues:**\n- GitHub API rate limited to 60 req/hr (unauthenticated)\n- `sed -E` varies between GNU and BSD (breaks on macOS vs Linux)\n- Falls back to ancient `v0.1.0` on failure\n\n---\n\n## The Solution\n\nReplace with redirect-based resolution:\n```bash\nresolve_version() {\n  if [ -n \"$VERSION\" ]; then return 0; fi\n\n  info \"Resolving latest version...\"\n  \n  # Redirect-based resolution: GitHub redirects /releases/latest → /releases/tag/{version}\n  # Advantages: No API rate limits, no JSON parsing, works identically on all platforms\n  local releases_url=\"https://github.com/${OWNER}/${REPO}/releases/latest\"\n  local final_url\n  \n  final_url=\"$(curl -fsSL \\\n    --connect-timeout 10 \\\n    --max-time 30 \\\n    -A \"cass-memory-installer/1.0\" \\\n    -o /dev/null \\\n    -w '%{url_effective}' \\\n    \"$releases_url\" 2>/dev/null || true)\"\n  \n  # Extract tag: .../releases/tag/v0.2.1 → v0.2.1\n  local tag=\"${final_url##*/}\"\n  \n  # Validate redirect worked (URL must contain /releases/tag/)\n  if [ -n \"$tag\" ] && [[ \"$final_url\" == *\"/releases/tag/\"* ]]; then\n    VERSION=\"$tag\"\n    info \"Resolved latest version: $VERSION\"\n  else\n    VERSION=\"v0.2.1\"  # Update this when releasing new major versions\n    warn \"Could not resolve latest version; defaulting to $VERSION\"\n  fi\n}\n```\n\n---\n\n## Implementation Steps\n\n### 1. Verify Approach Works (5 min)\n```bash\n# Quick verification that redirect works\ncurl -fsSL -o /dev/null -w '%{url_effective}\\n' \\\n  \"https://github.com/Dicklesworthstone/cass_memory_system/releases/latest\"\n# Expected: https://github.com/.../releases/tag/v0.2.1\n\n# Test extraction\nfinal_url=\"$(curl -fsSL -o /dev/null -w '%{url_effective}' \\\n  \"https://github.com/Dicklesworthstone/cass_memory_system/releases/latest\")\"\necho \"${final_url##*/}\"\n# Expected: v0.2.1\n```\n\n### 2. Edit install.sh (10 min)\nReplace lines 26-43 with the new implementation above.\n\n### 3. Test Edge Cases (10 min)\n```bash\n# Test 1: Normal resolution\n./install.sh --verify\n\n# Test 2: Explicit version bypass\n./install.sh --version v0.2.0 --verify\n\n# Test 3: Invalid repo (should fallback)\nOWNER=nonexistent REPO=repo ./install.sh --verify\n# Expected: warns and uses fallback\n\n# Test 4: Bash 3.2 compatibility (macOS)\n/bin/bash -c 'url=\"https://x/releases/tag/v1.2.3\"; echo \"${url##*/}\"'\n# Expected: v1.2.3\n```\n\n### 4. Commit\n```bash\ngit add install.sh\ngit commit -m \"fix(install): use redirect-based version resolution\n\nReplace GitHub API-based version resolution with redirect-based approach.\nThis avoids API rate limits (60/hr) and fragile grep+sed JSON parsing.\n\n- Uses curl %{url_effective} to capture redirect destination\n- Shell parameter expansion instead of sed regex\n- Adds validation that redirect actually happened\n- Updates fallback from v0.1.0 to v0.2.1\n\nFixes #11\"\n```\n\n---\n\n## Edge Cases Handled\n\n| Scenario | Behavior |\n|----------|----------|\n| Normal release exists | Extract version from redirect |\n| No releases | Falls back gracefully |\n| Pre-release only | Falls back (GitHub doesn't redirect to pre-releases) |\n| Network timeout | Falls back (10s connect, 30s max) |\n| Corporate proxy intercept | Validation fails, falls back |\n| Non-semver tags | Works - extracts whatever the tag is |\n\n---\n\n## Cross-Project Note\n\nThe sibling project `cass` (coding_agent_session_search) has PR #29 with the same fix. Once both are merged, the install scripts will be consistent. Reference their PR in our commit if merged first.\n\n---\n\n## Acceptance Criteria\n\n- [ ] `resolve_version()` uses redirect-based approach\n- [ ] Works on macOS (arm64, x64) and Linux (x64)\n- [ ] Handles network failures gracefully\n- [ ] Fallback version updated to v0.2.1\n- [ ] Comments explain the approach\n- [ ] Commit references issue #11","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T19:13:34.750457Z","created_by":"jemanuel","updated_at":"2026-01-05T19:24:08.160664Z","closed_at":"2026-01-05T19:24:08.160664Z","close_reason":"Implemented redirect-based version resolution. Committed as c694251. Fixes GitHub Issue #11.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-yf5m","depends_on_id":"cass_memory_system-yea2","type":"blocks","created_at":"2026-01-21T09:28:53Z","created_by":"import"}]}
{"id":"cass_memory_system-ygng","title":"[Critical] Implicit Feedback - Auto-Mark from Session Outcomes","description":"# Implicit Feedback - Auto-Mark from Session Outcomes\n\n## The Problem\nCurrent plan requires manual `cm mark helpful/harmful <rule>` commands.\nUsers won't do this. They'll use the tool, benefit from rules, but never give feedback.\nWithout feedback, the confidence system is useless.\n\n## The Solution\nInfer feedback automatically from observable signals:\n\n### Signal Sources:\n1. **Session Success/Failure**: Did the task complete? Errors? Retries?\n2. **Time to Completion**: Fast = rules helped. Slow = rules didn't help or were wrong.\n3. **Pattern Matching**: Did the session use patterns matching rules we showed?\n4. **Explicit Signals**: User said \"that worked!\" or \"that was wrong\"\n\n### Implementation:\n```typescript\ninterface SessionOutcome {\n  sessionPath: string;\n  startTime: Date;\n  endTime: Date;\n  rulesShown: string[];  // Rule IDs shown in context\n  signals: {\n    completedSuccessfully: boolean;  // No error exit\n    hadRetries: boolean;  // Multiple attempts at same thing\n    userSentiment: \"positive\" | \"negative\" | \"neutral\" | null;\n    taskDuration: number;  // Seconds\n    errorCount: number;\n  };\n}\n\nasync function inferFeedback(outcome: SessionOutcome): Promise<FeedbackEvent[]> {\n  const feedback: FeedbackEvent[] = [];\n  \n  for (const ruleId of outcome.rulesShown) {\n    let implicit: FeedbackStrength | null = null;\n    \n    // Strong positive: Quick success with no errors\n    if (outcome.signals.completedSuccessfully && \n        !outcome.signals.hadRetries &&\n        outcome.signals.taskDuration < FAST_THRESHOLD) {\n      implicit = \"helpful\";\n    }\n    \n    // Strong negative: Errors or retries on tasks using this rule\n    if (outcome.signals.errorCount > 2 || outcome.signals.hadRetries) {\n      implicit = \"not_helpful\";\n    }\n    \n    // Explicit overrides implicit\n    if (outcome.signals.userSentiment === \"positive\") {\n      implicit = \"very_helpful\";\n    } else if (outcome.signals.userSentiment === \"negative\") {\n      implicit = \"harmful\";\n    }\n    \n    if (implicit) {\n      feedback.push({\n        bulletId: ruleId,\n        strength: implicit,\n        source: \"implicit\",\n        sessionId: outcome.sessionPath,\n        timestamp: new Date()\n      });\n    }\n  }\n  \n  return feedback;\n}\n```\n\n### Sentiment Detection (Lightweight):\n```typescript\nconst POSITIVE_PATTERNS = [\n  /that worked/i, /perfect/i, /thanks/i, /great/i,\n  /exactly what I needed/i, /solved it/i\n];\n\nconst NEGATIVE_PATTERNS = [\n  /that('s| is) wrong/i, /doesn't work/i, /broke/i,\n  /not what I wanted/i, /try again/i, /undo/i\n];\n\nfunction detectSentiment(sessionText: string): \"positive\" | \"negative\" | \"neutral\" {\n  const positiveCount = POSITIVE_PATTERNS.filter(p => p.test(sessionText)).length;\n  const negativeCount = NEGATIVE_PATTERNS.filter(p => p.test(sessionText)).length;\n  \n  if (positiveCount > negativeCount) return \"positive\";\n  if (negativeCount > positiveCount) return \"negative\";\n  return \"neutral\";\n}\n```\n\n### Feedback Weighting:\n```typescript\nconst FEEDBACK_WEIGHTS = {\n  // Explicit feedback (user ran command)\n  \"explicit_helpful\": 2.0,\n  \"explicit_harmful\": -3.0,\n  \n  // Implicit from session outcome\n  \"implicit_helpful\": 0.5,\n  \"implicit_not_helpful\": -0.3,\n  \n  // Implicit from sentiment\n  \"sentiment_positive\": 0.3,\n  \"sentiment_negative\": -0.5\n};\n```\n\n### Post-Session Hook:\n```typescript\n// Runs automatically after cass detects session end\nasync function onSessionEnd(sessionPath: string): Promise<void> {\n  // 1. Get rules that were shown for this session\n  const contextLog = await loadContextLog(sessionPath);\n  if (!contextLog?.rulesShown) return;  // Context wasn't used\n  \n  // 2. Analyze session outcome\n  const outcome = await analyzeSession(sessionPath);\n  outcome.rulesShown = contextLog.rulesShown;\n  \n  // 3. Infer and record feedback\n  const feedback = await inferFeedback(outcome);\n  for (const f of feedback) {\n    await recordFeedbackEvent(f);\n  }\n  \n  // 4. Update confidence scores\n  await updateConfidenceScores(feedback);\n}\n```\n\n## Why This Is Critical\n- Manual feedback has ~0% adoption rate\n- Without feedback, confidence scores never update\n- System can't learn what works vs what doesn't\n- Implicit feedback is \"good enough\" for most cases\n- Can always add explicit feedback later for edge cases\n\n## Trade-offs\n- False positives/negatives possible (mitigated by low weights)\n- Privacy: Analyzing session content (already in cass, so OK)\n- Complexity: Need to track which rules were shown","status":"tombstone","priority":0,"issue_type":"feature","created_at":"2025-12-07T22:08:16.860446Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"feature","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-yher","title":"Feature: Icon/Emoji Consistency","description":"# Feature: Icon/Emoji Consistency\n\n## Problem Statement\n\nThe codebase has a well-designed icon system in output.ts that respects `CASS_MEMORY_NO_EMOJI` environment variable, but many commands bypass it by hardcoding emoji characters directly.\n\n## Current Infrastructure\n\n```typescript\n// output.ts - The RIGHT way\nexport function iconPrefix(name: IconName): string {\n  const value = icon(name);  // Returns emoji or \"\" based on env var\n  return value ? `${value} ` : \"\";\n}\n\n// Commands using it correctly\nconsole.log(chalk.bold(`\\n${iconPrefix(\"check\")}Reflection complete.`));\n```\n\n## Problem: Hardcoded Emoji\n\n```typescript\n// mark.ts:118 - WRONG\nconsole.log(chalk.green(`✓ Marked bullet ${bulletId} as ${result.type}`));\n\n// forget.ts:91 - WRONG\nconsole.log(chalk.green(`✓ Forgot bullet ${bulletId}`));\n\n// outcome.ts:138 - WRONG\nconsole.log(chalk.green(`✓ Recorded implicit ${scored.type} feedback...`));\n\n// playbook.ts:588, 595 - WRONG\nconsole.log(chalk.yellow(`⊘ Skipped...`));\nconsole.log(chalk.red(`✗ Failed...`));\n```\n\n## Why This Matters\n\n1. **CI/CD environments** often can't render emoji properly\n2. **Log aggregation** tools may mangle Unicode\n3. **Screen readers** may not handle emoji well\n4. **Parsers** expecting ASCII output break on Unicode\n\nThe `CASS_MEMORY_NO_EMOJI` env var exists precisely for these cases, but it's being bypassed.\n\n## Solution\n\n### Step 1: Add Missing Icons to ICONS Table\n\nThe current ICONS table doesn't have simple checkmark/cross icons. Add them:\n\n```typescript\n// output.ts - Add to ICONS\nconst ICONS: Record<IconName, { emoji: string; plain: string }> = {\n  // ... existing icons ...\n  success: { emoji: \"✓\", plain: \"[OK]\" },\n  failure: { emoji: \"✗\", plain: \"[FAIL]\" },\n  skipped: { emoji: \"⊘\", plain: \"[SKIP]\" },\n};\n```\n\n### Step 2: Replace Hardcoded Emoji\n\n```typescript\n// Before\nconsole.log(chalk.green(`✓ Marked bullet ${bulletId}`));\n\n// After\nconsole.log(chalk.green(`${icon(\"success\")} Marked bullet ${bulletId}`));\n```\n\n## Files to Modify\n\n- src/output.ts - Add missing icons\n- src/commands/mark.ts\n- src/commands/forget.ts\n- src/commands/outcome.ts\n- src/commands/playbook.ts\n- Any others found during audit\n\n## Acceptance Criteria\n\n- [ ] All emoji in command output go through icon() or iconPrefix()\n- [ ] CASS_MEMORY_NO_EMOJI=1 produces clean ASCII output\n- [ ] Grep for `✓`, `✗`, `⊘` in commands/ returns 0 results\n\n## Impact Assessment\n\n**Low risk** - Only affects human-readable output, not JSON mode. \n**Medium effort** - Find and replace across ~10 files.\n\n## Parent Epic\nThis feature is part of the CLI Agent-Friendliness Improvements epic.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-15T18:25:31.920546Z","updated_at":"2025-12-15T20:11:43.269002Z","closed_at":"2025-12-15T20:11:43.269002Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-yher","depends_on_id":"cass_memory_system-kpn4","type":"blocks","created_at":"2026-01-21T09:28:53Z","created_by":"import"},{"issue_id":"cass_memory_system-yher","depends_on_id":"cass_memory_system-uazo","type":"blocks","created_at":"2026-01-21T09:28:53Z","created_by":"import"}]}
{"id":"cass_memory_system-yj1z","title":"[Test Infrastructure] Test fixtures and factory functions","description":"## Test Fixtures and Factory Functions\n\nCreate reusable test fixtures and factory functions for deterministic testing WITHOUT mocks.\n\n### Required Factories:\n1. `createTestPlaybook(overrides?)` - Returns valid Playbook with controllable defaults\n2. `createTestBullet(overrides?)` - Returns valid PlaybookBullet with all fields\n3. `createTestDiary(overrides?)` - Returns valid DiaryEntry\n4. `createTestConfig(overrides?)` - Returns valid Config with test-safe defaults\n5. `createTestFeedbackEvent(type, overrides?)` - Returns helpful/harmful events\n\n### Design Principles:\n- NO mocks - use real data structures\n- Deterministic - same inputs always produce same outputs\n- Composable - factories can be nested/combined\n- Type-safe - full TypeScript inference\n\n### Example Usage:\n```typescript\nconst bullet = createTestBullet({\n  helpfulCount: 5,\n  harmfulCount: 1,\n  maturity: 'proven'\n});\n```\n\n### File Location: test/fixtures/factories.ts","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-08T01:23:03.081639Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-yo24","title":"[E2E Tests] Full ACE pipeline - session to playbook","description":"## E2E Test: Full ACE Pipeline - Session to Playbook\n\n### Test Scenario\nComplete end-to-end test of the Autonomous Curation Engine:\nSession ingestion → Reflection → Validation → Playbook update\n\n### Test Steps\n\n#### 1. Setup\n- Create temp directory structure\n- Initialize cass-memory config\n- Create sample session transcript file\n- Create initial empty playbook\n\n#### 2. Execute Full Pipeline\n- Run `cm context` with session path\n- Trigger reflection (automatic or manual)\n- Verify diary entry created\n- Verify playbook updated\n\n#### 3. Validate Outputs\n- Diary entry has valid structure\n- Playbook has new bullets\n- Bullets have confidence scores\n- Timestamps are correct\n\n#### 4. Verify Logging\n- Each pipeline stage logs entry/exit\n- Timing information captured\n- Error paths logged appropriately\n- Verbose mode shows full details\n\n### Test Data\n- Sample session with 20+ messages\n- Mix of code, discussion, errors\n- Clear lessons to extract\n\n### Success Criteria\n- Pipeline completes without error\n- Diary entry matches session content\n- Playbook bullets are relevant\n- All intermediate files created\n\n### Verbose Logging Requirements\n- Log: 'Starting ACE pipeline for session: <path>'\n- Log: 'Reflection phase: extracting lessons...'\n- Log: 'Validation phase: checking bullet quality...'\n- Log: 'Curation phase: updating playbook...'\n- Log: 'Pipeline complete. Added N bullets, duration: Xms'","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-08T01:24:28.156899Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-yo24","depends_on_id":"cass_memory_system-70sd","type":"blocks","created_at":"2026-01-21T09:28:53Z","created_by":"import"}]}
{"id":"cass_memory_system-yoh8","title":"Harden ProcessedLog.append against missing trailing newline","description":"If a processed log file exists but does not end with a newline (legacy/manual edit), ProcessedLog.append can concatenate JSON lines and corrupt the log. Under lock, detect last byte and insert a separator newline before appending.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-16T07:02:20.523577Z","updated_at":"2025-12-16T07:03:29.848971Z","closed_at":"2025-12-16T07:03:29.848971Z","close_reason":"ProcessedLog.append now ensures line separation when the existing file lacks a trailing newline (legacy/manual edits), preventing JSONL concatenation; added regression test","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-ypmh","title":"[ErrorHandling] validateAndSanitizeInput - Input validation","description":"Validate and sanitize user input to prevent errors and security issues.\n\nFunction signature:\nfunction validateAndSanitizeInput(\n  type: 'bulletId' | 'sessionPath' | 'task' | 'category',\n  value: string\n): string\n\nValidation rules:\n- bulletId: Must match pattern (e.g., 'B001', alphanumeric)\n- sessionPath: Valid file path, resolve relative to absolute\n- task: Non-empty, max length, no control characters\n- category: Must be in allowed list or match pattern\n\nSanitization:\n- Trim whitespace\n- Normalize unicode\n- Remove control characters\n- Resolve paths to absolute\n\nThrows descriptive error with hint if invalid:\n- What was invalid\n- What format is expected\n- Example of valid input\n\nReturns sanitized value on success.","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:51:27.710962Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-yqds","title":"[Tracking] atomicWrite - Safe file updates","description":"Purpose: Prevent file corruption on crashes/interruptions during writes\n\nFunction signature:\n```typescript\nasync function atomicWrite(\n  filePath: string,\n  content: string\n): Promise<void>\n```\n\nImplementation steps:\n1. Generate temp file path: {filePath}.tmp\n2. Write content to temp file\n3. Call fsync() on temp file descriptor to ensure data on disk\n4. Close temp file\n5. Rename temp file to final path (atomic operation on POSIX)\n6. On error: cleanup temp file and rethrow\n\nPlatform considerations:\n- POSIX (macOS/Linux): rename() is atomic\n- Windows: May need MoveFileEx with MOVEFILE_REPLACE_EXISTING\n\nError handling:\n```typescript\ntry {\n  await fs.writeFile(tmpPath, content);\n  const fd = await fs.open(tmpPath, 'r+');\n  await fd.sync();\n  await fd.close();\n  await fs.rename(tmpPath, filePath);\n} catch (err) {\n  await fs.unlink(tmpPath).catch(() => {});\n  throw err;\n}\n```\n\nUsed for: Playbooks, config files, processed logs, all critical data files","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:51:30.763028Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-yt21","title":"Fix failing playbook merge tests - git repo initialization","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-13T08:52:55.594568Z","updated_at":"2025-12-13T09:09:34.189867Z","closed_at":"2025-12-13T09:09:34.189867Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-yue","title":"[Diary] findDiaryBySession - Lookup by session path","description":"Find diary entry by session path, used for evidence correlation.\n\nFunction Signature:\nasync function findDiaryBySession(\n  sessionPath: string,\n  config: Config\n): Promise<DiaryEntry | null>\n\nProcess:\n1. List all files in diary directory\n2. Filter for JSON files matching diary filename pattern\n3. For each diary file:\n   a. Load diary using loadDiaryEntry\n   b. Check if diary.sessionPath === sessionPath\n   c. Return diary if match found\n4. Return null if no match found\n\nOptimization:\n- Early exit on first match (no need to scan all)\n- Cache recently loaded diaries in memory\n- Use filename hash to skip unlikely matches\n\nKey Features:\n- Exact path matching\n- Graceful null return on no match\n- Error resilient (skips corrupted diaries)\n- Performance optimized for large diary collections\n\nUse Cases:\n- Validator looking up evidence for rule\n- Checking if diary already exists for session\n- Correlating playbook rules with diary insights\n- Evidence chain construction\n\nExample:\nconst session = '~/.claude/projects/myapp/session-123.jsonl';\nconst diary = await findDiaryBySession(session, config);\nif (diary) {\n  console.log('Session outcome:', diary.status);\n  console.log('Key learnings:', diary.keyLearnings);\n}\n\nPerformance:\n- O(n) worst case where n = number of diaries\n- O(1) best case with early exit\n- Consider indexing for large collections (future enhancement)\n\nOutput:\nReturns DiaryEntry if found, null otherwise.","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:46:22.156714Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-yyy","title":"[Types] DiaryEntry Schema - Structured Session Summary","description":"## Overview\nDefine DiaryEntry schema for structured session summaries - the Working Memory layer of the 3-layer memory system (Working Memory -> Playbook -> Long-term Sessions).\n\n## Purpose\nDiary entries compress raw cass sessions into structured, searchable summaries that:\n1. Enable fast semantic search across session history\n2. Provide context for playbook rule creation\n3. Support cross-session learning and pattern detection\n4. Serve as intermediate representation between raw logs and refined rules\n\n## Core Identity Fields\n\n### id: string\n- Format: 'diary-{hash}' (hash of sessionPath + timestamp)\n- Purpose: Unique identifier for diary entry\n- Example: 'diary-a3f8b2c1'\n\n### sessionPath: string\n- Purpose: Path to original cass session file\n- Required: Yes\n- Example: '/Users/dev/.cass/sessions/2025-12-07-auth-fix.jsonl'\n- Usage: Link back to full session details\n\n### timestamp: string\n- Purpose: When session occurred\n- Format: ISO 8601\n- Required: Yes\n- Example: '2025-12-07T14:30:00Z'\n- Usage: Chronological ordering, recency filtering\n\n## Context Fields\n\n### agent: string\n- Purpose: Which AI agent or tool conducted the session\n- Values: 'claude', 'codex', 'cursor', 'copilot', 'human', etc.\n- Required: Yes\n- Example: 'claude'\n- Usage: Agent-specific pattern analysis, multi-agent collaboration\n\n### workspace: string | undefined\n- Purpose: Repository/project where work occurred\n- Value: Absolute path to workspace root\n- Example: '/Users/dev/projects/auth-service'\n- Usage: Workspace-scoped rule creation, project context\n\n### duration: number | undefined\n- Purpose: Session length in seconds\n- Example: 1800 (30 minutes)\n- Usage: Productivity metrics, context weight\n\n### status: 'success' | 'failure' | 'mixed'\n- Purpose: Overall session outcome\n- Values:\n  - success: Completed task successfully\n  - failure: Task not completed or failed\n  - mixed: Partial success or mixed outcomes\n- Usage: Evidence weighting for validation\n\n## Structured Content (The Key Innovation)\n\n### accomplishments: string[]\n- Purpose: What was completed in this session\n- Examples: ['Implemented JWT token validation', 'Fixed authentication bypass bug', 'Added test coverage for auth flow']\n- Usage: Success pattern detection, context for helpful feedback\n\n### decisions: string[]\n- Purpose: Design/architecture choices made\n- Examples: ['Chose to centralize auth in TokenValidator service', 'Decided to use JWT over sessions for stateless auth', 'Selected Zod for schema validation']\n- Usage: Design pattern extraction, project convention creation\n\n### challenges: string[]\n- Purpose: Problems encountered and how they were solved\n- Examples: ['Struggled with circular dependency in auth module - resolved by extracting types', 'JWT library had breaking changes - migrated to jose v5']\n- Usage: Anti-pattern detection, pitfall documentation\n\n### preferences: string[]\n- Purpose: User style/preference revelations\n- Examples: ['Prefers async/await over Promise chains', 'Likes co-located tests', 'Uses Conventional Commits format']\n- Usage: Personalized workflow rule creation\n\n### keyLearnings: string[]\n- Purpose: Reusable insights and takeaways\n- Examples: ['Always validate JWT exp claim', 'Mock Router hooks cause flaky tests', 'Next.js middleware runs on edge runtime']\n- Usage: Direct rule extraction, playbook bullet candidates\n\n## Cross-Session Linking\n\n### relatedSessions: object[] | undefined\n- Purpose: Links to similar/related past sessions\n- Structure: [{ sessionPath: string, agent: string, relevanceScore: number, snippet: string }]\n- Example: [{ sessionPath: '/cass/2025-11-20-auth-refactor.jsonl', agent: 'claude', relevanceScore: 0.87, snippet: 'Refactored AuthService to use JWT tokens' }]\n- Usage: Cross-session pattern detection, evidence accumulation\n\n## Searchability Enhancement\n\n### tags: string[]\n- Purpose: Categorical labels for filtering\n- Examples: ['authentication', 'security', 'bug-fix', 'refactoring']\n- Usage: Faceted search, rule categorization\n\n### searchAnchors: string[]\n- Purpose: \"SEO for agents\" - optimized search terms\n- Content: Key phrases likely to be searched\n- Examples: ['JWT token validation', 'authentication bypass fix', 'TokenValidator service', 'Zod schema validation']\n- Usage: Improve recall in semantic search, make entries discoverable\n- Generation: Extracted from content + LLM enhancement\n\n## Complete Example\n\n{\n  id: 'diary-a3f8b2c1',\n  sessionPath: '/Users/dev/.cass/sessions/2025-12-07-auth-fix.jsonl',\n  timestamp: '2025-12-07T14:30:00Z',\n  agent: 'claude',\n  workspace: '/Users/dev/projects/auth-service',\n  duration: 1800,\n  status: 'success',\n  accomplishments: ['Fixed authentication bypass vulnerability', 'Implemented centralized JWT validation', 'Added comprehensive test coverage'],\n  decisions: ['Centralized all auth logic in TokenValidator service', 'Used jose library for JWT handling', 'Implemented token expiration checks'],\n  challenges: ['Circular dependency in auth module - resolved by extracting types file', 'Needed to update 15 call sites to use new TokenValidator'],\n  preferences: ['Prefers explicit token validation over implicit middleware'],\n  keyLearnings: ['Always validate JWT exp and iat claims', 'Centralized auth prevents bypass vulnerabilities', 'Type extraction breaks circular deps'],\n  relatedSessions: [{ sessionPath: '/cass/2025-11-20-auth-refactor.jsonl', agent: 'claude', relevanceScore: 0.87, snippet: 'Initial auth refactor discussion' }],\n  tags: ['authentication', 'security', 'bug-fix', 'jwt'],\n  searchAnchors: ['JWT token validation', 'authentication bypass fix', 'TokenValidator service', 'centralized auth pattern', 'token expiration validation']\n}\n\n## Integration with Playbook\n\nDiary entries are the RAW MATERIAL for playbook rules:\n1. Reflector analyzes diary entries to propose new rules\n2. Validation checks diary entries for supporting evidence\n3. Context enrichment pulls relevant diary snippets\n4. Cross-session patterns emerge from diary analysis\n\n## Storage and Indexing\n\n- Stored as individual YAML files in diary directory\n- File naming: {date}-{agent}-{hash}.yaml\n- Indexed by: timestamp, agent, workspace, tags\n- Searchable by: searchAnchors, content fields, semantic similarity\n\n## Acceptance Criteria\n- All core identity fields (id, sessionPath, timestamp)\n- Context fields (agent, workspace, duration, status)\n- Structured content arrays (accomplishments, decisions, challenges, preferences, keyLearnings)\n- relatedSessions linking structure\n- tags and searchAnchors arrays\n- Zod schema with validation\n- YAML serialization/deserialization\n- Examples showing all field types\n- JSDoc documentation","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:45:02.547524Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-z7kw","title":"[Test] Helpers: Temp directory management","description":"Create test/helpers/temp.ts with:\n\n## Functions\n\n### createTempTestDir(testName: string): string\n- Creates unique temp directory: /tmp/cass-test-{testName}-{timestamp}/\n- Returns absolute path\n- Auto-registers for cleanup\n\n### cleanupTempTestDir(dir: string): void\n- Recursively removes directory\n- Safe (only removes dirs in /tmp/cass-test-*)\n- Logs cleanup in verbose mode\n\n### withTempDir<T>(testName: string, fn: (dir: string) => Promise<T>): Promise<T>\n- Higher-order helper that creates temp dir, runs fn, then cleans up\n- Handles errors gracefully (still cleans up)\n- Preferred pattern for tests\n\n## Example Usage\n\\`\\`\\`typescript\nimport { withTempDir } from \"./helpers/temp\";\n\nit(\"creates playbook file\", async () => {\n  await withTempDir(\"creates-playbook\", async (dir) => {\n    const playbookPath = path.join(dir, \"playbook.yaml\");\n    await savePlaybook(playbook, playbookPath);\n    expect(await fs.exists(playbookPath)).toBe(true);\n  });\n});\n\\`\\`\\`\n\n## Implementation Notes\n- Use crypto.randomUUID() for uniqueness\n- Use fs.rm with { recursive: true, force: true }\n- Add safety check to prevent deleting non-temp dirs","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-08T01:22:43.322036Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-z7mv","title":"Fix outcome command help to include partial status","description":"CLI help in src/cm.ts omits 'partial' though outcomeCommand accepts it. Align description with supported statuses.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-07T07:22:03.055329388Z","created_by":"ubuntu","updated_at":"2026-01-07T07:22:29.655299560Z","closed_at":"2026-01-07T07:22:29.655299560Z","close_reason":"Updated outcome command help string to include partial status.","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-z8y7","title":"[Unit Tests] scoring.ts - Confidence decay and effective scores","description":"## Unit Tests: scoring.ts - Confidence Decay and Effective Scores\n\n### Test Categories\n\n#### 1. calculateDecay()\n- Returns 1.0 at time zero\n- Exponential decay over time\n- Respects half-life parameter\n- Never drops below floor value\n\n#### 2. effectiveConfidence()\n- Combines base confidence with decay\n- Handles missing created_at timestamps\n- Uses current time as reference\n- Returns original if decay disabled\n\n#### 3. applyDecayToBullets()\n- Maps decay to array of bullets\n- Preserves other bullet properties\n- Adds effective_confidence field\n- Filters bullets below threshold\n\n#### 4. calculateMaturity()\n- New bullets start at 0\n- Increases with positive feedback\n- Decreases with negative feedback\n- Caps at 1.0 maximum\n- Has minimum floor\n\n#### 5. sortByEffectiveScore()\n- Primary sort by effective confidence desc\n- Secondary sort by maturity desc\n- Tertiary sort by created_at asc\n- Stable sort for equal scores\n\n#### 6. Half-Life Configurations\n- Default half-life (30 days)\n- Custom half-life from config\n- Very short half-life (rapid decay)\n- Very long half-life (slow decay)\n- Infinite half-life (no decay)\n\n### Test Data Requirements\n- Bullets with various created_at timestamps\n- Bullets with various base confidence scores\n- Config objects with different decay settings\n\n### Precision Testing\n- Floating point comparison with epsilon\n- Edge cases around decay thresholds","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-08T01:23:35.673912Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-z8y7","depends_on_id":"cass_memory_system-ep5y","type":"blocks","created_at":"2026-01-21T09:28:53Z","created_by":"import"},{"issue_id":"cass_memory_system-z8y7","depends_on_id":"cass_memory_system-yj1z","type":"blocks","created_at":"2026-01-21T09:28:53Z","created_by":"import"}]}
{"id":"cass_memory_system-zc1d","title":"Sub-Epic: Integration Tests (Real File I/O)","description":"# Sub-Epic: Integration Tests (Real File I/O)\n\n## Philosophy\nTest module interactions with REAL file system operations.\nUse temp directories for isolation, clean up after tests.\nNO mocking of file system - test actual behavior.\n\n## Test Infrastructure Required\n1. **Temp Directory Management**\n   - beforeAll: Create isolated temp dir\n   - afterAll: Clean up temp dir\n   - Helper: createTempConfig(), createTempPlaybook()\n\n2. **Fixture Data**\n   - test/fixtures/sessions/ - Sample session files (JSONL, JSON, MD)\n   - test/fixtures/playbooks/ - Sample playbook YAML files\n   - test/fixtures/diaries/ - Sample diary JSON files\n\n3. **Test Utilities**\n   - test/helpers/fs.ts - File system test helpers\n   - test/helpers/fixtures.ts - Fixture loading utilities\n   - test/helpers/assertions.ts - Custom assertions\n\n## Integration Test Areas\n\n### Area 1: Configuration System\n- config.ts: Load, save, merge (global + repo)\n- Path expansion (~/, ./, ../)\n- Default value handling\n- Schema validation on load\n\n### Area 2: File Locking\n- lock.ts: withLock() concurrent access\n- Lock timeout behavior\n- Lock release on error\n\n### Area 3: Processed Log Tracking\n- tracking.ts: ProcessedLog class\n- Atomic write verification\n- Malformed line resilience\n\n### Area 4: Cass Wrapper Integration\n- cass.ts: When cass binary available\n- Graceful degradation when unavailable\n- Error code handling\n\n### Area 5: Playbook File Operations\n- Load/save playbook YAML\n- Atomic write safety\n- Concurrent modification handling\n\n### Area 6: Diary File Operations\n- Generate diary → save to disk → reload\n- DiaryLoadError handling\n- Schema migration on load\n\n## Test Isolation\nEach test file gets its own temp directory.\nTests must not depend on global state.","status":"tombstone","priority":1,"issue_type":"epic","created_at":"2025-12-08T01:22:57.793123Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"epic","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-zc1d","depends_on_id":"cass_memory_system-m7np","type":"blocks","created_at":"2026-01-21T09:28:53Z","created_by":"import"}]}
{"id":"cass_memory_system-zdx8","title":"[UX][safety] Fix misleading cm init --force semantics (backup + explicit behavior)","description":"Problem\n- `cm init` advertises `--force` as “Overwrite existing config”, but the current implementation does not actually overwrite existing files (it only ensures missing structure).\n- README recovery steps reference `cm init --force`, so this mismatch breaks recovery and erodes trust.\n\nWhat to do\n- Decide on the intended semantics and implement/document it:\n  Option A (recommended):\n  - `cm init --force` performs a true re-init *with backups*:\n    - Copy existing config/playbook to `.backup.<timestamp>`\n    - Write fresh defaults\n  Option B:\n  - Rename `--force` to `--repair` (or similar) and keep it non-destructive\n  - Provide a new explicit `--reset` / `--reinit` for destructive behavior\n\nNotes\n- This should align with the safety epic: destructive behavior must require explicit intent and create backups.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-13T10:19:27.037146Z","updated_at":"2025-12-13T21:03:55.485699Z","closed_at":"2025-12-13T21:03:55.485699Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"cass_memory_system-zdx8","depends_on_id":"cass_memory_system-jfc5","type":"parent-child","created_at":"2026-01-21T09:28:53Z","created_by":"import"}]}
{"id":"cass_memory_system-zex2","title":"[Critical] LLM Cost Controls - Budget Limits and Local-Only Mode","description":"# LLM Cost Controls\n\n## The Problem\nCurrent plan has LLM calls in: reflect, validate, curate, context, diary extraction.\nWith 10 sessions/day and all features enabled, that's 50+ LLM calls/day.\nAt ~$0.01-0.10 per call, that's $0.50-$5.00/day = $15-150/month.\n\n## The Solution\nMake LLM usage opt-in with clear cost visibility and hard limits.\n\n### Cost-Aware Configuration:\n```typescript\ninterface LLMConfig {\n  provider: \"anthropic\" | \"openai\" | \"ollama\" | \"none\";\n  budget: {\n    dailyLimit: number;  // Max $ per day, default: 0.10\n    monthlyLimit: number;  // Max $ per month, default: 2.00\n    warningThreshold: number;  // Warn at this %, default: 80\n  };\n}\n```\n\n### Local-Only Mode (Default):\n```bash\n# Default behavior - NO LLM CALLS\ncm context \"my task\"  # Uses keyword search, no embeddings\ncm reflect            # Extracts patterns with regex, no LLM\n\n# Opt-in to LLM\ncm reflect --llm      # Uses LLM for better extraction\ncm validate --llm     # Uses LLM for validation\n```\n\n### Cost Transparency:\n```bash\n$ cm reflect --llm\n\nReflecting on 3 sessions...\nExtracted 5 potential rules.\nCost: $0.03 (Daily: $0.08/$0.10, Monthly: $0.45/$2.00)\n\n$ cm usage\nToday:     $0.08 / $0.10 (80%) ⚠️\nThis month: $0.45 / $2.00 (22%)\nAll time:  $1.23\n```\n\n## Why This Is Critical\n- Users are cost-sensitive\n- Surprise bills = angry users = uninstalls\n- Local-first is privacy-friendly AND cost-friendly\n- LLM should enhance, not be required","status":"tombstone","priority":0,"issue_type":"feature","created_at":"2025-12-07T22:08:16.006476Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"feature","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-zgtb","title":"[Testing] Testing architecture and categories","description":"Test categories:\n- Unit tests: Individual functions, pure logic (bun test)\n- Integration tests: cass interaction, file I/O (bun test + fixtures)\n- LLM tests: Mocked LLM responses (bun test + mocks)\n- E2E tests: Full command workflows (shell scripts)\n- Property tests: Edge cases, fuzzing (fast-check)\n\nCoverage target: 80% line, 80% function, 70% branch","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T21:49:24.158242Z","updated_at":"2025-12-13T20:15:17.152185Z","closed_at":"2025-12-13T20:15:17.152185Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-ziej","title":"[Impl] Simplify cm context Output for LLM Consumption","description":"# Simplify cm context Output for LLM Consumption\n\n## Purpose\nThe context command is THE most important command for agents. Its output must be optimized for LLM consumption:\n- Compact (fits in limited context budget)\n- Structured (easy to parse)\n- Actionable (rules have clear IDs for feedback)\n\n## Current Output Analysis\n\nCurrent `cm context` output includes:\n- Rules with scores\n- Anti-patterns\n- Historical session snippets\n- Suggested cass queries\n\n## Proposed Improvements\n\n### 1. Compact Mode (default for --json)\n- Only essential fields: id, content, category, score\n- No verbose metadata\n- No suggested queries (agent can figure this out)\n\n### 2. Size Control\n- Default to top 10 rules (was unlimited?)\n- Add `--compact` flag for even smaller output\n- Add `--verbose` for full metadata\n\n### 3. Better Structure\n```json\n{\n  \"task\": \"...\",\n  \"rules\": [\n    {\"id\": \"b-xyz\", \"content\": \"...\", \"score\": 8.5}\n  ],\n  \"antiPatterns\": [\n    {\"id\": \"b-abc\", \"content\": \"AVOID: ...\"}\n  ],\n  \"sessionCount\": 3,\n  \"note\": \"3 related sessions found. Run cm search for details.\"\n}\n```\n\n### 4. Remove Noise\n- No ASCII progress bars\n- No decorative elements\n- Minimal stderr output in --json mode\n\n## Implementation\n- Review contextCommand in src/commands/context.ts\n- Add compact output mode\n- Ensure consistent JSON structure\n- Add size limits with sensible defaults\n\n## Deliverables\n- [ ] Compact JSON output mode\n- [ ] Size control flags\n- [ ] Documentation of output schema\n- [ ] Tests for output format","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-08T17:47:11.675392Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-zja7","title":"Task: Add pi_agent to known agents (allowlist + detection + icon)","description":"## Problem\n`cass-memory` assumes a small set of known agents by default (e.g. `claude`, `cursor`, `codex`, `aider`).\n\nIf the user has sessions from **PI** (agent name commonly appears as `pi_agent` in cass timelines), the default cross-agent allowlist excludes it. That means:\n- cross-agent enrichment may silently skip PI sessions\n- onboarding/discoverability messaging under-represents a real source of history\n\nAlso, some “agent from path” helpers only recognize `.claude/.cursor/.codex/.aider`, so local diary/session metadata can end up as `unknown` even when PI sessions are present.\n\n## Goal\nTreat PI as a first-class agent name in the same way we treat the other common agents.\n\n## Implementation plan\n\n1. **Defaults / UX**\n   - Add `pi_agent` to the default agent allowlist when enabling cross-agent enrichment:\n     - `src/commands/init.ts` (interactive enable path)\n     - `src/commands/privacy.ts` (fallback allowlist when cass discovery is unavailable)\n\n2. **Detection**\n   - Extend agent-from-path heuristics to recognize PI session paths (if PI stores sessions under a stable directory name):\n     - `src/utils.ts` `extractAgentFromPath()`\n     - `src/diary.ts` `extractSessionMetadata()`\n\n   Notes:\n   - Determine the real PI session path convention first (e.g. `~/.pi/...`, `~/.picode/...`, etc). Don’t guess silently; document the exact matching rule.\n\n3. **Docs**\n   - Update README + quickstart text where we enumerate “other agents” so PI is included (keep the list short; don’t explode it).\n\n## Agent-integration guidance\n- Keep agent names normalized (lowercase, underscores) so allowlist filtering is predictable.\n- Avoid hard-coding dozens of agents; include PI as a common case and allow custom agents via `cm privacy allow`.\n\n## Acceptance criteria\n- [ ] Enabling cross-agent enrichment includes `pi_agent` in the default allowlist.\n- [ ] `cm privacy status --json` shows PI counts when present in cass timeline.\n- [ ] If PI session paths are recognized, diary/session metadata uses `agent: \"pi_agent\"` rather than `unknown`.\n\n## Related\n- The cass repo already maps `pi_agent` to an icon in its timeline view (🟠). This task is about cass-memory defaults and detection.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-15T21:43:01.020535Z","updated_at":"2025-12-15T23:50:44.221555Z","closed_at":"2025-12-15T23:50:44.221555Z","close_reason":"Already implemented: init.ts:119, privacy.ts:149, utils.ts:1689, diary.ts:160, output.ts:88, README:88,121,1436 all have pi_agent support","source_repo":".","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-zk7","title":"[Validator] validateDelta - Full validation pipeline","description":"Implement the validateDelta function - Full validation pipeline orchestrating pre-LLM gate and LLM validation.\n\nSIGNATURE:\n```typescript\nasync function validateDelta(\n  delta: PlaybookDelta,\n  config: Config\n): Promise<{\n  valid: boolean;\n  reason: string;\n  evidence: string[];\n  suggestedState: \"draft\" | \"active\"\n}>\n```\n\nVALIDATION FLOW:\n1. Check if validation should be skipped (non-add deltas, config disabled)\n2. Run shouldSkipValidation() heuristics\n3. Run evidenceCountGate() for pre-LLM filtering\n4. If gate fails, return invalid with reason\n5. If gate passes with overwhelming evidence (5+ success, 0 fail), skip LLM and return valid\n6. Otherwise, run runLLMValidation() for deeper analysis\n7. Return result with evidence citations and suggested state\n\nDECISION TREE:\n- Delta type != \"add\" → Pass through (valid: true)\n- evidenceCountGate().passed === false → Reject\n- successCount >= 5 && failureCount === 0 → Accept without LLM\n- Otherwise → Run LLM validation\n\nRETURN VALUE:\n```typescript\n{\n  valid: boolean,              // Whether rule is valid\n  reason: string,              // Explanation of decision\n  evidence: string[],          // Citations from cass history\n  suggestedState: \"draft\" | \"active\"  // Recommended lifecycle state\n}\n```\n\nWHY THIS MATTERS:\n- Central orchestration point for validation logic\n- Optimizes costs by avoiding LLM when evidence is clear\n- Provides audit trail with evidence and reasoning\n- Ensures scientific rigor in rule acceptance\n\nDEPENDENCIES:\n- shouldSkipValidation() - Skip validation heuristics\n- evidenceCountGate() - Pre-LLM evidence filter\n- runLLMValidation() - Deep LLM-based validation\n- PlaybookDelta type\n\nLOCATION:\n- src/validator/validate-delta.ts","status":"tombstone","priority":3,"issue_type":"task","created_at":"2025-12-07T21:44:52.189542Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-zs4","title":"[Types] PlaybookBullet Schema Part 4 - Event-Level Feedback Tracking","description":"## Overview\nDefine event-level feedback tracking with timestamps for PlaybookBullet. This is the KEY INNOVATION enabling confidence decay - storing individual feedback events rather than simple counters.\n\n## Why Event-Level Tracking?\n\nTraditional Approach (Counters): { helpfulCount: 5, harmfulCount: 1 }\nProblem: No temporal information - can't tell if feedback is recent or ancient\n\nEvent-Level Approach (This System): { helpfulEvents: [{ timestamp: '2025-12-07T14:00:00Z', sessionPath: '/path/to/session1' }, { timestamp: '2025-12-06T10:00:00Z', sessionPath: '/path/to/session2' }], harmfulEvents: [{ timestamp: '2025-11-15T08:00:00Z', reason: 'outdated' }] }\nBenefit: Can calculate time-weighted confidence with decay\n\n## Fields\n\n### helpfulEvents: FeedbackEvent[]\n- Type: Array of FeedbackEvent objects\n- Purpose: Individual instances of helpful feedback\n- Each Event Contains: timestamp (when), sessionPath (which session), context (why helpful)\n- Usage: Calculate decayed helpful score / Identify trending rules (recent helpful events) / Analyze which sessions benefit from rule\n- Example: [{ timestamp: '2025-12-07T14:30:00Z', sessionPath: '/cass/2025-12-07-auth-fix.jsonl', context: 'Rule prevented authentication bypass' }, { timestamp: '2025-12-05T09:15:00Z', sessionPath: '/cass/2025-12-05-api-design.jsonl', context: 'Rule guided proper JWT validation' }]\n\n### harmfulEvents: FeedbackEvent[]\n- Type: Array of FeedbackEvent objects\n- Purpose: Individual instances of harmful feedback\n- Each Event Contains: timestamp (when), sessionPath (which session), reason (why harmful - HarmfulReason enum), context (explanation)\n- Usage: Calculate decayed harmful score / Detect deteriorating rules (recent harmful events) / Analyze failure patterns / Inform auto-pruning decisions\n- Example: [{ timestamp: '2025-11-20T11:00:00Z', sessionPath: '/cass/2025-11-20-refactor.jsonl', reason: 'outdated', context: 'AuthService was refactored to AuthManager' }]\n\n### helpfulCount: number\n- Type: Derived/aggregate field\n- Purpose: Quick access to total helpful feedback\n- Calculation: helpfulEvents.length\n- Usage: Display, quick filtering, promotion thresholds\n- NOT used for: Confidence scoring (use events instead)\n\n### harmfulCount: number\n- Type: Derived/aggregate field\n- Purpose: Quick access to total harmful feedback\n- Calculation: harmfulEvents.length\n- Usage: Display, pruning thresholds\n- NOT used for: Confidence scoring (use events instead)\n\n## Additional Tracking Fields\n\n### lastValidatedAt: string | undefined\n- Purpose: When rule was last scientifically validated by cass\n- Format: ISO 8601 timestamp\n- Usage: Determine if rule needs revalidation / Calculate staleness (days since validation) / Trigger periodic revalidation\n- Example: '2025-11-01T10:00:00Z'\n- Update Trigger: After running 'cass memory validate <bulletId>'\n\n### confidenceDecayHalfLifeDays: number\n- Purpose: Per-bullet customizable decay rate\n- Default: Inherited from config.defaultDecayHalfLife (90 days)\n- Range: 1-365 days\n- Usage: Calculate decay factor λ = ln(2) / halfLifeDays\n- Customization: 30 days (fast-moving tech), 90 days (default), 180 days (stable patterns), 365 days (timeless principles)\n\n## Confidence Decay Algorithm\n\nEffective Helpful Score:\nfunction calculateEffectiveHelpful(bullet) {\n  const now = Date.now()\n  const lambda = Math.ln(2) / bullet.confidenceDecayHalfLifeDays\n  return bullet.helpfulEvents.reduce((sum, event) => {\n    const ageInDays = (now - new Date(event.timestamp).getTime()) / (1000 * 60 * 60 * 24)\n    const decayFactor = Math.exp(-lambda * ageInDays)\n    return sum + decayFactor  // Each event worth 1.0 when fresh, decays over time\n  }, 0)\n}\n\nEffective Harmful Score: Same algorithm applied to harmfulEvents\n\nNet Confidence Score:\nfunction calculateConfidence(bullet) {\n  const effectiveHelpful = calculateEffectiveHelpful(bullet)\n  const effectiveHarmful = calculateEffectiveHarmful(bullet)\n  return effectiveHelpful - (effectiveHarmful * 2)  // Harmful has 2x weight\n}\n\n## Example Scenarios\n\nRecent Activity (High Confidence): helpfulEvents from today/yesterday/2 days ago, harmfulEvents empty -> Effective score ≈ 2.95 (minimal decay)\n\nOld Activity (Low Confidence): helpfulEvents from 6-8 months ago, harmfulEvents empty -> Effective score ≈ 0.15 (heavy decay at 90-day half-life)\n\nMixed Recent Feedback (Medium Confidence): 2 helpful from 1-2 weeks ago, 1 harmful from 10 days ago -> Effective score ≈ -2.0 (negative, consider deprecation)\n\n## Integration Points\n\nCommands Using This Data:\n- context: Rank bullets by effective confidence score\n- stats: Show effective scores, not just counts\n- validate: Update lastValidatedAt timestamp\n- helpful/harmful: Append to appropriate events array\n- audit: Detect rules with declining confidence\n- prune: Remove rules with low effective score\n\nDisplay Formats:\n- Show effective score alongside counts\n- Visualize decay curve in stats\n- Highlight recently active rules\n- Flag stale rules (old lastValidatedAt)\n\n## Acceptance Criteria\n- helpfulEvents array field (FeedbackEvent[])\n- harmfulEvents array field (FeedbackEvent[])\n- helpfulCount derived field\n- harmfulCount derived field\n- lastValidatedAt optional timestamp\n- confidenceDecayHalfLifeDays number field with default\n- Decay calculation functions implemented\n- Event appending utility functions\n- Examples for all scenarios\n- JSDoc explaining decay algorithm","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-07T21:45:00.589588Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-zs47","title":"[CLI:playbook] list - List all bullets","description":"List playbook bullets with optional filters.\n\nCommand signature:\n```bash\ncass-memory playbook list [options]\n\nOptions:\n  --all              Include deprecated bullets\n  --category CAT     Filter by category\n  --scope SCOPE      Filter by scope (global/workspace)\n  --json             Output as JSON\n```\n\nImplementation:\n1. Load playbook from memory directory\n2. Apply filters:\n   - By default: only active bullets (exclude deprecated)\n   - If --all: include deprecated\n   - If --category: filter by category\n   - If --scope: filter by global or workspace-scoped\n   \n3. Format output:\n   - Default: table format\n   - If --json: array of bullet objects\n\nTable format:\n```\nID          CATEGORY        MATURITY    SCORE   CONTENT\nb-abc123    best-practice   proven      0.95    Always run tests before committing\nb-def456    tools           accepted    0.78    Use httpx instead of requests\nb-ghi789    workflow        candidate   0.45    Prefer async/await over callbacks\n...\n\nTotal: 42 bullets (3 proven, 15 accepted, 24 candidates)\n```\n\nSorting:\n- Default: by score (descending)\n- Can add --sort option later (by category, maturity, created, etc)\n\nColumn widths:\n- ID: 12 chars\n- Category: 20 chars\n- Maturity: 12 chars\n- Score: 8 chars\n- Content: remaining width (truncate with ellipsis if needed)\n\nThis provides quick overview of playbook state.","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T21:51:45.453109Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"cass_memory_system-zvr1","title":"[Critical] Rename toxic to blocked - Better Terminology","description":"$(cat /tmp/fix_zvr1.txt)","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-07T22:14:06.323937Z","updated_at":"2026-01-10T23:23:52.103605542Z","closed_at":"2026-01-10T23:23:52.103605542Z","source_repo":".","deleted_at":"2026-01-10T23:23:52.103605542Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task","compaction_level":0,"original_size":0}
